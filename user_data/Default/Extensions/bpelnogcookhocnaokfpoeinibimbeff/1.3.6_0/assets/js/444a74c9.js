(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[1477,3670],{52326:function(s){s.exports=function(){"use strict";return function(s,e,t){e.prototype.isToday=function(){var s="YYYY-MM-DD",e=t();return this.format(s)===e.format(s)}}}()},43670:(s,e,t)=>{"use strict";t.d(e,{B:()=>a});var r=t(74003),i=t(97432),o=t(86114);const a=new class{hasPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["system.cpu","system.memory"]},(e=>{s(e)}));s(!1)}));reqPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["system.cpu","system.memory"]},(e=>{chrome.runtime.lastError?s(!1):s(e)}))}));hasBookmarksPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["bookmarks"]},(e=>{s(e)})):s(e)}));s(!1)}));reqBookmarksPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,i.useBookmarksStore)().setFavicon(!0),chrome.permissions.request({permissions:["bookmarks"]},(e=>{s(e)}))):s(!1):s(e)}))}));hasHistoryPermission=async()=>new Promise((s=>{if(!r.Pl)return chrome.permissions.contains({permissions:["history","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["history"]},(e=>{s(e)})):s(e)}));s(!1)}));reqHistoryPermission=async()=>new Promise((s=>{r.Pl?s(!1):chrome.permissions.request({permissions:["history","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,o.useHistoryRecordStore)().setFavicon(!0),chrome.permissions.request({permissions:["history"]},(e=>{s(e)}))):s(!1):s(e)}))}));getCpuInfo=()=>chrome.system.cpu.getInfo();getStorageInfo=()=>chrome.system.storage.getInfo();getMemoryInfo=()=>chrome.system.memory.getInfo()}},97432:(s,e,t)=>{"use strict";t.r(e),t.d(e,{useBookmarksStore:()=>l});var r=t(43670),i=t(84522),o=t(10435),a=t(17319),n=t(87322);const c=async(s,e)=>{try{await chrome.bookmarks.move(s,e)}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}},m=async s=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await(async s=>{try{await chrome.bookmarks.remove(s)}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s)}))),await(0,n.startBrowserListening)()};var h=t(81220);const l=(0,o.Q_)(i.BU.bookmarks,{syncStorage:{watch:["isFirst","bookmarks","flattenBookmarks","folderList","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,bookmarks:[],flattenBookmarks:[],folderList:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setBookmarks(s){this.bookmarks=s},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await r.B.hasBookmarksPermission(),!this.hasPermission)return;const[s,e,t]=await(0,h.jl)();this.bookmarks=s,this.flattenBookmarks=e,this.folderList=t},setFaviconById(s,e){this.bookmarks=[...(0,h.Ob)(this.bookmarks,e,{favicon:s})],this.flattenBookmarks=(0,h.Qj)(this.bookmarks),this.folderList=(0,h.Ln)(this.flattenBookmarks)},async reqPermission(){return this.hasPermission=await r.B.reqBookmarksPermission(),this.hasPermission},async batchMoveBookmark(s,e){await(async(s,e)=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await c(s,e)}))),await(0,n.startBrowserListening)()})(s,e),this.getAllData()},async batchRemoveBookmark(s){await m(s),this.getAllData()},async updateBookmark(s,e){await(async(s,e)=>{try{await(0,n.stopBrowserListening)(),await chrome.bookmarks.update(s,e),await(0,n.startBrowserListening)()}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s,{title:e.title,url:e.url}),e.parentId&&await c(s,{parentId:e.parentId}),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})},87322:(s,e,t)=>{"use strict";t.r(e),t.d(e,{startBrowserListening:()=>m,stopBrowserListening:()=>h});var r=t(43670),i=t(97432);const o=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},a=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},n=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},c=(s,e)=>{(0,i.useBookmarksStore)().getAllData()},m=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.addListener(o),chrome.bookmarks.onChanged.addListener(a),chrome.bookmarks.onRemoved.addListener(n),chrome.bookmarks.onMoved.addListener(c))},h=async()=>{await r.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.removeListener(o),chrome.bookmarks.onChanged.removeListener(a),chrome.bookmarks.onRemoved.removeListener(n))}},81220:(s,e,t)=>{"use strict";t.d(e,{GR:()=>m,Ln:()=>a,OK:()=>n,Ob:()=>c,Qj:()=>o,jl:()=>i});var r=t(45844);const i=async()=>{const s=await chrome.bookmarks.getTree(),e=h(s);return[s,e,a(e)]},o=s=>h(s),a=s=>s.filter((s=>{var e;return"0"!=s.id&&s.children&&(null===(e=m(s))||void 0===e?void 0:e.length)>0})),n=s=>s.filter((s=>"0"!=s.id&&s.children)),c=(s,e,t)=>{const i=(0,r.Z)(s);return i.forEach(((s,e)=>t=>{const r=t=>{t.id===s?Object.assign(t,e):t.children&&t.children.forEach(r)};return r(t)})(e,t)),i},m=s=>{var e;return s?null===(e=s.children)||void 0===e?void 0:e.filter((s=>s.url)):[]};function h(s,e){return s.reduce(((s,t)=>(s.push({id:t.id,parentId:(null==e?void 0:e.id)||"",title:t.title,url:t.url,children:t.children,index:t.index}),t.children&&s.push(...h(t.children,t)),s)),[])}},86114:(s,e,t)=>{"use strict";t.r(e),t.d(e,{useHistoryRecordStore:()=>d});var r=t(43670),i=t(84522),o=t(10435),a=t(17319),n=t(80661),c=t.n(n),m=t(52326),h=t.n(m);c().extend(h());const l=async s=>{await Promise.all(s.map((async s=>{await(async s=>{try{await chrome.history.deleteUrl({url:s})}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s)})))},u=async()=>await async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return await chrome.history.search({text:s,maxResults:e,startTime:0})}(),d=(0,o.Q_)(i.BU.historyRecord,{syncStorage:{watch:["isFirst","historyRecord","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,historyRecord:[],historyRecordProcessed:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setHistoryRecord(s){this.historyRecord=s,this.historyRecordProcessed=(s=>{if(0===s.length)return[];let e="";const t=[];for(const r of s){const s=new Date(r.lastVisitTime||""),i=c()(s),o=(i.isToday()?"今天 - ":"")+(i.add(1,"day").isToday()?"昨天 - ":"")+i.format("YYYY-MM-DD")+", "+i.format("dddd");if(o!==e){e=o;const s={url:"data:text/plain;charset=utf-8,"+e,title:e,id:o,isDate:!0};t.push(s)}t.push(r)}return t})(s)},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await r.B.hasHistoryPermission(),!this.hasPermission)return;const s=await u();this.setHistoryRecord(s)},async reqPermission(){return this.hasPermission=await r.B.reqHistoryPermission(),this.hasPermission},async batchRemoveHistoryRecord(s){await l(s),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})},12282:(s,e,t)=>{"use strict";t.d(e,{VP:()=>a,qf:()=>i,yg:()=>c});var r=t(6325);const i=30,o=-10,a=(s,e,t)=>{n(s,e,t)},n=function(s,e,t){const a=[...t].reverse(),n=s.width,c=s.height,m=s.clientWidth;e.clearRect(0,0,n,c);const h=n- -20,l=c-20;if(0===a.length)return;s.style.transition="none",s.style.transform=`translateX(${m/i}px)`;const u=e.createLinearGradient(0,0,0,c);u.addColorStop(0,"rgba(219, 63, 59, 1)"),u.addColorStop(.5,"rgba(145, 95, 252, 1)"),u.addColorStop(1,"rgba(74, 207, 255, 1)"),e.strokeStyle=u,e.lineWidth=2;const d=l/100,y=h/i,k=.1;e.beginPath(),a.forEach(((s,t)=>{const i=h-(0,r.Z)((t-1)*y)+o,n=l-(0,r.Z)(a[t-1]*d)+10,c=h-(0,r.Z)((t-2)*y)+o,m=l-(0,r.Z)(a[t-2]*d)+10,u=h-(0,r.Z)(t*y)+o,p=l-(0,r.Z)(s*d)+10,g=h-(0,r.Z)((t+1)*y)+o,f=l-(0,r.Z)(a[t+1]*d)+10;let v=i+(u-c)*k,w=n+(p-m)*k,P=u-(g-i)*k,b=p-(f-n)*k;0!==t?(1===t?(v=i+(u-0)*k,w=n+(p-200)*k):t===a.length-1&&(P=u-(u-i)*k,b=p-(p-n)*k),e.bezierCurveTo(v,w,P,b,u,p)):e.lineTo(u,p)})),e.stroke(),requestAnimationFrame((()=>{s.style.transition="transform 0.8s",s.style.transform="none"}))};const c=new class{setPrevCPU(s){this.prevCPUTime=s}getPrevCPU(){return this.prevCPUTime}getUsedList(s){let e;const t=[];return s.processors.forEach(((s,r)=>{const i=s.usage;if(this.getPrevCPU()){const s=this.getPrevCPU().processors[r].usage;e=Math.floor((i.kernel+i.user-s.kernel-s.user)/(i.total-s.total)*100)}else e=Math.floor((i.kernel+i.user)/i.total*100);t.push(e)})),this.setPrevCPU(s),t}}},61477:(s,e,t)=>{"use strict";t.r(e),t.d(e,{useSystemStore:()=>l});var r=t(43670),i=t(6325),o=t(34906),a=t(70642),n=t(10435),c=t(12282);let m=null,h=null;const l=(0,n.Q_)("store-system",{state:()=>({hasPermission:null,cpu:{name:"",shortName:"",usedPercent:0},cpuHistory:[],cpuInterval:1e3,memory:{available:0,total:0,usedPercent:0}}),actions:{async getMemory(){const s=await r.B.getMemoryInfo();this.memory={available:(0,i.Z)(s.availableCapacity/1024/1024/1024,2),total:(0,i.Z)(s.capacity/1024/1024/1024),usedPercent:(0,o.Z)((0,i.Z)((s.capacity-s.availableCapacity)/s.capacity*100,1),0,100)}},async getCpu(){const s=await r.B.getCpuInfo(),e=c.yg.getUsedList(s),t=(0,o.Z)((0,i.Z)((0,a.Z)(e),1),1,100),n=t>10?(0,i.Z)(t):t,m=s.modelName.match(/([0-9\.]*)ghz/gi);let h="";m&&(h=m[0]),this.cpu={name:s.modelName,shortName:h,usedPercent:n},this.cpuHistory.push(n),this.cpuHistory.length>c.qf?this.cpuHistory.shift():this.cpuHistory.length>4?this.cpuInterval=2e3:this.cpuHistory.length>8&&(this.cpuInterval=3e3)},getIntervalCpu(){m&&(window.clearTimeout(m),m=null),this.getCpu(),m=window.setTimeout((()=>{this.getIntervalCpu()}),this.cpuInterval)},getIntervalMemory(){h&&(window.clearTimeout(h),h=null),this.getMemory(),h=window.setTimeout((()=>{this.getIntervalMemory()}),3500)},async getAllData(){this.hasPermission=await r.B.hasPermission(),this.hasPermission&&(this.getIntervalCpu(),this.getIntervalMemory())},async reqPermission(){return this.hasPermission=await r.B.reqPermission(),this.hasPermission}}})}}]);