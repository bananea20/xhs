(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[4990,3670],{52326:function(s){s.exports=function(){"use strict";return function(s,e,r){e.prototype.isToday=function(){var s="YYYY-MM-DD",e=r();return this.format(s)===e.format(s)}}}()},43670:(s,e,r)=>{"use strict";r.d(e,{B:()=>a});var i=r(74003),t=r(97432),o=r(86114);const a=new class{hasPermission=async()=>new Promise((s=>{if(!i.Pl)return chrome.permissions.contains({permissions:["system.cpu","system.memory"]},(e=>{s(e)}));s(!1)}));reqPermission=async()=>new Promise((s=>{i.Pl?s(!1):chrome.permissions.request({permissions:["system.cpu","system.memory"]},(e=>{chrome.runtime.lastError?s(!1):s(e)}))}));hasBookmarksPermission=async()=>new Promise((s=>{if(!i.Pl)return chrome.permissions.contains({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["bookmarks"]},(e=>{s(e)})):s(e)}));s(!1)}));reqBookmarksPermission=async()=>new Promise((s=>{i.Pl?s(!1):chrome.permissions.request({permissions:["bookmarks","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,t.useBookmarksStore)().setFavicon(!0),chrome.permissions.request({permissions:["bookmarks"]},(e=>{s(e)}))):s(!1):s(e)}))}));hasHistoryPermission=async()=>new Promise((s=>{if(!i.Pl)return chrome.permissions.contains({permissions:["history","favicon"]},(e=>{chrome.runtime.lastError?chrome.permissions.contains({permissions:["history"]},(e=>{s(e)})):s(e)}));s(!1)}));reqHistoryPermission=async()=>new Promise((s=>{i.Pl?s(!1):chrome.permissions.request({permissions:["history","favicon"]},(e=>{chrome.runtime.lastError?"'favicon' is not a recognized permission."==chrome.runtime.lastError.message?((0,o.useHistoryRecordStore)().setFavicon(!0),chrome.permissions.request({permissions:["history"]},(e=>{s(e)}))):s(!1):s(e)}))}));getCpuInfo=()=>chrome.system.cpu.getInfo();getStorageInfo=()=>chrome.system.storage.getInfo();getMemoryInfo=()=>chrome.system.memory.getInfo()}},97432:(s,e,r)=>{"use strict";r.r(e),r.d(e,{useBookmarksStore:()=>l});var i=r(43670),t=r(84522),o=r(10435),a=r(17319),n=r(87322);const m=async(s,e)=>{try{await chrome.bookmarks.move(s,e)}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}},c=async s=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await(async s=>{try{await chrome.bookmarks.remove(s)}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s)}))),await(0,n.startBrowserListening)()};var h=r(81220);const l=(0,o.Q_)(t.BU.bookmarks,{syncStorage:{watch:["isFirst","bookmarks","flattenBookmarks","folderList","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,bookmarks:[],flattenBookmarks:[],folderList:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setBookmarks(s){this.bookmarks=s},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await i.B.hasBookmarksPermission(),!this.hasPermission)return;const[s,e,r]=await(0,h.jl)();this.bookmarks=s,this.flattenBookmarks=e,this.folderList=r},setFaviconById(s,e){this.bookmarks=[...(0,h.Ob)(this.bookmarks,e,{favicon:s})],this.flattenBookmarks=(0,h.Qj)(this.bookmarks),this.folderList=(0,h.Ln)(this.flattenBookmarks)},async reqPermission(){return this.hasPermission=await i.B.reqBookmarksPermission(),this.hasPermission},async batchMoveBookmark(s,e){await(async(s,e)=>{await(0,n.stopBrowserListening)(),await Promise.all(s.map((async s=>{await m(s,e)}))),await(0,n.startBrowserListening)()})(s,e),this.getAllData()},async batchRemoveBookmark(s){await c(s),this.getAllData()},async updateBookmark(s,e){await(async(s,e)=>{try{await(0,n.stopBrowserListening)(),await chrome.bookmarks.update(s,e),await(0,n.startBrowserListening)()}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s,{title:e.title,url:e.url}),e.parentId&&await m(s,{parentId:e.parentId}),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})},87322:(s,e,r)=>{"use strict";r.r(e),r.d(e,{startBrowserListening:()=>c,stopBrowserListening:()=>h});var i=r(43670),t=r(97432);const o=(s,e)=>{(0,t.useBookmarksStore)().getAllData()},a=(s,e)=>{(0,t.useBookmarksStore)().getAllData()},n=(s,e)=>{(0,t.useBookmarksStore)().getAllData()},m=(s,e)=>{(0,t.useBookmarksStore)().getAllData()},c=async()=>{await i.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.addListener(o),chrome.bookmarks.onChanged.addListener(a),chrome.bookmarks.onRemoved.addListener(n),chrome.bookmarks.onMoved.addListener(m))},h=async()=>{await i.B.hasBookmarksPermission()&&(chrome.bookmarks.onCreated.removeListener(o),chrome.bookmarks.onChanged.removeListener(a),chrome.bookmarks.onRemoved.removeListener(n))}},81220:(s,e,r)=>{"use strict";r.d(e,{GR:()=>c,Ln:()=>a,OK:()=>n,Ob:()=>m,Qj:()=>o,jl:()=>t});var i=r(45844);const t=async()=>{const s=await chrome.bookmarks.getTree(),e=h(s);return[s,e,a(e)]},o=s=>h(s),a=s=>s.filter((s=>{var e;return"0"!=s.id&&s.children&&(null===(e=c(s))||void 0===e?void 0:e.length)>0})),n=s=>s.filter((s=>"0"!=s.id&&s.children)),m=(s,e,r)=>{const t=(0,i.Z)(s);return t.forEach(((s,e)=>r=>{const i=r=>{r.id===s?Object.assign(r,e):r.children&&r.children.forEach(i)};return i(r)})(e,r)),t},c=s=>{var e;return s?null===(e=s.children)||void 0===e?void 0:e.filter((s=>s.url)):[]};function h(s,e){return s.reduce(((s,r)=>(s.push({id:r.id,parentId:(null==e?void 0:e.id)||"",title:r.title,url:r.url,children:r.children,index:r.index}),r.children&&s.push(...h(r.children,r)),s)),[])}},34990:(s,e,r)=>{"use strict";r.r(e),r.d(e,{startBrowserListening:()=>n,stopBrowserListening:()=>m});var i=r(43670),t=r(86114);const o=()=>{(0,t.useHistoryRecordStore)().getAllData()},a=()=>{(0,t.useHistoryRecordStore)().getAllData()},n=async()=>{await i.B.hasHistoryPermission()&&(chrome.history.onVisited.addListener(o),chrome.history.onVisitRemoved.addListener(a))},m=async()=>{await i.B.hasHistoryPermission()&&(chrome.history.onVisited.removeListener(o),chrome.history.onVisitRemoved.removeListener(a))}},86114:(s,e,r)=>{"use strict";r.r(e),r.d(e,{useHistoryRecordStore:()=>k});var i=r(43670),t=r(84522),o=r(10435),a=r(17319),n=r(80661),m=r.n(n),c=r(52326),h=r.n(c);m().extend(h());const l=async s=>{await Promise.all(s.map((async s=>{await(async s=>{try{await chrome.history.deleteUrl({url:s})}catch(s){s&&a.R.fail({message:"操作失败！",duration:1500})}})(s)})))},d=async()=>await async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return await chrome.history.search({text:s,maxResults:e,startTime:0})}(),k=(0,o.Q_)(t.BU.historyRecord,{syncStorage:{watch:["isFirst","historyRecord","needInfinityFavicon"]},state:()=>({isFullScreen:!1,isFirst:!0,modalShow:!1,hasPermission:!1,historyRecord:[],historyRecordProcessed:[],needInfinityFavicon:!1}),actions:{setModal(s){this.modalShow=s},setHistoryRecord(s){this.historyRecord=s,this.historyRecordProcessed=(s=>{if(0===s.length)return[];let e="";const r=[];for(const i of s){const s=new Date(i.lastVisitTime||""),t=m()(s),o=(t.isToday()?"今天 - ":"")+(t.add(1,"day").isToday()?"昨天 - ":"")+t.format("YYYY-MM-DD")+", "+t.format("dddd");if(o!==e){e=o;const s={url:"data:text/plain;charset=utf-8,"+e,title:e,id:o,isDate:!0};r.push(s)}r.push(i)}return r})(s)},setIsFirst(s){this.isFirst=s},setIsFullScreen(s){this.isFullScreen=s},async getAllData(){if(this.hasPermission=await i.B.hasHistoryPermission(),!this.hasPermission)return;const s=await d();this.setHistoryRecord(s)},async reqPermission(){return this.hasPermission=await i.B.reqHistoryPermission(),this.hasPermission},async batchRemoveHistoryRecord(s){await l(s),this.getAllData()},setFavicon(s){this.needInfinityFavicon=s}}})}}]);