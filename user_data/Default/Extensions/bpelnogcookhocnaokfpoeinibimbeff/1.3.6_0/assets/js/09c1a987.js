"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[8491],{24182:(e,l,t)=>{t.d(l,{o:()=>a});const a=(0,t(10435).Q_)("wallpaper-settings-main",{state:()=>({curTab:0,showMoreSetting:!1,moreSettingMenu:"auto-replace"}),actions:{setCurTab(e){this.curTab=e},setMoreSettingShow(e){this.showMoreSetting=e},setMenu(e){this.moreSettingMenu=e}}})},58491:(e,l,t)=>{t.r(l),t.d(l,{default:()=>z});var a=t(35427),o=t(79282),i=t(57268),n=t(94209),s=t(68398),r=t(3627),u=t(63477),p=t(95329),c=t(96643),v=t(64845),d=t(17319),f=t(24182),g=t(29445),m=t(10435),x=t(35274);const b={class:"h-full px-[70px] py-[40px] mb:px-[20px] mb:py-[30px]"},w=(0,i._)("i",{class:"iconfont icon-return_icon text-[18px]"},null,-1),h={class:"ml-[12px] font-ali-65 text-[16px]"},y={class:"mt-[24px] w-full font-ali-65 text-[14px] leading-[20px] text-color-t2"},_={class:"relative mt-[16px] h-[202px] w-full overflow-hidden rounded-[6px] bg-color-m2 bg-opacity-5"},k=(0,i._)("i",{class:"iconfont icon-bendishangchuan mt-[60px] text-[28px] text-color-t1"},null,-1),C={class:"mt-[4px] font-ali-55 text-[14px] leading-[20px] text-color-t2"},D={class:"mt-[4px] font-ali-55 text-[12px] leading-[17px] text-color-t3"},S={key:0,class:"iconfont icon-loading_small mt-[14px] animate-spin text-[20px] text-color-t3"},T=["src"],L=["src"],M=["placeholder"],R={class:"flex justify-center pt-[24px]"},z=(0,i.aZ)({__name:"wallpaper-setting-upload",setup(e){const l=(0,f.o)(),t=(0,r.MX)(),z=(0,p.useUserStore)(),H=(0,g.iH)(!0),B=(0,g.iH)(!1),E=(0,g.iH)(!1),U=(0,g.iH)(),W=(0,g.iH)(!1),j=(0,g.iH)(""),F=(0,g.iH)(!1),Y="mp4|webm|ogg|mp3|wav|flac|aac|flv|avi|rmvb|rm|wmv|mov|mkv|mpg|mpeg|3gp|dat|vob|m4v|f4v",{customWallpaperUrl:q}=(0,m.Jk)(t);function V(e){const l=e.split(".").pop();F.value=!!l&&Y.split("|").includes(l)}q.value&&(j.value=q.value,H.value=!1,W.value=!1,V(j.value));const Z=async()=>{if(!E.value)if(z.isLogin){const e="image/*,video/*",l=await(0,u.Y)(e,"readAsDataURL",!1);l.type&&l.type.includes("video")?function(e){if(e.size>104857600)return void d.R.fail({message:"文件大小超出限制"});const l="custom-local-video";(0,x.EM)(l);const a=new Blob([e],{type:e.type}),o=(0,u.kb)("custom-");t.setVideoBg({poster:"",src:"",id:o,origin:"custom-local"}),t.setCustomWallpaper(""),(0,x.DF)(l,a),d.R.warn({message:"视频已保存到本地",duration:2e3})}(l):$(l)}else d.R.warn({message:"请登录后再上传图片",btnText:"去登录",onBtnClick:()=>{z.showLogin(!1)}})};async function $(e){if(!z.isLogin)return void d.R.warn({message:"请登录后再上传图片",btnText:"去登录",onBtnClick:()=>{z.showLogin(!1)}});if(e.size>20971520)return void d.R.fail({message:"文件大小超出限制"});E.value=!0;const l=z.user.id,t=e.name.split(".").pop(),[a,o]=await(0,c.E)("user-wallpaper",e,l,`${l}.${t}`);E.value=!1,a?d.R.fail({message:"文件上传失败"}):(j.value=o,V(o),H.value=!1,W.value=!1)}function A(){l.setMoreSettingShow(!1)}function I(){j.value="",W.value=!1,H.value=!0}function J(){if(!H.value&&!W.value&&j.value){t.setCustomWallpaper(j.value);const e=j.value.split(".").pop();e&&Y.split("|").includes(e)?async function(){B.value=!0,t.setVideoBg({poster:"",src:q.value,id:"",origin:"custom-input"}),setTimeout((()=>{B.value=!1}),1e3)}():async function(){B.value=!0,(0,v.Y)().addTips({category:"wallpaperLoad",type:"loading"});const[e]=await(0,u.pt)((0,u.Em)(q.value,"wallpaper"),!0);e?(0,v.Y)().addTips({category:"wallpaperLoad",type:"fail"}):((0,v.Y)().removeTips({category:"wallpaperLoad"}),t.setImageBg(q.value,""));B.value=!1}()}}async function Q(e){const l=e.target.value;if(!l)return H.value=!0,void(W.value=!1);V(l);const t=function(e){return/(http(s)?:\/\/.+\.(?:jpg|jpeg|png|gif|bmp|webp|svg|tiff|ico|flif|heif|bpg|mp4|webm|ogg|mp3|wav|flac|aac|flv|avi|rmvb|rm|wmv|mov|mkv|mpg|mpeg|3gp|dat|vob|m4v|f4v))/.test(e)}(l);if(!t)return W.value=!0,void(H.value=!0);try{await fetch(l,{mode:"no-cors"}),W.value=!1,H.value=!1}catch(e){W.value=!0,H.value=!0}}return(0,i.bv)((()=>{var e,l;null===(e=U.value)||void 0===e||e.addEventListener("drop",(e=>{var l;if(E.value)return;e.preventDefault();const t=null===(l=e.dataTransfer)||void 0===l?void 0:l.files[0];null!=t&&t.type&&null!=t&&t.type.includes("image")?$(t):d.R.warn({message:"请上传图片文件"})})),null===(l=U.value)||void 0===l||l.addEventListener("dragover",(e=>{e.preventDefault()}))})),(e,l)=>{const t=o.Z,r=a.Z;return(0,i.wg)(),(0,i.iD)("div",b,[(0,i._)("div",{class:"inline-flex cursor-pointer items-center text-color-t1",onClick:A},[w,(0,i._)("span",h,(0,n.toDisplayString)("自定义壁纸"),1)]),(0,i._)("div",y,(0,n.toDisplayString)("您可以上传本地图片或视频文件，也可以填写图片或视频链接来自定义壁纸。注意: 上传视频仅存储到本地。"),1),(0,i._)("div",_,[(0,i._)("div",{ref_key:"uploadRef",ref:U,class:"group relative flex h-full w-full flex-col items-center overflow-hidden rounded-[6px] border border-solid border-color-m2 border-opacity-5 outline-none",onClick:Z},[(0,i._)("div",{class:(0,n.normalizeClass)(["absolute inset-0 z-[1] flex h-full w-full cursor-pointer flex-col items-center transition-[display]",[!j.value||H.value||W.value?"":" bg-color-m1 bg-opacity-60 group-hover:flex"]]),tabindex:"-1"},[k,(0,i._)("p",C,(0,n.toDisplayString)("点击或拖动文件到此区域上传"),1),(0,i._)("p",D,(0,n.toDisplayString)("支持 jpg、png、svg、gif、mp4 等格式"),1),E.value?((0,i.wg)(),(0,i.iD)("i",S)):(0,i.kq)("",!0)],2),H.value||W.value||!j.value||F.value?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("img",{key:0,src:j.value,class:"h-full w-full",alt:""},null,8,T)),!H.value&&!W.value&&j.value&&F.value?((0,i.wg)(),(0,i.iD)("video",{key:1,src:j.value,class:"h-full w-full"},null,8,L)):(0,i.kq)("",!0)],512)]),(0,i._)("div",{class:(0,n.normalizeClass)(["relative mt-[16px] flex h-[44px] w-full items-center rounded-[8px] border border-solid bg-color-m2 bg-opacity-5 pl-[12px]",[W.value?"border-[#FF4D4F] border-opacity-10 bg-[#DC4538]":"border-color-m2 border-opacity-0 bg-color-m2"]])},[(0,i._)("i",{class:(0,n.normalizeClass)(["iconfont icon-link_icon text-[18px]",[W.value?"text-color-red":"text-color-t3"]])},null,2),(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>j.value=e),type:"text",autocomplete:"off",class:(0,n.normalizeClass)(["h-full flex-1 text-ellipsis bg-color-none pl-[12px] pr-[36px] text-[14px] placeholder:text-[14px] placeholder:text-color-t3",[W.value?"text-color-red":"text-color-t1"]]),placeholder:"图片或视频链接",maxlength:"500",onChange:Q},null,42,M),[[s.vModelText,j.value]]),(0,i.Wm)(t,{show:!!j.value,ani:"scale",class:"absolute bottom-0 right-0 h-[42px] w-[40px]"},{default:(0,i.w5)((()=>[(0,i._)("button",{tabindex:"-1",type:"button",class:"h-full w-full",onClick:I},[(0,i._)("i",{class:(0,n.normalizeClass)(["iconfont icon-clear_merge_icon text-[16px] text-color-t2 duration-150",{"!text-color-red":W.value}])},null,2)])])),_:1},8,["show"])],2),(0,i._)("div",R,[(0,i.Wm)(r,{loading:B.value,disabled:H.value,class:"h-[36px] w-[114px]",onClick:J},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.toDisplayString)("确定"),1)])),_:1},8,["loading","disabled"])])])}}})}}]);