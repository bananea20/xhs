(self.webpackChunkbrowser_extension=self.webpackChunkbrowser_extension||[]).push([[26,204],{71786:(e,t,n)=>{"use strict";n.d(t,{C:()=>a,UR:()=>l,pB:()=>o});var r=n(80432),s=n(72481),i=n(99853);const o=[s.Lx,r.Ty],a={[i.of.WebSpeech]:s.zr,[i.of.TencentRealtime]:r.Uz},l={[i.of.WebSpeech]:s.Xn,[i.of.TencentRealtime]:r.PK}},69026:(e,t,n)=>{"use strict";n.d(t,{Z:()=>pn});n(77950),n(15735),n(6886),n(43108),n(36728),n(17368),n(24471),n(73439),n(39529);var r=n(50251),s=n.n(r),i=n(2784),o=n(57047),a=n(72779),l=n.n(a),c=n(91942),u=n(97025),d=n(68346),p=n(3717);const h="static"!==getComputedStyle(document.documentElement).position;var f=n(25347),m=n.n(f);function g(){return{edges:{left:!0,right:!0,bottom:!1,top:!1},modifiers:[m().modifiers.restrictSize({min:{width:250,height:100}})]}}n(85940);function y(e){if(!e||!e.startsWith("translate"))return null;const t=e.startsWith("translate3d"),n=e.replace("translate"+(t?"3d":""),"").match(/-?\d+(\.\d+)?/g);if(!n)return null;const r=Number(n[0]),s=Number(n[1]);return Number.isNaN(r)||Number.isNaN(s)?null:{x:r,y:s,is3d:t}}function v(e){return`translate${e.is3d?"3d":""}(${Math.round(e.x)}px,${Math.round(e.y)}px${e.is3d?",0":""})`}var x=n(18435),b=n(26777),w=n(60279),T=n(25130),S=n.n(T);n(71372);function E(e,t){switch(t.type){case"overload":return t.payload;case"incremental":if(!e||!t.payload.placement)return e;const n=y(e.transform);if(!n)throw new Error("未解析到箭头的位置信息");return t.payload.placement.startsWith("bottom")||t.payload.placement.startsWith("top")?n.x=n.x-t.payload.x:(t.payload.placement.startsWith("left")||t.payload.placement.startsWith("right"))&&(n.y=n.y-t.payload.y),{...e,transform:v(n)}}}var C=n(52887),k=n(69378),_=n.n(k),j=n(81139),N=n(99887);function R(e,t){const n=e.pos;switch(t.type){case"setWidth":const r=e.width,s=t.payload;return r===s?e:{...e,width:s};case"readWidth":return t.payload(e.width),e;case"setPosSafe":const{pos:i,containerWidth:o=0,containerHeight:a=0}=t.payload,l=(0,j.Q)(document.documentElement),c=(0,N.L)()||0;let u=i.x;const d=u+o-(window.innerWidth-(l.v?c:0));d>0&&(u-=d),u<0&&(u=0);let p=i.y;if(a){const e=p+a-(window.innerHeight-(l.h?c:0));e>0&&(p-=e)}return p<0&&(p=0),u===n.x&&p===n.y?null==e.otherStyles?e:{...e,otherStyles:null}:{...e,pos:{x:u,y:p,is3d:n.is3d},otherStyles:null};case"readPos":return t.payload(e.pos),e;case"importPopperStyles":const f=t.payload,m={pos:y(f.transform)||{x:0,y:0,is3d:!1},otherStyles:f};return _()(m,(0,b.Z)(e,["pos","otherStyles"]))?e:{...e,...m};case"incrementalPos":const{dx:g,dy:v}=t.payload;return 0===g&&0===v?e:{...e,pos:{x:n.x+g,y:n.y+v,is3d:n.is3d}};case"switch2fixed":const{pageXOffset:x,pageYOffset:w}=window,T={...e,otherStyles:null};return h||0===x&&0===w||(T.pos={x:n.x-x,y:n.y-w,is3d:n.is3d}),T;default:return e}}var L=n(52322);const P=S()("popperContainer"),I=(0,b.Z)(w.qI,["width","pinPos","pinAfterDrag"]),z=(0,i.forwardRef)((function(e,t){const{pin:n,setPin:r,range:s,show:o,placement:a,setMaxHeight:f,targetRef:y}=e,[w,T]=(0,i.useState)(!1);(0,i.useEffect)((()=>{o&&T(!1)}),[o]),(0,i.useEffect)((()=>{n||T(!1)}),[n]);const[S,k]=(0,i.useState)(null),_=(0,i.useRef)(null),j=(0,i.useMemo)((()=>o&&!n&&s?s:null),[s,o,n]),[N,z]=(0,i.useReducer)(R,{width:I.width,pos:{x:0,y:0,is3d:!1},otherStyles:null}),[O,A]=(0,x.Z)(I),M=O?O.width:I.width,F=e=>{P("保存窗口宽度",e),A({width:e})};(0,i.useEffect)((()=>{P("同步 storage 中的宽度",M),z({type:"setWidth",payload:M})}),[M]);const U=O?O.pinPos:I.pinPos,D=e=>{const t=e&&(0,b.Z)(e,["x","y"]);P("保存窗口位置",t),A({pinPos:t})},Z=()=>{n?z({type:"readPos",payload:D}):P("保存窗口位置时由于不是 pin 状态，取消保存")},B=(0,i.useCallback)((()=>{U&&(P("设置窗口位置"),z({type:"setPosSafe",payload:{pos:U,containerWidth:null==S?void 0:S.clientWidth,containerHeight:null==S?void 0:S.clientHeight}}))}),[S,U]);(0,i.useEffect)((()=>{if(n&&o)return B(),window.addEventListener("resize",B),()=>{window.removeEventListener("resize",B)}}),[B,n,o]);const[W,H]=(0,i.useReducer)(E,null),{realtimePlacement:$,updatePopper:Y,popperStyles:K,popperAttrs:q,arrowStyles:V,maxSizeObj:X}=function(e,t,n,r){const{styles:s,attributes:i,update:o,state:a}=(0,d.D)(e,t,{placement:r,strategy:h?"fixed":void 0,modifiers:[{name:"arrow",options:{element:n}},{name:"computeStyles",options:{adaptive:!1}},{name:"offset",options:{offset:[0,12]}},p.Z]});return{realtimePlacement:e&&(null==a?void 0:a.placement)||null,updatePopper:e?o:null,popperStyles:e?s.popper:null,popperAttrs:e?i.popper:null,arrowStyles:e?s.arrow:null,maxSizeObj:e&&(null==a?void 0:a.modifiersData.maxSize)||null}}(j,S,_.current,a);(0,i.useEffect)((()=>{H({type:"overload",payload:V})}),[V]),(0,i.useEffect)((()=>{!n&&X&&f(X.height)}),[X,n,f]),(0,C.Z)((()=>{K&&(P("导入 popperjs 的样式",K),z({type:"importPopperStyles",payload:K}))}),[K]);const Q=function(e,t,n,r){const[s,o]=(0,i.useState)(null),[a,l]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{if(!e)return;const t=m()(e);return t.resizable({...g(),onstart(){l(!0)}}),o(t),()=>{t.unset(),o(null)}}),[e]),(0,i.useEffect)((()=>{if(!s)return;let e;if(t){const n=t.indexOf("-");switch(e=n>0?t.slice(0,n):t,e){case"top":e="bottom";break;case"bottom":e="top";break;case"left":e="right";break;case"right":e="left"}if("top"===e||"bottom"===e)return}const n=g();e&&(n.edges[e]=!1),s.set({resize:n})}),[t,s]),(0,i.useEffect)((()=>{if(!s)return;const e=function(e){n(e.rect.width,e.deltaRect.left,e.deltaRect.top)};return s.on("resizemove",e),()=>{s.off("resizemove",e)}}),[n,s]),(0,i.useEffect)((()=>{if(!s)return;const e=function(){l(!1),r()};return s.on("resizeend",e),()=>{s.off("resizeend",e)}}),[s,r]),a}(S,$,((e,t,n)=>{z({type:"setWidth",payload:e}),z({type:"incrementalPos",payload:{dx:t,dy:n}}),H({type:"incremental",payload:{x:t,y:n,placement:$}})}),(()=>{z({type:"readWidth",payload:F}),Z()}));!function(e,t,n,r,s){const[o,a]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(!e)return;const n=e.querySelector(t);if(!n)return;const r=m()(n);return r.draggable(!0).styleCursor(!1),a(r),()=>{r.unset(),a(null)}}),[e,t]),(0,i.useEffect)((()=>{if(!o)return;const e=()=>{c(!0),n()};return o.on("dragstart",e),()=>{o.off("dragstart",e)}}),[o,n]),(0,i.useEffect)((()=>{if(!o)return;const e=e=>{r(e.dx,e.dy)};return o.on("dragmove",e),()=>{o.off("dragmove",e)}}),[o,r]),(0,i.useEffect)((()=>{if(!o)return;const e=()=>{c(!1),s()};return o.on("dragend",e),()=>{o.off("dragend",e)}}),[o,s])}(S,".drag-block",(0,i.useCallback)((()=>{T(!0),(null==(null==O?void 0:O.pinAfterDrag)?I.pinAfterDrag:O.pinAfterDrag)&&r((e=>(e||(P("拖拽过程中将窗口转为固定模式位置"),z({type:"switch2fixed"})),!0)))}),[r,null==O?void 0:O.pinAfterDrag]),((e,t)=>{z({type:"incrementalPos",payload:{dx:e,dy:t}})}),(()=>{Z()})),(0,i.useImperativeHandle)(t,(()=>({switch2pin(){P("主动调用 switch2pin 方法转为固定模式"),z({type:"switch2fixed"}),Z()},clearPos(){P("由于转为了非固定模式，所以清空了 storage 里的位置"),D(null),window.setTimeout((()=>{Y&&Y()}))}})));const J=(0,i.useMemo)((()=>{const e={...N.otherStyles,width:N.width,transform:v(N.pos)};return P("合成 container 样式",e),e}),[N]);return(0,L.jsxs)("div",{id:"popper-container",ref:k,style:J,...q,className:l()({show:o,pin:n},c.W7H),children:[(0,L.jsx)(u.z,{onResize:()=>{n&&o&&!Q&&B()},targetRef:y,children:e.children}),!w&&(0,L.jsx)("div",{className:"arrow",ref:_,style:W||void 0})]})}));var O=n(41752),A=n(24400),M=n(12776),F=n(8560),U=n(4953),D=n(15454),Z=n(39421),B=n(39279),W=n(22168),H=n(82228),$=n(51035),Y=n(25456),K=n(64526),q=n(4307),V=n(61974),X=n(67067),Q=n(76539),J=n(73827),G=n(42165),ee=n(86388),te=n(10586),ne=n(66012),re=n(18625),se=n(47909);const ie=(0,b.Z)(w.qI,"secondDestinationLatestSource","selectedAPIs","collapsedAPIs","selectedExternalLinks","source","destination","autoPlay","autoCopy","recentUseLangFrom","recentUseLangTo","sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceTransformRegExps","tipPanelSettingsClosed","historyEnabled","favoritesEnabled","quickLinks","tipQuickLinksClosed","panelCustomStyle","customAPINames","panelSize","panelButtons","textAreaAuto"),oe=(0,b.Z)(w.d6,["user","noticesUnreadNum"]),ae={small:14,middle:18,large:22},le=(0,i.forwardRef)((function(e,t){const{toaster:n,headerLeft:r,headerRight:o,extendOptions:a,showTextArea:l=!1,size:u="small",style:d,hasDragTip:p,portalContainer:h,showOptionsTip:f=!0,onTranslate:m,elementRef:g}=e,[y,v,w]=(0,x.Z)(ie),[T]=(0,x.Z)(oe),S=(null==T?void 0:T.user)||null,E=(0,i.useMemo)((()=>{const e=null==y?void 0:y.selectedAPIs,t=null==y?void 0:y.customAPINames;if(e&&t)return[...e,...t]}),[null==y?void 0:y.customAPINames,null==y?void 0:y.selectedAPIs]),C=(0,i.useMemo)((()=>{const e=null==y?void 0:y.collapsedAPIs;return e&&e.length?(0,X.Uy)(E,(t=>{t&&e.forEach((e=>{const n=t.indexOf(e);n>=0&&t.splice(n,1)}))})):E}),[E,null==y?void 0:y.collapsedAPIs]),k=(null==y?void 0:y.quickLinks.filter((e=>e.panel)))||[],_=y||ie,j=ae[u],N="small"===u,R="large"===u,P=(null==y?void 0:y.source)||"",I=(0,i.useCallback)((e=>{v({source:e})}),[v]),[z,le]=(0,i.useState)(""),[ce,ue]=(0,i.useState)(""),de=z===ce,pe=(0,i.useRef)(null),[he,fe]=(0,i.useState)(!1),{results:me,queryResult:ge,dispatchResults:ye}=(0,q.n)(ce,C,P,null==y?void 0:y.destination,m),[ve,xe]=(0,i.useState)([]),[,be]=(0,Y.Z)(),{isInFavorites:we,saveOrDelete:Te}=(0,V.Z)(ce,ye,C),Se=(0,ee._)(n),{sourceTransformNCaml:Ee,sourceTransformNoBr:Ce,sourceTransformNoComment:ke,sourceTransformRegExps:_e}=null!=S&&S.vipActivated?(0,b.Z)(y||ie,["sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","sourceTransformRegExps"]):{sourceTransformNCaml:!1,sourceTransformNoBr:!1,sourceTransformNoComment:!1,sourceTransformRegExps:[]},je=(0,i.useRef)(""),Ne=(0,i.useCallback)((e=>{if(e===je.current)return;je.current=e,xe((e=>(0,X.Uy)(e,(e=>{e.splice(0)}))));const t=(0,se.L)(e,{sourceTransformNCaml:Ee,sourceTransformNoBr:Ce,sourceTransformNoComment:ke,sourceTransformRegExps:_e});le(t),ue(t)}),[Ee,Ce,ke,_e]),Re=(0,i.useRef)(Ne);Re.current=Ne;const Le=(0,Q.Z)(ce);(0,i.useEffect)((()=>{_.historyEnabled&&Le!==ce&&ce&&be({type:"save translate record",text:ce})}),[be,ce,_.historyEnabled]),(0,i.useEffect)((()=>{_.secondDestinationLatestSource&&Le!==ce&&ce&&(0,re.e)(ce).then((e=>{null!=e&&"中文(简体)"!==e&&s().storage.local.set({latestSource:e})}))}),[ce,_.secondDestinationLatestSource]),(0,i.useImperativeHandle)(t,(()=>({select(){var e;null===(e=pe.current)||void 0===e||e.select()},async play(){var e;if(!E)return;const t=E[0],n=null===(e=me.results[t])||void 0===e?void 0:e.result;var r;return t&&(null==n?void 0:n.text)===je.current?(0,B.h)({apiId:t,source:n.from,text:n.text,ttsURI:(null===(r=n.phonetic)||void 0===r?void 0:r[0].ttsURI)||n.ttsURI}):void 0},async setText(e){if(await w,"text"===e.type)le(e.text);else if("image"===e.type)return Se(e.dataURI).then((e=>{le(e)}))},async translate(e,t){if(await w,"text"===e.type)Re.current(e.text),t&&this.select();else if("image"===e.type)return Se(e.dataURI).then((e=>{Re.current(e),t&&this.select()}))}})),[Se,w,me.results,E]);const Pe=(0,i.useMemo)((()=>N?{width:6,height:6,borderRadius:3,right:3,top:1}:R?{width:10,height:10,borderRadius:5,right:8,top:6}:{width:8,height:8,borderRadius:4,right:5,top:3}),[R,N]),Ie=(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:"cog",size:j}),small:N,large:R,minimal:!0,active:he,className:"settings",onClick:()=>{fe((e=>!e))},title:"快捷设置"});return(0,L.jsxs)(L.Fragment,{children:[(null==y?void 0:y.panelCustomStyle)&&(0,L.jsx)("style",{children:y.panelCustomStyle.replace(/bp3/g,"bp4").replace(/bp4/g,"bp5")}),(0,L.jsxs)("div",{id:"translate-panel",className:"size-"+u,style:d,ref:g,children:[(0,L.jsxs)("div",{className:"fixed",children:[(0,L.jsxs)("div",{className:"header",children:[(0,L.jsxs)("div",{className:"left",children:[r,(null==y?void 0:y.panelButtons.includes("media"))&&(0,L.jsx)(te.j,{isSmall:N,isLarge:R,iconSize:j,onSelect:e=>{Se(e).then(Ne,W.Z)},portalContainer:h}),(null==y?void 0:y.panelButtons.includes("microphone"))&&(0,L.jsx)(ne.k,{isSmall:N,isLarge:R,iconSize:j,onSelect:Ne,portalContainer:h}),(null==y?void 0:y.panelButtons.includes("folder-open"))&&(0,L.jsx)(O.z,{small:N,large:R,minimal:!0,icon:(0,L.jsx)(A.I,{icon:"folder-open",size:j}),onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/stars"})},title:"打开收藏夹"}),(null==y?void 0:y.panelButtons.includes("history"))&&(0,L.jsx)(O.z,{small:N,large:R,minimal:!0,icon:(0,L.jsx)(A.I,{icon:"history",size:j}),onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/history"})},title:"打开历史记录"})]}),(0,L.jsx)("div",{className:"drag-block",title:p?"按住不放可以拖动":void 0}),(0,L.jsxs)("div",{className:"right",children:[!!ve.length&&(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:"undo",size:j}),small:N,large:R,minimal:!0,title:"返回上一次翻译",onClick:()=>{const e=(0,H.Z)(ve);e&&(le(e),ue(e)),xe((e=>(0,X.Uy)(e,(e=>{e.pop()}))))}}),!(null==T||!T.noticesUnreadNum)&&(0,L.jsxs)("div",{style:{fontSize:0,position:"relative"},children:[(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:"notifications",size:j}),small:N,large:R,minimal:!0,title:`你有 ${T.noticesUnreadNum} 条未读消息`,onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"?notices"})}}),(0,L.jsx)("div",{style:{position:"absolute",background:"rgb(243,1,1)",...Pe}})]}),y&&(0,L.jsxs)(L.Fragment,{children:[y.favoritesEnabled&&(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:we?"star":"star-empty",size:j}),disabled:!ce,small:N,large:R,minimal:!0,title:we?"从收藏夹中删除":"添加到收藏夹",onClick:Te}),y.tipPanelSettingsClosed&&Ie,!y.tipPanelSettingsClosed&&(0,L.jsx)(M.J,{enforceFocus:!1,content:(0,L.jsxs)("div",{className:c.Tio,style:{width:"200px",padding:"5px"},children:["添加 / 隐藏翻译源、语种切换、鼠标悬浮取词开关和显示翻译文本开关在这里。",(0,L.jsx)("a",{onClick:()=>{v({tipPanelSettingsClosed:!0})},children:"不再提示"})]}),canEscapeKeyClose:!1,isOpen:!y.tipPanelSettingsClosed&&f,portalContainer:h,children:Ie})]}),o]})]}),(0,L.jsx)(F.U,{isOpen:he,keepChildrenMounted:!0,children:(0,L.jsx)(K.Z,{source:P,setSource:I,options:y,setOptions:v,user:S,size:u,portalContainer:h,children:a})}),l&&(0,L.jsx)(G.H,{isLarge:R,isSmall:N,iconSize:j,value:z,onChange:le,onTranslate:e=>{Ne(null==e?z:e)},ref:pe,hideBtn:de||!z,auto:(null==y?void 0:y.textAreaAuto)||!1})]}),(0,L.jsxs)("div",{className:"body",style:de?void 0:{opacity:.7},children:[!ce&&(0,L.jsx)("p",{children:"请输入需要翻译的文本。"}),ce&&y&&(null==E?void 0:E.map(((e,t)=>{const n=me.results[e];return(0,L.jsx)(B.Z,{portalContainer:h,apiId:e,result:n,size:u,queryResult:t=>{ge(ce,e,t||P)},autoPlay:y.autoPlay&&0===t,autoCopy:!!(null==S?void 0:S.vipActivated)&&y.autoCopy&&0===t,setQuery:e=>{xe((e=>(0,X.Uy)(e,(e=>{e.push(ce)})))),ue(e),le(e)},collapse:y.collapsedAPIs.includes(e),onCollapseChange:()=>{v((t=>{const n=t.collapsedAPIs.indexOf(e);n>=0?t.collapsedAPIs.splice(n,1):t.collapsedAPIs.push(e)}))}},e)}))),E&&!E.length&&(0,L.jsx)(U.t,{className:"no-api",title:"你隐藏了所有翻译源",description:"请添加一个翻译源来显示翻译结果。",action:(0,L.jsx)(M.J,{portalContainer:h,content:(0,L.jsx)(D.v,{children:(0,L.jsx)($.Z,{})}),children:(0,L.jsx)(O.z,{icon:"add",small:N,large:R,text:"添加翻译源"})})}),!(null==y||!y.selectedExternalLinks.length)&&(0,L.jsx)("div",{className:"external-translators",children:y.selectedExternalLinks.map((e=>{const t=J.F.find((t=>t.id===e));return t?(0,L.jsx)("div",{children:(0,L.jsx)(O.A,{small:N,large:R,text:t.name,target:"_blank",href:t.generateLink(ce,y.destination,P)})},e):null}))}),y&&!y.tipQuickLinksClosed&&ce&&(0,L.jsxs)(Z.U,{style:{marginBottom:8,fontSize:12},children:["下方是预定义的三个快捷链接，你可以前往",(0,L.jsx)("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page",suffix:"#/panel"})},children:"“设置” - “翻译面板”"})," ","- “快捷链接”中修改或删除它们。",(0,L.jsx)("a",{onClick:()=>{v({tipQuickLinksClosed:!0})},children:"不再提示"})]}),!!k.length&&ce&&(0,L.jsx)("div",{className:"quick-links",children:k.map((e=>(0,L.jsx)("a",{href:e.link.replace("%s",encodeURIComponent(ce)),target:"_blank",rel:"noreferrer",children:e.name},e.name)))})]})]})]})})),ce=function(e){e.preventDefault()},ue=(0,b.Z)(w.qI,["buttonAutoClose","buttonOffsetTop","buttonOffsetLeft"]);function de(e){const{btnPos:t,setBtnPos:n,onBtnClick:r}=e,s=t?"show":void 0,[o]=(0,x.Z)(ue),a=(0,i.useRef)(),[l,c]=(0,i.useState)(!1),u=t?{transform:`translate(${t.x+10-((null==o?void 0:o.buttonOffsetLeft)||0)}px,${t.y+10-((null==o?void 0:o.buttonOffsetTop)||0)}px)`}:void 0;return(0,i.useEffect)((()=>{if(null==o||!o.buttonAutoClose)return c(!1),void window.clearTimeout(a.current);t?l?window.clearTimeout(a.current):a.current=window.setTimeout((()=>{n(null)}),2e3):(c(!1),window.clearTimeout(a.current))}),[t,l,n,null==o?void 0:o.buttonAutoClose]),(0,L.jsx)("div",{id:"translate-btn",className:s,style:u,onPointerDown:ce,onPointerEnter:()=>{c(!0)},onPointerLeave:()=>{c(!1)},children:(0,L.jsx)(O.z,{icon:(0,L.jsx)("span",{className:"btn-icon"}),onClick:r})})}var pe=n(84609),he=n(10106);function fe(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let n=t[3]||"";const r=n.indexOf(":");r>=0&&(n=n.slice(0,r));let s=t[4]||"";const i=s.indexOf("#");if(i>=0&&(s=s.slice(0,i)),!n.startsWith(".")){if(!s){if(!n)return;s="/"}return{host:n,path:s}}}function me(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function ge(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function ye(e,t,n){let r,s;r="string"==typeof e?fe(e):e;let i=!1,o=!1;if(r){const e=e=>{const t=function(e,t){let n;if(n="string"==typeof t?fe(t):t,n)return me(e.host,n.host)&&ge(e.path,n.path)}(e,r);return t&&(s=e),t};i=n.some(e),i||(o=t.some(e))}return{urlParts:r,matchedRule:s,whiteListMatched:i,blackListMatched:o}}var ve=n(59069),xe=n(98140),be=n(52145),we=n(55773),Te=(n(634),n(15754)),Se=n(23882),Ee=n(52779),Ce=n(9520);function ke(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _e=S()("detector master");function je(e){const t=e.selection;let n=null;if(t){const r=t.text,s=t.event;let i,o,a;if("function"==typeof t.rect)i=t.rect(),o={getBoundingClientRect:t.rect},a=s?{x:s.clientX+e.path[0].scrollLeft,y:s.clientY+e.path[0].scrollTop}:null;else{a=s?{x:s.clientX,y:s.clientY}:null;const n=e.path;i=(0,b.Z)(t.rect,["top","left","width","height","right","bottom"]),(0,Te.Z)(n,(e=>{if(e.rect&&e.computedStyles){const t=e.rect.left+e.computedStyles.paddingLeft+e.computedStyles.borderLeftWidth,n=e.rect.top+e.computedStyles.paddingTop+e.computedStyles.borderTopWidth;i.left+=t,i.top+=n,a&&(a.x+=t,a.y+=n)}})),i.right=i.left+i.width,i.bottom=i.top+i.height,o={getBoundingClientRect:()=>i};const r=(0,H.Z)(e.path);a=a?{x:a.x+r.scrollLeft,y:a.y+r.scrollTop}:null}n={text:r,mouseUpEvent:s,isTop:t.isTop,isInTextarea:t.isInTextarea,isInContentEditable:t.isInContentEditable,range:o,btnPos:a}}return{parsedData:n,activeFrameIndex:e.path.map((e=>e.frameIndex))}}var Ne=n(41131),Re=n.n(Ne),Le=n(61064),Pe=n(8721);const Ie=(0,b.Z)(w.qI,["localOCR"]);function ze(e){const{imgSrc:t,isShow:n,setIsShow:r,onText:s,isLocalOCR:o,portalContainer:a}=e,[l,c]=(0,x.Z)(Ie),u=(0,i.useRef)(null),d=(0,i.useRef)(),p=(0,i.useRef)(null),[h,f]=(0,i.useState)(null);return(0,i.useLayoutEffect)((()=>{if(!n)return;const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}),[n]),(0,i.useLayoutEffect)((()=>{if(!n||!u.current)return;const e=u.current,t=new(Re())(u.current,{viewMode:1,guides:!1,center:!1,minContainerWidth:e.clientWidth,minContainerHeight:e.clientHeight,autoCrop:!1,movable:!1,rotatable:!1,scalable:!1,zoomable:!1,zoomOnTouch:!1,zoomOnWheel:!1,cropstart(){f(null)},cropend(){const e=t.getCropBoxData();f({left:-9999,top:-9999}),window.setTimeout((()=>{var t;f({left:e.left+e.width-((null===(t=p.current)||void 0===t?void 0:t.clientWidth)||0),top:e.top+e.height+5})}))}});return d.current=t,()=>{f(null),t.destroy(),d.current=void 0}}),[n]),(0,i.useEffect)((()=>{if(!n)return;const e=e=>{27===e.keyCode&&(e.stopPropagation(),r(!1))};return window.addEventListener("keyup",e,!0),()=>{window.removeEventListener("keyup",e,!0)}}),[r,n]),n?(0,L.jsxs)("div",{id:"ocr-container",children:[(0,L.jsxs)("div",{ref:p,className:"toolbar",style:{display:h?"block":"none",left:null==h?void 0:h.left,top:null==h?void 0:h.top},children:[(0,L.jsx)(O.z,{onClick:()=>{var e;if(!window.isSecureContext)return void window.alert("受限于浏览器的安全策略，复制截图只能在 https 网站使用。");if(null===(e=navigator.clipboard)||void 0===e||!e.write)return void window.alert(Pe.XO?"复制截图的功能需要在 Chrome 66 / Edge 79 及以上的版本中才能使用。":"Firefox 浏览器暂时不支持复制截图，请在别的浏览器上使用。");const t=d.current;t&&t.getCroppedCanvas({imageSmoothingEnabled:!1}).toBlob((e=>{e&&navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).then((()=>{r(!1)}),(e=>{window.alert("复制失败，错误消息："+e.message)}))}))},children:"复制截图"}),o&&(0,L.jsx)(Le.U,{value:(null==l?void 0:l.localOCR.lang)||Ie.localOCR.lang,onChange:e=>{c((t=>{t.localOCR.lang=e}))},portalContainer:a}),(0,L.jsx)(O.z,{onClick:()=>r(!1),children:"取消 (Esc)"}),(0,L.jsx)(O.z,{onClick:()=>{const e=d.current;if(!e)return;const t=e.getCroppedCanvas().toDataURL(),n=e.getCropBoxData();s(t,n),r(!1)},children:"确定"})]}),(0,L.jsx)("img",{ref:u,src:t,alt:"屏幕截图"})]}):null}var Oe=n(60265),Ae=(n(21515),n(89930)),Me=n(51813),Fe=n(30686);function Ue(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class De extends Fe.Z{constructor(e,t){super(),Ue(this,"stream",[]),Ue(this,"streamTextLength",0),Ue(this,"queue",[]),Ue(this,"handling",!1),this.apiCode=e,this.options=t}addStream(e){const t=e.text.length;t&&(this.streamTextLength+t>3e3&&(this.queue.push(this.stream),this.stream=[],this.streamTextLength=0,this.handleTask()),this.stream.push(e),this.streamTextLength+=t,window.setTimeout((()=>{this.handleTask()}),500))}handleTask(){if(this.handling)return;let e=this.queue.shift();if(!e){if(!this.stream.length)return;e=this.stream,this.stream=[],this.streamTextLength=0}this.handling=!0;const t=[],n=[];e.forEach((e=>{const r=e.text.split("\n").map((e=>e.trim())).filter(Ae.Z);n.push({start:t.length,end:t.length+r.length}),t.push(...r)})),this.emit("translate-before"),s().runtime.sendMessage({action:"translate",data:{apiCode:this.apiCode,source:this.options.source,destinations:this.options.dest,text:t.join("\n")}}).finally((()=>{this.emit("translate-after")})).then((t=>{let r;if(t.result)r=t.result;else{var s;const e=null===(s=t.dict)||void 0===s?void 0:s[0].terms[0];e&&(r=[e])}const i=t.error;var o,a;null!=i&&i.message&&(i.message=`【${o=this.apiCode,null===(a=Me.Y.find((e=>e.id===o)))||void 0===a?void 0:a.name}】${i.message}`),e.forEach(((e,t)=>{if(i)return void e.reject(i);if(!r)return void e.reject(new Error("没有翻译结果"));const s=n[t],o=s.end-s.start,a=r.slice(s.start,s.end);e.resolve(a.length===o?a.join("\n"):null)})),this.handling=!1}),(t=>{e.forEach((e=>{e.reject(t)})),this.handling=!1})).then((()=>{this.handleTask()}))}}var Ze=n(80471);function Be(){const e=document.body.childNodes;return 1===e.length&&e[0]instanceof HTMLPreElement}class We{constructor(e,t=Ze.U.source,n){let r;if(n)r=n;else{if(!Be())throw new TypeError("当前页面不是 txt 文件。");r=document.body.firstElementChild}this.preElement=r,this.showType=Ze.U.source,this.originText=r.textContent||"",this.originParagraphs=this.originText.split(/\n{2,}/),this.resultParagraphs=[],this.originParagraphs.forEach(((t,n)=>{const r=t.replace(/\n/g," ").trim();r?(this.resultParagraphs[n]="正在翻译，请稍候……",e(r).then((e=>{this.resultParagraphs[n]=e||"",this.renderResult()}))):this.resultParagraphs[n]=""})),this.switchShowType(t)}renderResult(){switch(this.showType){case Ze.U.source:this.preElement.textContent=this.originText;break;case Ze.U.result:this.preElement.textContent=this.resultParagraphs.join("\n\n");break;case Ze.U.both:this.preElement.textContent=this.originParagraphs.reduce(((e,t,n)=>t.trim()?e+t+"\n【译文】"+this.resultParagraphs[n]+"\n\n":e),"")}}switchShowType(e){this.showType!==e&&(this.showType=e,this.renderResult())}destroy(){this.switchShowType(Ze.U.source),this.destroyed=!0}}class He{constructor(e,t,n,r){this.rootNode=e,this.staticChildNodes=t,this.translateNodes=[],this.translateFn=n,this.options=r}add(e,t){const{rootNode:n,staticChildNodes:r,translateNodes:s,translateFn:i}=this,o=r.slice(e,t+1),a=new Ze.o(n,o,i,this.options);return s.push(a),a}translate(){this.translateNodes.forEach((e=>e.translate()))}setOnlyChild(){var e;null===(e=this.translateNodes[0])||void 0===e||e.setOnlyChild()}switchShowType(e){this.translateNodes.forEach((t=>t.switchShowType(e)))}destroy(){this.translateNodes.forEach((e=>e.destroy()))}}const $e=["base","head","link","meta","style","body","hr","pre","br","area","audio","img","map","track","video","embed","iframe","object","param","picture","portal","source","svg","math","canvas","noscript","script","input","meter","progress","textarea","select"],Ye=["article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","li","ol","p","ul","details","dialog","menu","summary","form","table","thead","tbody","tr","th","td","center","label"].concat($e);function Ke(e){return e.nodeType===Node.ELEMENT_NODE}function qe(e){const t=e.tagName.toLowerCase();return Ye.includes(t)||t.includes("-")&&"g-emoji"!==t}function Ve(e){const t=e.tagName.toLowerCase();return"button"===e.getAttribute("role")?!$e.includes(t):"button"===t||"a"===t}function Xe(e,t,n=(()=>!1),r){const s={element:e,paragraphs:[],children:[]};if(e instanceof Element&&n(e))return s;if(e instanceof Element){const i=e.shadowRoot;if(i){const e=Xe(i,t,n,r);s.children.push(e)}}let i;const o=Array.from(e.childNodes);let a=!1;const l=o.filter((e=>{if(e.nodeType===Node.TEXT_NODE){var t;const n=!(null===(t=e.nodeValue)||void 0===t||!t.trim());return n&&(a=!0),n}return e.nodeType===Node.ELEMENT_NODE})),c=e=>o.indexOf(l[e]);if(l.forEach(((u,d)=>{if(null==i&&(i=d),Ke(u)&&(qe(u)||function(e,t,n){const r=e[t];if(!Ke(r))return!1;const s=e[t-1],i=e[t+1];if(Ve(r)&&!n){if(s&&Ke(s)&&Ve(s))return!0;if(i&&Ke(i)&&Ve(i))return!0}return s?Ke(s)&&qe(s):!i||Ke(i)&&qe(i)}(l,d,a))){const a=d-1;if(a>=i){const n=c(i),r=c(a);s.paragraphs.push([n,r]),null==t||t(e,o,n,r)}if(i=void 0,!function(e){if(Ve(e))return!1;const t=e.tagName.toLowerCase();return $e.includes(t)}(u)&&!n(u)){const e=Xe(u,t,n,r);s.children.push(e)}}})),null!=i){const n=l.length-1,r=c(i),a=c(n);s.paragraphs.push([r,a]),null==t||t(e,o,r,a)}return 1===s.paragraphs.length&&0===s.children.length&&(null==r||r(s)),s}function Qe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Je{constructor(e){Qe(this,"text",document.title),Qe(this,"translateResult",""),Qe(this,"translating",!1),Qe(this,"translated",!1),Qe(this,"showType",Ze.U.source),Qe(this,"destroyed",!1),this.translateFn=e}destroy(){document.title=this.text,this.destroyed=!0}switchShowType(e){if(!this.destroyed){switch(e){case Ze.U.both:document.title=`${this.text} ~ ${this.translateResult}`;break;case Ze.U.source:document.title=this.text;break;case Ze.U.result:document.title=this.translateResult}this.showType=e}}async translate(){if(this.destroyed||!this.text||this.translating||this.translated)return;let e;this.translating=!0,this.translateResult="正在翻译……",this.switchShowType(this.showType);try{e=await this.translateFn(this.text)}catch(e){return this.translating=!1,this.translated=!0,this.translateResult="翻译出错："+e.message,void this.switchShowType(this.showType)}if(this.translating=!1,null==e)return this.translate();this.translated=!0,this.translateResult=e,this.switchShowType(this.showType)}}var Ge=n(64643),et=n(28909),tt=n(13888),nt=n.n(tt);const rt={STYLE_NONE:Ge.Yx,STYLE_DOTTED_CLASSIC:Ge.l,STYLE_DOTTED:Ge.Su,STYLE_WAVY:Ge.HQ,STYLE_LINE:Ge.pZ,STYLE_BACKGROUND:Ge.kw,STYLE_QUOTE:Ge.Xi};let st;function it(){if(st)return;st=document.createElement("style"),st.dataset.title="这是由划词翻译创建的节点，用于控制全文翻译的译文样式。",document.head.appendChild(st);const e=nt()(w.qI,["pageTrsResultStyleId","pageTrsResultStyleMainColor","pageTrsResultStyleTextColor","pageTrsResultStyleTextSize","pageTrsResultStyleTextWeight","pageTrsResultStyleCustom"]);(0,et.Z)(e,(t=>{t.pageTrsResultStyleId&&(e.pageTrsResultStyleId=t.pageTrsResultStyleId),void 0!==t.pageTrsResultStyleCustom&&(e.pageTrsResultStyleCustom=t.pageTrsResultStyleCustom),void 0!==t.pageTrsResultStyleMainColor&&(e.pageTrsResultStyleMainColor=t.pageTrsResultStyleMainColor),void 0!==t.pageTrsResultStyleTextColor&&(e.pageTrsResultStyleTextColor=t.pageTrsResultStyleTextColor),void 0!==t.pageTrsResultStyleTextSize&&(e.pageTrsResultStyleTextSize=t.pageTrsResultStyleTextSize),void 0!==t.pageTrsResultStyleTextWeight&&(e.pageTrsResultStyleTextWeight=t.pageTrsResultStyleTextWeight),function(){if(!st)return;let t="hcfy-result{";e.pageTrsResultStyleMainColor&&(t+=`--hcfy-result-main-color:${e.pageTrsResultStyleMainColor};`),e.pageTrsResultStyleTextColor&&(t+=`--hcfy-result-text-color:${e.pageTrsResultStyleTextColor};`),e.pageTrsResultStyleTextSize&&(t+=`--hcfy-result-text-size:${e.pageTrsResultStyleTextSize}em;`),e.pageTrsResultStyleTextWeight&&(t+=`--hcfy-result-text-weight:${e.pageTrsResultStyleTextWeight};`),t+="}","STYLE_CUSTOM"===e.pageTrsResultStyleId?t+=e.pageTrsResultStyleCustom:t+=rt[e.pageTrsResultStyleId]||"",st.textContent=t}()}))}function ot(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function at(e){const t=e.nodeName.toLowerCase();return"body"!==t&&"html"!==t}function lt(e){return Array.prototype.some.call(e.childNodes,(e=>"hcfy-result"===e.nodeName.toLowerCase()))}class ct{constructor(e,t=Ze.U.both,n=document.body,r){ot(this,"groups",new Map),ot(this,"mutationObserver",new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{Ke(e)&&!function(e,t){let n=e;do{if(t(n))return!0;n=n.parentElement}while(n&&at(n));return!1}(e,(e=>{const t=e.tagName.toLowerCase();return"pre"===t||"hcfy-result"===t||(!!lt(e)||void 0)}))&&this.analysis(e)})),e.removedNodes.forEach((e=>{if(Ke(e)){const t=e=>{this.groups.delete(e),Array.prototype.forEach.call(e.children,t)};t(e)}}))}))}))),ot(this,"intersectionObserver",new IntersectionObserver((e=>{e.forEach((e=>{if(0===e.intersectionRatio)return;const t=this.groups.get(e.target);t&&t.translate()}))}),{rootMargin:`${window.screen.availHeight*window.devicePixelRatio}px ${window.screen.availWidth*window.devicePixelRatio}px`})),it(),this.options=r,this.translateFn=e,this.showType=t,this.titleNode=new Je(e),this.titleNode.switchShowType(t),this.titleNode.translate(),this.analysis(n);const s=document.getElementsByTagName("sr-read")[0];s&&this.analysis(s),this.mutationObserver.observe(n,{childList:!0,subtree:!0})}analysis(e){const{groups:t,translateFn:n}=this;Xe(e,((e,r,s,i)=>{let o=t.get(e);o||(o=new He(e,r,n,this.options),t.set(e,o),e instanceof Element&&this.intersectionObserver.observe(e));o.add(s,i).switchShowType(this.showType)}),(e=>"hcfy-result"===e.tagName.toLowerCase()||lt(e)),(e=>{const n=t.get(e.element);n&&n.setOnlyChild()}))}switchShowType(e){this.showType=e,this.titleNode.switchShowType(e);for(const t of this.groups.values())t.switchShowType(e)}destroy(){this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.titleNode.destroy();for(const e of this.groups.values())e.destroy()}}const ut=nt()(w.qI,["pageTrsEditable"]);var dt=n(15929),pt=n(4253),ht=n(7749);const ft=S()("useHoverShow"),mt=Pe.un?2e3:500;function gt(e,t){(0,i.useEffect)((()=>{if(!e)return;let n=!1;const r=e.clientWidth;let s;ft("第一次读取面板的宽度为 %dpx",r),e.style.transform=`translateX(${t.includes("left")?"-":""}${r}px)`,e.style.transition="none",setTimeout((()=>{if(!n){if(e.style.transform){const n=e.clientWidth;ft("第二次读取面板的宽度为 %dpx",n),e.style.transform=`translateX(${t.includes("left")?"-":""}${n}px)`}setTimeout((()=>{n||(e.style.transition="transform 0.2s")}),0)}}),16);const i=()=>{null!=s&&clearTimeout(s)},o=()=>{i(),e.style.transform=""},a=()=>{var n;n=mt,i(),s=setTimeout((()=>{e.style.transform=`translateX(${t.includes("left")?"-":""}${e.clientWidth}px)`}),n)};return e.addEventListener("mouseenter",o),e.addEventListener("mouseleave",a),()=>{n=!0,i(),e.style.transform="",e.style.transition="",e.removeEventListener("mouseenter",o),e.removeEventListener("mouseleave",a)}}),[e,t])}var yt=n(89458);function vt(e){const{children:t,portalContainer:n,showTip:r,clearTip:s}=e;return r?(0,L.jsx)(yt.u,{isOpen:!0,portalContainer:n,placement:"left",content:(0,L.jsxs)("div",{style:{width:180},children:["可以在这里切换翻译服务和双语 / 原文 / 译文。",(0,L.jsx)("a",{onClick:s,children:"不再提示"})]}),children:t}):(0,L.jsx)(L.Fragment,{children:t})}var xt=n(97276);const bt=(0,b.Z)(w.d6,"tipForSaveSourceSelectClosed");function wt(){const[e,t]=(0,x.Z)(bt);return null==e||e.tipForSaveSourceSelectClosed?null:(0,L.jsxs)(Z.U,{children:["从现在起，划词翻译会记住你选择的“源语种”，在下次开启全文翻译时会自动使用你之前选择的源语种。",(0,L.jsx)("a",{onClick:()=>{t({tipForSaveSourceSelectClosed:!0})},children:"不再提示"})]})}const Tt=[{label:"关闭",value:"close"},{label:"当前标签页",value:"tab"},{label:"当前窗口",value:"window"}];function St(e){return(0,L.jsx)(pt.L,{options:Tt,value:e.value,onChange:t=>{const n=t.currentTarget.value;e.setValue(n)}})}const Et=[{name:"双语",value:Ze.U.both},{name:"原文",value:Ze.U.source},{name:"译文",value:Ze.U.result}],Ct=s().runtime.getURL("/logodark.png");function kt(){s().runtime.sendMessage({action:"open options page",suffix:"#/fulltext"})}const _t={...(0,b.Z)(w.qI,["pageTrsApiOptions","customAPINames","tipForSlowDeepLPageTrsClosed","tipForPageTrsClosed"]),...(0,b.Z)(w.d6,["tipForShortKeyForPageTrsTypeClosed","tipForAddJumpTwoClosed"])};function jt(e){const{apiCode:t,source:n,onSourceChange:r,target:o,onTargetChange:a,showType:l,onShowTypeChange:u,onAPIChange:d,auto:p,onAutoChange:h,loading:f,portalContainer:m,pos:g}=e,[y,v]=(0,x.Z)(_t),b=(0,i.useMemo)((()=>{let e=(null==y?void 0:y.pageTrsApiOptions)||_t.pageTrsApiOptions;e.includes(t)||(e=e.concat(t));const n=Me.L.filter((t=>e.includes(t.id))),r=((null==y?void 0:y.customAPINames)||_t.customAPINames).map((e=>({id:e,name:e})));return r.length?[...n,...r]:n}),[null==y?void 0:y.pageTrsApiOptions,null==y?void 0:y.customAPINames,t]),[w,T]=(0,i.useState)(null),[S,E]=(0,i.useState)(null);(0,i.useEffect)((()=>{if(w)return E(w.closest("."+c.otd)),()=>{E(null)}}),[w]),gt(S,g);const C=!!y&&!y.tipForPageTrsClosed,k={position:"absolute",width:30,top:0,bottom:0,padding:"0 3px",...g.includes("right")?{left:-30}:{right:-30}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(O.z,{ref:T,loading:f,style:k,children:(0,L.jsx)(vt,{portalContainer:m,showTip:C,clearTip:C?()=>{v({tipForPageTrsClosed:!0})}:void 0,children:(0,L.jsx)("img",{src:Ct,style:{width:"100%"},alt:"展开"})})}),(0,L.jsxs)(dt.c,{label:"翻译服务：",inline:!0,className:"page-trs-form-group",style:{margin:"0 0 5px 0"},children:[(0,L.jsx)(pt.L,{value:t,onChange:e=>{const t=e.currentTarget.value;d(t)},children:b.map((e=>"BingDictWeb"===e.id?null:(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))}),"DeepLWeb"===t&&y&&!y.tipForSlowDeepLPageTrsClosed&&(0,L.jsxs)(Z.U,{intent:"warning",icon:null,style:{width:200},children:[(0,L.jsxs)("p",{children:["DeepL 首次翻译速度较慢，请耐心等待。若遇到问题（报错、翻译结果不全等）请",(0,L.jsx)("a",{href:"https://hcfy.app/docs/services/free/#deepl",target:"_blank",rel:"noreferrer",children:"点击查看解决方案"}),"。"]}),(0,L.jsx)(O.z,{small:!0,intent:"primary",onClick:()=>{v({tipForSlowDeepLPageTrsClosed:!0})},children:"不再提示"})]})]}),(0,L.jsxs)(dt.c,{label:"模式：",inline:!0,className:"page-trs-form-group",children:[(0,L.jsx)(ht.h,{style:{padding:0},children:Et.map((e=>(0,L.jsx)(O.z,{active:l===e.value,onClick:()=>{e.value!==l&&u(e.value)},text:e.name},e.value)))}),y&&!y.tipForShortKeyForPageTrsTypeClosed&&(0,L.jsxs)(Z.U,{style:{width:160},children:["你可以用快捷键来切换双语 / 原文 / 译文。",(0,L.jsxs)("div",{children:[(0,L.jsx)("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,L.jsx)("a",{onClick:()=>{v({tipForShortKeyForPageTrsTypeClosed:!0})},children:"不再提示"})]})]}),y&&!y.tipForAddJumpTwoClosed&&(0,L.jsxs)(Z.U,{style:{width:160},children:["切换双语 / 原文 / 译文的快捷键现在可以选择【跳过双语】了。",(0,L.jsxs)("div",{children:[(0,L.jsx)("a",{onClick:()=>{s().runtime.sendMessage({action:"open options page"})},style:{marginRight:15},children:"前往设置"}),(0,L.jsx)("a",{onClick:()=>{v({tipForAddJumpTwoClosed:!0})},children:"不再提示"})]})]})]}),(0,L.jsx)(dt.c,{label:"自动开启：",inline:!0,className:"page-trs-form-group",children:(0,L.jsx)(St,{value:p,setValue:h})}),(0,L.jsxs)(dt.c,{label:"源语种：",inline:!0,className:"page-trs-form-group",children:[(0,L.jsx)(xt.Z,{lang:n,setLang:r,addAuto:!0,portalContainer:m}),(0,L.jsx)(wt,{})]}),(0,L.jsx)(dt.c,{label:"目标语种：",inline:!0,className:"page-trs-form-group",children:(0,L.jsx)(xt.Z,{lang:o,setLang:a,portalContainer:m})}),(0,L.jsx)("div",{children:(0,L.jsx)("a",{onClick:kt,children:"打开设置"})})]})}var Nt=n(75578);const Rt=(0,b.Z)(w.d6,"tipForFullTextClosed");function Lt(e){const{fullTextOpen:t,portalContainer:n}=e,[r,s]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),[l,u]=(0,x.Z)(Rt),d=null==l?void 0:l.tipForFullTextClosed;return(0,i.useEffect)((()=>{!1===d&&t&&s(!0)}),[t,d]),!0===d?null:(0,L.jsxs)(Nt.V,{isOpen:r,title:"全文翻译功能的重要提示",portalContainer:n,canEscapeKeyClose:!1,canOutsideClickClose:!1,isCloseButtonShown:!1,children:[(0,L.jsxs)("div",{className:c.TmF,children:[(0,L.jsxs)("p",{children:["全文翻译功能默认使用谷歌翻译，但",(0,L.jsx)("a",{href:"https://hcfy.app/blog/2022/09/28/ggg",target:"_blank",rel:"noreferrer",children:"谷歌翻译可能需要额外配置才能使用"}),"。"]}),(0,L.jsxs)("p",{children:["你还可以切换为别的翻译服务，如 DeepL、Yandex 等，",(0,L.jsx)("b",{children:"将鼠标移动至右下角的划词翻译图标上，在弹出来的面板里即可切换"}),"。"]}),(0,L.jsxs)("p",{children:[(0,L.jsx)("b",{children:"DeepL 和 Yandex 是可以直接使用的"}),"，其它翻译服务需要自行申请后才能使用。"]}),(0,L.jsx)("div",{style:{textAlign:"right"},children:(0,L.jsx)(ve.XZ,{inline:!0,style:{margin:0},checked:o,onChange:e=>{a(e.currentTarget.checked)},label:"不再提示"})})]}),(0,L.jsx)("div",{className:c.Alt,style:{marginTop:0},children:(0,L.jsx)("div",{className:c.e$L,children:(0,L.jsx)(O.z,{intent:"primary",text:"我知道了",onClick:()=>{s(!1),o&&u({tipForFullTextClosed:!0})}})})})]})}var Pt=n(75320),It=n(52665);const zt=T("@hcfyapp/aftr");class Ot extends Fe.Z{constructor(){super(),chrome.runtime.onMessage.addListener((e=>{var t;if((t=e,(0,It.yD)(t)&&"__aftrMessage__"in t)&&(zt("收到消息 %o",e),"setMode"===e.__aftrAction__))this.emit("change",e.__aftrPayload__)}))}getMode(){return(0,Pt.j)({__aftrMessage__:!0,__aftrAction__:"getMode"})}setMode(e){return(0,Pt.j)({__aftrMessage__:!0,__aftrAction__:"setMode",__aftrPayload__:e})}}const At=new Ot;const Mt=3,Ft=new Oe.P("pageTranslateLimit",Mt);const Ut={...(0,b.Z)(w.qI,["pageTrsApi","pageTrsSource","pageTrsDest"]),...(0,b.Z)(w.d6,["pageTrsType"])},Dt=(0,b.Z)(w.qI,["pageTrsJumpTwo"]);function Zt(e){const{open:t,setOpen:n,portalContainer:r,pos:o="bottom-right"}=e,{mode:a,setMode:l}=function(e){const[t,n]=(0,i.useState)(null),r=(0,i.useRef)(e);return(0,i.useEffect)((()=>{r.current=e}),[e]),(0,i.useEffect)((()=>{At.getMode().then((e=>{var t;n(e),null===(t=r.current)||void 0===t||t.call(r,e)}))}),[]),(0,i.useEffect)((()=>(At.on("change",n),()=>{At.off("change",n)})),[]),{mode:t,setMode:(0,i.useCallback)((e=>{n(e),At.setMode(e)}),[])}}((e=>{"close"!==e&&n(!0)})),[c,u]=(0,i.useState)(null),d=(0,i.useRef)(),p=(0,i.useRef)(""),[h,f]=(0,i.useState)(Ze.U.both),[m,g]=(0,i.useState)(""),y=(0,i.useCallback)((e=>{s().storage.local.set({pageTrsType:e}),f(e),d.current?d.current.switchShowType(e):console.warn("不应该在未开启全文翻译时切换显示类型。")}),[]),[v,x]=(0,i.useState)(Ut.pageTrsSource),[b,w]=(0,i.useState)(Ut.pageTrsDest[0]),[T,S]=(0,i.useState)(!1),E=(0,i.useCallback)((async()=>{d.current&&(d.current.destroy(),d.current=void 0);if(await Ft.isOver(!0)){if(n(!1),l("close"),!c)throw new Error("toaster 不应该为空。");!function(e){e.show({action:{text:"开通会员",onClick:K.H},message:`非会员每天只能使用 ${Mt} 次网页全文翻译功能，成为会员即可解除此限制。`,intent:"primary",timeout:0})}(c)}else d.current=await async function(){const{pageTrsType:e,pageTrsApi:t,pageTrsDest:n,pageTrsSource:r}=await s().storage.local.get(Ut);f(e),g(t),w(n[0]),x(r);const i=new De(t,{dest:n,source:r});return i.on("translate-before",(()=>{S(!0)})),i.on("translate-after",(()=>{S(!1)})),async function(e,t=Ze.U.both){if(Be())return new We(e,t);{const n=await s().storage.local.get(ut);return new ct(e,t,document.body,{editable:n.pageTrsEditable})}}((e=>new Promise(((t,n)=>i.addStream({text:e,resolve:t,reject:n})))),e)}()}),[n,l,c]);return(0,i.useEffect)((()=>{if(!c||!t)return;const e={message:(0,L.jsx)(jt,{loading:T,source:v,onSourceChange:e=>{s().storage.local.set({pageTrsSource:e}).then((()=>{E()}))},target:b,onTargetChange:e=>{s().storage.local.set({pageTrsDest:[e]}).then((()=>{E()}))},showType:h,onShowTypeChange:y,auto:a||"close",onAutoChange:e=>{l(e)},apiCode:m,onAPIChange:e=>{s().storage.local.set({pageTrsApi:e}),g(e),E()},portalContainer:r,pos:o}),timeout:0,onDismiss(){p.current="",n(!1)}};p.current?c.show(e,p.current):p.current=c.show(e)}),[T,t,E,m,a,h,r,o,n,l,v,y,b,c]),(0,i.useEffect)((()=>{t&&E()}),[t,E]),(0,i.useEffect)((()=>{c&&!t&&(d.current&&(d.current.destroy(),d.current=void 0),p.current&&(c.dismiss(p.current),p.current=""))}),[t,c]),(0,i.useEffect)((()=>{if(t)return s().runtime.onMessage.addListener(e),()=>{s().runtime.onMessage.removeListener(e)};function e(e){if("page translate switch mode"===e){const e=Et.findIndex((e=>e.value===h));if(e<0)return;let t=e+1;t>=Et.length?s().storage.local.get(Dt).then((({pageTrsJumpTwo:e})=>{t=e?1:0,y(Et[t].value)})):y(Et[t].value)}}}),[t,h,y]),(0,L.jsxs)("div",{id:"web-trs-panel",children:[(0,L.jsx)(Lt,{fullTextOpen:t,portalContainer:r}),(0,L.jsx)(xe.q,{position:o,ref:u,className:"app-toaster-container",usePortal:!1})]})}var Bt=n(99266),Wt=n(17419);function Ht(e){const{mediaElement:t,serviceImplement:n,lang:r,onStart:s,onStop:o}=e,[a,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)([]),[d,p]=(0,i.useState)(""),h=t instanceof HTMLAudioElement?"音频":"视频",f=(0,i.useRef)(!1),m=(0,i.useRef)(),g=()=>{u([]),p("")},y=(0,i.useCallback)((()=>{if(!t)return;if(a)throw new Error("识别服务正在运行，在停止前无法直接开始。");f.current=!1,l(!0),t.pause();const e=e=>{const t=(0,Wt.DR)(e);window.alert(t.message),g(),l(!1),o()};n.mediaStream({mediaStream:t,lang:r,options:{onInterim:e=>{f.current||p(e)},onSentence:e=>{f.current||(p(""),u((t=>(0,X.Uy)(t,(t=>{t.push(e)})))))},onStop:e=>{if(f.current)return;g();const t=e.join("\n");t.length?o(t):o()},onError:t=>{f.current||e(t)}}}).then((e=>{f.current?e.abort():(m.current=e,t.play(),s())}),e)}),[r,t,s,o,a,n]),v=(0,i.useCallback)((()=>{var e;l(!1),null===(e=m.current)||void 0===e||e.stop(),m.current=void 0,null==t||t.pause()}),[t]),x=(0,i.useCallback)((()=>{var e;f.current=!0,l(!1),null===(e=m.current)||void 0===e||e.abort(),m.current=void 0}),[]);return(0,i.useEffect)((()=>x),[x]),{start:y,stop:v,abort:x,running:a,mediaText:h,allSentences:c,interimSentence:d}}const $t=new Oe.P("videoLimit",5);let Yt="";function Kt(e){e.show({action:{text:"开通会员",onClick:K.H},message:`非会员每天只能翻译 ${$t.max} 个音视频，成为会员即可解除此限制。`,intent:"primary",timeout:0})}function qt(e){const{disabled:t,toaster:n}=e,{start:r,stop:s,running:i,mediaText:o,allSentences:a,interimSentence:l}=Ht(e);return(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{children:[i&&(0,L.jsx)(O.z,{disabled:t,icon:"stop",intent:"primary",onClick:s,children:"停止识别并翻译"}),!i&&(0,L.jsxs)(O.z,{disabled:t,icon:"play",intent:"primary",onClick:()=>{$t.isOver().then((e=>{e?Kt(n):r()}))},children:["播放",o,"并开始识别"]})]}),(0,L.jsxs)("div",{children:[a.map(((e,t)=>(0,L.jsx)("div",{children:e},t))),(0,L.jsx)("span",{style:{opacity:.6},children:l})]})]})}var Vt=n(99853),Xt=n(71786);function Qt(e){const{disabled:t,serviceImplement:n,onStop:r,toaster:o}=e,{start:a,abort:l,running:c,mediaText:u,allSentences:d,interimSentence:p}=Ht(e),h=!n.service.realtime,f=t||h,m=d[d.length-1],[g,y]=(0,i.useState)({text:"正在等待识别出一个完整的句子……",result:""});return(0,i.useEffect)((()=>{if(!m)return;let e=!1;return y({text:m,result:"正在翻译，请稍候……"}),s().runtime.sendMessage({action:"translate",data:{apiCode:"GoogleWeb",text:m}}).then((t=>{var n;if(e)return;const r=t.error?t.error.message:(null===(n=t.result)||void 0===n?void 0:n.join(""))||"没有翻译结果";y({text:m,result:r})}),(t=>{e||y({text:m,result:t.message})})),()=>{e=!0}}),[m]),(0,L.jsxs)("div",{children:[h&&(0,L.jsxs)(Z.U,{intent:"primary",children:[n.service.name,"不支持实时翻译功能，请选择名称中带有“实时语音识别”的服务。"]}),!c&&(0,L.jsxs)(O.z,{intent:"primary",icon:"play",disabled:f,onClick:()=>{$t.isOver().then((e=>{e?Kt(o):a()}))},children:["播放",u,"并开始实时翻译"]}),c&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(O.z,{intent:"primary",icon:"stop",onClick:()=>{l(),r()},children:"停止实时翻译"}),(0,L.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",textAlign:"center",color:"white"},children:(0,L.jsxs)("div",{style:{width:"80%",margin:"0 auto"},children:[(0,L.jsx)("div",{style:{marginBottom:10,fontSize:18},children:(0,L.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:g.text})}),(0,L.jsx)("div",{style:{fontSize:24},children:(0,L.jsx)("span",{style:{backgroundColor:"rgba(0,0,0,0.8)"},children:g.result})})]})})]}),(0,L.jsx)("div",{style:{opacity:.6},children:p})]})}var Jt=n(80432),Gt=function(e){return e.PerSentence="0",e.Realtime="1",e}(Gt||{});const en={[Gt.PerSentence]:"逐句翻译",[Gt.Realtime]:"实时翻译"};function tn(e){const{onText:t}=e,[n]=(0,i.useState)((()=>Array.from(document.querySelectorAll("video,audio")))),[r,s]=(0,i.useState)(0),[o,a]=(0,i.useState)(Gt.PerSentence),[l,c]=(0,i.useState)(Vt.of.TencentRealtime),[u,d]=(0,i.useState)(Jt.PK),[p,h]=(0,i.useState)(Jt.Ty.defaultLang),[f,m]=(0,i.useState)(!1),g=Xt.C[l];(0,i.useEffect)((()=>{d(Xt.UR[g.service.id]),h(g.service.defaultLang)}),[g]);const y=(0,i.useCallback)((()=>{m(!0),function(){const e=window.location.href;Yt!==e&&(Yt=e,$t.addOne())}()}),[]),v=(0,i.useCallback)((e=>{m(!1),e&&t(e)}),[t]),x=n[r],b=!x,w=l===Vt.of.WebSpeech,T=b||w;(0,i.useEffect)((()=>{null==x||x.pause()}),[x]);const S=x instanceof HTMLAudioElement?"音频":"视频";return(0,L.jsxs)(L.Fragment,{children:[b&&(0,L.jsx)(Z.U,{intent:"primary",style:{marginBottom:10},children:"当前页面没有视频或音频。"}),w&&(0,L.jsxs)(Z.U,{intent:"primary",style:{marginBottom:10},children:[g.service.name,"不支持音视频翻译功能，请选择其它语音服务。"]}),n.length>1&&(0,L.jsxs)("div",{children:["选择要翻译的音 / 视频：",(0,L.jsx)(pt.L,{disabled:f,value:r,onChange:e=>{const t=Number(e.currentTarget.value);s(t)},children:n.map(((e,t)=>(0,L.jsx)("option",{value:t,children:t},t)))})]}),(0,L.jsxs)(Bt.E,{inline:!0,className:"translate-type-selector",label:"翻译方式：",selectedValue:o,onChange:e=>{a(e.currentTarget.value)},disabled:f||T,children:[Object.keys(en).map((e=>(0,L.jsx)(ve.Y8,{value:e,children:en[e]},e))),(0,L.jsx)("a",{href:"https://hcfy.app/docs/guides/video/",target:"_blank",rel:"noreferrer",children:"查看使用说明"})]}),(0,L.jsxs)("div",{children:["选择要使用的语音识别服务：",(0,L.jsx)(pt.L,{disabled:f||T,value:l,onChange:e=>{c(e.currentTarget.value)},children:Xt.pB.map((e=>(0,L.jsx)("option",{value:e.id,children:e.name},e.id)))})]}),(0,L.jsxs)("div",{children:["选择",S,"的语种：",(0,L.jsx)(pt.L,{disabled:f||T,value:p,onChange:e=>{h(e.currentTarget.value)},children:Object.keys(u).map((e=>(0,L.jsx)("option",{value:e,children:u[e]},e)))})]}),o===Gt.PerSentence&&(0,L.jsx)(qt,{toaster:e.toaster,disabled:T,mediaElement:x,serviceImplement:g,lang:p,onStart:y,onStop:v}),o===Gt.Realtime&&(0,L.jsx)(Qt,{toaster:e.toaster,disabled:T,mediaElement:x,serviceImplement:g,lang:p,onStart:y,onStop:v})]})}function nn(e){const{show:t,onClose:n,onText:r}=e,[s,o]=(0,i.useState)(null),a=(0,i.useRef)();return(0,i.useEffect)((()=>{s&&(t?$t.isOver().then((e=>{e?(n(),Kt(s)):a.current=s.show({message:(0,L.jsx)(tn,{onText:r,toaster:s}),timeout:0,onDismiss:()=>{a.current=void 0,n()}},a.current)})):a.current&&s.dismiss(a.current))}),[n,r,t,s]),(0,L.jsx)(xe.q,{position:"bottom-right",ref:o,className:"app-toaster-container",usePortal:!1})}const rn={...(0,b.Z)(w.qI,["button","disableInTextarea","domainBlackList","domainWhiteList","textList","placement","pin","pinPos","pinIgnoreDomainList","showTextArea","panelSize","modifierKeys","modifierKeyPressedAction","modifierKeyTranslate","modifierKeyLink","ocrService","panelButtons","charsLimit","pageTrsPanelPos","pinEnhance"]),...(0,b.Z)(w.d6,["hoverTranslate"])};function sn(e,t,n,r){return!(!e&&!n)&&!(null!=r&&r.some((e=>e.test(t))))}function on(e){const{pin:t,onClick:n,size:r}=e;return(0,L.jsx)("div",{className:"switch-pin",children:(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:"pin",size:ae[r]}),small:"small"===r,large:"large"===r,minimal:!0,active:t,onClick:n})})}const an=new class{constructor(){ke(this,"topParsedData",null),ke(this,"activeFrameIndex",null),ke(this,"msgMap",new Map),ke(this,"listeners",null),this.topWorker=new Ee.U((e=>{_e("收到来自顶层 worker 发送的消息",e),this.sendMsg(e)})),this.messagePassingBetweenFrames=new Ce.C,this.messagePassingBetweenFrames.on("message",(e=>{const t=e;t&&(_e("收到来自 iframe worker 发送的消息",t),this.sendMsg(t))}))}sendMsg(e){var t,n,r,s,i;switch(e.type){case"HCFY_SELECTION_EVENT_MOUSEDOWN":this.clearSelectionData(),null===(t=this.listeners)||void 0===t||t.onMouseDown(e.event);break;case"HCFY_SELECTION_EVENT_RECEIVE_SELECTION_INFO":const{parsedData:u,activeFrameIndex:d}=je(e.data);this.topParsedData=null!=u&&u.isTop?u:null,this.activeFrameIndex=d;const{reason:p}=e.meta;var o;if("mouseup"===p)u&&(null===(o=this.listeners)||void 0===o||o.onMouseUp(u,u.mouseUpEvent));else if("hover"===p){var a;u&&(null===(a=this.listeners)||void 0===a||a.onHoverSelection(u))}else if("proactive"===p){const t=e.meta.mid;if(t){const e=this.msgMap.get(t);e&&(this.msgMap.delete(t),e(u||void 0))}}break;case"HCFY_SELECTION_EVENT_SCROLL":var l;if(this.topParsedData)null===(l=this.listeners)||void 0===l||l.onScroll(this.topParsedData,e.event);else if(this.isTopFrameActivated()){var c;const t=this.getInfoSync();t&&(null===(c=this.listeners)||void 0===c||c.onScroll(t,e.event))}else this.getInfo().then((t=>{var n;t&&(null===(n=this.listeners)||void 0===n||n.onScroll(t,e.event))}));break;case"HCFY_SELECTION_EVENT_ESC_KEY":this.clearSelectionData(),null===(n=this.listeners)||void 0===n||n.onEsc();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_ACTIVE":null===(r=this.listeners)||void 0===r||r.onModifierKeysActive();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_RELEASED":null===(s=this.listeners)||void 0===s||s.onModifierKeysReleased();break;case"HCFY_SELECTION_EVENT_ON_MODIFIER_KEYS_INTERRUPTED":null===(i=this.listeners)||void 0===i||i.onModifierKeysInterrupted()}}isTopFrameActivated(){var e;return-1===(null===(e=this.activeFrameIndex)||void 0===e?void 0:e[0])}getInfoSync(){const e=this.topWorker.sendMsg({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:"sync"});if(e)return je(e.data).parsedData}getInfo(){return new Promise((e=>{if(!this.activeFrameIndex)return void e(void 0);if(this.isTopFrameActivated())return void e(this.getInfoSync());const t=(0,Se.Z)();this.msgMap.set(t,e),this.messagePassingBetweenFrames.tell({type:"HCFY_SELECTION_EVENT_REPORT_INFO_PROACTIVE",mid:t},this.isTopFrameActivated()?"top":this.activeFrameIndex.reverse().slice(1))}))}clearSelectionData(){this.topParsedData=null}sendToAllFrames(e){this.topWorker.sendMsg(e),this.messagePassingBetweenFrames.tell(e,"all")}disableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_LINK"})}enableLink(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_LINK"})}enableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_ENABLE_HOVER_TRANSLATE"})}disableHoverTranslate(){this.sendToAllFrames({type:"HCFY_SELECTION_EVENT_DISABLE_HOVER_TRANSLATE"})}};function ln(e){const{portalContainer:t}=e,[n,r]=(0,x.Z)(rn),a="tesseractocr"===(null==n?void 0:n.ocrService),l=null==n?void 0:n.button,u=null==n?void 0:n.domainBlackList,d=null==n?void 0:n.domainWhiteList,p=null==n?void 0:n.textList,h=(null==n?void 0:n.placement)||rn.placement,f=n?n.pin:rn.pin,m=n?n.pinIgnoreDomainList:rn.pinIgnoreDomainList,g=n?n.pinEnhance:rn.pinEnhance,y=(null==n?void 0:n.panelSize)||rn.panelSize,v="small"===y,b="large"===y,w=(0,i.useMemo)((()=>null==p?void 0:p.reduce(((e,t)=>(t.enabled&&e.push(new RegExp(t.value)),e)),[])),[p]),T=(0,i.useCallback)((e=>{r("function"==typeof e?t=>{t.pin=e(t.pin)}:{pin:e})}),[r]),[S,E]=(0,i.useState)(null),[C,k]=(0,i.useState)(!1),_=(0,i.useRef)(null),[j,N]=(0,i.useState)(),R=n?n.hoverTranslate:rn.hoverTranslate,[P,I]=(0,i.useState)(void 0),M=(()=>{const e=window.location.href;return!!(0,be.ZP)(e)||(!!(f&&m&&C)||(void 0!==d&&void 0!==u?function(e,t,n){const r=ye(e,t,n);return!r.urlParts||r.whiteListMatched||!r.blackListMatched}(e,u,d):void 0))})();(0,i.useEffect)((()=>{if(f){function e(){I(window.innerHeight)}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}I(void 0)}),[f]);const F=(0,i.useRef)(null);(0,he.Z)(t),(0,he.Z)(F.current);const[U,D]=(0,i.useState)(!1),[Z,B]=(0,i.useState)(""),[H,$]=(0,i.useState)(null);async function Y(){const e=await an.getInfo();var t;e&&(N(e.range),null===(t=q.current)||void 0===t||t.translate({type:"text",text:e.text}),k(!0))}(0,i.useEffect)((()=>{if(!t)return;const e=new o.T(t,c.ZOf);return e.start(),()=>{e.stop()}}),[t]);const K=(0,i.useRef)(C),q=(0,i.useRef)(null);async function V(){B(await s().runtime.sendMessage({action:"take screenshot"})),D(!0)}(0,i.useEffect)((()=>(C&&!K.current&&s().storage.local.get("autoPlay").then((({autoPlay:e})=>{var t;e&&(null===(t=q.current)||void 0===t||t.play())})),()=>{K.current=C})),[C]);const X=(0,i.useCallback)((()=>{E(null),Y()}),[]);(0,i.useEffect)((()=>{s().runtime.onMessage.addListener((e=>{var t;switch(e){case"translate":return void X();case"getSelectionText":return an.getInfo().then((e=>(null==e?void 0:e.text)||""));case"screenshot translate":V();break;case"hover translate":r((e=>{e.hoverTranslate=!e.hoverTranslate}));break;case"page translate":G((e=>!e));break;case"video translate":ne((e=>!e));break;case"play":null===(t=q.current)||void 0===t||t.play()}}))}),[X,r]),(0,i.useEffect)((()=>{function e(){an.enableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&r({hoverTranslate:!1})}void 0!==M&&void 0!==l&&w&&(an.listeners={onMouseUp(e,t){if(null!=n&&n.disableInTextarea&&(e.isInTextarea||e.isInContentEditable))return;if(null!=n&&n.charsLimit&&e.text.length>n.charsLimit)return;const r=t&&"selection"===(null==n?void 0:n.modifierKeyPressedAction)&&(0,we.Pe)(t,n.modifierKeys);sn(M,e.text,r||!1,w)&&(C||!l||r?Y():E(e.btnPos))},onMouseDown(){E(null),f&&g||k(!1)},onScroll(e,t){e.isTop&&(null==t?void 0:t.target)===document||N(e.isTop?Object.assign({},e.range):e.range)},onEsc(){E(null),k(!1)},onModifierKeysActive(){null!=n&&n.modifierKeyLink&&an.disableLink(),"hover"===(null==n?void 0:n.modifierKeyPressedAction)&&r({hoverTranslate:!0})},onModifierKeysReleased(){e(),null!=n&&n.modifierKeyTranslate&&X()},onModifierKeysInterrupted(){e()},onHoverSelection(e){sn(!0,e.text,!1,w)&&Y()}})}),[l,M,w,C,null==n?void 0:n.modifierKeyLink,null==n?void 0:n.modifierKeyPressedAction,null==n?void 0:n.modifierKeyTranslate,null==n?void 0:n.modifierKeys,null==n?void 0:n.disableInTextarea,null==n?void 0:n.charsLimit,f,X,r,g]),(0,i.useEffect)((()=>{pe.B||(R?an.enableHoverTranslate():an.disableHoverTranslate())}),[R]);const Q=(0,L.jsx)(O.z,{className:"cut-btn",onClick:V,icon:(0,L.jsx)(A.I,{icon:"cut",size:ae[y]}),small:"small"===y,large:"large"===y,minimal:!0,title:"截图翻译"}),[J,G]=(0,i.useState)(!1),ee=(0,L.jsx)(O.z,{className:"cut-btn",onClick:()=>G(!0),icon:(0,L.jsx)(A.I,{icon:"translate",size:ae[y]}),small:"small"===y,large:"large"===y,minimal:!0,title:"网页全文翻译"}),[te,ne]=(0,i.useState)(!1),re=(0,L.jsx)(O.z,{className:"cut-btn",onClick:()=>ne(!0),icon:(0,L.jsx)(A.I,{icon:"video",size:ae[y]}),small:"small"===y,large:"large"===y,minimal:!0,title:"音视频翻译",style:{marginRight:2}}),se=(0,i.useRef)(null);return(0,L.jsxs)("div",{id:"app",ref:F,children:[n&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(de,{btnPos:S,setBtnPos:E,onBtnClick:X}),(0,L.jsx)(z,{show:C,pin:f,setMaxHeight:I,setPin:T,range:j,placement:h,ref:_,targetRef:se,children:(0,L.jsx)(le,{hasDragTip:!0,ref:q,elementRef:se,style:{maxHeight:P},showOptionsTip:C,headerLeft:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(on,{pin:f,onClick:()=>{r((e=>{const t=!e.pin;e.pin=t,window.setTimeout((()=>{var e,n;t?null===(e=_.current)||void 0===e||e.switch2pin():null===(n=_.current)||void 0===n||n.clearPos()}))}))},size:y}),(null==n?void 0:n.panelButtons.includes("cut"))&&Q,(null==n?void 0:n.panelButtons.includes("translate"))&&ee,(null==n?void 0:n.panelButtons.includes("video"))&&re]}),headerRight:(0,L.jsx)(O.z,{icon:(0,L.jsx)(A.I,{icon:"cross",size:ae[y]+4}),onClick:()=>{k(!1)},small:v,large:b,minimal:!0,title:"关闭(Esc)"}),extendOptions:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(ve.XZ,{inline:!0,large:b,label:"显示文本框",checked:n.showTextArea,onChange:e=>{r({showTextArea:e.target.checked})}}),(0,L.jsx)(ve.XZ,{large:b,style:{marginRight:"0"},disabled:pe.B,label:"鼠标悬浮取词",inline:!0,checked:R,onChange:()=>r((e=>{e.hoverTranslate=!e.hoverTranslate}))})]}),showTextArea:n.showTextArea,toaster:H||void 0,size:y,portalContainer:t})})]}),(0,L.jsx)(xe.q,{position:"top",ref:$,className:"app-toaster-container",usePortal:!1}),(0,L.jsx)(Zt,{open:J,setOpen:G,portalContainer:t,pos:n?n.pageTrsPanelPos:rn.pageTrsPanelPos}),(0,L.jsx)(ze,{isShow:U,setIsShow:D,isLocalOCR:a,imgSrc:Z,portalContainer:t,onText:(e,t)=>{var n;null===(n=q.current)||void 0===n||n.translate({type:"image",dataURI:e}).then((()=>{const e=window.pageXOffset,n=window.pageYOffset;N({getBoundingClientRect(){const r=t.top-(window.pageYOffset-n),s=t.left-(window.pageXOffset-e);return{top:r,left:s,width:t.width,height:t.height,right:s+t.width,bottom:r+t.height}}}),k(!0)}),W.Z)}}),(0,L.jsx)(nn,{show:te,onClose:()=>ne(!1),onText:e=>{var t;null===(t=q.current)||void 0===t||t.translate({type:"text",text:e}),k(!0)}})]})}var cn=n(55548),un=n.n(cn);var dn=n(51308);function pn(){return(0,L.jsx)(dn.Z,{id:"__hcfy__",stylesheetURLs:["blueprint-select.css","cropper.css"],cssText:(e=un(),e.replace(/url\((["']?)(.*?)\1\)/g,(function(e,t,n){return n.startsWith("data:")?e:`url(${s().runtime.getURL(n)})`}))),children:e=>(0,L.jsx)(ln,{portalContainer:e||void 0})});var e}},84609:(e,t,n)=>{"use strict";n.d(t,{B:()=>i,Z:()=>o});var r=n(13474);const s=document.caretPositionFromPoint?function(e,t){const n=document.caretPositionFromPoint(e,t);return n&&{offsetNode:n.offsetNode,offset:n.offset}}:document.caretRangeFromPoint?function(e,t){const n=document.caretRangeFromPoint(e,t);return n&&{offsetNode:n.startContainer,offset:n.startOffset}}:void 0;const i=!s;class o{constructor(e,t=1e3,n,i=document.body){this.destroyed=!1,this.context=i,this.onMouseMove=(0,r.Z)((t=>{n&&!t[n]||(!function(e,t){if(!s)return null;const n=window.getSelection();if(!n)return null;const r=s(e,t);if(!r)return null;const{offset:i,offsetNode:o}=r;if(o.nodeType!==Node.TEXT_NODE)return null;const a=n.rangeCount>0?n.getRangeAt(0):void 0;n.removeAllRanges();const l=document.createRange();l.setStart(o,i),l.setEnd(o,i),n.addRange(l),n.modify("move","backward","word"),n.modify("extend","forward","word");const c=n.getRangeAt(0).getBoundingClientRect();(c.left>e||c.left+c.width<e||c.top>t||c.top+c.height<t)&&(n.removeAllRanges(),a&&n.addRange(a))}(t.clientX,t.clientY),e(t))}),t),i.addEventListener("pointermove",this.onMouseMove)}destroy(){this.destroyed=!0,this.context.removeEventListener("pointermove",this.onMouseMove)}}},55773:(e,t,n)=>{"use strict";n.d(t,{Pe:()=>l,dD:()=>c,oJ:()=>o});n(15735),n(6886),n(39529);var r=n(8721),s=n(25130);const i=n.n(s)()("hotkeys"),o={ctrl:r.eE?"metaKey":"ctrlKey",alt:"altKey",shift:"shiftKey"},a={ctrl:r.eE?r.vU?[224]:[91,93]:[17],alt:[18],shift:[16]};function l(e,t){return!(!t||!t.length)&&t.every((t=>e[o[t]]))}function c(e,t,n,r){const s=new Set;let o=!1;function l(){s.clear(),o?(o=!1,i("辅助键处于激活状态，执行中断回调"),r()):i("辅助键未处于激活状态")}function c(){i("页面失去了焦点，执行中断操作"),l()}function u(n){const r=n.keyCode,c=s.size;if(!e.some((e=>{if(a[e].includes(r))return s.add(e),!0})))return i("按下了不是辅助键的其它键，执行中断操作"),void l();c!==s.size&&(i("按下了新的辅助键，当前已经按下的辅助键：",[...s]),s.size===e.length&&(i("全部辅助键已按下，将辅助键改为激活状态，并执行辅助键按下回调"),o=!0,t()))}function d(t){const r=t.keyCode,l=s.size;if(!l)return;e.some((e=>{if(a[e].includes(r))return s.delete(e),!0}))&&l!==s.size&&(i("松开了新的辅助键，当前已经按下的辅助键：",[...s]),o=!1,e.length-s.size==1&&(i("一个辅助键已松开，执行辅助键松开回调"),n()))}return window.addEventListener("keydown",u),window.addEventListener("blur",c),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("blur",c),window.removeEventListener("keyup",d)}}},8721:(e,t,n)=>{"use strict";n.d(t,{XO:()=>a,eE:()=>o,un:()=>l,vU:()=>c});n(39529);var r=n(50251),s=n.n(r);const i=window.navigator.userAgent,o=i.includes("Mac"),a=i.includes("Chrome"),l=i.includes("Edg"),c=i.includes("Firefox");function u(e){return e.split(".").map((e=>Number(e)))}u(s().runtime.getManifest().version)},51308:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});n(15735),n(6886);var r=n(50251),s=n.n(r),i=n(41831),o=n(31411),a=n.n(o),l=n(2784),c=n(52322);function u(e){const{children:t,id:n,stylesheetURLs:r,cssText:o}=e,[u,d]=(0,l.useState)(null),p=(0,l.useRef)(null);return(0,l.useEffect)((()=>{const e=document.getElementById("dark-mode");if(!e)return;const t=()=>{if(e.getAttribute("href")){var t;const e=null===(t=p.current)||void 0===t?void 0:t.shadowRoot;e&&setTimeout((()=>{e.adoptedStyleSheets=[]}),800)}};t();const n=new MutationObserver(t);return n.observe(e,{attributeFilter:["href"]}),()=>{n.disconnect()}}),[]),(0,c.jsxs)(i.ZP.div,{style:{all:"initial"},id:n,ref:p,children:[(0,c.jsx)("style",{children:a()}),(0,c.jsx)("link",{rel:"stylesheet",href:s().runtime.getURL("normalize.css")}),(0,c.jsx)("link",{rel:"stylesheet",href:s().runtime.getURL("blueprint.css")}),null==r?void 0:r.map((e=>(0,c.jsx)("link",{rel:"stylesheet",href:s().runtime.getURL(e)},e))),o&&(0,c.jsx)("style",{children:o}),(0,c.jsx)("div",{id:"root",ref:d,dir:"ltr",children:t(u)})]})}},81139:(e,t,n)=>{"use strict";n.d(t,{H:()=>i,Q:()=>s});n(15735),n(6886);var r=n(2784);function s(e){return{h:e.scrollWidth>e.clientWidth,v:e.scrollHeight>e.clientHeight}}function i(e){const[t,n]=(0,r.useState)({v:!1,h:!1});return(0,r.useEffect)((()=>{if(!e)return;const t=()=>{n(s(e))};t();const r=new ResizeObserver(t);return r.observe(e),()=>{r.unobserve(e)}}),[e]),t}},80471:(e,t,n)=>{"use strict";n.d(t,{U:()=>u,o:()=>h});n(77950),n(73439),n(71372),n(15735),n(6886),n(634);var r=n(35368),s=n(64643);function i(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,c(e,t,"get"))}function l(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,c(e,t,"set"),n),n}function c(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}let u=function(e){return e.both="both",e.source="source",e.result="result",e}({});var d=new WeakMap,p=new WeakMap;class h{constructor(e,t,n,r){o(this,"inited",!1),o(this,"valid",!0),o(this,"isOnlyChild",!1),o(this,"destroyed",!1),o(this,"innerText",""),o(this,"translating",!1),o(this,"translated",!1),o(this,"inline",!1),o(this,"showType",u.source),i(this,d,{writable:!0,value:void 0}),i(this,p,{writable:!0,value:void 0}),this.rootNode=e,this.sourceNodes=t,this.translateFn=n,l(this,d,new s.rh),a(this,d).props.editable=null!=(null==r?void 0:r.editable)&&r.editable,a(this,d).props.onRetry=()=>this.retry(),function(e,t,n){const r=n.nextSibling;r?e.insertBefore(t,r):e.appendChild(t)}(e,a(this,d).container,t[t.length-1])}init(){this.destroyed||this.inited||(this.calcInnerText(),this.valid=function(e){const t=e.trim();return!!t&&!/^[0-9\s.\-_#:()!•+~@$%^&*\n\/`]+$/.test(t)}(this.innerText),this.valid||this.destroy(),this.inited=!0)}calcInnerText(){const{sourceNodes:e,rootNode:t}=this;let n;if(this.isOnlyChild){const e=this.showType;this.switchShowType(u.source),n=function(e){if(e instanceof HTMLElement)return e.innerText;const t=document.createElement("hcfy-result");Array.from(e.childNodes).forEach((e=>{t.appendChild(e)})),e.appendChild(t);const n=t.innerText;return e.removeChild(t),Array.from(t.childNodes).forEach((t=>{e.appendChild(t)})),n}(t).trim(),this.switchShowType(e)}else{const t=document.createElement("span");e.forEach((e=>{t.appendChild(e)})),document.documentElement.appendChild(t),n=t.innerText.trim(),document.documentElement.removeChild(t),this.showType!==u.result&&this.appendSourceNodes()}this.innerText=n}setOnlyChild(){if(this.destroyed)return;const{rootNode:e}=this;this.isOnlyChild=!0,this.inited&&this.calcInnerText(),e instanceof Element&&("span"===e.nodeName.toLowerCase()||function(e,t,n=3){let r=e,s=0;do{if(s+=1,r.matches(t))return r;if(s===n)return null;r=r.parentElement}while(r);return null}(e,"a, button, [role=button], h1,h2,h3,h4,h5,h6"))&&(this.inline=!0,this.inited&&this.renderResult())}destroy(){this.switchShowType(u.source),this.removeResult(),a(this,d).destroy(),this.destroyed=!0}renderResult(e){this.translating?a(this,d).props.mode="hide":this.showType===u.both?a(this,d).props.mode="comparison":this.showType===u.result?a(this,d).props.mode="plain":a(this,d).props.mode="hide",a(this,d).props.comparison.newLine=!this.inline,e&&(a(this,d).props.content=e),a(this,d).render()}async translate(){if(this.inited||this.init(),this.destroyed||!this.innerText)return;if(this.translating||this.translated)return;let e;this.translating=!0;try{e=await this.translateFn(this.innerText)}catch(e){if(this.destroyed)return;if(this.translating=!1,this.translated=!0,this.renderResult({error:(0,r.sanitize)(e.message+(e.link?`<a target='_blank' href='${e.link.url}'>${e.link.name}</a>`:""),{ALLOWED_TAGS:["a","#text","b","i"],ALLOWED_ATTR:["target","rel","href","class"]}),type:"html"}),a(this,p)){const e=a(this,p);l(this,p,void 0),this.switchShowType(e)}return}if(!this.destroyed){if(this.translating=!1,null==e)return this.translate();if(this.translated=!0,this.renderResult({value:e,type:"text"}),a(this,p)){const e=a(this,p);l(this,p,void 0),this.switchShowType(e)}}}retry(){if(!this.translated)throw new Error("未翻译过");l(this,p,this.showType),this.switchShowType(u.source),a(this,d).props.content=void 0,a(this,d).renderInner(),this.translated=!1,this.translate()}removeSourceNodes(){const{rootNode:e,sourceNodes:t}=this;t.forEach((t=>{try{e.removeChild(t)}catch(e){}}))}appendSourceNodes(){const{rootNode:e}=this,t=a(this,d).container;this.sourceNodes.forEach((n=>{try{e.insertBefore(n,t)}catch(e){}}))}removeResult(){try{this.rootNode.removeChild(a(this,d).container)}catch(e){}}switchShowType(e){if(this.destroyed||e===this.showType)return;if(!this.translated)return void l(this,p,e);const t=this.showType;switch(this.showType=e,e){case u.source:t===u.result&&this.appendSourceNodes(),a(this,d).props.mode="hide",this.renderResult();break;case u.result:a(this,d).props.mode="plain",this.renderResult(),this.removeSourceNodes();break;case u.both:a(this,d).props.mode="comparison",this.renderResult(),t===u.result&&this.appendSourceNodes();break;default:throw this.showType=t,new TypeError(`不支持的显示类型：${e}`)}}}},23268:(e,t,n)=>{var r=n(39601),s=n(82609),i=n(78991),o=n(30659),a=n(17919),l=s(r),c=i(o),u=i(a);l.push([e.id,`#translate-panel{background-color:#f6f7f9;display:flex;flex-direction:column;padding-bottom:8px}.bp5-dark #translate-panel{background-color:#252a31}#translate-panel .fixed{flex-shrink:0;margin-bottom:10px}#translate-panel .body{flex-grow:1;overflow:auto;overscroll-behavior:contain}#translate-panel .body::-webkit-scrollbar{width:8px;background-color:rgba(0,0,0,0);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar:hover{background-color:rgba(0,0,0,.09)}#translate-panel .body::-webkit-scrollbar-thumb:vertical{background:rgba(0,0,0,.5);-webkit-border-radius:100px}#translate-panel .body::-webkit-scrollbar-thumb:vertical:active{background:rgba(0,0,0,.61);-webkit-border-radius:100px}#translate-panel.size-small,#translate-panel.size-small h6.bp5-heading,#translate-panel.size-small .bp5-control.bp5-large,#translate-panel.size-small textarea.bp5-input.bp5-small{font-size:14px}#translate-panel.size-small .phonetic-item,#translate-panel.size-small .quick-settings a{font-size:12px}#translate-panel.size-middle,#translate-panel.size-middle h6.bp5-heading,#translate-panel.size-middle .bp5-control.bp5-large,#translate-panel.size-middle textarea.bp5-input{font-size:18px}#translate-panel.size-middle .phonetic-item,#translate-panel.size-middle .quick-settings a{font-size:14px}#translate-panel.size-large,#translate-panel.size-large h6.bp5-heading,#translate-panel.size-large .bp5-control.bp5-large,#translate-panel.size-large textarea.bp5-input.bp5-large{font-size:22px}#translate-panel.size-large .source,#translate-panel.size-large .phonetic-item,#translate-panel.size-large .quick-settings a{font-size:18px}#translate-panel .bp5-button.bp5-small,#translate-panel .bp5-small .bp5-button{min-height:20px;min-width:20px}#translate-panel .header{display:flex;align-items:center;padding:4px 6px 4px 10px;border-bottom:1px solid #d1d1d1}.bp5-dark #translate-panel .header{border-bottom-color:rgba(17,20,24,.4)}#translate-panel .header .drag-block{min-width:5px;flex-shrink:0;flex-grow:1;align-self:stretch}#translate-panel .header .left{flex-shrink:0;display:flex}#translate-panel .header .right{flex-shrink:0;display:flex;align-items:center}#translate-panel .header .right .bp5-icon-arrow-right{flex-shrink:0;margin:0 5px}#translate-panel .header .right>.bp5-button{flex-shrink:0;margin:0 1px}#translate-panel .header .right>.bp5-button:last-child{margin-right:0}#translate-panel .quick-settings{padding:4px 9px;margin:0 1px}#translate-panel .quick-settings>div{margin-bottom:5px}#translate-panel .quick-settings .bp5-control{margin-bottom:0}#translate-panel .query-text{position:relative;padding:10px 10px 2px 10px}#translate-panel .query-text textarea.bp5-input{min-height:44px;font-family:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";overscroll-behavior:contain}#translate-panel .query-text .translate-btn{position:absolute;opacity:.6}#translate-panel .query-text .translate-btn:hover{opacity:1}#translate-panel .body{padding:0 10px}#translate-panel .body .bp5-card:first-child{margin-top:1px}#translate-panel .body .bp5-card:last-child{margin-bottom:1px}#translate-panel .body .no-api{margin:20px 0}.result-block{margin:8px 0;padding:2px 5px}.result-block .bp5-button{visibility:hidden}.result-block .error .bp5-button,.result-block:hover .bp5-button{visibility:visible}.result-block .legend{display:flex;align-items:center;justify-content:space-between}.result-block .legend .legend-left{display:flex;align-items:center}.result-block .legend .api-ico,.result-block .legend .bp5-heading{flex-shrink:0;white-space:nowrap}.result-block .legend .api-ico{display:inline-block;width:14px;height:14px;background-size:contain;margin-right:3px}.result-block .legend .bp5-heading{margin-bottom:0;margin-right:10px}.result-block .legend .source{cursor:pointer;font-size:12px;display:inline-flex;align-items:center}.result-block .legend .source .source-text{overflow:hidden}.result-block .legend .source .bp5-icon{position:relative;top:-1px;margin-left:1px}.result-block .phonetic{display:flex;flex-wrap:wrap}.result-block .phonetic .phonetic-item{display:flex;align-items:center;font-size:12px}.result-block .phonetic .phonetic-item:not(:last-child){margin-right:12px}.result-block .common-result p{line-height:1.3;margin:2px 0;overflow-wrap:break-word}.result-block .common-result .dict a{text-decoration:underline}.result-block .error{font-size:12px;padding:5px 10px}.result-block .dict-pos{margin-right:5px}.external-translators{margin-bottom:3px;padding:0;display:flex;flex-wrap:wrap}.external-translators>div{margin:0 5px 5px 0}.quick-links a{margin:0 5px 5px 0}#popper-container{width:250px;max-width:100%;position:absolute;left:0;top:0;z-index:9999999998;touch-action:none;transition:opacity .2s;background-color:#f6f7f9}.bp5-dark #popper-container{background-color:#252a31}#popper-container.show{opacity:1;pointer-events:auto;user-select:auto}#popper-container,#popper-container[data-popper-reference-hidden=true]{opacity:0;pointer-events:none;user-select:none}#popper-container .drag-block{cursor:grab}#popper-container.pin{position:fixed}#popper-container.pin .arrow{display:none}#popper-container .arrow,#popper-container .arrow::before{position:absolute;width:8px;height:8px;z-index:-1}#popper-container .arrow::before{content:"";transform:rotate(45deg);background:#f6f7f9}.bp5-dark #popper-container .arrow::before{background-color:#252a31}#popper-container .arrow{display:none}#popper-container.show[data-popper-placement]:not([data-popper-reference-hidden=true]) .arrow{display:block}#popper-container[data-popper-placement^=top] .arrow{bottom:-5px}#popper-container[data-popper-placement^=top] .arrow::before{border-right:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#popper-container[data-popper-placement^=bottom] .arrow{top:-5px}#popper-container[data-popper-placement^=bottom] .arrow::before{border-left:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=left] .arrow{right:-5px}#popper-container[data-popper-placement^=left] .arrow::before{border-right:1px solid #d1d1d1;border-top:1px solid #d1d1d1}#popper-container[data-popper-placement^=right] .arrow{left:-5px}#popper-container[data-popper-placement^=right] .arrow::before{border-left:1px solid #d1d1d1;border-bottom:1px solid #d1d1d1}#translate-btn{display:none;position:absolute;z-index:9999999999;left:0;top:0}#translate-btn .bp5-button{padding:2px;min-width:0;min-height:0}#translate-btn .btn-icon{width:18px;height:18px;background-image:url(${c});background-size:contain}.bp5-dark #translate-btn .btn-icon{background-image:url(${u})}#translate-btn.show{display:block}.translate-type-selector .bp5-label{display:inline}.translate-type-selector .bp5-radio{margin-bottom:0}#ocr-container{position:fixed;z-index:99999999999999;left:0;top:0;right:0;bottom:0}#ocr-container .toolbar{display:none;position:absolute;z-index:1}#ocr-container img{max-width:100%}#app{cursor:default}.switch-pin{flex-shrink:0;cursor:pointer}.switch-pin .bp5-icon-pin{transition:transform .2s,color .2s;transform:rotate(-45deg)}.pin .switch-pin .bp5-icon-pin{transform:rotate(-70deg)}.cut-btn{margin-left:2px}.app-toaster-container{position:fixed !important;z-index:9999999999 !important}.app-toaster-container .bp5-toast{min-width:auto}#web-trs-panel .app-toaster-container{padding-right:0;padding-left:0}#web-trs-panel .page-trs-form-group{margin:0 0 0 0;align-items:center}#web-trs-panel .page-trs-form-group>label{width:70px}`,""]),e.exports=l},38689:(e,t,n)=>{var r=n(39601),s=n(82609)(r);s.push([e.id,'#root{-webkit-text-size-adjust:100%;box-sizing:border-box;font-size:14px;font-weight:400;letter-spacing:0;line-height:1.28581;text-transform:none;color:#182026;font-family:-apple-system,"BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Open Sans","Helvetica Neue","Icons16",sans-serif}#root{touch-action:manipulation}#root>.bp5-portal{z-index:9999999999}',""]),e.exports=s},30659:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"logo.png"},17919:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"logowhite36.png"},55548:(e,t,n)=>{var r=n(23268);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},31411:(e,t,n)=>{var r=n(38689);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},74584:(e,t,n)=>{"use strict";n.d(t,{r:()=>m});n(71372),n(15735),n(6886),n(634);var r=n(52322),s=n(2784),i=n(41188);const o={visibility:"visible"};function a(e){const{content:t,onRetry:n,editable:a,onEdit:l}=e,[c,u]=(0,s.useState)(null),{isEditing:d,props:p}=function(e,t,n,r="text"){const[o,a]=(0,s.useState)(!1);return(0,i.oJ)(t?e:null,(()=>{a(!0)})),(0,s.useEffect)((()=>{t||a(!1)}),[t]),(0,s.useEffect)((()=>{o&&e&&e.focus()}),[e,o]),(0,s.useEffect)((()=>{if(!o||!e)return;const t=t=>{const n=t.target;e.contains(n)||a(!1)};return document.addEventListener("pointerup",t),()=>{document.removeEventListener("pointerup",t)}}),[o,e]),(0,s.useEffect)((()=>{if(!o||!e||!n)return;const t=e=>{const t=e.target;n({value:"html"===r?t.innerHTML:t.innerText,type:r})};return e.addEventListener("input",t),()=>{e.removeEventListener("input",t)}}),[e,o,n,r]),t?{isEditing:o,props:{contentEditable:o?"true":void 0}}:{isEditing:o}}(c,a&&!!t&&"value"in t,l,null==t?void 0:t.type);return(0,s.useEffect)((()=>{if(d&&c)return c.closest("hcfy-result").classList.add("__hcfy-result-editing__"),()=>{c.closest("hcfy-result").classList.remove("__hcfy-result-editing__")}}),[c,d]),t?(0,r.jsxs)(r.Fragment,{children:["html"===t.type?(0,r.jsx)("hcfy-result-content",{style:o,ref:u,...p,dangerouslySetInnerHTML:{__html:"value"in t?t.value:t.error}}):(0,r.jsx)("hcfy-result-content",{style:o,ref:u,...p,children:"value"in t?t.value:t.error}),(0,r.jsx)("hcfy-result-actions",{style:o,children:"error"in t&&(0,r.jsx)("button",{onClick:n,children:"点击重试"})})]}):null}var l=n(17029);function c(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,h(e,t,"get"))}function p(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,h(e,t,"set"),n),n}function h(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var f=new WeakMap;class m{constructor(){u(this,"container",void 0),c(this,f,{writable:!0,value:void 0}),u(this,"props",void 0);const e=document.createElement("hcfy-result");e.style.display="none";const t=(0,l.s)(e);this.container=e,p(this,f,t),this.props={mode:"hide",comparison:{newLine:!0},editable:!1}}renderContainer(){switch(this.props.mode){case"hide":this.container.style.display="none",this.container.className="";break;case"plain":this.container.style.display="inline-block",this.container.className="";break;case"comparison":this.container.style.display=this.props.comparison.newLine?"block":"inline-block",this.container.className="__hcfy-result-comparison__ "+(this.props.comparison.newLine?"__hcfy-result-comparison-block__":"__hcfy-result-comparison-inline__")}}renderInner(){d(this,f).render((0,r.jsx)(a,{content:this.props.content,editable:this.props.editable,onEdit:e=>{var t,n;null===(t=(n=this.props).onEdit)||void 0===t||t.call(n,e),this.props.content=e},onRetry:this.props.onRetry}))}render(){this.renderContainer(),this.renderInner()}destroy(){d(this,f).unmount()}}},99687:(e,t,n)=>{"use strict";n.d(t,{HQ:()=>o,Su:()=>i,Xi:()=>c,Yx:()=>r,kw:()=>l,l:()=>s,pZ:()=>a});const r="",s=".__hcfy-result-comparison__ {\n  outline: 1px dotted;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}",i=".__hcfy-result-comparison__ {\n  outline: 1px dotted var(--hcfy-result-main-color, #008B45);\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}",o=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) wavy underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",a=".__hcfy-result-comparison__ hcfy-result-content {\n  text-decoration: var(--hcfy-result-main-color, #008B45) underline;\n  text-underline-offset: 0.2em;\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  text-decoration: none;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",l=".__hcfy-result-comparison__ hcfy-result-content {\n  background-color: var(--hcfy-result-main-color, #008B45);\n  color: var(--hcfy-result-text-color, white);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-editing__ hcfy-result-content {\n  background: unset;\n  color: unset;\n}\n\n.__hcfy-result-editing__ {\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}\n\n.__hcfy-result-comparison-inline__ hcfy-result-content {\n  margin-left: 0.4em;\n}",c=".__hcfy-result-comparison__ {\n  border-left: 3px solid var(--hcfy-result-main-color, #008B45);\n  padding-left: 6px;\n}\n\n.__hcfy-result-comparison__ hcfy-result-content {\n  color: var(--hcfy-result-text-color, unset);\n  font-size: var(--hcfy-result-text-size, unset);\n  font-weight: var(--hcfy-result-text-weight, unset);\n}\n\n.__hcfy-result-comparison-block__ {\n  padding: 6px 0 6px 12px;\n}\n\n.__hcfy-result-comparison-inline__ {\n  margin-left: 0.4em;\n}\n\n.__hcfy-result-editing__ {\n  border-left-color: transparent;\n  outline: 2px solid #2d72d2;\n  border-radius: 2px;\n}\n\nhcfy-result-content:focus {\n  outline: none;\n}"},64643:(e,t,n)=>{"use strict";n.d(t,{rh:()=>r.r,kw:()=>s.kw,Su:()=>s.Su,l:()=>s.l,pZ:()=>s.pZ,Yx:()=>s.Yx,Xi:()=>s.Xi,HQ:()=>s.HQ});var r=n(74584),s=n(99687)}}]);