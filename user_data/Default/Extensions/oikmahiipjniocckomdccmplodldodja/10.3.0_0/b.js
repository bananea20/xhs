(()=>{var e,t={40048:(e,t,s)=>{"use strict";s.d(t,{$o:()=>l,ff:()=>p});s(71372),s(43108),s(36728);var a=s(88120),n=s(99853),o=s(41215),r=s(50251),i=s.n(r),c=s(74875);const l=!0,d={id:n.gu.BaiDu,name:"百度文字识别",points:!0,secretKeys:{get:()=>i().storage.local.get({baiDuOCRKey:[]}).then((({baiDuOCRKey:e})=>(Array.isArray(e)?e:[e]).map((e=>({id:e.key,key:e.secret}))))),set:e=>i().storage.local.set({baiDuOCRKey:e.map((e=>({key:e.id,secret:e.key})))}),isComplete:e=>(0,c.dz)(e,["id"])},pointsEnable:{get:()=>i().storage.local.get({bdOcrPoints:l}).then((({bdOcrPoints:e})=>e)),set:e=>i().storage.local.set({bdOcrPoints:e})}};class u extends a.E{constructor(){super(d,!0)}callBySecretKey(e,t){return new o.w(e).ocr(t.image)}transform(e){if(!e.paragraphs_result)throw new Error("百度文字识别服务配置有误，请确认你领取过免费资源包，且密钥填写无误。");return e.paragraphs_result.reduce(((t,{words_result_idx:s})=>(t.push(s.reduce(((t,s)=>t+e.words_result[s].words),"")),t)),[]).join("\n")}}const p=new u},98269:(e,t,s)=>{"use strict";s.d(t,{Ds:()=>y,Il:()=>m,Kl:()=>u,Wx:()=>p,YU:()=>h,oK:()=>f});s(73439);var a=s(27126),n=s(92658),o=s(85756),r=s(99853),i=s(50251),c=s.n(i),l=s(17419),d=s(74875);const u=!0,p={id:r.nV.ALi,name:"阿里翻译",points:!0,secretKeys:{get:()=>c().storage.local.get({aLiApiKey:[]}).then((({aLiApiKey:e})=>Array.isArray(e)?e:[e])),set:e=>c().storage.local.set({aLiApiKey:e}),isComplete:e=>(0,d.dz)(e,["id"])},pointsEnable:{get:()=>c().storage.local.get({aliPoints:u}).then((({aliPoints:e})=>e)),set:e=>c().storage.local.set({aliPoints:e})}},h=!0,m={id:r.nV.ALiPro,name:"阿里翻译（专业版）",points:!0,getDomain:()=>c().storage.local.get("aliDomain").then((({aliDomain:e})=>e)),secretKeys:p.secretKeys,pointsEnable:{get:()=>c().storage.local.get({aliProPoints:h}).then((({aliProPoints:e})=>e)),set:e=>c().storage.local.set({aliProPoints:e})}};class g extends o.s{constructor(e){super(e,{standardMap:a,retry:!0})}isSuccessResponse(e){return(0,n.nX)(e)}throwErrorResponse(e){throw new l.mD(`${this.service.name}报错了，错误码：${e.Code}，错误消息："${e.Message}"`,{type:l.cF.API_SERVER_ERROR,link:{name:"查看错误码释义",url:this.service.getDomain?"https://help.aliyun.com/document_detail/158267.html":"https://help.aliyun.com/document_detail/158244.html"}})}isSameLang(e,t){return(0,n.Ky)(e,t.text)}async callBySecretKey(e,t){const s=await(0,n.ZP)(t.text,t.destination,e,{source:t.source,domain:t.domain});return this.isSuccessResponse(s)||this.throwErrorResponse(s),s}transform(e,t){const s=e.text,a=e.destinations[e.destIndex],n={text:s,link:`https://translate.alibaba.com/#hcfy_text=${encodeURIComponent(s)}&hcfy_from=auto&hcfy_to=${a}`,from:e.source&&this.convertToStandard(e.source),to:a&&this.convertToStandard(a)};if(t)try{n.result=t.Data.Translated.split("\n")}catch(e){}return n}}const f=new g(p),y=new g(m)},67956:()=>{chrome.webRequest.onBeforeSendHeaders.addListener((function(e){var t=e.requestHeaders;return t.some((function(e){if("hcfy-Date"===e.name)return e.name="Date",!0})),{requestHeaders:t}}),{urls:["https://mt.cn-hangzhou.aliyuncs.com/api/translate/web/general","https://mt.cn-hangzhou.aliyuncs.com/api/translate/web/ecommerce"],types:["xmlhttprequest"]},["blocking","requestHeaders"])},59250:(e,t,s)=>{"use strict";s.d(t,{Fi:()=>u,ZX:()=>h,b4:()=>y,gG:()=>m,pe:()=>p,qj:()=>f});s(73439);var a=s(50251),n=s.n(a),o=s(65314),r=s(85756),i=s(99853),c=s(59773),l=s(17419),d=s(74875);const u=!0,p={id:i.nV.BaiDu,name:"百度翻译",points:!0,secretKeys:{get:()=>n().storage.local.get({baiDuAppKey:[]}).then((({baiDuAppKey:e})=>Array.isArray(e)?e:[e])),set:e=>n().storage.local.set({baiDuAppKey:e}),isComplete:e=>(0,d.dz)(e,["id"])},pointsEnable:{get:()=>n().storage.local.get({bdPoints:u}).then((({bdPoints:e})=>e)),set:e=>n().storage.local.set({bdPoints:e})}},h=!0,m={id:i.nV.BaiDuPro,name:"百度翻译（专业版）",points:!0,getDomain:()=>n().storage.local.get("baiduDomain").then((({baiduDomain:e})=>e)),secretKeys:p.secretKeys,pointsEnable:{get:()=>n().storage.local.get({bdProPoints:h}).then((({bdProPoints:e})=>e)),set:e=>n().storage.local.set({bdProPoints:e})}};class g extends r.s{constructor(e){super(e,{standardMap:o,retry:!0})}isSuccessResponse(e){return(0,c.nX)(e)}throwErrorResponse(e){throw new l.mD(`${this.service.name}报错了，错误码：${e.error_code}。`,{type:l.cF.API_SERVER_ERROR,link:{name:"查看错误码释义",url:this.service.getDomain?"https://fanyi-api.baidu.com/doc/22":"https://fanyi-api.baidu.com/doc/21"}})}isSameLang(e){return(0,c.Ky)(e)}async callBySecretKey(e,t){const s=async a=>{const n=await(0,c.ZP)(t.text,t.destination,e,{source:t.source,domain:t.domain});if(!this.isSuccessResponse(n)){if(!a&&"54003"===n.error_code)return new Promise(((e,t)=>{setTimeout((()=>{s(!0).then(e,t)}),800)}));this.throwErrorResponse(n)}return n};return s()}transform(e,t){const s=e.text,a=null==t?void 0:t.from,n=null==t?void 0:t.to,o={text:s,link:`https://fanyi.baidu.com/#${a||"auto"}/${n||"zh"}/${encodeURIComponent(s)}`,from:a&&this.convertToStandard(a),to:n&&this.convertToStandard(n)};if(t)try{o.result=t.trans_result.map((e=>e.dst))}catch(e){}return o}}const f=new g(p),y=new g(m)},81523:(e,t,s)=>{"use strict";s.d(t,{L:()=>c,f:()=>d});s(77950),s(73439),s(36728);var a=s(85756),n=s(29883),o=s(99853),r=s(17419);function i(e){var t;const s={},a=null===(t=e.textContent)||void 0===t?void 0:t.trim().split(/\s+/);var n;a&&(s.name=a[0],s.value=null===(n=a[1])||void 0===n?void 0:n.slice(1,-1));const o=e.nextElementSibling;if(null!=o&&o.matches(".hd_tf")){var r;const e=null===(r=o.getElementsByTagName("a")[0])||void 0===r||null===(r=r.getAttribute("onclick"))||void 0===r||null===(r=r.match(/'(http[^']+)'/))||void 0===r?void 0:r[1];e&&(s.ttsURI=e)}return s}const c={id:o.nV.BingDict,name:"必应词典",free:!0};class l extends a.s{constructor(){super(c,{standardMap:{"中文(简体)":"中文(简体)",英语:"英语"},retry:!0})}async callByFree(e){return(0,n.K)(e.text)}transform(e,t){const{text:s}=e,a={text:s,link:"https://www.bing.com/dict/search?q="+encodeURIComponent(s)+"&cc=cn"};if(t){var n;const e=t.getElementsByClassName("qdef")[0];if(e){const t=e.getElementsByClassName("hd_p1_1")[0];if(t){const e=[],s=t.getElementsByClassName("hd_prUS")[0];s&&e.push(i(s));const n=t.getElementsByClassName("hd_pr")[0];if(n&&e.push(i(n)),s||n)a.from="英语";else{var o;const s=null===(o=t.textContent)||void 0===o?void 0:o.trim().slice(1,-1);s&&(a.from="中文(简体)",e.push({value:s}))}e.length&&(a.phonetic=e)}const s=[];e.querySelectorAll("ul li").forEach((e=>{const t=e.getElementsByClassName("pos")[0];if(t){const e=t.nextElementSibling;if(null!=e&&e.matches(".b_regtxt"))if(t.matches(".web")){var a;const t=null===(a=e.textContent)||void 0===a?void 0:a.trim();t&&s.push({pos:"网络: ",terms:t.split(/；\s*/)})}else{var n;const a=null===(n=e.textContent)||void 0===n?void 0:n.trim().split(/；\s*/);var o;if(a)s.push({pos:null===(o=t.textContent)||void 0===o?void 0:o.trim(),terms:a})}}})),s.length&&(a.dict=s)}a.dict||null!==(n=a.result)&&void 0!==n&&n.length||(a.error={type:r.cF.API_SERVER_ERROR,message:"无翻译结果。",link:{name:"查看解决方案",url:"https://hcfy.app/docs/services/free#bingdict"}})}return a}}const d=new l},88311:(e,t,s)=>{"use strict";s.d(t,{HK:()=>l,Wh:()=>p,Xi:()=>d});s(73439);var a=s(50251),n=s.n(a),o=s(85756),r=s(87778),i=s(99853),c=s(74875);const l=!0,d={id:i.nV.CaiYun,name:"彩云小译",points:!0,secretKeys:{get:()=>n().storage.local.get({cyApiToken:[]}).then((({cyApiToken:e})=>e?(Array.isArray(e)?e:[e]).map((e=>({key:e}))):[])),set:e=>n().storage.local.set({cyApiToken:e.map((e=>e.key))}),isComplete:e=>(0,c.dz)(e)},pointsEnable:{get:()=>n().storage.local.get({cyPoints:l}).then((({cyPoints:e})=>e)),set:e=>n().storage.local.set({cyPoints:e})}};class u extends o.s{constructor(){super(d,{standardMap:{"中文(简体)":"zh",英语:"en",日语:"ja"},retry:!0})}isSameLang(e,t){return(0,r.K)(e,t.text)}async callBySecretKey(e,t){return(0,r.Z)(t.text,t.destination,e.key,{source:t.source})}transform(e,t){const s=e.text,a=e.destinations[e.destIndex],n={text:s,link:"https://fanyi.caiyunapp.com/",from:e.source&&this.convertToStandard(e.source),to:a&&this.convertToStandard(a)};return t&&(n.result=t.target.filter((e=>e.trim()))),n}}const p=new u},99344:(e,t,s)=>{"use strict";s.d(t,{K:()=>m,V:()=>f});s(73439),s(39529),s(77950),s(85940);var a=s(85756),n=s(99853),o=s(50251),r=s.n(o),i=s(60279),c=s(74875),l=s(79248),d=s(17419),u=s(43890),p=s(47192),h=s(67643);const m={id:n.nV.ChatGPT,name:"ChatGPT",free:!0,points:!1,secretKeys:{get:()=>r().storage.local.get({chatGPTKey:[]}).then((({chatGPTKey:e})=>e.map((e=>({key:e}))))),set:e=>r().storage.local.set({chatGPTKey:e.map((e=>e.key))}),isComplete:e=>(0,c.dz)(e)}};class g extends a.s{constructor(){super(m)}async translateInner(e,t){const s=await r().storage.local.get({chatGPTPrompt:i.qI.chatGPTPrompt});if(s.chatGPTPrompt&&!s.chatGPTPrompt.includes("{{text}}"))throw new d.mD("翻译命令内必须包含 `{{text}}`，请前往设置修改翻译命令。",{type:d.cF.OTHER});return super.translateInner(e,t)}async callByFree(e){return async function t(s){const a=await r().storage.local.get({chatGPTPrompt:i.qI.chatGPTPrompt,chatGPTEndpoint:i.qI.chatGPTEndpoint,chatGPTModel:i.qI.chatGPTModel,chatGPTConversationInfo:i.d6.chatGPTConversationInfo}),n=(a.chatGPTPrompt||"将下面的文本翻译为{{target}}：\n{{text}}").replace("{{text}}",e.text).replace("{{target}}",e.destination);let o="";try{var c,l,m;const e=await(0,u.Z)(n,(e=>{o=e}),{conversationId:(null===(c=a.chatGPTConversationInfo)||void 0===c?void 0:c.cId)||void 0,messageId:(null===(l=a.chatGPTConversationInfo)||void 0===l?void 0:l.userMessageId)||(null===(m=a.chatGPTConversationInfo)||void 0===m?void 0:m.assistantMessageId)||void 0});await r().storage.local.set({chatGPTConversationInfo:e})}catch(e){var g;if(!s&&(0,h.k)(e)&&404===(null===(g=e.response)||void 0===g?void 0:g.status))return await r().storage.local.remove("chatGPTConversationInfo"),t(!0);throw new d.mD((0,p.E)(e).message,{type:d.cF.API_SERVER_ERROR,link:{name:"查看解决方案",url:"https://hcfy.app/docs/services/free#chatgpt"}})}return{choices:[{message:{content:o}}]}}()}async callBySecretKey(e,t){const s=await r().storage.local.get({chatGPTPrompt:i.qI.chatGPTPrompt,chatGPTEndpoint:i.qI.chatGPTEndpoint,chatGPTModel:i.qI.chatGPTModel}),a=(s.chatGPTPrompt||"将下面的文本翻译为{{target}}：\n{{text}}").replace("{{text}}",t.text).replace("{{target}}",t.destination);return(0,l.Z)(e.key,{model:s.chatGPTModel,messages:[{role:"user",content:a}]},s.chatGPTEndpoint||void 0)}transform(e,t){const s=e.text,n=e.destinations[e.destIndex],o={text:s,link:"https://chat.openai.com/",from:e.source&&this.convertToStandard(e.source),to:n&&this.convertToStandard(n)};return t&&(o.result=(0,a.b)(t.choices[0].message.content.trim()).split("\n")),o}}const f=new g},52768:(e,t,s)=>{"use strict";s.d(t,{A7:()=>g,EH:()=>p,VY:()=>u});s(73439),s(77950),s(85940),s(71639),s(15735),s(6886);var a=s(85756),n=s(39165),o=s(99853),r=s(74875),i=s(50251),c=s.n(i),l=s(29532);const d={"中文(简体)":"zh",英语:"en",德语:"de",法语:"fr",西班牙语:"es",葡萄牙语:"pt",意大利语:"it",荷兰语:"nl",波兰语:"pl",俄语:"ru",日语:"ja",爱沙尼亚语:"et",保加利亚语:"bg",丹麦语:"da",芬兰语:"fi",捷克语:"cs",拉脱维亚语:"lv",立陶宛语:"lt",罗马尼亚语:"ro",瑞典语:"sv",斯洛伐克语:"sk",斯洛文尼亚语:"sl",希腊语:"el",匈牙利语:"hu",乌克兰语:"uk",印尼语:"id",书面挪威语:"nb",韩语:"ko",土耳其语:"tr"},u=!1,p={id:o.nV.DeepL,name:"DeepL",free:!0,points:!0,secretKeys:{get:()=>c().storage.local.get({deeplKey:[]}).then((({deeplKey:e})=>e)),set:e=>c().storage.local.set({deeplKey:e}),isComplete:e=>(0,r.dz)(e,["deeplPro"])},pointsEnable:{get:()=>c().storage.local.get({deeplPoints:u}).then((({deeplPoints:e})=>e)),set:e=>c().storage.local.set({deeplPoints:e})}};function h(e){var t;return{from:null===(t=e.translations[0])||void 0===t?void 0:t.detected_source_language,result:e.translations.map((e=>e.text)).join("\n"),otherResults:[]}}class m extends a.s{constructor(){super(p,{standardMap:d,retry:{secretKey:!0}})}isSameLang(e,t){return e.from?e.from===t.destinations[t.destIndex]:t.text===e.result}async callByPoints(e){return super.callByPoints(e).then(h)}callBySecretKey(e,t){var s;return(0,l.I)(t.text,t.destination.toUpperCase(),e.key,null===(s=t.source)||void 0===s?void 0:s.toUpperCase(),e.deeplPro).then(h)}callByFree(e){return(0,n.s)(e)}transform(e,t){var s;const a={text:e.text,from:(null==t?void 0:t.from)&&this.convertToStandard(t.from.toLowerCase()),link:`https://www.deepl.com/translator#${(null==t||null===(s=t.from)||void 0===s?void 0:s.toLowerCase())||e.source||"auto"}/${e.destinations[e.destIndex]}/${encodeURIComponent(e.text.replaceAll("/","\\/"))}`};if(t){const e=t.result.split("\n");t.otherResults.length?a.dict=[{terms:e},...t.otherResults.map((e=>({terms:[e]})))]:a.result=e}return a}}const g=new m},49350:(e,t,s)=>{"use strict";s.d(t,{q:()=>p,w:()=>d});s(73439),s(71372);var a=s(85756),n=s(35175),o=s(17419),r=s(99853),i=s(42791),c=s(47192),l=s(52665);const d={id:r.nV.Google,name:"谷歌翻译",free:!0};class u extends a.s{constructor(){super(d,{standardMap:n,retry:{secretKey:!0}}),this.region="cn",this.type="fast",this.mirror=""}isSameLang(e,t){return e.from===t.destinations[t.destIndex]}async callByFree(e){const{text:t,destination:s,source:a="auto"}=e;let n;try{n=await(0,i.C6)(t,s,a,{signal:(0,l.Yx)(8e3)},this.mirror)}catch(e){if("fast"!==this.type)throw new Error("“速度慢、准确率高的谷歌翻译暂时不可用，请在设置中切换为“速度快、准确率低”。");try{n=await(0,i.o3)(t,s,a,{signal:(0,l.Yx)(8e3)},this.mirror)}catch(e){throw(0,c.E)(e)}}return n}transform(e,t){const{text:s}=e,a=e.destinations[e.destIndex],n=null==t?void 0:t.from,o={text:s,from:n&&this.convertToStandard(n),to:a&&this.convertToStandard(a),link:`https://translate.google.${this.region}/?sl=${n||"auto"}&tl=${a}&text=${encodeURIComponent(s)}&op=translate`};if(t){o.result=t.result.split("\n"),t.dict&&(o.dict=t.dict),t.phonetic&&(o.phonetic=t.phonetic.map((e=>({name:e.name,value:e.value,ttsURI:o.from&&this.getTTS(s,o.from)}))));try{!o.phonetic&&o.from&&(o.ttsURI=this.getTTS(s,o.from))}catch(e){}}return o}getTTS(e,t){const s=this.convertToCustom(t);if(!s)throw new o.mD(`${this.service.name}不支持朗读${t}。`,{type:o.cF.UNSUPPORTED_LANGUAGE});return`https://translate.googleapis.com/translate_tts?client=gtx&tl=${s}&ie=UTF-8&q=${encodeURIComponent(e)}`}}const p=new u},49402:(e,t,s)=>{s(77950),s(36728);var a=["blocking","responseHeaders"],n=["blocking","requestHeaders"],o=/Chrome\/(\d+)/.exec(navigator.userAgent);(o&&Number(o[1]))>71&&(a.push("extraHeaders"),n.push("extraHeaders")),chrome.webRequest.onHeadersReceived.addListener((function(e){var t=e.responseHeaders,s=t.findIndex((e=>"cross-origin-resource-policy"===e.name.toLowerCase()));return-1!==s&&t.splice(s,1),{responseHeaders:t}}),{urls:["https://translate.googleapis.com/translate_tts?*"]},a),chrome.webRequest.onHeadersReceived.addListener((function(e){var t=e.responseHeaders,s=t.findIndex((e=>"x-frame-options"===e.name.toLowerCase()));return-1!==s&&t.splice(s,1),{responseHeaders:t}}),{urls:["https://translate.google.com/*","https://translate.google.cn/*"],types:["sub_frame"]},a),chrome.webRequest.onBeforeSendHeaders.addListener((function(e){var t=e.requestHeaders;if(!t.some((e=>"referer"===e.name.toLowerCase()))){var s=e.url.startsWith("https://translate.google.cn/")?"https://translate.google.cn":"https://translate.google.com",a=t.find((e=>"origin"===e.name.toLowerCase()));return a?a.value=s:t.push({name:"Origin",value:s}),t.push({name:"Referer",value:s+"/"}),{responseHeaders:t}}}),{urls:["https://translate.google.cn/_/TranslateWebserverUi/data/batchexecute?*","https://translate.google.com/_/TranslateWebserverUi/data/batchexecute?*"]},n)},13429:(e,t,s)=>{"use strict";s.d(t,{I$:()=>p,Mr:()=>m,p7:()=>u});s(73439);var a=s(50251),n=s.n(a),o=s(65259),r=s(85756),i=s(99853),c=s(17419),l=s(74875);const d={"中文(简体)":"zh","中文(繁体)":"zh-Hant",英语:"en",越南语:"vi",伊努克提图特语:"iu",意大利语:"it",印尼语:"id",印地语:"hi",希伯来语:"he",西班牙语:"es",现代希腊语:"el",乌克兰语:"uk",乌尔都语:"ur",土库曼语:"tk",土耳其语:"tr",提格利尼亚语:"ti",塔希提语:"ty",他加禄语:"tl",汤加语:"to",泰语:"th",泰米尔语:"ta",泰卢固语:"te",斯洛文尼亚语:"sl",斯洛伐克语:"sk",世界语:"eo",萨摩亚语:"sm",桑戈语:"sg",塞索托语:"st",瑞典语:"sv",日语:"ja",契维语:"tw",克丘亚语:"qu",葡萄牙语:"pt",旁遮普语:"pa",挪威语:"no",新挪威语:"nb",南恩德贝莱语:"nr",缅甸语:"my",孟加拉语:"bn",蒙古语:"mn",马绍尔语:"mh",马其顿语:"mk",马拉雅拉姆语:"ml",马拉地语:"mr",马来语:"ms",罗马尼亚语:"ro",立陶宛语:"lt",拉脱维亚语:"lv",老挝语:"lo",克罗地亚语:"hr",卡纳达语:"kn",捷克语:"cs",加泰隆语:"ca",荷兰语:"nl",韩语:"ko",海地克里奥尔语:"ht",古吉拉特语:"gu",格鲁吉亚语:"ka",格陵兰语:"kl",高棉语:"km",卢干达语:"lg",刚果语:"kg",芬兰语:"fi",斐济语:"fj",法语:"fr",俄语:"ru",德语:"de",鞑靼语:"tt",丹麦语:"da",聪加语:"ts",楚瓦什语:"cv",波斯语:"fa",波斯尼亚语:"bs",波兰语:"pl",比斯拉马语:"bi",巴什基尔语:"ba",保加利亚语:"bg",阿塞拜疆语:"az",阿拉伯语:"ar",南非荷兰语:"af",阿尔巴尼亚语:"sq",阿布哈兹语:"ab",奥塞梯语:"os",埃维语:"ee",爱沙尼亚语:"et",艾马拉语:"ay","中文(文言文)":"lzh",阿姆哈拉语:"am",中库尔德语:"ckb",威尔士语:"cy",加利西亚语:"gl",豪萨语:"ha",亚美尼亚语:"hy",伊博语:"ig",林加拉语:"ln",北索托语:"nso",齐切瓦语:"ny",奥罗莫语:"om",修纳语:"sn",索马里语:"so",塞尔维亚语:"sr",斯瓦希里语:"sw",科萨语:"xh",约鲁巴语:"yo",祖鲁语:"zu",匈牙利语:"hu"},u=!1,p={id:i.nV.HuoShan,name:"火山翻译",points:!1,secretKeys:{get:()=>n().storage.local.get({hsApiKey:[]}).then((({hsApiKey:e})=>Array.isArray(e)?e:[e])),set:e=>n().storage.local.set({hsApiKey:e}),isComplete:e=>(0,l.dz)(e,["id"])}};class h extends r.s{constructor(){super(p,{standardMap:d,retry:!0})}isSuccessResponse(e){return(0,o.nX)(e)}throwErrorResponse(e){const t=e.ResponseMetaData.Error;throw new c.mD(`${this.service.name}报错了，错误码：${t.Code}，错误消息：${t.Message}。`,{type:c.cF.API_SERVER_ERROR,link:{name:"查看错误码释义",url:"https://cloud.tencent.com/document/product/551/30637"}})}isSameLang(e,t){return(0,o.Ky)(e,t.destinations[t.destIndex])}async callBySecretKey(e,t){const s=await(0,o.ZP)(t.text,t.destination,e,{source:t.source});return this.isSuccessResponse(s)||this.throwErrorResponse(s),s}transform(e,t){const s=e.text,a=t&&this.convertToStandard(t.TranslationList[0].DetectedSourceLanguage),n={text:s,link:`https://translate.volcengine.com/translate?category=&home_language=zh&source_language=${e.source||"detect"}&target_language=${e.destinations[e.destIndex]}&text=${encodeURIComponent(s)}`,from:a};if(t)try{n.result=t.TranslationList[0].Translation.split("\n")}catch(e){}return n}}const m=new h},66331:(e,t,s)=>{"use strict";s.d(t,{B:()=>c,r:()=>r});s(73439),s(71372);var a=s(85756),n=s(99853),o=s(17419);const r={id:n.nV.SouGou,name:"搜狗翻译"};class i extends a.s{constructor(){super(r)}translate(){return Promise.resolve({text:"",error:{type:o.cF.OTHER,message:"搜狗翻译已下线。",link:{name:"查看公告",url:"https://hcfy.app/blog/2021/11/23/sougou-off"}}})}transform(){throw new Error("Method not implemented.")}}const c=new i},62259:(e,t,s)=>{"use strict";s.d(t,{A:()=>m,xu:()=>u,ym:()=>p});s(73439);var a=s(50251),n=s.n(a),o=s(94715),r=s(2483),i=s(85756),c=s(99853),l=s(17419),d=s(74875);const u=!0,p={id:c.nV.QQ,name:"腾讯翻译君",points:!0,secretKeys:{get:()=>n().storage.local.get({qqApiKey:[]}).then((({qqApiKey:e})=>Array.isArray(e)?e:[e])),set:e=>n().storage.local.set({qqApiKey:e}),isComplete:e=>(0,d.dz)(e,["id"])},pointsEnable:{get:()=>n().storage.local.get({qqPoints:u}).then((({qqPoints:e})=>e)),set:e=>n().storage.local.set({qqPoints:e})}};class h extends i.s{constructor(){super(p,{standardMap:o,retry:!0})}isSuccessResponse(e){return(0,r.nX)(e)}throwErrorResponse(e){const t=e.Response.Error;throw new l.mD(`${this.service.name}报错了，错误码：${t.Code}，错误消息：${t.Message}。`,{type:l.cF.API_SERVER_ERROR,link:{name:"查看错误码释义",url:"https://cloud.tencent.com/document/product/551/30637"}})}isSameLang(e){return(0,r.Ky)(e)}async callBySecretKey(e,t){const s=await(0,r.ZP)(t.text,t.destination,e,{source:t.source});return this.isSuccessResponse(s)||this.throwErrorResponse(s),s}transform(e,t){const s=e.text,a=t&&this.convertToStandard(t.Response.Source),n=t&&this.convertToStandard(t.Response.Target),o={text:s,link:`https://fanyi.qq.com/#hcfy_text=${encodeURIComponent(s)}&hcfy_from=${a||""}&hcfy_to=${n||""}`,from:a,to:n};if(t)try{o.result=t.Response.TargetText.split("\n")}catch(e){}return o}}const m=new h},53657:(e,t,s)=>{"use strict";s.d(t,{B:()=>c,l:()=>d});s(73439),s(15735),s(6886);var a=s(85756),n=s(99853),o=s(17419),r=s(89360);const i={"中文(简体)":"zh",英语:"en",阿塞拜疆语:"az",马拉雅拉姆语:"ml",阿尔巴尼亚语:"sq",马耳他语:"mt",阿姆哈拉语:"am",马其顿语:"mk",毛利语:"mi",阿拉伯语:"ar",马拉地语:"mr",亚美尼亚语:"hy","马里语（俄罗斯）":"mhr",南非荷兰语:"af",蒙古语:"mn",巴斯克语:"eu",德语:"de",巴什基尔语:"ba",尼泊尔语:"ne",白俄罗斯语:"be",挪威语:"no",孟加拉语:"bn",旁遮普语:"pa",缅甸语:"my",帕皮阿门托语:"pap",保加利亚语:"bg",波斯语:"fa",波斯尼亚语:"bs",波兰语:"pl",威尔士语:"cy",葡萄牙语:"pt",匈牙利语:"hu",罗马尼亚语:"ro",越南语:"vi",俄语:"ru",海地克里奥尔语:"ht",宿务语:"ceb",加利西亚语:"gl",塞尔维亚语:"sr",荷兰语:"nl",僧伽罗语:"si",斯洛伐克语:"sk",希腊语:"el",斯洛文尼亚语:"sl",格鲁吉亚语:"ka",斯瓦希里语:"sw",古吉拉特语:"gu",印尼巽他语:"su",丹麦语:"da",塔吉克语:"tg",希伯来语:"he",泰语:"th",意第绪语:"yi",他加禄语:"tl",印尼语:"id",泰米尔语:"ta",爱尔兰语:"ga",鞑靼语:"tt",意大利语:"it",泰卢固语:"te",冰岛语:"is",土耳其语:"tr",西班牙语:"es",乌德穆尔特语:"udm",哈萨克语:"kk",乌兹别克语:"uz",卡纳达语:"kn",乌克兰语:"uk",加泰罗尼亚语:"ca",乌尔都语:"ur",吉尔吉斯语:"ky",芬兰语:"fi",法语:"fr",韩语:"ko",印地语:"hi",科萨语:"xh",克罗地亚语:"hr",高棉语:"km",捷克语:"cs",老挝语:"lo",瑞典语:"sv",拉丁语:"la",苏格兰语:"gd",拉脱维亚语:"lv",爱沙尼亚语:"et",立陶宛语:"lt",世界语:"eo",卢森堡语:"lb",爪哇语:"jv",马尔加什语:"mg",日语:"ja",马来语:"ms"},c={id:n.nV.Yandex,name:"Yandex 翻译",free:!0};class l extends a.s{constructor(){super(c,{standardMap:i,retry:!0})}isSuccessResponse(e){return(0,r.s8)(e)}throwErrorResponse(e){const t=e;throw new o.mD(`${this.service.name}报错了，错误码：${t.code}，错误消息：${t.message}。`,{type:o.cF.API_SERVER_ERROR})}async callByFree(e){const t=await(0,r.Iu)(e.text,e.destination,{source:e.source});return this.isSuccessResponse(t)||this.throwErrorResponse(t),t}transform(e,t){const s=e.text;let a,n,o=e.source,r=e.destinations[e.destIndex];if(t){const[e,s]=t.lang.split("-");o=e,r=s,a=this.convertToStandard(e),n=this.convertToStandard(s)}const i={text:s,link:`https://translate.yandex.com/?source_lang=${o}&target_lang=${r}&text=${encodeURIComponent(s)}`,from:a,to:n};if(t)try{i.result=t.text[0].split("\n")}catch(e){}return i}}const d=new l},47288:(e,t,s)=>{"use strict";s.d(t,{Rw:()=>p,eT:()=>u,ji:()=>m});s(73439),s(15735),s(6886),s(77950),s(36728);var a=s(50251),n=s.n(a),o=s(29514),r=s(3209),i=s(85756),c=s(99853),l=s(17419),d=s(74875);const u=!0,p={id:c.nV.YouDao,name:"有道翻译",points:!0,secretKeys:{get:()=>n().storage.local.get({youDaoAppKey:[]}).then((({youDaoAppKey:e})=>Array.isArray(e)?e:[e])),set:e=>n().storage.local.set({youDaoAppKey:e}),isComplete:e=>(0,d.dz)(e,["id"])},pointsEnable:{get:()=>n().storage.local.get({ydPoints:u}).then((({ydPoints:e})=>e)),set:e=>n().storage.local.set({ydPoints:e})}};class h extends i.s{constructor(){super(p,{standardMap:o,retry:!0})}isSuccessResponse(e){return(0,r.nX)(e)}throwErrorResponse(e){throw new l.mD(`${this.service.name}报错了，错误码：${e.errorCode}。`,{type:l.cF.API_SERVER_ERROR,link:{name:"查看错误码释义",url:"https://ai.youdao.com/DOCSIRMA/html/%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E7%BF%BB%E8%AF%91/API%E6%96%87%E6%A1%A3/%E6%96%87%E6%9C%AC%E7%BF%BB%E8%AF%91%E6%9C%8D%E5%8A%A1/%E6%96%87%E6%9C%AC%E7%BF%BB%E8%AF%91%E6%9C%8D%E5%8A%A1-API%E6%96%87%E6%A1%A3.html"}})}isSameLang(e){return(0,r.Ky)(e)}async callBySecretKey(e,t){const s=await(0,r.ZP)(t.text,t.destination,e,{source:t.source});return this.isSuccessResponse(s)||this.throwErrorResponse(s),s}transform(e,t){var s;const a=e.text,[n,o]=((null==t?void 0:t.l)||"").split("2"),r={text:a,from:this.convertToStandard(n),to:this.convertToStandard(o),ttsURI:null==t?void 0:t.speakUrl,link:null!=t&&t.basic?`https://dict.youdao.com/search?q=${encodeURIComponent(a)}`:`http://fanyi.youdao.com/translate?i=${encodeURIComponent(a)}`,result:null==t||null===(s=t.translation[0])||void 0===s?void 0:s.split("\n")};if(null!=t&&t.basic){r.dict=t.basic.explains.map((e=>{const t=e.match(/^([a-z]+\.)\s+/);return{pos:t?t[1]:void 0,terms:[t?e.slice(t[0].length):e]}}));const e=[];t.basic["us-phonetic"]&&e.push({name:"美",value:t.basic["us-phonetic"],ttsURI:t.basic["us-speech"]}),t.basic["uk-phonetic"]&&e.push({name:"英",value:t.basic["uk-phonetic"],ttsURI:t.basic["uk-speech"]}),!e.length&&t.basic.phonetic&&e.push({value:t.basic.phonetic,ttsURI:t.speakUrl}),e.length&&(r.phonetic=e)}return r}}const m=new h},51813:(e,t,s)=>{"use strict";s.d(t,{L:()=>g});var a=s(98269),n=s(59250),o=s(88311),r=s(66331),i=s(62259),c=s(47288),l=s(49350),d=s(52768),u=s(81523),p=s(13429),h=s(99344),m=s(53657);const g=[l.w,d.EH,h.K,m.B,n.pe,n.gG,i.ym,o.Xi,a.Wx,a.Il,c.Rw,p.I$,u.L,r.r].filter((e=>e!==u.L))},99853:(e,t,s)=>{"use strict";s.d(t,{gu:()=>n,nV:()=>a});let a=function(e){return e.Yandex="Yandex",e.ChatGPT="ChatGPT",e.BaiDu="BaiDuWeb",e.BaiDuPro="BaiDuDomain",e.HuoShan="HuoShan",e.QQ="QQOfficial",e.CaiYun="CaiYunOfficial",e.ALi="ALiOfficial",e.ALiPro="ALiOfficialDomain",e.SouGou="SoGouOfficial",e.YouDao="YouDaoWeb",e.Google="GoogleWeb",e.DeepL="DeepLWeb",e.BingDict="BingDictWeb",e}({}),n=function(e){return e.Tesseract="tesseractocr",e.BaiDu="bdocr",e}({})},1636:(e,t,s)=>{"use strict";s(67956),s(49402),s(77950),s(36728);const a=["blocking","responseHeaders"],n=/Chrome\/(\d+)/.exec(navigator.userAgent),o=n&&Number(n[1]);o&&o>71&&a.push("extraHeaders"),chrome.webRequest.onHeadersReceived.addListener((function(e){const t=e.responseHeaders||[],s=t.findIndex((e=>"content-security-policy"===e.name.toLowerCase()));return-1!==s&&t.splice(s,1),{responseHeaders:t}}),{urls:["https://www.deepl.com/translator"],types:["sub_frame"]},a);var r=s(50251),i=s.n(r);i().runtime.onMessage.addListener(((e,t)=>{var s;if("forward between frames"!==(null==e?void 0:e.action))return;const a=null===(s=t.tab)||void 0===s?void 0:s.id;return null!=a?i().tabs.sendMessage(a,e,"top"===e.target?{frameId:0}:void 0):void 0}));var c=s(7674),l=(s(15735),s(6886),s(39529),s(73439),s(71372),s(30686)),d=s(52665),u=s(25130),p=s.n(u);const h=u("@hcfyapp/aftr");function m(e,t,s){g(e,t),t.set(e,s)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t){var s=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,s)}var y=new WeakMap,w=new WeakMap,v=new WeakSet;class b extends l.Z{constructor(...e){var t,s;super(...e),g(t=this,s=v),s.add(t),m(this,y,{writable:!0,value:[]}),m(this,w,{writable:!0,value:[]})}getMode(e){return f(this,w).includes(e.windowId)?"window":f(this,y).includes(e.id)?"tab":"close"}setMode(e,t){const s=this.getMode(e);switch(t){case"close":(0,d.bA)(f(this,w),e.windowId),(0,d.bA)(f(this,y),e.id),"window"===s&&this.emit("change-other-tabs-to",e,"close"),h("tab %o 变成了 %s 模式之后的内部状态 windowIds: %o tabIds %o",e,t,f(this,w),f(this,y));break;case"window":(0,d.zf)(f(this,w),e.windowId),(0,d.bA)(f(this,y),e.id),function(e,t,s){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return s}(this,v,x).call(this,e.windowId).then((()=>{h("tab %o 变成了 %s 模式之后的内部状态 windowIds: %o tabIds %o",e,t,f(this,w),f(this,y))})),this.emit("change-other-tabs-to",e,"window");break;case"tab":(0,d.zf)(f(this,y),e.id),(0,d.bA)(f(this,w),e.windowId),"window"===s&&this.emit("change-other-tabs-to",e,"close"),h("tab %o 变成了 %s 模式之后的内部状态 windowIds: %o tabIds %o",e,t,f(this,w),f(this,y))}}}async function x(e){(await(0,c.N6)({windowId:e})).forEach((e=>{const t=e.id;null!=t&&(0,d.bA)(f(this,y),t)}))}const R=new b;chrome.runtime.onMessage.addListener(((e,t,s)=>{if(!t.tab)return;if(null==t.tab.id)return;if(a=e,!(0,d.yD)(a)||!("__aftrMessage__"in a))return;var a;const n={id:t.tab.id,windowId:t.tab.windowId};switch(e.__aftrAction__){case"getMode":s(R.getMode(n));break;case"setMode":R.setMode(n,e.__aftrPayload__);break;default:console.warn("未知的消息类型：",e)}})),R.on("change-other-tabs-to",((e,t)=>{h("通知 tab %o 所在的 window 下的其它 tab 需要改变自动模式的值为 %s",e,t),(0,c.fd)(e.windowId,{__aftrMessage__:!0,__aftrAction__:"setMode",__aftrPayload__:t},[e.id])}));var I=s(60279),A=s(26777),S=s(28909),P=s(49350),k=s(52768),T=s(81523),C=s(98269),E=s(88311),L=s(1327),D=s(85756),_=s(17419);(0,A.Z)(I.qI,["customAPI"]);class q extends D.s{constructor(e){super({id:e,name:e})}async translateInner(e){const{customAPI:t}=await i().storage.local.get("customAPI");if(!t)throw new _.mD("没有配置自定义翻译源。");return(await L.Z.post(t,{text:e.text,destination:e.destinations,source:e.source,name:this.service.name})).data}transform(e,t){return t||{text:e.text}}}var K=s(59250),B=s(66331),O=s(62259),M=s(13429),Z=s(47288),U=s(99344),$=s(53657);function G(e){switch(e){case"Yandex":return $.l;case"ChatGPT":return U.V;case"DeepLWeb":return k.A7;case"GoogleWeb":return P.q;case"BaiDuWeb":return K.qj;case"BaiDuDomain":return K.b4;case"YouDaoWeb":return Z.ji;case"BingDictWeb":return T.f;case"ALiOfficial":return C.oK;case"ALiOfficialDomain":return C.Ds;case"QQOfficial":return O.A;case"HuoShan":return M.Mr;case"SoGouOfficial":return B.B;case"CaiYunOfficial":return E.Wh;default:return new q(e)}}(0,S.Z)((0,A.Z)(I.qI,["googleRegion","googleType","googleMirror"]),(e=>{e.googleRegion&&(P.q.region=e.googleRegion),e.googleType&&(P.q.type=e.googleType),null!=e.googleMirror&&(P.q.mirror=e.googleMirror)}));const F={...(0,A.Z)(I.qI,["destination","secondDestination","secondDestinationLatestSource"]),...(0,A.Z)(I.d6,["latestSource"])};var W=s(64443),N=s(83736),z=s(15833);let H;const V=()=>H||(H=(0,W.X)((()=>new Promise(((e,t)=>{const s=window.speechSynthesis.getVoices();s.length?e(s):t(new Error("无法获取系统支持的语音列表，请稍后重试。"))}))),{delay:500,count:10}).then((e=>{const t={},s={};e.forEach((e=>{const a=e.lang;t[a]?t[a].push(e):t[a]=[e];const n=a.slice(0,a.indexOf("-"));s[n]?s[n].indexOf(a)<0&&s[n].push(a):s[n]=[a]}));const a=[],n={};return(0,N.Z)(t,((e,s)=>{1===e.length&&(a.push(s),n[s]=e[0],delete t[s])})),(0,N.Z)(s,((e,t)=>{1===e.length&&delete s[t]})),{singleVoiceMap:n,singleList:a,voicesGroup:t,multipleLang:s}}))),j={"中文(简体)":"zh-CN","中文(粤语)":"zh-HK","中文(繁体)":"zh-TW",英语:"en","英语(英国)":"en-GB","英语(美国)":"en-US","英语(加拿大)":"en-CA","英语(澳大利亚)":"en-AU","英语(印度)":"en-IN","英语(爱尔兰)":"en-IE","英语(南非)":"en-ZA",德语:"de-DE",西班牙语:"es-ES","西班牙语(墨西哥)":"es-MX","西班牙语(美国)":"es-US","西班牙语(阿根廷)":"es-AR",法语:"fr-FR","法语(加拿大)":"fr-CA",印地语:"hi-IN",印尼语:"id-ID",意大利语:"it-IT",日语:"ja-JP",韩语:"ko-KR",荷兰语:"nl-NL","荷兰语(比利时)":"nl-BE",波兰语:"pl-PL",葡萄牙语:"pt-PT","葡萄牙语(巴西)":"pt-BR",俄语:"ru-RU",土耳其语:"tr-TR",瑞典语:"sv-SE",希伯来语:"he-IL",罗马尼亚语:"ro-RO",泰语:"th-TH",斯洛伐克语:"sk-SK",阿拉伯语:"ar-SA",匈牙利语:"hu-HU",希腊语:"el-GR",挪威语:"nb-NO",丹麦语:"da-DK",芬兰语:"fi-FI",捷克语:"cs-CZ"},Y=(0,z.Z)(j),X={"中文(简体)":"zh",英语:"en",法语:"fr",西班牙语:"es",荷兰语:"nl",葡萄牙语:"pt"};(0,z.Z)(X).zh="中文";const Q=window.navigator.userAgent,J=Q.includes("Mac"),ee=Q.includes("Chrome"),te=Q.includes("Edg"),se=ee&&!te,ae=Q.includes("Firefox");function ne(e){return e.split(".").map((e=>Number(e)))}const oe=ne(i().runtime.getManifest().version);function re(e,t){const s="string"==typeof e?ne(e):e,a="string"==typeof t?ne(t):t,n=Math.max(s.length,a.length);for(let e=0;e<n;e++){const t=s[e]||0,n=a[e]||0;if(t<n)return-1;if(t>n)return 1}return 0}function ie(e){return re(e,oe)}const ce=p()("audio"),le={...(0,A.Z)(I.qI,["audioVolume","audioRate","systemTTS","systemTTSVoice","systemTTSAccent"]),...(0,A.Z)(I.d6,["user"])};let de,ue=I.qI.audioVolume,pe=I.qI.audioRate,he=I.qI.systemTTS,me=I.qI.systemTTSVoice,ge=I.qI.systemTTSAccent,fe=I.d6.user;async function ye(){return(await i().tabs.query({active:!0,highlighted:!0,windowId:i().windows.WINDOW_ID_CURRENT}))[0]}var we;let ve,be;(0,S.Z)(le,(e=>{null!=e.audioRate&&(pe=e.audioRate,de&&(de.playbackRate=pe)),null!=e.audioVolume&&(ue=e.audioVolume,de&&(de.volume=ue/100)),null!=e.systemTTS&&(he=e.systemTTS),null!=e.systemTTSVoice&&(me=e.systemTTSVoice),null!=e.systemTTSAccent&&(ge=e.systemTTSAccent),void 0!==e.user&&(fe=e.user)})),i().windows.onRemoved.addListener((e=>{ve===e&&(ve=void 0)})),null!==(we=window)&&void 0!==we&&null!==(we=we.chrome)&&void 0!==we&&null!==(we=we.windows)&&void 0!==we&&we.onBoundsChanged&&chrome.windows.onBoundsChanged.addListener((e=>{e.id===ve&&i().storage.local.set({panelPos:(0,A.Z)(e,["width","height","left","top"])})}));const xe=(0,A.Z)(I.qI,["panelPos"]);async function Re(){const{panelPos:e}=await i().storage.local.get(xe),t={...e};return e.left<0&&(t.left=0),e.top<0&&(t.top=0),t}const Ie=(0,A.Z)(I.qI,["panelFocus"]);function Ae(e,t){return i().windows.create({url:i().runtime.getURL("panel.html")+"?text="+encodeURIComponent(e),type:"popup",...t})}async function Se(e=""){if(void 0!==ve&&void 0!==be){const t=[i().tabs.sendMessage(be,{action:"translateInPopup",data:e})];await async function(){const{panelFocus:e}=await i().storage.local.get(Ie);return e}()&&t.push(i().windows.update(ve,{focused:!0})),await Promise.all(t)}else{const t=await Re();let s,a=ae;try{s=await Ae(e,t)}catch(t){a=!1,s=await Ae(e,I.qI.panelPos)}a&&s.id&&i().windows.update(s.id,{top:t.top,left:t.left}),ve=s.id,be=s.tabs&&s.tabs[0].id}}async function Pe(e="",t,s=!0){var a;if(!t&&!(t=null===(a=await ye())||void 0===a?void 0:a.id))return void(s&&Se(e));try{await i().tabs.sendMessage(t,"translate")}catch(t){s&&Se(e)}}s(17368),s(24471),s(85940);function ke(e){const t=e.match(/^(([^:]+):\/\/)?([^/]+)?(\/.*)?$/);if(!t)return;let s=t[3]||"";const a=s.indexOf(":");a>=0&&(s=s.slice(0,a));let n=t[4]||"";const o=n.indexOf("#");if(o>=0&&(n=n.slice(0,o)),!s.startsWith(".")){if(!n){if(!s)return;n="/"}return{host:s,path:n}}}function Te(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".*").replace(/^\.\*\\\./,"(.*\\.)?")+"$").test(t)}function Ce(e,t){return new RegExp("^"+e.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$").test(t)}function Ee(e,t,s){let a,n;a="string"==typeof e?ke(e):e;let o=!1,r=!1;if(a){const e=e=>{const t=function(e,t){let s;if(s="string"==typeof t?ke(t):t,s)return Te(e.host,s.host)&&Ce(e.path,s.path)}(e,a);return t&&(n=e),t};o=s.some(e),o||(r=t.some(e))}return{urlParts:a,matchedRule:n,whiteListMatched:o,blackListMatched:r}}s(14121),s(60523),s(43673),s(40753),s(28399);const Le=i().runtime.getURL("/pdf-viewer/web/viewer.html"),De=(0,A.Z)(I.qI,["pdfStandalone"]);function _e(e){return e.startsWith(Le)}function qe(e){let t,s,a;e&&("string"==typeof e?t=e:(t=e.file,s=e.blocked,a=e.incognito));let n="",o="";if(t){const e=new URL(t);n+=`&file=${encodeURIComponent(t)}`,o=e.hash}return s&&(n+="&_blocked"),a&&(n+="&_incognito"),Le+n.replace("&","?")+o}function Ke(e){return async function(e){const{pdfStandalone:t}=await i().storage.local.get(De);let s;if(t)s=await i().windows.create({url:e,type:"popup"});else{const t=await i().tabs.create({url:e});s=await i().windows.get(t.windowId)}s.focused||await i().windows.update(s.id,{drawAttention:!0})}(qe(e))}async function Be(e){return"normal"===(await i().windows.get(e)).type}async function Oe(e){if(!e)return void await i().browserAction.setIcon({path:"logogray.png"});if(_e(e))return void await i().browserAction.setIcon({path:"logodark.png"});const{domainBlackList:t,domainWhiteList:s}=await i().storage.local.get((0,A.Z)(I.qI,["domainBlackList","domainWhiteList"])),a=function(e,t,s){const a=Ee(e,t,s);return!a.urlParts||a.whiteListMatched||!a.blackListMatched}(e,t,s);await i().browserAction.setIcon({path:a?"logodark.png":"logogray.png"})}async function Me(e){let t,s;if(e)t=e.tabId,s=e.windowId;else{const e=await ye();if(!e)return Oe();t=e.id,s=e.windowId}if(null==s||await Be(s))return Oe(await async function(e){try{let t;if(t=void 0===e?(await i().tabs.executeScript({code:"window.location.href",runAt:"document_start"}))[0]:(await i().tabs.executeScript(e,{code:"window.location.href",runAt:"document_start"}))[0],t.startsWith("moz-extension"))throw new Error;return t}catch(s){var t;if(void 0===e&&!(e=null===(t=await ye())||void 0===t?void 0:t.id))return;try{return await i().tabs.sendMessage(e,"get tab url")}catch(e){}}}(t))}Me(),i().tabs.onActivated.addListener((e=>{Me(e)})),i().tabs.onUpdated.addListener(((e,t)=>{"loading"===t.status&&Me()})),i().windows.onFocusChanged.addListener((async e=>{e!==i().windows.WINDOW_ID_NONE&&await Be(e)&&Me()})),i().storage.onChanged.addListener(((e,t)=>{"local"===t&&(e.hasOwnProperty("domainBlackList")||e.hasOwnProperty("domainWhiteList"))&&Me()}));var Ze=s(59085);class Ue extends Ze.ZP{constructor(){super("hcfy"),this.version(3).stores({historyRecords:"id,date,_id,syncStatus",favorites:"id,date,text,_id,syncStatus"}),this.historyRecords=this.table("historyRecords"),this.favorites=this.table("favorites")}}const $e=new Ue;s(43108);var Ge=s(23882),Fe=s(22168),We=s(7279);const Ne=(e,t)=>{e._id?(e.deleted=!0,e.syncStatus=ze.Pending):delete t.value};let ze=function(e){return e.Pending="Pending",e}({});class He{constructor(e,t,s,a,n,o,r,i){this.table=e,this.syncKeys=t.concat("date"),this.getDataFromServer=s,this.syncTimeStorageKey=a,this.deleteData=n,this.commitChanges=o,this.pullChanges=r,this.deleteLogsFn=i}async add(e,t){const s={...e},a=Date.now();s.id=(0,Ge.Z)(a+"-"),s.date=a,s.syncStatus=ze.Pending,await this.table.add(s),t&&this.commit().catch(Fe.Z)}async deleteById(e,t){await this.table.where("id").anyOf(e).modify(Ne),t&&this.commit().catch(Fe.Z)}async deleteAll(e){let t;e&&(t=await this.deleteData()),await this.table.clear(),t&&await this.setSyncTime(t)}async deleteByKey(e,t,s){await this.table.where(e).equalsIgnoreCase(t).modify(Ne),s&&this.commit().catch(Fe.Z)}async hasByKey(e,t){return await this.table.where(e).equalsIgnoreCase(t).and((e=>!e.deleted)).count()>0}query(e,t,s){const a=t?this.table.where("date").below(t).reverse():this.table.orderBy("date").reverse();return a.filter(s?e=>!e.deleted&&s(e):e=>!e.deleted),a.limit(e).toArray()}async getSyncChanges(){const e=await this.table.where("syncStatus").equals(ze.Pending).toArray(),t=[],s=[],a=[];return e.forEach((e=>{e._id?e.deleted&&a.push(e._id):(t.push((0,A.Z)(e,this.syncKeys)),s.push(e.id))})),{changes:{added:(0,We.Z)(t)?void 0:t,deleted:(0,We.Z)(a)?void 0:a},addedLocalIds:s}}addServerData(e){return $e.transaction("rw",this.table,(async()=>{const t=Date.now()+"-",s=e.map((e=>(e.id=(0,Ge.Z)(t),e._id)));await this.table.where("_id").anyOf(s).delete(),await this.table.bulkAdd(e)}))}async downloadData(e){const t=await this.getDataFromServer(e),s=t.list;return Array.isArray(s)&&s.length&&await this.addServerData(s),t.date}setSyncTime(e){return i().storage.local.set({[this.syncTimeStorageKey]:e})}async commit(){const{changes:e,addedLocalIds:t}=await this.getSyncChanges(),s=await this.commitChanges(e);(0,We.Z)(s)||await this.table.where("id").anyOf(t).modify((e=>{const a=t.indexOf(e.id);a>=0&&(e._id=s[a],delete e.syncStatus)}))}async pull(e){const t=(await i().storage.local.get(this.syncTimeStorageKey))[this.syncTimeStorageKey];if(!t){const e=await this.downloadData();return await this.setSyncTime(e),this.deleteLogsFn(e).catch(Fe.Z),!0}if(!e)return!1;const{changes:s,date:a}=await this.pullChanges(t);let n;const o=s.reduce(((e,t)=>{var s,a;return t.deleteAll?(e.added.clear(),e.deleted.clear(),n=!0,e):(null===(s=t.added)||void 0===s||s.forEach((t=>{e.added.add(t)})),null===(a=t.deleted)||void 0===a||a.forEach((t=>{e.added.has(t)?e.added.delete(t):e.deleted.add(t)})),e)}),{added:new Set,deleted:new Set});let r,c=[];const l=!!o.added.size;o.added.size&&(c=await this.table.where("_id").anyOf(Array.from(o.added)).toArray(),c.forEach((e=>{o.added.delete(e._id)})),o.added.size&&(r=(await this.getDataFromServer(Array.from(o.added))).list));const d=n||!!r||!!o.deleted.size;return d&&await $e.transaction("rw",this.table,(async()=>{n&&(await this.table.clear(),!(0,We.Z)(c)&&await this.table.bulkAdd(c));const e=[];return r&&e.push(this.addServerData(r)),o.deleted.size&&e.push(this.table.where("_id").anyOf(Array.from(o.deleted)).delete()),Promise.all(e)})),await this.setSyncTime(a),(d||l)&&this.deleteLogsFn(a).catch(Fe.Z),d}}var Ve=s(81834);const je=new He($e.historyRecords,["text","url","favicon","title"],(async e=>(await Ve.L.post("/histories",e)).data),"historiesSyncAt",(async()=>(await Ve.L.delete("/histories")).data),(async e=>(await Ve.L.put("/histories",e)).data),(async e=>(await Ve.L.get("/histories?lastCheck="+e)).data),(e=>Ve.L.delete("/histories/logs?date="+e)));var Ye=s(14062);const Xe=new He($e.favorites,["text","dir"],(async e=>(await Ve.L.post("/favorites",e)).data),"favoritesSyncAt",(async()=>(await Ve.L.delete("/favorites")).data),(async e=>(await Ve.L.put("/favorites",e)).data),(async e=>(await Ve.L.get("/favorites?lastCheck="+e)).data),(e=>Ve.L.delete("/favorites/logs?date="+e)));let Qe,Je,et=()=>{et=Fe.Z,Qe=document.createElement("textarea"),Qe.style.position="absolute",Qe.style.top="-99999px",document.body.appendChild(Qe)};let tt=()=>{tt=Fe.Z,Je=document.createElement("div"),Je.style.position="absolute",Je.style.top="-99999px",Je.contentEditable="true",document.body.appendChild(Je)};function st(){if(tt(),Je.innerHTML="",Je.focus(),document.execCommand("paste")){const e=Je.getElementsByTagName("img")[0];if(e)return e.src}return!1}function at(){const e=st();if(e)return{type:"image",dataURI:e};const t=(et(),Qe.value="",Qe.focus(),!!document.execCommand("paste")&&Qe.value);return"string"==typeof t&&{type:"text",text:t}}const nt=(0,A.Z)(I.d6,["user"]);async function ot(){const{user:e}=await i().storage.local.get(nt);return!!e&&e.vipActivated}var rt=s(60265),it=s(24370),ct=s(88120),lt=s(99853);const dt={workerPath:"worker.min.js",corePath:"tesseract-core.js",langPath:"https://tessdata.projectnaptha.com/4.0.0_best",workerBlobURL:!1},ut={id:lt.gu.Tesseract,name:"Tesseract OCR",free:!0};class pt extends ct.E{constructor(){super(ut)}async callByFree(e){const t=await(0,it.createWorker)(dt);await t.loadLanguage(e.lang),await t.initialize(e.lang),await t.setParameters({tessjs_create_hocr:"0",tessjs_create_tsv:"0",preserve_interword_spaces:"1"});const s=await t.recognize(e.image);return t.terminate(),s.data}transform(e){return e.paragraphs.map((e=>e.text.trim().replace(/\r?\n/g," "))).join("\n")}}const ht=new pt;var mt=s(40048);const gt=(0,A.Z)(I.qI,["ocrService","localOCR"]),ft=new rt.P("ocrLimit",5);const yt=L.Z.create({baseURL:"https://hcfy.app/"}),wt={...(0,A.Z)(I.d6,["user"]),...(0,A.Z)(I.qI,["noticesRead"])};let vt=[];async function bt(e){if(e)try{vt=await yt.get("/notices.json").then((e=>e.data)),wt.noticesRead=wt.noticesRead.filter((e=>vt.find((t=>t.id===e)))),i().storage.local.set({noticesRead:wt.noticesRead})}catch(e){}const t=function(e,t,s){let a=0;return{filteredNotices:e.filter((e=>{if(e.filter){if(e.filter.noFree&&(null==t||!t.vipActivated))return!1;if(e.filter.noVip&&null!=t&&t.vipActivated&&!t.forever)return!1;if(e.filter.noForever&&null!=t&&t.forever)return!1;if(e.filter.noChrome&&se)return!1;if(e.filter.noEdge&&te)return!1;if(e.filter.noFirefox&&ae)return!1;const s=Date.now();if(e.filter.start&&e.filter.start>s)return!1;if(e.filter.end&&e.filter.end<s)return!1;if(e.filter.versionStart&&ie(e.filter.versionStart)>0)return!1;if(e.filter.versionEnd&&ie(e.filter.versionEnd)<0)return!1}return s.includes(e.id)||(a+=1),!0})),unreadNum:a}}(vt,wt.user,wt.noticesRead);i().storage.local.set({noticesUnreadNum:t.unreadNum,noticesFiltered:t.filteredNotices})}const xt="fetch-notices-alarm";i().alarms.create(xt,{periodInMinutes:60}),i().alarms.onAlarm.addListener((async e=>{e.name===xt&&bt(!0)})),(0,S.Z)(wt,((e,t)=>{void 0!==e.user&&(wt.user=e.user),e.noticesRead&&(wt.noticesRead=e.noticesRead),bt(!!t)})),(0,S.Z)({noticesUnreadNum:0},(e=>{var t;null!=e.noticesUnreadNum&&(t=e.noticesUnreadNum,i().browserAction.setBadgeText({text:t?String(t):""}))}));var Rt=s(68454);function It(e,t,s){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function At(e,t,s){return function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=s}}(e,Pt(e,t,"set"),s),s}function St(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Pt(e,t,"get"))}function Pt(e,t,s){if(!t.has(e))throw new TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}var kt=new WeakMap,Tt=new WeakMap;class Ct extends l.Z{constructor(...e){super(...e),It(this,kt,{writable:!0,value:void 0}),It(this,Tt,{writable:!0,value:void 0})}get running(){return null!=St(this,kt)}start(){this.running||At(this,kt,setInterval((()=>{let e;try{e=Rt.BR.read()}catch(e){return this.stop(),void this.emit("error",e)}const t=St(this,Tt);e!==t&&(At(this,Tt,e),null!=t&&this.emit("change",e))}),500))}stop(){St(this,kt)&&(clearInterval(St(this,kt)),At(this,kt,void 0))}}const Et=new Ct;Et.on("error",(e=>{console.error(e)})),Et.on("change",(e=>{Se(e)}));const Lt=Et,Dt=i().runtime.getURL("settings.html");i().runtime.onMessage.addListener((e=>{switch(e.action){case"open options page":return e.suffix?i().tabs.create({url:Dt+e.suffix}).then(Fe.Z):i().runtime.openOptionsPage();case"translate":return async function(e){const t=G(e.apiCode);let s=e.destinations;if(!s){const e=await i().storage.local.get(F),t=e.secondDestinationLatestSource&&e.latestSource?e.latestSource:e.secondDestination;s=e.destination===t?[e.destination]:[e.destination,t]}return t.translate({text:e.text,destinations:s,source:e.source})}(e.data);case"audio":return async function(e){de&&de.pause(),speechSynthesis.cancel();try{if("prior"===he)throw new Error("由于用户设置了始终使用系统语音朗读，所以主动抛出错误");let t;if(e.ttsURI)t=e.ttsURI;else if(e.source){const s=G(e.apiId);t=await s.getTTS(e.text,e.source)}if(!t)throw new Error("跳过");await new Promise(((e,s)=>{de=new Audio(t),de.volume=ue/100,de.playbackRate=pe,de.addEventListener("canplay",(()=>{var t;null===(t=de)||void 0===t||t.play(),e()})),de.addEventListener("error",(()=>{s()}))}))}catch(t){if("none"===he)throw t;return new Promise((async(t,s)=>{var a;ce("开始用系统语音朗读 %O",e);const n=new SpeechSynthesisUtterance(e.text);n.volume=ue/100,n.rate=pe;const o=window.setTimeout((()=>{let e;speechSynthesis.cancel(),n.lang&&(e=Y[n.lang]),s(new Error("系统语音朗读超时。"+(se?`Chrome 浏览器提供的网络语音需要连接外网才能使用。你也可以前往设置中选择本地语音朗读${e||""}。`:`如果你的网络状况不佳，可以前往设置中选择本地语音朗读${e||""}。`)))}),2e3);if(n.addEventListener("start",(()=>{window.clearTimeout(o),t()})),n.addEventListener("error",(e=>{s(e)})),null!==(a=fe)&&void 0!==a&&a.vipActivated){const t=e.source&&X[e.source];if(t){const e=ge[t];e&&(ce("指定用户选择的口音："+e),n.lang=e)}}const r=n.lang||e.source&&j[e.source];if(r){n.lang||(n.lang=r,ce("指定文本的语种："+r));const e=me[r];var i;if(e){if(null!==(i=fe)&&void 0!==i&&i.vipActivated)try{const{voicesGroup:t}=await V(),s=t[r];if(s){const t=s.find((t=>t.name===e));t&&(ce("指定系统语音："+t.name),n.voice=t)}}catch(e){}}else if(J&&"en-US"===r){const e=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Wobble","Eddy","Flo"];try{const{voicesGroup:t}=await V(),s=t[r];if(s){const t=s.find((t=>e.every((e=>!t.name.startsWith(e)))));t&&(ce("为朗读英语（美国）的 macOS 用户指定系统语音："+t.name),n.voice=t)}}catch(e){}}}ce("开始朗读"),window.speechSynthesis.speak(n)}))}}(e.url);case"open panel":return Se();case"update panel pos":return async function(){if(null==ve)return;const e=await Re();await i().windows.update(ve,{...e,focused:!0})}();case"update badge":return Me();case"save history record":return ot().then((t=>je.add(e.record,t)));case"save favorite":return ot().then((t=>{const s=e.record.results;return s&&(e.record.dir=function(e){const t=[];(0,N.Z)(e,(e=>{if(!e)return;const s=e.from+" "+e.to,a=t.findIndex((e=>e[0]===s));a>=0?t[a][1]+=1:t.push([s,1])}));const s=(0,Ye.Z)(t,(e=>e[1]));if(s){const e=s[0].split(" ");return{from:e[0],to:e[1]}}}(s)),Xe.add(e.record,t)}));case"is text in favorites":return async function(e){return Xe.hasByKey("text",e)}(e.text);case"delete record in favorites":return ot().then((t=>Xe.deleteByKey("text",e.text,t)));case"write to clipboard":return Promise.resolve((t=e.text,et(),Qe.value=t,Qe.select(),document.execCommand("copy")));case"take screenshot":return i().tabs.captureVisibleTab(i().windows.WINDOW_ID_CURRENT,{format:"png"});case"ocr":return async function(e){if(await ft.isOver())throw new Error("非会员每天只能使用 5 次截图翻译功能，成为会员即可解除此限制。");let t;const{ocrService:s,localOCR:a}=await i().storage.local.get(gt);switch(s){case"tesseractocr":t=await ht.ocr({image:e,lang:a.lang});break;case"bdocr":t=await mt.ff.ocr({image:e});break;default:throw new TypeError(`不支持的 OCR 服务：${s}`)}return await ft.addOne(),t}(e.dataURI);case"sync data":return Promise.all([je,Xe].map((e=>e.commit())));case"refresh notices":return bt(!0);case"get user sid":return Ve.L.get("https://hs-api.limingkai.cn/sid").then((e=>e.data.sid));case"read clipboard":return Promise.resolve(at());case"read clipboard image":return Promise.resolve(st());case"open pdf viewer":return Ke(e.params);case"set clipboard monitor":return void(e.data?Lt.start():Lt.stop())}var t}));const _t=(0,A.Z)(I.qI,["pdfAuto","pdfStandalone"]);let qt=_t.pdfStandalone;function Kt(e){const{url:t,tabId:s,frameId:a}=e;return i().tabs.get(s).then((e=>{e.incognito?(a||i().tabs.remove(s),Ke({file:t,incognito:!0})):qt&&(a||i().tabs.remove(s),Ke(t))})),qt?{cancel:!0}:{redirectUrl:qe(e.url)}}function Bt(e){var t;if("GET"!==e.method)return;let s,a;return null===(t=e.responseHeaders)||void 0===t||t.some((e=>{var t;switch(e.name.toLowerCase()){case"content-type":s=e.value;break;case"content-disposition":a=null===(t=e.value)||void 0===t?void 0:t.trim()}return!(!s||!a)})),s?(s=s.toLowerCase().split(";",1)[0].trim(),"application/pdf"!==s||a&&!a.startsWith("inline")?void 0:Kt(e)):void 0}(0,S.Z)(_t,(e=>{null!=e.pdfAuto&&(e.pdfAuto?(i().webRequest.onBeforeRequest.hasListener(Kt)||i().webRequest.onBeforeRequest.addListener(Kt,{urls:["ftp://*/*.pdf","ftp://*/*.PDF","file://*/*.pdf","file://*/*.PDF"],types:["main_frame","sub_frame"]},["blocking"]),i().webRequest.onHeadersReceived.hasListener(Bt)||i().webRequest.onHeadersReceived.addListener(Bt,{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"])):(i().webRequest.onBeforeRequest.removeListener(Kt),i().webRequest.onHeadersReceived.removeListener(Bt))),null!=e.pdfStandalone&&(qt=e.pdfStandalone)}));var Ot=s(614);const Mt={YouDao:"YouDaoWeb",BaiDu:"BaiDuWeb",Google:"GoogleWeb",GoogleCN:"GoogleWeb"};i().runtime.onInstalled.addListener((async e=>{if("install"!==e.reason)if("update"!==e.reason);else{const t=e.previousVersion?e.previousVersion.split(".").map((e=>Number(e))):void 0,s=7===(null==t?void 0:t[0]);if(t&&6===t[0]){const e=await i().storage.local.get(),t={};if(t.pdfAuto=null!=e.pdf&&e.pdf,e.disableSelection)t.domainBlackList=[{host:"*",path:"/*"}];else{const s=e.excludeDomains;Array.isArray(s)&&(t.domainBlackList=s.map((e=>({host:`*${"."===e[0]?"":"."}${e}`,path:"/*"}))))}null!=e.showBtn&&(t.button=e.showBtn);const s=e.defaultApi||"GoogleCN",a=Mt[s];a&&(t.selectedAPIs=[a]);const n=(0,Ot.Z)(I.qI.textList);let o=!1;e.ignoreChinese&&(n[0].enabled=!0,o=!0),e.ignoreNumLike||(n[1].enabled=!1,o=!0),o&&(t.textList=n),await i().storage.local.clear(),await i().storage.local.set(t)}if(t&&s&&t[1]<=3){const{modifierKey:e}=await i().storage.local.get("modifierKey");!1!==e&&await i().storage.local.set({modifierKeys:["ctrl"],modifierKeyPressedAction:"selection",modifierKeyTranslate:!0}),await i().storage.local.remove(["region","tipNewGoogleAPI","modifierKey"])}if(t&&s&&(t[1]<5||5===t[1]&&t[2]<=2)&&await Promise.all([$e.favorites,$e.historyRecords].map((e=>e.filter((e=>!e._id&&!e.syncStatus)).modify({syncStatus:ze.Pending})))),t&&s&&(t[1]<5||5===t[1]&&t[2]<=5)){const{selectedAPIs:e}=await i().storage.local.get("selectedAPIs");e||await i().storage.local.set({selectedAPIs:["BaiDuWeb"]})}if(t&&s&&(t[1]<5||5===t[1]&&t[2]<=6)&&await i().storage.local.set({pinIgnoreDomainList:!1}),t&&re(t,"8.0.0")<=0){const{baiDuOCRKey:e}=await i().storage.local.get("baiDuOCRKey");if(null!=e&&e.secret||null!=e&&e.key){e.legacy=!0;const t=e.secret&&e.key;await i().storage.local.set(t?{baiDuOCRKey:e,ocrService:"bdocr"}:{baiDuOCRKey:e})}}if(t&&re(t,"8.5.6")<=0&&await i().storage.local.set({pinAfterDrag:!0}),t&&re(t,"8.6.0")<=0&&await i().storage.local.set({textAreaShortKey:I.VH.ctrlEnter}),t&&re(t,"8.6.1")<=0&&await i().storage.local.set({panelButtons:["cut","translate","video","media","microphone"]}),t&&re(t,"8.6.3")<=0){const{buttonAutoClose:e,pdfAuto:t,autoClipboard:s,autoClipboardImage:a}=await i().storage.local.get(["buttonAutoClose","pdfAuto","autoClipboard","autoClipboardImage"]),n={};null==e&&(n.buttonAutoClose=!1),null==t&&(n.pdfAuto=!0),null==s&&(n.autoClipboard=!0),null==a&&(n.autoClipboardImage=!0),await i().storage.local.set(n)}if(t&&re(t,"8.6.6")<=0&&await i().storage.local.set({tipForPageTrsClosed:!0}),t&&re(t,"8.6.8")<=0&&await i().storage.local.set({tipForAddJumpTwoClosed:!1}),t&&re(t,"8.6.10")<=0){const e=(0,A.Z)(I.d6,["baiDuAppKey","baiDuOCRKey","youDaoAppKey","aLiApiKey","qqApiKey","cyApiToken"]),t={baiDuAppKey:"bdPoints",baiDuOCRKey:"bdOcrPoints",youDaoAppKey:"ydPoints",aLiApiKey:"aliPoints",qqApiKey:"qqPoints",cyApiToken:"cyPoints"},s=await i().storage.local.get(e),a={tipForServicesUpdateClosed:!1};(0,N.Z)(s,((e,s)=>{Array.isArray(e)||("string"==typeof e?e&&(a[t[s]]=!1):"secret"in e?e.secret&&e.key&&(a[t[s]]=!1):e.id&&e.key&&(a[t[s]]=!1))})),await i().storage.local.set(a)}if(t&&re(t,"9.6.0")<=0&&await i().storage.local.set({pageTrsResultStyleId:"STYLE_DOTTED_CLASSIC"}),t&&re(t,"9.8.0")<=0){const{pageTrsResultStyleId:e}=await i().storage.local.get("pageTrsResultStyleId");e||await i().storage.local.set({pageTrsResultStyleId:"STYLE_BACKGROUND"})}if(t&&re(t,"9.8.1.1")<=0){const{width:e,selectedAPIs:t}=await i().storage.local.get(["width","selectedAPIs"]),s={tipForFullTextClosed:!0};e||(s.width=250),t||(s.selectedAPIs=["GoogleWeb","DeepLWeb","BingDictWeb"]),await i().storage.local.set(s)}t&&re(t,"9.8.2")<=0&&await i().storage.local.set({tipForSaveSourceSelectClosed:!1})}else i().tabs.create({url:"https://hcfy.app/docs/guides/welcome"})}));const Zt=(0,A.Z)(I.qI,["quickLinks"]),Ut=(0,A.Z)(I.qI,["quickLinks","contextMenus"]),$t=["*://*/*","file://*/*","ftp://*/*",qe()+"*"],Gt=["page","frame","link","editable","image","video","audio"],Ft=[{id:"screenshot-translate-in-action",title:"截图翻译",contexts:["browser_action"]},{id:"page-translate-in-action",title:"网页全文翻译",contexts:["browser_action"]},{id:"open-pdf-in-action",title:"内置 PDF 阅读器",contexts:["browser_action"]},{id:"open-panel-in-action",title:"独立翻译窗口",contexts:["browser_action"]}];ae&&Ft.push({id:"open-options-in-action",title:"设置",contexts:["browser_action"]});const Wt={translate:{id:"translate",title:"翻译这段文本(&Z)",contexts:["selection"]},"open-link-in-viewer":{id:"open-link-in-viewer",title:"在划词翻译中打开此 PDF (&P)",contexts:["link"],targetUrlPatterns:["*://*/*.pdf","*://*/*.PDF","*://*/*.pdf?*","*://*/*.PDF?*","ftp://*/*.pdf","ftp://*/*.PDF","ftp://*/*.pdf?*","ftp://*/*.PDF?*","file://*/*.pdf","file://*/*.PDF","file://*/*.pdf?*","file://*/*.PDF?*"]},"screen-translate":{id:"screen-translate",title:"截图翻译",contexts:Gt,documentUrlPatterns:$t},"page-translate":{id:"page-translate",title:"网页全文翻译",contexts:["page","frame"],documentUrlPatterns:$t},"video-translate":{id:"video-translate",title:"音视频翻译",contexts:Gt,documentUrlPatterns:$t}},Nt={id:"sp-for-quick-link",contexts:["selection"],type:"separator"},zt="quick-link-",Ht=e=>`${zt}${e.name}`;(0,S.Z)(Ut,(()=>{!async function(){await i().contextMenus.removeAll();const{contextMenus:e,quickLinks:t}=await i().storage.local.get(Ut),s=t.filter((e=>e.menu));e.length&&e.forEach((e=>{const t=Wt[e];t&&i().contextMenus.create(t)})),e.length&&s.length&&i().contextMenus.create(Nt),s.forEach((e=>{i().contextMenus.create({id:Ht(e),contexts:["selection"],title:e.name})})),Ft.forEach((e=>{i().contextMenus.create(e)}))}()})),i().contextMenus.onClicked.addListener((async(e,t)=>{switch(e.menuItemId){case"open-options-in-action":i().runtime.openOptionsPage();break;case"open-panel-in-action":Se();break;case"translate":const s=e.selectionText,a=e.pageUrl||"";s&&(a.startsWith("chrome")&&!_e(a)||a.startsWith("about")||!ae&&a.startsWith("https://chrome.google.com")?Se(s):Pe(s,null==t?void 0:t.id));break;case"open-pdf-in-action":Ke();break;case"open-link-in-viewer":e.linkUrl&&Ke(e.linkUrl);break;case"screen-translate":case"screenshot-translate-in-action":if(null!=t&&t.id)try{await i().tabs.sendMessage(t.id,"screenshot translate")}catch(e){}break;case"page-translate":case"page-translate-in-action":if(null!=t&&t.id)try{await i().tabs.sendMessage(t.id,"page translate")}catch(e){}break;case"video-translate":if(null!=t&&t.id)try{await i().tabs.sendMessage(t.id,"video translate")}catch(e){}break;default:if("string"==typeof e.menuItemId&&e.menuItemId.startsWith(zt)){const t=e.menuItemId.slice(11),s=(await i().storage.local.get(Zt)).quickLinks.find((e=>e.name===t));s&&i().tabs.create({url:s.link.replace("%s",encodeURIComponent(e.selectionText||""))})}}}));s(1951);const Vt=(0,A.Z)(I.qI,["domainBlackList"]);i().commands.onCommand.addListener((async e=>{var t,s,a,n,o,r;let c;switch(e){case"panel":Se();break;case"translate":Pe("",void 0,!1);break;case"translateWithPopup":if(c=null===(t=await ye())||void 0===t?void 0:t.id,c)try{Se(await i().tabs.sendMessage(c,"getSelectionText"))}catch(e){}break;case"screenshot":if(c=null===(s=await ye())||void 0===s?void 0:s.id,c)try{await i().tabs.sendMessage(c,"screenshot translate")}catch(e){}break;case"page":if(c=null===(a=await ye())||void 0===a?void 0:a.id,c)try{await i().tabs.sendMessage(c,"page translate")}catch(e){}break;case"pageSwitchMode":if(c=null===(n=await ye())||void 0===n?void 0:n.id,c)try{await i().tabs.sendMessage(c,"page translate switch mode")}catch(e){}break;case"hoverTranslate":if(c=null===(o=await ye())||void 0===o?void 0:o.id,c)try{await i().tabs.sendMessage(c,"hover translate")}catch(e){}break;case"switchWeb":const{domainBlackList:e}=await i().storage.local.get(Vt),l=e.findIndex((e=>"*"===e.host&&"/*"===e.path));l>=0?e.splice(l,1):e.unshift({host:"*",path:"/*"}),await i().storage.local.set({domainBlackList:e});break;case"play":if(c=null===(r=await ye())||void 0===r?void 0:r.id,c)try{await i().tabs.sendMessage(c,"play")}catch(e){}}}));var jt=s(13474),Yt=(s(6710),s(69378)),Xt=s.n(Yt);async function Qt(){const e=await i().storage.local.get(I.qI),t=await Ve.L.put("/options",{options:JSON.stringify(e)});await i().storage.local.set({optionsSyncAt:t.data})}async function Jt(){const e=await async function(e){let t;e||(t=(await i().storage.local.get("optionsSyncAt")).optionsSyncAt);const s=await Ve.L.get("/options",{params:{ifModifiedSince:t}});if(204===s.status)return"no-data";if(304===s.status)return"not-modified";const a=s.data;if(!a)return"server-data-error";let n;try{n=JSON.parse(a.optionsString)}catch(e){return"server-data-error"}return Xt()(await i().storage.local.get(I.qI),n)?(await i().storage.local.set({optionsSyncAt:a.updatedAt}),"not-modified"):e||t?(n.optionsSyncAt=a.updatedAt,await i().storage.local.set(n),"covered"):{status:"need-confirm",date:a.updatedAt}}();return"no-data"===e?(await Qt(),"uploaded"):e}const es=(0,A.Z)(I.d6,"user"),ts={...I.qI,...(0,A.Z)(I.d6,["optionsSyncAt"])},ss=(0,jt.Z)(Qt,5e3);let as;const ns="sync alarm",os="notify for options sync",rs=(0,A.Z)(I.qI,["notifySyncOptions"]);async function is(){let e;try{e=await Jt()}catch(e){return}if("covered"===e&&await i().permissions.contains({permissions:["notifications"]})){const{notifySyncOptions:e}=await i().storage.local.get(rs);if(e)try{await i().notifications.create(os,{type:"basic",iconUrl:"logodark.png",title:"划词翻译设置已更新",message:"已将划词翻译设置更新至最新版本。"})}catch(e){i().storage.local.set({disabledNofiByBrowserUI:!0})}}}function cs(e){e.name===ns&&is()}function ls(e){return`https://translate.google.com/translate?sl=auto&tl=zh-CN&u=${e}`}function ds(e){return`https://translate.sogoucdn.com/pcvtsnapshot?from=auto&to=zh-CHS&tfr=translatepc&url=${encodeURIComponent(e)}&domainType=sogou`}function us(e){return`http://webtrans.yodao.com/webTransPc/index.html#/?url=${encodeURIComponent(e)}&from=auto&to=auto&type=1`}(0,S.Z)(es,((e,t)=>{var s;null!==(s=e.user)&&void 0!==s&&s.vipActivated?(as=(0,S.Z)(ts,(e=>{Object.prototype.hasOwnProperty.call(e,"optionsSyncAt")||ss()}),Fe.Z),i().alarms.create(ns,{periodInMinutes:60}),i().alarms.onAlarm.addListener(cs),t&&is()):(as&&as(),i().alarms.clear(ns),i().alarms.onAlarm.removeListener(cs))}));var ps=s(29819);const hs=s.n(ps)()({exact:!0,strict:!1});function ms(e){return hs.test(e)}const gs=ee?e=>`<match>${e.k}</match>  <dim>${e.v}</dim>`:e=>`${e.k} ${e.v}`,fs=e=>e?"翻译这段文本":"请输入想要翻译的文本或网址。",ys=["谷歌翻译","搜狗翻译","有道翻译"];let ws;i().omnibox.onInputStarted.addListener((()=>{i().omnibox.setDefaultSuggestion({description:fs("")})})),i().omnibox.onInputChanged.addListener(((e,t)=>{const s=(0,Ge.Z)();ws=s,e?ms(e)?(i().omnibox.setDefaultSuggestion({description:"使用百度翻译此网址"}),t(ys.map((t=>({content:t+" "+e,description:`使用${t}此网址`}))))):async function(e){return(await L.Z.post("https://fanyi.baidu.com/sug",{kw:e})).data.data||[]}(e).then((a=>{if(ws===s){if(!a.length)return i().omnibox.setDefaultSuggestion({description:fs(e)}),void t([]);i().omnibox.setDefaultSuggestion({description:gs(a[0])}),t(a.slice(1).map((e=>({content:e.k,description:gs(e)}))))}})):i().omnibox.setDefaultSuggestion({description:fs("")})})),i().omnibox.onInputEntered.addListener((e=>{if(ms(e))return void i().tabs.create({url:(t=e,`https://fanyi.baidu.com/transpage?query=${encodeURIComponent(t)}&from=auto&to=zh&source=url&render=1`)});var t;const s=e.split(" ");if(2===s.length&&ys.includes(s[0])){const e=s[1];switch(s[0]){case"谷歌翻译":i().tabs.create({url:ls(e)});break;case"搜狗翻译":i().tabs.create({url:ds(e)});break;case"有道翻译":i().tabs.create({url:us(e)})}}else Se(e)}));const vs=(0,A.Z)(I.qI,["popupAction"]);(0,S.Z)(vs,(e=>{e.popupAction&&i().browserAction.setPopup({popup:"show-popup"===e.popupAction?"popup.html":""})})),i().browserAction.onClicked.addListener((e=>{e.id&&i().tabs.sendMessage(e.id,"page translate").catch(Fe.Z)}))},40448:(e,t,s)=>{"use strict";s.d(t,{m:()=>o});s(85371),s(71372);var a=s(21591),n=s(48194);class o extends Error{constructor(e,t){super(e),null!==(null==t?void 0:t.type)&&(this.type=(null==t?void 0:t.type)||a.c.OTHER),this.link=null==t?void 0:t.link,this.context=null==t?void 0:t.context,this.errors=null==t?void 0:t.errors,this.noRetry=null==t?void 0:t.noRetry}toJSON(){var e;return{type:this.type,message:this.message,link:this.link,errors:null===(e=this.errors)||void 0===e?void 0:e.map((e=>(0,n.R)(e).toJSON()))}}clone(){return new o(this.message,{context:this.context,type:this.type,link:this.link,errors:this.errors,noRetry:this.noRetry})}}},69548:(e,t,s)=>{"use strict";s.d(t,{D:()=>n});s(71372);var a=s(40448);function n(e){return e instanceof a.m?e:e instanceof Error?new a.m(e.message,{type:null}):new a.m("划词翻译内部出现了一个预期之外的错误，如果你看到了这条消息，请反馈给我。",{type:null})}},64643:(e,t,s)=>{"use strict";s(74584)}},s={};function a(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.loaded=!0,o.exports}a.m=t,e=[],a.O=(t,s,n,o)=>{if(!s){var r=1/0;for(d=0;d<e.length;d++){for(var[s,n,o]=e[d],i=!0,c=0;c<s.length;c++)(!1&o||r>=o)&&Object.keys(a.O).every((e=>a.O[e](s[c])))?s.splice(c--,1):(i=!1,o<r&&(r=o));if(i){e.splice(d--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,n,o]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={128:0,523:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[r,i,c]=s,l=0;if(r.some((t=>0!==e[t]))){for(n in i)a.o(i,n)&&(a.m[n]=i[n]);if(c)var d=c(a)}for(t&&t(s);l<r.length;l++)o=r[l],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self.webpackChunkbrowser_extension=self.webpackChunkbrowser_extension||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=a.O(void 0,[917,251,805,823,659,426,204,885],(()=>a(1636)));n=a.O(n)})();