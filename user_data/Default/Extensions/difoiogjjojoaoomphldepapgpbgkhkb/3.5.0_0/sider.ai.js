"use strict";(()=>{var Po=Object.create;var Tt=Object.defineProperty;var Io=Object.getOwnPropertyDescriptor;var ko=Object.getOwnPropertyNames;var So=Object.getPrototypeOf,Eo=Object.prototype.hasOwnProperty;var Co=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Oo=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ko(t))!Eo.call(e,n)&&n!==r&&Tt(e,n,{get:()=>t[n],enumerable:!(o=Io(t,n))||o.enumerable});return e};var ae=(e,t,r)=>(r=e!=null?Po(So(e)):{},Oo(t||!e||!e.__esModule?Tt(r,"default",{value:e,enumerable:!0}):r,e));var Q=Co((tt,_t)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof tt<"u")t(_t);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:tt,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=o=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class f extends WeakMap{constructor(s,l=void 0){super(l),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}let u=i=>i&&typeof i=="object"&&typeof i.then=="function",a=(i,s)=>(...l)=>{o.runtime.lastError?i.reject(new Error(o.runtime.lastError.message)):s.singleCallbackArg||l.length<=1&&s.singleCallbackArg!==!1?i.resolve(l[0]):i.resolve(l)},c=i=>i==1?"argument":"arguments",T=(i,s)=>function(x,..._){if(_.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${c(s.minArgs)} for ${i}(), got ${_.length}`);if(_.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${c(s.maxArgs)} for ${i}(), got ${_.length}`);return new Promise((C,N)=>{if(s.fallbackToNoCallback)try{x[i](..._,a({resolve:C,reject:N},s))}catch{x[i](..._),s.fallbackToNoCallback=!1,s.noCallback=!0,C()}else s.noCallback?(x[i](..._),C()):x[i](..._,a({resolve:C,reject:N},s))})},A=(i,s,l)=>new Proxy(s,{apply(x,_,C){return l.call(_,i,...C)}}),g=Function.call.bind(Object.prototype.hasOwnProperty),w=(i,s={},l={})=>{let x=Object.create(null),_={has(N,b){return b in i||b in x},get(N,b,V){if(b in x)return x[b];if(!(b in i))return;let R=i[b];if(typeof R=="function")if(typeof s[b]=="function")R=A(i,i[b],s[b]);else if(g(l,b)){let le=T(b,l[b]);R=A(i,i[b],le)}else R=R.bind(i);else if(typeof R=="object"&&R!==null&&(g(s,b)||g(l,b)))R=w(R,s[b],l[b]);else if(g(l,"*"))R=w(R,s[b],l["*"]);else return Object.defineProperty(x,b,{configurable:!0,enumerable:!0,get(){return i[b]},set(le){i[b]=le}}),R;return x[b]=R,R},set(N,b,V,R){return b in x?x[b]=V:i[b]=V,!0},defineProperty(N,b,V){return Reflect.defineProperty(x,b,V)},deleteProperty(N,b){return Reflect.deleteProperty(x,b)}},C=Object.create(i);return new Proxy(C,_)},m=i=>({addListener(s,l,...x){s.addListener(i.get(l),...x)},hasListener(s,l){return s.hasListener(i.get(l))},removeListener(s,l){s.removeListener(i.get(l))}}),h=new f(i=>typeof i!="function"?i:function(l){let x=w(l,{},{getContent:{minArgs:0,maxArgs:0}});i(x)}),S=new f(i=>typeof i!="function"?i:function(l,x,_){let C=!1,N,b=new Promise(Pe=>{N=function(z){C=!0,Pe(z)}}),V;try{V=i(l,x,N)}catch(Pe){V=Promise.reject(Pe)}let R=V!==!0&&u(V);if(V!==!0&&!R&&!C)return!1;let le=Pe=>{Pe.then(z=>{_(z)},z=>{let et;z&&(z instanceof Error||typeof z.message=="string")?et=z.message:et="An unexpected error occurred",_({__mozWebExtensionPolyfillReject__:!0,message:et})}).catch(z=>{})};return le(R?V:b),!0}),p=({reject:i,resolve:s},l)=>{o.runtime.lastError?o.runtime.lastError.message===t?s():i(new Error(o.runtime.lastError.message)):l&&l.__mozWebExtensionPolyfillReject__?i(new Error(l.message)):s(l)},y=(i,s,l,...x)=>{if(x.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${c(s.minArgs)} for ${i}(), got ${x.length}`);if(x.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${c(s.maxArgs)} for ${i}(), got ${x.length}`);return new Promise((_,C)=>{let N=p.bind(null,{resolve:_,reject:C});x.push(N),l.sendMessage(...x)})},k={devtools:{network:{onRequestFinished:m(h)}},runtime:{onMessage:m(S),onMessageExternal:m(S),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},E={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":E},services:{"*":E},websites:{"*":E}},w(o,k,n)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var ve=ae(Q());var Ro=typeof global=="object"&&global&&global.Object===Object&&global,De=Ro;var Mo=typeof self=="object"&&self&&self.Object===Object&&self,jo=De||Mo||Function("return this")(),I=jo;var No=I.Symbol,ue=No;var vt=Object.prototype,Do=vt.hasOwnProperty,Lo=vt.toString,Ie=ue?ue.toStringTag:void 0;function Go(e){var t=Do.call(e,Ie),r=e[Ie];try{e[Ie]=void 0;var o=!0}catch{}var n=Lo.call(e);return o&&(t?e[Ie]=r:delete e[Ie]),n}var Pt=Go;var Bo=Object.prototype,Uo=Bo.toString;function Vo(e){return Uo.call(e)}var It=Vo;var Wo="[object Null]",Fo="[object Undefined]",kt=ue?ue.toStringTag:void 0;function Ko(e){return e==null?e===void 0?Fo:Wo:kt&&kt in Object(e)?Pt(e):It(e)}var G=Ko;function $o(e){return e!=null&&typeof e=="object"}var W=$o;var zo="[object Symbol]";function qo(e){return typeof e=="symbol"||W(e)&&G(e)==zo}var St=qo;var Ho=Array.isArray,se=Ho;var Qo=/\s/;function Xo(e){for(var t=e.length;t--&&Qo.test(e.charAt(t)););return t}var Et=Xo;var Yo=/^\s+/;function Jo(e){return e&&e.slice(0,Et(e)+1).replace(Yo,"")}var Ct=Jo;function Zo(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var O=Zo;var Ot=0/0,en=/^[-+]0x[0-9a-f]+$/i,tn=/^0b[01]+$/i,rn=/^0o[0-7]+$/i,on=parseInt;function nn(e){if(typeof e=="number")return e;if(St(e))return Ot;if(O(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=O(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ct(e);var r=tn.test(e);return r||rn.test(e)?on(e.slice(2),r?2:8):en.test(e)?Ot:+e}var rt=nn;function an(e){return e}var Le=an;var sn="[object AsyncFunction]",fn="[object Function]",pn="[object GeneratorFunction]",ln="[object Proxy]";function un(e){if(!O(e))return!1;var t=G(e);return t==fn||t==pn||t==sn||t==ln}var me=un;var mn=I["__core-js_shared__"],Ge=mn;var Rt=function(){var e=/[^.]+$/.exec(Ge&&Ge.keys&&Ge.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function cn(e){return!!Rt&&Rt in e}var Mt=cn;var dn=Function.prototype,gn=dn.toString;function xn(e){if(e!=null){try{return gn.call(e)}catch{}try{return e+""}catch{}}return""}var q=xn;var hn=/[\\^$.*+?()[\]{}|]/g,yn=/^\[object .+?Constructor\]$/,bn=Function.prototype,An=Object.prototype,wn=bn.toString,Tn=An.hasOwnProperty,_n=RegExp("^"+wn.call(Tn).replace(hn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function vn(e){if(!O(e)||Mt(e))return!1;var t=me(e)?_n:yn;return t.test(q(e))}var jt=vn;function Pn(e,t){return e?.[t]}var Nt=Pn;function In(e,t){var r=Nt(e,t);return jt(r)?r:void 0}var D=In;var kn=D(I,"WeakMap"),Be=kn;var Dt=Object.create,Sn=function(){function e(){}return function(t){if(!O(t))return{};if(Dt)return Dt(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Lt=Sn;function En(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var Gt=En;function Cn(e,t){var r=-1,o=e.length;for(t||(t=Array(o));++r<o;)t[r]=e[r];return t}var Bt=Cn;var On=800,Rn=16,Mn=Date.now;function jn(e){var t=0,r=0;return function(){var o=Mn(),n=Rn-(o-r);if(r=o,n>0){if(++t>=On)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Ut=jn;function Nn(e){return function(){return e}}var Vt=Nn;var Dn=function(){try{var e=D(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ce=Dn;var Ln=ce?function(e,t){return ce(e,"toString",{configurable:!0,enumerable:!1,value:Vt(t),writable:!0})}:Le,Wt=Ln;var Gn=Ut(Wt),Ft=Gn;var Bn=9007199254740991,Un=/^(?:0|[1-9]\d*)$/;function Vn(e,t){var r=typeof e;return t=t??Bn,!!t&&(r=="number"||r!="symbol"&&Un.test(e))&&e>-1&&e%1==0&&e<t}var Ue=Vn;function Wn(e,t,r){t=="__proto__"&&ce?ce(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var de=Wn;function Fn(e,t){return e===t||e!==e&&t!==t}var X=Fn;var Kn=Object.prototype,$n=Kn.hasOwnProperty;function zn(e,t,r){var o=e[t];(!($n.call(e,t)&&X(o,r))||r===void 0&&!(t in e))&&de(e,t,r)}var Kt=zn;function qn(e,t,r,o){var n=!r;r||(r={});for(var f=-1,u=t.length;++f<u;){var a=t[f],c=o?o(r[a],e[a],a,r,e):void 0;c===void 0&&(c=e[a]),n?de(r,a,c):Kt(r,a,c)}return r}var $t=qn;var zt=Math.max;function Hn(e,t,r){return t=zt(t===void 0?e.length-1:t,0),function(){for(var o=arguments,n=-1,f=zt(o.length-t,0),u=Array(f);++n<f;)u[n]=o[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=o[n];return a[t]=r(u),Gt(e,this,a)}}var qt=Hn;function Qn(e,t){return Ft(qt(e,t,Le),e+"")}var Ht=Qn;var Xn=9007199254740991;function Yn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Xn}var Ve=Yn;function Jn(e){return e!=null&&Ve(e.length)&&!me(e)}var Y=Jn;function Zn(e,t,r){if(!O(r))return!1;var o=typeof t;return(o=="number"?Y(r)&&Ue(t,r.length):o=="string"&&t in r)?X(r[t],e):!1}var Qt=Zn;function ea(e){return Ht(function(t,r){var o=-1,n=r.length,f=n>1?r[n-1]:void 0,u=n>2?r[2]:void 0;for(f=e.length>3&&typeof f=="function"?(n--,f):void 0,u&&Qt(r[0],r[1],u)&&(f=n<3?void 0:f,n=1),t=Object(t);++o<n;){var a=r[o];a&&e(t,a,o,f)}return t})}var Xt=ea;var ta=Object.prototype;function ra(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||ta;return e===r}var J=ra;function oa(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o}var Yt=oa;var na="[object Arguments]";function aa(e){return W(e)&&G(e)==na}var ot=aa;var Jt=Object.prototype,sa=Jt.hasOwnProperty,ia=Jt.propertyIsEnumerable,fa=ot(function(){return arguments}())?ot:function(e){return W(e)&&sa.call(e,"callee")&&!ia.call(e,"callee")},ie=fa;function pa(){return!1}var Zt=pa;var rr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,er=rr&&typeof module=="object"&&module&&!module.nodeType&&module,la=er&&er.exports===rr,tr=la?I.Buffer:void 0,ua=tr?tr.isBuffer:void 0,ma=ua||Zt,ge=ma;var ca="[object Arguments]",da="[object Array]",ga="[object Boolean]",xa="[object Date]",ha="[object Error]",ya="[object Function]",ba="[object Map]",Aa="[object Number]",wa="[object Object]",Ta="[object RegExp]",_a="[object Set]",va="[object String]",Pa="[object WeakMap]",Ia="[object ArrayBuffer]",ka="[object DataView]",Sa="[object Float32Array]",Ea="[object Float64Array]",Ca="[object Int8Array]",Oa="[object Int16Array]",Ra="[object Int32Array]",Ma="[object Uint8Array]",ja="[object Uint8ClampedArray]",Na="[object Uint16Array]",Da="[object Uint32Array]",v={};v[Sa]=v[Ea]=v[Ca]=v[Oa]=v[Ra]=v[Ma]=v[ja]=v[Na]=v[Da]=!0;v[ca]=v[da]=v[Ia]=v[ga]=v[ka]=v[xa]=v[ha]=v[ya]=v[ba]=v[Aa]=v[wa]=v[Ta]=v[_a]=v[va]=v[Pa]=!1;function La(e){return W(e)&&Ve(e.length)&&!!v[G(e)]}var or=La;function Ga(e){return function(t){return e(t)}}var nr=Ga;var ar=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ke=ar&&typeof module=="object"&&module&&!module.nodeType&&module,Ba=ke&&ke.exports===ar,nt=Ba&&De.process,Ua=function(){try{var e=ke&&ke.require&&ke.require("util").types;return e||nt&&nt.binding&&nt.binding("util")}catch{}}(),at=Ua;var sr=at&&at.isTypedArray,Va=sr?nr(sr):or,xe=Va;var Wa=Object.prototype,Fa=Wa.hasOwnProperty;function Ka(e,t){var r=se(e),o=!r&&ie(e),n=!r&&!o&&ge(e),f=!r&&!o&&!n&&xe(e),u=r||o||n||f,a=u?Yt(e.length,String):[],c=a.length;for(var T in e)(t||Fa.call(e,T))&&!(u&&(T=="length"||n&&(T=="offset"||T=="parent")||f&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||Ue(T,c)))&&a.push(T);return a}var ir=Ka;function $a(e,t){return function(r){return e(t(r))}}var We=$a;var za=We(Object.keys,Object),fr=za;var qa=Object.prototype,Ha=qa.hasOwnProperty;function Qa(e){if(!J(e))return fr(e);var t=[];for(var r in Object(e))Ha.call(e,r)&&r!="constructor"&&t.push(r);return t}var pr=Qa;function Xa(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var lr=Xa;var Ya=Object.prototype,Ja=Ya.hasOwnProperty;function Za(e){if(!O(e))return lr(e);var t=J(e),r=[];for(var o in e)o=="constructor"&&(t||!Ja.call(e,o))||r.push(o);return r}var ur=Za;function es(e){return Y(e)?ir(e,!0):ur(e)}var Fe=es;var ts=D(Object,"create"),H=ts;function rs(){this.__data__=H?H(null):{},this.size=0}var mr=rs;function os(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var cr=os;var ns="__lodash_hash_undefined__",as=Object.prototype,ss=as.hasOwnProperty;function is(e){var t=this.__data__;if(H){var r=t[e];return r===ns?void 0:r}return ss.call(t,e)?t[e]:void 0}var dr=is;var fs=Object.prototype,ps=fs.hasOwnProperty;function ls(e){var t=this.__data__;return H?t[e]!==void 0:ps.call(t,e)}var gr=ls;var us="__lodash_hash_undefined__";function ms(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=H&&t===void 0?us:t,this}var xr=ms;function he(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}he.prototype.clear=mr;he.prototype.delete=cr;he.prototype.get=dr;he.prototype.has=gr;he.prototype.set=xr;var st=he;function cs(){this.__data__=[],this.size=0}var hr=cs;function ds(e,t){for(var r=e.length;r--;)if(X(e[r][0],t))return r;return-1}var Z=ds;var gs=Array.prototype,xs=gs.splice;function hs(e){var t=this.__data__,r=Z(t,e);if(r<0)return!1;var o=t.length-1;return r==o?t.pop():xs.call(t,r,1),--this.size,!0}var yr=hs;function ys(e){var t=this.__data__,r=Z(t,e);return r<0?void 0:t[r][1]}var br=ys;function bs(e){return Z(this.__data__,e)>-1}var Ar=bs;function As(e,t){var r=this.__data__,o=Z(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}var wr=As;function ye(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}ye.prototype.clear=hr;ye.prototype.delete=yr;ye.prototype.get=br;ye.prototype.has=Ar;ye.prototype.set=wr;var ee=ye;var ws=D(I,"Map"),te=ws;function Ts(){this.size=0,this.__data__={hash:new st,map:new(te||ee),string:new st}}var Tr=Ts;function _s(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _r=_s;function vs(e,t){var r=e.__data__;return _r(t)?r[typeof t=="string"?"string":"hash"]:r.map}var re=vs;function Ps(e){var t=re(this,e).delete(e);return this.size-=t?1:0,t}var vr=Ps;function Is(e){return re(this,e).get(e)}var Pr=Is;function ks(e){return re(this,e).has(e)}var Ir=ks;function Ss(e,t){var r=re(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}var kr=Ss;function be(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}be.prototype.clear=Tr;be.prototype.delete=vr;be.prototype.get=Pr;be.prototype.has=Ir;be.prototype.set=kr;var Sr=be;var Es=We(Object.getPrototypeOf,Object),Ke=Es;var Cs="[object Object]",Os=Function.prototype,Rs=Object.prototype,Er=Os.toString,Ms=Rs.hasOwnProperty,js=Er.call(Object);function Ns(e){if(!W(e)||G(e)!=Cs)return!1;var t=Ke(e);if(t===null)return!0;var r=Ms.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Er.call(r)==js}var it=Ns;function Ds(){this.__data__=new ee,this.size=0}var Cr=Ds;function Ls(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var Or=Ls;function Gs(e){return this.__data__.get(e)}var Rr=Gs;function Bs(e){return this.__data__.has(e)}var Mr=Bs;var Us=200;function Vs(e,t){var r=this.__data__;if(r instanceof ee){var o=r.__data__;if(!te||o.length<Us-1)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new Sr(o)}return r.set(e,t),this.size=r.size,this}var jr=Vs;function Ae(e){var t=this.__data__=new ee(e);this.size=t.size}Ae.prototype.clear=Cr;Ae.prototype.delete=Or;Ae.prototype.get=Rr;Ae.prototype.has=Mr;Ae.prototype.set=jr;var Nr=Ae;var Br=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Dr=Br&&typeof module=="object"&&module&&!module.nodeType&&module,Ws=Dr&&Dr.exports===Br,Lr=Ws?I.Buffer:void 0,Gr=Lr?Lr.allocUnsafe:void 0;function Fs(e,t){if(t)return e.slice();var r=e.length,o=Gr?Gr(r):new e.constructor(r);return e.copy(o),o}var Ur=Fs;var Ks=D(I,"DataView"),$e=Ks;var $s=D(I,"Promise"),ze=$s;var zs=D(I,"Set"),qe=zs;var Vr="[object Map]",qs="[object Object]",Wr="[object Promise]",Fr="[object Set]",Kr="[object WeakMap]",$r="[object DataView]",Hs=q($e),Qs=q(te),Xs=q(ze),Ys=q(qe),Js=q(Be),fe=G;($e&&fe(new $e(new ArrayBuffer(1)))!=$r||te&&fe(new te)!=Vr||ze&&fe(ze.resolve())!=Wr||qe&&fe(new qe)!=Fr||Be&&fe(new Be)!=Kr)&&(fe=function(e){var t=G(e),r=t==qs?e.constructor:void 0,o=r?q(r):"";if(o)switch(o){case Hs:return $r;case Qs:return Vr;case Xs:return Wr;case Ys:return Fr;case Js:return Kr}return t});var zr=fe;var Zs=I.Uint8Array,ft=Zs;function ei(e){var t=new e.constructor(e.byteLength);return new ft(t).set(new ft(e)),t}var qr=ei;function ti(e,t){var r=t?qr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Hr=ti;function ri(e){return typeof e.constructor=="function"&&!J(e)?Lt(Ke(e)):{}}var Qr=ri;function oi(e){return function(t,r,o){for(var n=-1,f=Object(t),u=o(t),a=u.length;a--;){var c=u[e?a:++n];if(r(f[c],c,f)===!1)break}return t}}var Xr=oi;var ni=Xr(),Yr=ni;var ai=function(){return I.Date.now()},He=ai;var si="Expected a function",ii=Math.max,fi=Math.min;function pi(e,t,r){var o,n,f,u,a,c,T=0,A=!1,g=!1,w=!0;if(typeof e!="function")throw new TypeError(si);t=rt(t)||0,O(r)&&(A=!!r.leading,g="maxWait"in r,f=g?ii(rt(r.maxWait)||0,t):f,w="trailing"in r?!!r.trailing:w);function m(l){var x=o,_=n;return o=n=void 0,T=l,u=e.apply(_,x),u}function h(l){return T=l,a=setTimeout(y,t),A?m(l):u}function S(l){var x=l-c,_=l-T,C=t-x;return g?fi(C,f-_):C}function p(l){var x=l-c,_=l-T;return c===void 0||x>=t||x<0||g&&_>=f}function y(){var l=He();if(p(l))return k(l);a=setTimeout(y,S(l))}function k(l){return a=void 0,w&&o?m(l):(o=n=void 0,u)}function E(){a!==void 0&&clearTimeout(a),T=0,o=c=n=a=void 0}function i(){return a===void 0?u:k(He())}function s(){var l=He(),x=p(l);if(o=arguments,n=this,c=l,x){if(a===void 0)return h(c);if(g)return clearTimeout(a),a=setTimeout(y,t),m(c)}return a===void 0&&(a=setTimeout(y,t)),u}return s.cancel=E,s.flush=i,s}var Se=pi;function li(e,t,r){(r!==void 0&&!X(e[t],r)||r===void 0&&!(t in e))&&de(e,t,r)}var Ee=li;function ui(e){return W(e)&&Y(e)}var Jr=ui;function mi(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ce=mi;function ci(e){return $t(e,Fe(e))}var Zr=ci;function di(e,t,r,o,n,f,u){var a=Ce(e,r),c=Ce(t,r),T=u.get(c);if(T){Ee(e,r,T);return}var A=f?f(a,c,r+"",e,t,u):void 0,g=A===void 0;if(g){var w=se(c),m=!w&&ge(c),h=!w&&!m&&xe(c);A=c,w||m||h?se(a)?A=a:Jr(a)?A=Bt(a):m?(g=!1,A=Ur(c,!0)):h?(g=!1,A=Hr(c,!0)):A=[]:it(c)||ie(c)?(A=a,ie(a)?A=Zr(a):(!O(a)||me(a))&&(A=Qr(c))):g=!1}g&&(u.set(c,A),n(A,c,o,f,u),u.delete(c)),Ee(e,r,A)}var eo=di;function to(e,t,r,o,n){e!==t&&Yr(t,function(f,u){if(n||(n=new Nr),O(f))eo(e,t,u,r,to,o,n);else{var a=o?o(Ce(e,u),f,u+"",e,t,n):void 0;a===void 0&&(a=f),Ee(e,u,a)}},Fe)}var ro=to;var gi=Xt(function(e,t,r,o){ro(e,t,r,o)}),pt=gi;var xi="[object Map]",hi="[object Set]",yi=Object.prototype,bi=yi.hasOwnProperty;function Ai(e){if(e==null)return!0;if(Y(e)&&(se(e)||typeof e=="string"||typeof e.splice=="function"||ge(e)||xe(e)||ie(e)))return!e.length;var t=zr(e);if(t==xi||t==hi)return!e.size;if(J(e))return!pr(e).length;for(var r in e)if(bi.call(e,r))return!1;return!0}var lt=Ai;var wi=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),bc=new Map(wi);var io=ae(Q());var L=ae(Q());function K(e){return L.default.storage.local.get(e)}async function B(e){return L.default.storage.local.set(e)}async function Qe(e){let t=await L.default.storage.local.get(e);return typeof e=="string"?t[e]:t}async function oo(e,t){return new Promise((r,o)=>{Qe(e).then(n=>{if(typeof n<"u"){r(n);return}function f(u){u[e]&&typeof u[e].newValue<"u"&&(L.default.storage.local.onChanged.removeListener(f),r(u[e].newValue))}L.default.storage.local.onChanged.addListener(f),t&&setTimeout(()=>{L.default.storage.local.onChanged.removeListener(f),o()},t)})})}async function Oe(e){return L.default.storage.local.remove(e)}async function ut(e){if(L.default?.cookies){let t=await L.default.cookies.get(e);return t?.value?decodeURIComponent(t.value):""}return L.default.runtime.sendMessage({type:"GET_COOKIE",data:e})}async function no(e){return L.default?.cookies?await L.default.cookies.set(e):L.default.runtime.sendMessage({type:"SET_COOKIE",data:e})}function ao(e){return ut({name:e,url:$.origin})}var mt=io.default.runtime.getManifest(),_i=mt.version_name===mt.version+"-e";var fo=`ChitChat_${_i?"Edge":"Chrome"}_Ext`,ct=mt.version;var vi={dev:"https://dev.wisehood.ai",test:"https://dev.wisehood.ai",preview:"https://preview.sider.ai",prod:"https://sider.ai"},Pi={dev:"wisehood.ai",test:"wisehood.ai",preview:"sider.ai",prod:"sider.ai"},so=vi["prod"],$={origin:so,api:`${so}/api`,domain:Pi["prod"]},po="https://www.google-analytics.com/mp/collect",lo="G-0PRFKME4HP";var uo="6FX_tIISST2SsnSx29yQRg";var Re=(d=>(d.English="en",d["Chinese(Simplified)"]="zh_CN",d["Chinese(Traditional)"]="zh_TW",d.Spanish="es",d.French="fr",d.Japanese="ja",d.German="de",d.Portuguese="pt",d.Arabic="ar",d.Russian="ru",d.Italian="it",d.Korean="ko",d.Hindi="hi",d.Dutch="nl",d.Polish="pl",d.Amharic="am",d.Bulgarian="bg",d.Bengali="bn",d.Catalan="ca",d.Czech="cs",d.Danish="da",d.Greek="el",d.Estonian="et",d.Persian="fa",d.Finnish="fi",d.Filipino="fil",d.Gujarati="gu",d.Hebrew="he",d.Croatian="hr",d.Hungarian="hu",d.Indonesian="id",d.Kannada="kn",d.Lithuanian="lt",d.Latvian="lv",d.Malayalam="ml",d.Marathi="mr",d.Malay="ms",d.Norwegian="no",d.Romanian="ro",d.Slovak="sk",d.Slovenian="sl",d.Serbian="sr",d.Swedish="sv",d.Swahili="sw",d.Tamil="ta",d.Telugu="te",d.Thai="th",d.Turkish="tr",d.Ukrainian="uk",d.Urdu="ur",d.Vietnamese="vi",d))(Re||{}),Ii={en:"English",zh_CN:"\u4E2D\u6587(\u7B80\u4F53)",zh_TW:"\u4E2D\u6587(\u7E41\u9AD4)",es:"Espa\xF1ol",fr:"Fran\xE7ais",ja:"\u65E5\u672C\u8A9E",de:"Deutsch",pt:"Portugu\xEAs",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",it:"Italiano",ko:"\uD55C\uAD6D\uC5B4",hi:"\u0939\u093F\u0928\u094D\u0926\u0940",nl:"Nederlands",pl:"Polski",am:"\u12A0\u121B\u122D\u129B",bg:"\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438",bn:"\u09AC\u09BE\u0982\u09B2\u09BE",ca:"Catal\xE0",cs:"\u010Ce\u0161tina",da:"Dansk",el:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",et:"Eesti",fa:"\u0641\u0627\u0631\u0633\u06CC",fi:"Suomi",fil:"Filipino",gu:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0",he:"\u05E2\u05D1\u05E8\u05D9\u05EA",hr:"Hrvatski",hu:"Magyar",id:"Indonesia",kn:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",lt:"Lietuvi\u0173",lv:"Latvie\u0161u",ml:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02",mr:"\u092E\u0930\u093E\u0920\u0940",ms:"Bahasa Melayu",no:"Norsk",ro:"Rom\xE2n\u0103",sk:"Sloven\u010Dina",sl:"Sloven\u0161\u010Dina",sr:"\u0421\u0440\u043F\u0441\u043A\u0438",sv:"Svenska",sw:"Kiswahili",ta:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD",te:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",th:"\u0E44\u0E17\u0E22",tr:"T\xFCrk\xE7e",uk:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",ur:"\u0627\u0631\u062F\u0648",vi:"Ti\u1EBFng Vi\u1EC7t"},Cc=Object.entries(Re).reduce((e,[t,r])=>(e[r]=t,e),{}),Oc=Object.entries(Re).map(([e,t])=>({label:e,value:t})),Rc=Object.entries(Ii).map(([e,t])=>({label:t,value:e}));async function mo(){let e="provider:gpt3",[t="siderApi",r]=await Promise.all([Qe("provider"),Qe(e)]);return{provider:t,configs:{gpt3:r}}}var Mc={login:`${$.origin}/login`,openaiChat:"https://chat.openai.com",openaiLogin:"https://platform.openai.com/login",openaiSignup:"https://platform.openai.com/signup",openaiApiKey:"https://platform.openai.com/account/api-keys",openaiApiSession:"https://chat.openai.com/api/auth/session",edgeStore:"https://microsoftedge.microsoft.com/addons/detail/sider-ai-sidebar/dhoenijjpgpeimemopealfcbiecgceod",chromeStoreReview:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb/reviews",chromeStore:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb",weChatQrCode:"https://sider.ai/resource/weixin/qrcode.jpeg",producthuntPromoteApi:"https://sider.ai/resource/promotion/extension-promote.json"};var jc=1024*1024*10;var wt=ae(Q());function co(e){let t,r,o,n,f,u,a;return c(),{feed:T,reset:c};function c(){t=!0,r="",o=0,n=-1,f=void 0,u=void 0,a=""}function T(g){r=r?r+g:g,t&&ki(r)&&(r=r.slice(go.length)),t=!1;let w=r.length,m=0,h=!1;for(;m<w;){h&&(r[m]===`
`&&++m,h=!1);let S=-1,p=n,y;for(let k=o;S<0&&k<w;++k)y=r[k],y===":"&&p<0?p=k-m:y==="\r"?(h=!0,S=k-m):y===`
`&&(S=k-m);if(S<0){o=w-m,n=p;break}else o=0,n=-1;A(r,m,p,S),m+=S+1}m===w?r="":m>0&&(r=r.slice(m))}function A(g,w,m,h){if(h===0){a.length>0&&(e({type:"event",id:f,event:u||void 0,data:a.slice(0,-1)}),a="",f=void 0),u=void 0;return}let S=m<0,p=g.slice(w,w+(S?h:m)),y=0;S?y=h:g[w+m+1]===" "?y=m+2:y=m+1;let k=w+y,E=h-y,i=g.slice(k,k+E).toString();if(p==="data")a+=i?"".concat(i,`
`):`
`;else if(p==="event")u=i;else if(p==="id"&&!i.includes("\0"))f=i;else if(p==="retry"){let s=parseInt(i,10);Number.isNaN(s)||e({type:"reconnect-interval",value:s})}}}var go=[239,187,191];function ki(e){return go.every((t,r)=>e.charCodeAt(r)===t)}var Xe,Si=new Uint8Array(16);function dt(){if(!Xe&&(Xe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xe(Si)}var M=[];for(let e=0;e<256;++e)M.push((e+256).toString(16).slice(1));function xo(e,t=0){return(M[e[t+0]]+M[e[t+1]]+M[e[t+2]]+M[e[t+3]]+"-"+M[e[t+4]]+M[e[t+5]]+"-"+M[e[t+6]]+M[e[t+7]]+"-"+M[e[t+8]]+M[e[t+9]]+"-"+M[e[t+10]]+M[e[t+11]]+M[e[t+12]]+M[e[t+13]]+M[e[t+14]]+M[e[t+15]]).toLowerCase()}var Ei=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gt={randomUUID:Ei};function Ci(e,t,r){if(gt.randomUUID&&!t&&!e)return gt.randomUUID();e=e||{};let o=e.random||(e.rng||dt)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){r=r||0;for(let n=0;n<16;++n)t[r+n]=o[n];return t}return xo(o)}var Me=Ci;var bt=ae(Q());async function*ho(e){let t=e.getReader();try{for(;;){let{done:r,value:o}=await t.read();if(r)return;yield o}}finally{t.releaseLock()}}var Oi=ae(Q());function xt(e){return[...new Set(e)]}var yo=(...e)=>e.join("/").replace(/([^:])\/{2,}/g,"$1/");function bo(e=1e3){return new Promise(t=>setTimeout(t,e))}async function we(e,t=1e3,r=2){let o=0;for(;;){try{return await e()}catch(n){if(r>=0&&o++>=r)throw n}await bo(t)}}function Ye(e,t=0){let r=!1,o;return function(...n){return r||(r=!0,o=new Promise((f,u)=>{e(...n).then(f).catch(u).finally(async()=>{t&&await bo(t),r=!1})})),o}}var Ao=ae(Q());async function oe(){let{generatedRandomId:e}=await K({generatedRandomId:""});if(!e){let t=await Ri();return t||(t=Me(),Mi(t)),Ao.default.storage.local.set({generatedRandomId:t}),t}return e}var wo=$.origin.replace(/\/\/\w+?\./,"//Y2hhdGdwdC1zaWRlYmFy."),To="zgv2awnlswq";async function Ri(){try{return await ut({url:wo,name:To})}catch{return""}}async function Mi(e){let t=Math.round(Date.now()/1e3)+31104e3;try{return await no({url:wo,name:To,value:e,expirationDate:t,secure:!0})}catch{}}var ht={609:"error_sider_premium_required",610:"error_sider_high_traffic",1003:"error_sider_need_login",1006:"error_sider_device_bind_account",1101:"error_sider_processing",1102:"error_sider_api_limit",1107:"error_sider_api_limit2",1109:"error_sider_gpt4_highload",1110:"error_sider_gpt_highload",1112:"error_sider_gpt4_limit",1113:"error_sider_gpt4_limit",1118:"error_sider_image_limit",1121:"error_sider_summary_video_limit",1127:"error_sider_ocr_limit",1515:"error_sider_bard_busy",1129:"error_sider_basic_text_limit",1130:"error_sider_advanced_text_limit",1132:"error_sider_openai_filter"};function yt(e,t){switch(e){case 1102:case 1107:case 1112:case 1113:case 1118:case 1121:case 1127:Te.getVipInfoCached();break;default:break}if(e===1129||e===1130){let r=t.match(/restriction of (.*) messages/),o=t.match(/messages every (.*) minute[s]?\. Alternatively/);throw new Error(ht[e]+"-"+r[1]+"-"+o[1])}throw e in ht?new Error(ht[e]):typeof t=="string"&&t.startsWith("504")?new Error("error_sider_timeout"):new Error(t)}var j=fo,F=ct,_e=Intl.DateTimeFormat().resolvedOptions().timeZone,Te={async refreshToken(e){let t=await P("/v1/user/token/refresh",{refresh_token:e},{headers:{Authorization:""}});return{token:t.token.token,refreshToken:t.token.refresh_token}},getSiderAnonymousToken:Ye(async()=>{let e=await oe();return P("/v1/user/login/device_id",{device_id:e,uuid:e,app_name:j,app_version:F},{headers:{Authorization:""}})}),getUserInfo:async()=>{let e=await U(`/v1/user/info?app_name=${j}&app_version=${F}`);return await B({userInfo:e}),e},getVipInfo:_o,getVipInfoCached:Ye(_o,5e3),async getPricingPlan(){let e=await U("/v1/app/ipinfo",null,{headers:{Authorization:""}}),t=e.region==="CN"||_e==="Asia/Shanghai"&&(await K({language:"en"})).language==="zh_CN",r=await U(`/v1/payment/pricing?from=web&location=${t?"CN":e.region}`,null,{headers:{Authorization:""}});B({isCNUser:t,pricingPlan:r.plan.map(o=>({currency:o.currency,interval:o.interval,originPrice:o.origin_price/100,price:o.price/100}))})},getUserSettings:Ye(async()=>{let e=await U(`/v1/user/settings?app_name=${j}&keys=ChitChat_Ext`),t=e.client_setting,r=e.keys?.ChitChat_Ext;if(t&&(!r||Object.keys(t).some(o=>!(o in r)))){let o={...t,...r||{}};return await Te.setUserSettings(o),o}return r},2e3),setUserSettings(e){return we(()=>P("/v1/user/settings",{app_name:j,key:"ChitChat_Ext",key_setting:e}))},getUserPromptList(e){return U(`/v1/prompt/list?type=${e}&page_size=999`)},getAllPromptList:Se(async()=>{let e=await K({language:"",chatVisiblePromptKeys:null,readVisiblePromptKeys:null,writeVisiblePromptKeys:null,sidebarPromptTemplate:null}),t=e.language;if(!t)return;let r={};try{r=await Te.getUserSettings()}catch{}let[o,n]=await Promise.all([U(`/v1/prompt/list_all?app_name=${j}&page_size=999&language=${t}`,null,{headers:{Authorization:(await je())?.token||""}}),U(`/v1/prompt/list?type=special&app_name=${j}&page_size=999&language=${t}`,null,{headers:{Authorization:(await je())?.token||""}})]),f=o.List;f.sort((p,y)=>(p.sort!==0||p.key==="improve_writing")&&(y.sort!==0||y.key==="improve_writing")?y.sort-p.sort:y.sort===0?1:p.sort===0?-1:0);let u=f.reduce((p,y)=>(p[y.key||y.id]=y,p),{});function a(p){return{id:String(p.id),key:String(p.key||p.id),isCustom:!p.key||p.key.startsWith("custom"),name:p.display_name||p.name,shortName:p.short_name,content:p.content,icon:p.icon,placeholder:p.placeholder,usedIn:p.use||void 0,children:p.has_child?[]:void 0,parentKey:p.parent_key}}let c=[],T={};for(let p of f){let{key:y,has_child:k,parent_key:E}=p;if(k){if(!(y in T)){let s=a(p);T[y]=s,c.push(s)}continue}if(E){let s=u[E];if(!s)continue;if(!(E in T)){let l=a(s);T[E]=l,c.push(l)}T[E]?.children?.push(a(p));continue}let i=a(p);c.push(i)}if(e.sidebarPromptTemplate)for(let p of e.sidebarPromptTemplate)!p.uid&&p.key?.startsWith("custom")&&c.unshift({id:"",key:p.key,isCustom:!0,name:p.title,content:p.template});function A(p,y=!1){let k=[];for(let E of c){let{usedIn:i}=E;(!i||i.includes(p))&&(!y||E.isCustom)&&k.push(E.key)}return k}let g=new Set(c.map(({key:p})=>p)),w=o.Sort,m={chat:["chatVisiblePromptKeys","ChatAsk"],read:["readVisiblePromptKeys","ReadingAssistant"],write:["writeVisiblePromptKeys","WritingAssistant"]},h={};for(let[p,[y,k]]of Object.entries(m)){let E=e[y];E?h[y]=xt([...E.filter(s=>g.has(s)),...A(p)]):h[y]=xt([...A(p,!0),...w[k].split(",").map(s=>s.trim()),...A(p)]);let i=r?.[y];if(i?.length){let s=i.reduce((l,x,_)=>(l[x]=_,l),{});h[y].sort((l,x)=>{let _=s[l],C=s[x],N=typeof _>"u",b=typeof C>"u";return N&&b?0:N?1:b?-1:_-C})}}let S=n.List.map(p=>a(p));await B({...h,allPromptList:c,specialPromptList:S,__DONT_SYNC__:`visiblePromptKeys${Date.now()}`})},1e3),createPrompt(e){return we(()=>P("/v1/prompt/create",{is_template:!1,type:"sidebar",...e}))},createUserPrompt(e){return we(()=>P("/v1/prompt/create",{is_template:!1,...e}))},editUserPrompt(e){return we(()=>P("/v1/prompt/edit",e))},delUserPrompt(e){return we(()=>P("/v1/prompt/update",{id:e,status:"Deleted"}))},async uploadHistoryMsg(e){return(await P("/v1/conversation/upload",{app_name:j,app_version:F,messages:e})).cid},uploadConversion(e){return P("/v1/conversation/upload",{share:!0,app_name:j,app_version:F,messages:e})},saveConversion(e){return P("/v1/conversation/upload",{save_by_user:!0,app_name:j,app_version:F,messages:e})},async shareConversion(e){return(await U(`/v1/conversation/share/${e}`)).share_key},saveSiderConversion(e){return U(`/v1/conversation/save-by-user/${e}`)},unSaveSiderConversion(e){return U(`/v1/conversation/unsave-by-user/${e}`)},delConversion(e){return ji(`/v1/conversation/delete/${e}`)},checkGrammarError(e){return P("/v1/completion/grammar_check",{content:e,tz_name:_e,app_name:j,app_version:F})},async improveWriting(e){function t(o){if(o?.total){let n={[e.model]:{total:o.total,remain:o.remain,extraTotal:o.extra_total,extraRemain:o.extra_quota,period:o.remain_period}};pe(n)}}let r=Se(t,1e3,{leading:!0});return P("/v1/completion/improve_writing",{content:e.content,model:e.model==="gpt-4"?e.model:"gpt3.5",tz_name:_e,app_name:j,app_version:F},{onStreamData({data:o,done:n}){!n&&o&&r(o),e.onStreamData({text:o?.text||"",done:n})},getAbortMethod(o){}})},async sendFeedback({title:e,detail:t,email:r}){let o=await je();return P("/v1/app/feedback",{title:e,email:r,data:{detail:t},app_name:j,app_version:F},{headers:{Authorization:o?.token||""}})},async getInviteRewardConfig(){let e=await U("/v1/invite/config",null,{headers:{Authorization:""}});return B({inviteRewardConfig:{"gpt3.5":e.GPT3Dot5Count,gpt4:e.GPT4Count}}),e},createInviteLink(){return P("/v1/invite/create",{type:"link"})},async getInviteRewardCount(){let e=await U("/v1/invite/reward");return B({inviteRewardCount:{"gpt3.5":e.reward_gpt3dot5_count,gpt4:e.reward_gpt4_count}}),e},inviteFinish:async()=>{let e=await oe();return P("/v1/invite/finish",{device_id:e})},async summaryVideo(e){function t(m){if(m?.total)if(e.vip){let h={"gpt-3.5":{total:m.total,remain:m.remain,extraTotal:m.extra_total,extraRemain:m.extra_quota,period:m.remain_period}};pe(h)}else{let h={summary:{remain:m.remain}};pe(h)}}let r=Se(t,1e3,{leading:!0}),o={app_name:j,app_version:F,tz_name:_e,content:e.text,title:e.title,language:e.lang,source:e.source,source_type:e.sourceType,request_id:Me(),cid:""},n=[];e.getAbortMethod(()=>{for(let m of n)m()});let{content:f,cid:u,...a}=o,c=null;try{c=await P("/v1/completion/summarize_init",a,{getAbortMethod(m){n.push(m)}})}catch{}c&&(o.cid=c.cid||"");let T=P("/v1/completion/summarize_all",o,{onStreamData({data:m,done:h}){!h&&m&&r(m),e.onStreamData({text:m?.text||"",done:h})},getAbortMethod(m){n.push(m)}}),A=P("/v1/completion/summarize",o,{getAbortMethod(m){n.push(m)}}),[g,w]=await Promise.all([T,A]);return t(w),{text:w.text,subtitle:w.subtitle}},statUserStop(e,t){return P("/v1/completion/mark-user-stop",{app_name:j,app_version:F,cid:e,mid:t})},async OCR(e,t){let r=new FormData;r.append("file",e),r.append("app_name",j),r.append("app_version",F),r.append("tz_name",_e);let o=await P("/v1/ocr/math",r,{getAbortMethod:t});if(o?.limit){let f={"image-creator":{total:o.limit.total,remain:o.limit.remain,extraTotal:o.limit.extra_total,extraRemain:o.limit.extra_quota,period:o.limit.remain_period}};pe(f)}return o?.result?.text||""},adStat(e){return P("/v1/lp/action",e,{headers:{Authorization:""}})},async googleAnalytics(e,t){return bt.default.tabs?P(`${po}?measurement_id=${lo}&api_secret=${uo}`,{client_id:await oe(),events:[{name:e.replace(/-/gi,"_"),params:{...t}}]},{headers:{Authorization:""}}):bt.default.runtime.sendMessage({type:"GA_API",args:[e,t]})},uploadImage(e){let t=new FormData;return t.append("file",e),P("/v1/imagechat/upload",t)},signImageCookie(){return P("/v1/image/sign-cookie")}};async function _o(){let e;try{e=await U(`/v1/completion/limit?app_name=${j}&app_version=${F}&tz_name=${_e}`)}catch(u){throw pe({isVIP:!1}),u}if(!e.chat.count)throw B({ERR_MUST_LOGIN:!0}),new Error("wrong_data");let t=e.user_type,r=["device","login","premium"],o=e.chat_period_info,n=e.gpt_4_chat_period_info,f={isVIP:e.user_type==="premium",userTypeDetail:e.user_type_detail,resetTimeSec:e.chat.reset_time,showNewPlan:!!e.show_new_plan,"gpt-3.5":{total:e.chat.count,remain:e.chat.remain,extraTotal:e.chat.extra_total,extraRemain:e.chat.extra_quota,period:e.chat.period,maxToken:o[t]?.prompt_max_token,award:r.reduce((u,a)=>(u[a]={count:o[a].count},u),{})},"gpt-4":{total:e.gpt_4_chat.count,remain:e.gpt_4_chat.remain,extraTotal:e.gpt_4_chat.extra_total,extraRemain:e.gpt_4_chat.extra_quota,period:e.gpt_4_chat.period,maxToken:n[t]?.prompt_max_token,award:r.reduce((u,a)=>(u[a]={count:n[a].count},u),{})},summary:{total:e.summarize.count,remain:e.summarize.remain,cost:e.summarize.deduct_count,period:e.summarize.period},ocr:{cost:e.ocr_period_info.deduct_count},"image-creator":{total:e.image.count,remain:e.image.remain,extraTotal:e.image.extra_total,extraRemain:e.image.extra_quota,period:e.image.period}};return pe(f),f}async function At(e,t=null,r={}){e.startsWith("http")||(e=yo($.api,e));let{onStreamData:o,getAbortMethod:n,noAuth:f,timeout:u,...a}=r;a.method&&(a.method=a.method.toUpperCase());let c=new AbortController;if(a.signal=c.signal,n?.(()=>{c.abort()}),a.headers=new Headers(a.headers||{}),!f&&!a.headers.has("Authorization")){let w=(await Ne()).token;w&&(a.headers.set("Authorization",w),Oe("ERR_MUST_LOGIN"))}if(t)try{t instanceof FormData||t instanceof Blob||t instanceof URLSearchParams||t instanceof ReadableStream||t instanceof ArrayBuffer||t instanceof DataView?a.body=t:(a.body=JSON.stringify(t),a.headers.set("Content-Type","application/json"))}catch{a.body=t}let T;u&&(T=setTimeout(()=>c.abort(),u));let A=await fetch(e,a);u&&clearTimeout(T);let g=null;if(o||(g=await A.json().catch(()=>({}))),!A.ok||g&&g.code!==0){if(g||(g=await A.json().catch(()=>({}))),g.errMsg=g.msg||g.message,lt(g))g.errMsg=`${A.status} ${A.statusText}`;else{(g.code===1003||g.code===1006)&&B({ERR_MUST_LOGIN:!0});try{yt(g.code,g.msg||g.message)}catch(w){g.errMsg=w.message}}throw o&&o({data:null,done:!0}),g}if(o&&A.body){let w=co(m=>{if(m.type==="event"){let h={code:0,data:null,msg:"",errMsg:"",done:m.data==="[DONE]"},S=null;try{S=JSON.parse(m.data)}catch{}if(S&&(h={...h,...S}),h.code!==0){try{yt(h.code,h.msg)}catch(p){h.errMsg=p.message}throw o({data:null,done:!0}),h}o({data:h.data,done:h.done})}});for await(let m of ho(A.body)){let h=new TextDecoder().decode(m);w.feed(h)}}return g?.data}function U(e,t=null,r={}){return At(e,t,{method:"GET",...r})}function P(e,t=null,r={}){return At(e,t,{method:"POST",...r})}function ji(e,t=null,r={}){return At(e,t,{method:"DELETE",...r})}async function Ni(){let e=await Je("userinfo-type"),t=await Je("token");if(e===null)return null;let r=!!(t&&e&&e!=="device");return B({logged:r}),r}async function Di(){let{vipInfo:e}=await K({vipInfo:{isVIP:!1,userTypeDetail:"login",resetTimeSec:0,"gpt-3.5":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},"gpt-4":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},"image-creator":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},summary:{total:0,remain:0,cost:3,period:"total"},ocr:{cost:1}}});return e}async function pe(e){let t=await Di();return pt(t,e,(r,o)=>{if(Array.isArray(r))return o}),B({vipInfo:t})}async function Ne(){let e=await je();return e?{...e,anonymous:!1}:(e=await Li(),{...e,anonymous:!0})}async function je(){if(await Ni()){let e=await Je("token"),t=await Je("refresh_token");return e?{token:e,refreshToken:t}:null}return null}async function Li(){let e=await vo();if(e)return e;let{__getSiderAnonymousToken__:t}=await K({__getSiderAnonymousToken__:!1});if(t)await oo("siderApiToken"),e=await vo();else{B({__getSiderAnonymousToken__:!0});try{let r=await Te.getSiderAnonymousToken();e={token:r.token.token,refreshToken:r.token.refresh_token}}catch(r){throw Oe("__getSiderAnonymousToken__"),r}Oe("__getSiderAnonymousToken__"),Gi(e)}return e}async function Gi(e){return wt.default.storage.local.set({siderApiToken:e.token,siderApiRefreshToken:e.refreshToken})}async function vo(){let{siderApiToken:e,siderApiRefreshToken:t}=await wt.default.storage.local.get(["siderApiToken","siderApiRefreshToken"]);return e?{token:e,refreshToken:t}:null}async function Je(e){try{let t=await ao(e);if(!t)throw new Error("");return B({[e]:t}),t}catch{return(await K({[e]:""}))[e]}}var ne={};function Ze(e){let t=new CustomEvent("web-response",{detail:e});window.dispatchEvent(t)}Ze({type:"loaded"});window.addEventListener("web-request",async e=>{if(location.origin!==$.origin&&!(location.protocol=="chrome-extension:"||location.hostname==="localhost"))return;let t=e.detail,r;switch(t.type){case"chat":{let o=ve.default.runtime.connect();ne[t.data.originId]=o;let n=f=>{Ze(f),f.type=="chat-answer-end"&&(o.disconnect(),delete ne[f.data.originId])};o.onMessage.addListener(n),o.postMessage({type:"chat",data:t.data});return}case"chat-abort":{try{ne[t.data].disconnect(),delete ne[t.data],r={success:!0}}catch(o){r={success:!1,error:o.toString()}}break}}switch(t.type){case"chat":{let o=ve.default.runtime.connect();ne[t.data.originId]=o;let n=f=>{Ze(f),f.type=="chat-answer-end"&&(o.disconnect(),delete ne[f.data.originId])};o.onMessage.addListener(n),o.postMessage({type:"chat",data:t.data});return}case"chat-abort":{try{ne[t.data].disconnect(),delete ne[t.data],r={success:!0}}catch(o){r={success:!1,error:o.toString()}}break}}switch(t.type){case"get-token":{let o=await Ne();r={token:o.token,refreshToken:o.refreshToken};break}case"get-device_id":{r=await oe();break}case"get-userinfo":{let o=await Ne();r={token:o.token,refreshToken:o.refreshToken,clientId:await oe()};break}case"get-setting-lang":r=await K({language:"en"});break;case"pricing":{ve.default.runtime.sendMessage({type:"REFRESH_VIP_INFO"});break}case"open-options":{ve.default.runtime.sendMessage({type:"OPEN_OPTIONS_PAGE"});break}case"chat-get-chatGPT-models":{r=await ve.default.runtime.sendMessage({type:"chat-get-chatGPT-models"});break}case"chat-get-provider-type":{r=await(await mo()).provider;break}}Ze({type:t.type,data:r})});})();
