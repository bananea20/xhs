"use strict";(()=>{var Hl=Object.create;var Gn=Object.defineProperty;var zl=Object.getOwnPropertyDescriptor;var Jl=Object.getOwnPropertyNames;var Ql=Object.getPrototypeOf,Yl=Object.prototype.hasOwnProperty;var v=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Xl=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Jl(e))!Yl.call(t,n)&&n!==r&&Gn(t,n,{get:()=>e[n],enumerable:!(o=zl(e,n))||o.enumerable});return t};var M=(t,e,r)=>(r=t!=null?Hl(Ql(t)):{},Xl(e||!t||!t.__esModule?Gn(r,"default",{value:t,enumerable:!0}):r,t));var j=v((so,_s)=>{(function(t,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof so<"u")e(_s);else{var r={exports:{}};e(r),t.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:so,function(t){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",r=o=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class a extends WeakMap{constructor(h,x=void 0){super(x),this.createItem=h}get(h){return this.has(h)||this.set(h,this.createItem(h)),super.get(h)}}let i=y=>y&&typeof y=="object"&&typeof y.then=="function",s=(y,h)=>(...x)=>{o.runtime.lastError?y.reject(new Error(o.runtime.lastError.message)):h.singleCallbackArg||x.length<=1&&h.singleCallbackArg!==!1?y.resolve(x[0]):y.resolve(x)},p=y=>y==1?"argument":"arguments",c=(y,h)=>function(A,...O){if(O.length<h.minArgs)throw new Error(`Expected at least ${h.minArgs} ${p(h.minArgs)} for ${y}(), got ${O.length}`);if(O.length>h.maxArgs)throw new Error(`Expected at most ${h.maxArgs} ${p(h.maxArgs)} for ${y}(), got ${O.length}`);return new Promise(($,X)=>{if(h.fallbackToNoCallback)try{A[y](...O,s({resolve:$,reject:X},h))}catch{A[y](...O),h.fallbackToNoCallback=!1,h.noCallback=!0,$()}else h.noCallback?(A[y](...O),$()):A[y](...O,s({resolve:$,reject:X},h))})},f=(y,h,x)=>new Proxy(h,{apply(A,O,$){return x.call(O,y,...$)}}),l=Function.call.bind(Object.prototype.hasOwnProperty),m=(y,h={},x={})=>{let A=Object.create(null),O={has(X,S){return S in y||S in A},get(X,S,le){if(S in A)return A[S];if(!(S in y))return;let V=y[S];if(typeof V=="function")if(typeof h[S]=="function")V=f(y,y[S],h[S]);else if(l(x,S)){let et=c(S,x[S]);V=f(y,y[S],et)}else V=V.bind(y);else if(typeof V=="object"&&V!==null&&(l(h,S)||l(x,S)))V=m(V,h[S],x[S]);else if(l(x,"*"))V=m(V,h[S],x["*"]);else return Object.defineProperty(A,S,{configurable:!0,enumerable:!0,get(){return y[S]},set(et){y[S]=et}}),V;return A[S]=V,V},set(X,S,le,V){return S in A?A[S]=le:y[S]=le,!0},defineProperty(X,S,le){return Reflect.defineProperty(A,S,le)},deleteProperty(X,S){return Reflect.deleteProperty(A,S)}},$=Object.create(y);return new Proxy($,O)},u=y=>({addListener(h,x,...A){h.addListener(y.get(x),...A)},hasListener(h,x){return h.hasListener(y.get(x))},removeListener(h,x){h.removeListener(y.get(x))}}),g=new a(y=>typeof y!="function"?y:function(x){let A=m(x,{},{getContent:{minArgs:0,maxArgs:0}});y(A)}),_=new a(y=>typeof y!="function"?y:function(x,A,O){let $=!1,X,S=new Promise(It=>{X=function(ye){$=!0,It(ye)}}),le;try{le=y(x,A,X)}catch(It){le=Promise.reject(It)}let V=le!==!0&&i(le);if(le!==!0&&!V&&!$)return!1;let et=It=>{It.then(ye=>{O(ye)},ye=>{let Zr;ye&&(ye instanceof Error||typeof ye.message=="string")?Zr=ye.message:Zr="An unexpected error occurred",O({__mozWebExtensionPolyfillReject__:!0,message:Zr})}).catch(ye=>{})};return et(V?le:S),!0}),d=({reject:y,resolve:h},x)=>{o.runtime.lastError?o.runtime.lastError.message===e?h():y(new Error(o.runtime.lastError.message)):x&&x.__mozWebExtensionPolyfillReject__?y(new Error(x.message)):h(x)},b=(y,h,x,...A)=>{if(A.length<h.minArgs)throw new Error(`Expected at least ${h.minArgs} ${p(h.minArgs)} for ${y}(), got ${A.length}`);if(A.length>h.maxArgs)throw new Error(`Expected at most ${h.maxArgs} ${p(h.maxArgs)} for ${y}(), got ${A.length}`);return new Promise((O,$)=>{let X=d.bind(null,{resolve:O,reject:$});A.push(X),x.sendMessage(...A)})},k={devtools:{network:{onRequestFinished:u(g)}},runtime:{onMessage:u(_),onMessageExternal:u(_),sendMessage:b.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:b.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},I={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":I},services:{"*":I},websites:{"*":I}},m(o,k,n)};t.exports=r(chrome)}else t.exports=globalThis.browser})});var Ys=v((eI,Qs)=>{"use strict";Qs.exports=()=>{let t={};return t.promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t}});var Zs=v((tI,Xs)=>{"use strict";var Tg=Ys();function Ag(t,e="maxAge"){let r,o,n,a=async()=>{if(r!==void 0)return;let p=async c=>{n=Tg();let f=c[1][e]-Date.now();if(f<=0){t.delete(c[0]),n.resolve();return}return r=c[0],o=setTimeout(()=>{t.delete(c[0]),n&&n.resolve()},f),typeof o.unref=="function"&&o.unref(),n.promise};try{for(let c of t)await p(c)}catch{}r=void 0},i=()=>{r=void 0,o!==void 0&&(clearTimeout(o),o=void 0),n!==void 0&&(n.reject(void 0),n=void 0)},s=t.set.bind(t);return t.set=(p,c)=>{t.has(p)&&t.delete(p);let f=s(p,c);return r&&r===p&&i(),a(),f},a(),t}Xs.exports=Ag});var Ar=v((rI,ei)=>{"use strict";var Pg=Zs(),Co=class{constructor(e,r){if(this.maxAge=e,this[Symbol.toStringTag]="Map",this.data=new Map,Pg(this.data),r)for(let[o,n]of r)this.set(o,n)}get size(){return this.data.size}clear(){this.data.clear()}delete(e){return this.data.delete(e)}has(e){return this.data.has(e)}get(e){let r=this.data.get(e);if(r)return r.data}set(e,r){return this.data.set(e,{maxAge:Date.now()+this.maxAge,data:r}),this}values(){return this.createIterator(e=>e[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(e=>[e[0],e[1].data])}forEach(e,r){for(let[o,n]of this.entries())e.apply(r,[n,o,this])}[Symbol.iterator](){return this.entries()}*createIterator(e){for(let r of this.data.entries())yield e(r)}};ei.exports=Co});var Ci=v(($I,ki)=>{"use strict";function Ii(t){return(Ii=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ai(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function qt(t,e,r){return e&&Ai(t.prototype,e),r&&Ai(t,r),t}function wh(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Si(t,e)}function Wo(t){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(t)}function Si(t,e){return(Si=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r})(t,e)}function vh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Th(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ah(t,e){return!e||typeof e!="object"&&typeof e!="function"?Th(t):e}function Ph(t){var e=vh();return function(){var r,o=Wo(t);if(e){var n=Wo(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return Ah(this,r)}}function Pi(t){return Ih(t)||Sh(t)||Eh(t)||kh()}function Ih(t){if(Array.isArray(t))return Vo(t)}function Sh(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function Eh(t,e){if(t){if(typeof t=="string")return Vo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vo(t,e):void 0}}function Vo(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function kh(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ko=function(){function t(e){Ft(this,t),this._listeners=[],this._mute=!1,this._accumulate=!1,this._accumulatedEvents=[],this._name=e||"",this._onListenerAdded=null,this._onFirstListenerAdded=null,this._onListenerRemoved=null,this._onLastListenerRemoved=null}return qt(t,[{key:"addListener",value:function(e,r){this._pushListener(e,r,!1)}},{key:"addOnceListener",value:function(e,r){this._pushListener(e,r,!0)}},{key:"removeListener",value:function(e,r){this._ensureListener(e);var o=this._indexOfListener(e,r);0<=o&&this._spliceListener(o)}},{key:"removeAllListeners",value:function(){for(;this.hasListeners();)this._spliceListener(0)}},{key:"hasListener",value:function(e,r){return this._ensureListener(e),0<=this._indexOfListener(e,r)}},{key:"hasListeners",value:function(){return 0<this._listeners.length}},{key:"dispatch",value:function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];this._invokeListeners({args:r,async:!1})}},{key:"dispatchAsync",value:function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];this._invokeListeners({args:r,async:!0})}},{key:"mute",value:function(e){var r=0<arguments.length&&e!==void 0?e:{};this._mute=!0,r.accumulate?this._accumulate=!0:(this._accumulate=!1,this._accumulatedEvents=[])}},{key:"unmute",value:function(){this._mute=!1,this._accumulate&&(this._dispatchAccumulated(),this._accumulate=!1)}},{key:"_invokeListeners",value:function(e){var r=this,o=0<arguments.length&&e!==void 0?e:{args:[],async:!1};this._mute?this._accumulate&&this._accumulatedEvents.push(o):this._listeners.slice().forEach(function(n){r._invokeListener(n,o),n.once&&r.removeListener(n.callback,n.context)})}},{key:"_invokeListener",value:function(e,r){var o,n,a=e.callback instanceof t;r.async?a?(o=e.callback).dispatchAsync.apply(o,Pi(r.args)):setTimeout(function(){return e.callback.apply(e.context,r.args)},0):a?(n=e.callback).dispatch.apply(n,Pi(r.args)):e.callback.apply(e.context,r.args)}},{key:"_ensureListener",value:function(e){if(!t.isValidListener(e))throw new Error("Channel "+this._name+": listener is not a function and not a Channel")}},{key:"_dispatchInnerAddEvents",value:function(){var e,r;this._onListenerAdded&&(e=this._onListenerAdded).dispatch.apply(e,arguments),this._onFirstListenerAdded&&this._listeners.length===1&&(r=this._onFirstListenerAdded).dispatch.apply(r,arguments)}},{key:"_dispatchInnerRemoveEvents",value:function(){var e,r;this._onListenerRemoved&&(e=this._onListenerRemoved).dispatch.apply(e,arguments),this._onLastListenerRemoved&&this._listeners.length===0&&(r=this._onLastListenerRemoved).dispatch.apply(r,arguments)}},{key:"_indexOfListener",value:function(e,r){for(var o=0;o<this._listeners.length;o++){var n=this._listeners[o],a=n.callback===e,i=e instanceof t,s=r===void 0&&n.context===void 0,p=r===n.context;if(a&&(i||s||p))return o}}},{key:"_dispatchAccumulated",value:function(){var e=this;this._accumulatedEvents.forEach(function(r){return e._invokeListeners(r)}),this._accumulatedEvents=[]}},{key:"_pushListener",value:function(e,r,o){this._ensureListener(e),this._checkForDuplicates(e,r),this._listeners.push({callback:e,context:r,once:o}),this._dispatchInnerAddEvents(e,r,o)}},{key:"_checkForDuplicates",value:function(e,r){if(this.hasListener(e,r))throw new Error("Channel "+this._name+": duplicating listeners")}},{key:"_spliceListener",value:function(e){var r=this._listeners[e],o=r.callback,n=r.context,a=r.once;this._listeners.splice(e,1),this._dispatchInnerRemoveEvents(o,n,a)}},{key:"onListenerAdded",get:function(){return this._onListenerAdded||(this._onListenerAdded=new t("".concat(this._name,":onListenerAdded"))),this._onListenerAdded}},{key:"onFirstListenerAdded",get:function(){return this._onFirstListenerAdded||(this._onFirstListenerAdded=new t("".concat(this._name,":onFirstListenerAdded"))),this._onFirstListenerAdded}},{key:"onListenerRemoved",get:function(){return this._onListenerRemoved||(this._onListenerRemoved=new t("".concat(this._name,":onListenerRemoved"))),this._onListenerRemoved}},{key:"onLastListenerRemoved",get:function(){return this._onLastListenerRemoved||(this._onLastListenerRemoved=new t("".concat(this._name,":onLastListenerRemoved"))),this._onLastListenerRemoved}}],[{key:"isValidListener",value:function(e){return typeof e=="function"||e instanceof t}}]),t}(),Ch=function(){function t(){Ft(this,t),this._channels=new Map}return qt(t,[{key:"addListener",value:function(e,r,o){this._getChannel(e).addListener(r,o)}},{key:"on",value:function(e,r,o){this.addListener(e,r,o)}},{key:"addOnceListener",value:function(e,r,o){this._getChannel(e).addOnceListener(r,o)}},{key:"once",value:function(e,r,o){this.addOnceListener(e,r,o)}},{key:"removeListener",value:function(e,r,o){this._getChannel(e).removeListener(r,o)}},{key:"off",value:function(e,r,o){this.removeListener(e,r,o)}},{key:"hasListener",value:function(e,r,o){return this._getChannel(e).hasListener(r,o)}},{key:"has",value:function(e,r,o){return this.hasListener(e,r,o)}},{key:"hasListeners",value:function(e){return this._getChannel(e).hasListeners()}},{key:"dispatch",value:function(e){for(var r,o=arguments.length,n=new Array(1<o?o-1:0),a=1;a<o;a++)n[a-1]=arguments[a];(r=this._getChannel(e)).dispatch.apply(r,n)}},{key:"emit",value:function(e){for(var r=arguments.length,o=new Array(1<r?r-1:0),n=1;n<r;n++)o[n-1]=arguments[n];this.dispatch.apply(this,[e].concat(o))}},{key:"_getChannel",value:function(e){return this._channels.has(e)||this._channels.set(e,new Ko(e)),this._channels.get(e)}}]),t}(),Rh=function(){function t(e){Ft(this,t),this._params=e,this._isOn=!1,this._assertParams()}return qt(t,[{key:"on",value:function(){if(!this._isOn){var e=this._params.channel,r=e.addListener||e.addEventListener||e.on;this._applyMethod(r),this._isOn=!0}}},{key:"off",value:function(){if(this._isOn){var e=this._params.channel,r=e.removeListener||e.removeEventListener||e.off;this._applyMethod(r),this._isOn=!1}}},{key:"_applyMethod",value:function(e){var r=this._params,o=r.channel,n=r.event,a=r.listener,i=n?[n,a]:[a];e.apply(o,i)}},{key:"_assertParams",value:function(){var e=this._params,r=e.channel,o=e.event,n=e.listener;if(!r||Ii(r)!=="object")throw new Error("Channel should be object");if(o&&typeof o!="string")throw new Error("Event should be string");if(!n||!Ko.isValidListener(n))throw new Error("Listener should be function or Channel")}}]),t}(),Ei=function(){function t(e){Ft(this,t),this._items=e.map(function(r){return new Rh(r)})}return qt(t,[{key:"on",value:function(){return this._items.forEach(function(e){return e.on()}),this}},{key:"off",value:function(){return this._items.forEach(function(e){return e.off()}),this}}]),t}(),Oh=function(){wh(e,Ei);var t=Ph(e);function e(r,o){var n;return Ft(this,e),(n=t.call(this,o))._overrideComponentCallback(r,"componentDidMount","on"),n._overrideComponentCallback(r,"componentWillUnmount","off"),n}return qt(e,[{key:"_overrideComponentCallback",value:function(r,o,n){var a=this,i=r[o];r[o]=function(){if(a[n](),typeof i=="function"){for(var s=arguments.length,p=new Array(s),c=0;c<s;c++)p[c]=arguments[c];return i.apply(r,p)}}}}]),e}(),kr=Ko;kr.EventEmitter=Ch,kr.Subscription=Ei,kr.ReactSubscription=Oh,ki.exports=kr});var Oi=v((WI,Ri)=>{Ri.exports={timeout:0,timeoutReason:"Promise rejected by PromiseController timeout {timeout} ms.",resetReason:"Promise rejected by PromiseController reset."}});var Mi=v(Cr=>{Cr.isPromise=function(t){return t&&typeof t.then=="function"};Cr.tryCall=function(t){return typeof t=="function"?t():t};Cr.createErrorType=function(t){function e(r){Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r}return e.prototype=new Error,e.prototype.name=t,e.prototype.constructor=e,e}});var Ho=v((KI,ji)=>{var Mh=Oi(),{isPromise:Li,createErrorType:Di,tryCall:Ni}=Mi(),$t=class t{constructor(e){this._options=Object.assign({},Mh,e),this._resolve=null,this._reject=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._promise=null,this._timer=null}get promise(){return this._promise}get value(){return this._value}get isPending(){return this._isPending}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isSettled(){return this._isFulfilled||this._isRejected}call(e){return this._isPending||(this.reset(),this._createPromise(),this._createTimer(),this._callFn(e)),this._promise}resolve(e){this._isPending&&(Li(e)?this._tryAttachToPromise(e):(this._settle(e),this._isFulfilled=!0,this._resolve(e)))}reject(e){this._isPending&&(this._settle(e),this._isRejected=!0,this._reject(e))}reset(){if(this._isPending){let e=Ni(this._options.resetReason),r=new t.ResetError(e);this.reject(r)}this._promise=null,this._isPending=!1,this._isFulfilled=!1,this._isRejected=!1,this._value=void 0,this._clearTimer()}configure(e){Object.assign(this._options,e)}_createPromise(){this._promise=new Promise((e,r)=>{this._isPending=!0,this._resolve=e,this._reject=r})}_handleTimeout(){let e=Ni(this._options.timeoutReason),r=typeof e=="string"?e.replace("{timeout}",this._options.timeout):"",o=new t.TimeoutError(r);this.reject(o)}_createTimer(){this._options.timeout&&(this._timer=setTimeout(()=>this._handleTimeout(),this._options.timeout))}_clearTimer(){this._timer&&(clearTimeout(this._timer),this._timer=null)}_settle(e){this._isPending=!1,this._value=e,this._clearTimer()}_callFn(e){if(typeof e=="function")try{let r=e();this._tryAttachToPromise(r)}catch(r){this.reject(r)}}_tryAttachToPromise(e){Li(e)&&e.then(r=>this.resolve(r),r=>this.reject(r))}};$t.TimeoutError=Di("TimeoutError");$t.ResetError=Di("ResetError");ji.exports=$t});var Ui=v(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.PromisedMap=void 0;var Lh=function(){function t(){this.map=new Map}return Object.defineProperty(t.prototype,"size",{get:function(){return this.map.size},enumerable:!1,configurable:!0}),t.prototype.set=function(e,r){var o=this.createMapItem(r);return this.map.set(e,o),o.promise},t.prototype.get=function(e){var r=this.map.get(e);return r&&r.data},t.prototype.has=function(e){return this.map.has(e)},t.prototype.delete=function(e){return this.map.delete(e)},t.prototype.resolve=function(e,r){var o=this.map.get(e);o&&(this.delete(e),o.resolve(r))},t.prototype.reject=function(e,r){var o=this.map.get(e);o&&(this.delete(e),o.reject(r))},t.prototype.resolveAll=function(e){this.map.forEach(function(r){return r.resolve(e)}),this.map.clear()},t.prototype.rejectAll=function(e){this.map.forEach(function(r){return r.reject(e)}),this.map.clear()},t.prototype.forEach=function(e){this.map.forEach(function(r,o,n){return e(r.data,o,n)})},t.prototype.clear=function(){return this.map.clear()},t.prototype.createMapItem=function(e){var r={data:e};return r.promise=new Promise(function(o,n){r.resolve=o,r.reject=n}),r},t}();Rr.PromisedMap=Lh});var Bi=v((zI,Gi)=>{"use strict";var Nh="Function.prototype.bind called on incompatible ",zo=Array.prototype.slice,Dh=Object.prototype.toString,jh="[object Function]";Gi.exports=function(e){var r=this;if(typeof r!="function"||Dh.call(r)!==jh)throw new TypeError(Nh+r);for(var o=zo.call(arguments,1),n,a=function(){if(this instanceof n){var f=r.apply(this,o.concat(zo.call(arguments)));return Object(f)===f?f:this}else return r.apply(e,o.concat(zo.call(arguments)))},i=Math.max(0,r.length-o.length),s=[],p=0;p<i;p++)s.push("$"+p);if(n=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(a),r.prototype){var c=function(){};c.prototype=r.prototype,n.prototype=new c,c.prototype=null}return n}});var Or=v((JI,Fi)=>{"use strict";var Uh=Bi();Fi.exports=Function.prototype.bind||Uh});var $i=v((QI,qi)=>{"use strict";qi.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),o=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(o)!=="[object Symbol]")return!1;var n=42;e[r]=n;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var i=Object.getOwnPropertyDescriptor(e,r);if(i.value!==n||i.enumerable!==!0)return!1}return!0}});var Ki=v((YI,Vi)=>{"use strict";var Wi=typeof Symbol<"u"&&Symbol,Gh=$i();Vi.exports=function(){return typeof Wi!="function"||typeof Symbol!="function"||typeof Wi("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Gh()}});var Ji=v((XI,zi)=>{"use strict";var Hi={foo:{}},Bh=Object;zi.exports=function(){return{__proto__:Hi}.foo===Hi.foo&&!({__proto__:null}instanceof Bh)}});var Be=v((ZI,Qi)=>{"use strict";var Fh=Or();Qi.exports=Fh.call(Function.call,Object.prototype.hasOwnProperty)});var pe=v((eS,tc)=>{"use strict";var E,vt=SyntaxError,ec=Function,wt=TypeError,Jo=function(t){try{return ec('"use strict"; return ('+t+").constructor;")()}catch{}},Ye=Object.getOwnPropertyDescriptor;if(Ye)try{Ye({},"")}catch{Ye=null}var Qo=function(){throw new wt},qh=Ye?function(){try{return arguments.callee,Qo}catch{try{return Ye(arguments,"callee").get}catch{return Qo}}}():Qo,xt=Ki()(),$h=Ji()(),K=Object.getPrototypeOf||($h?function(t){return t.__proto__}:null),_t={},Wh=typeof Uint8Array>"u"||!K?E:K(Uint8Array),Xe={"%AggregateError%":typeof AggregateError>"u"?E:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?E:ArrayBuffer,"%ArrayIteratorPrototype%":xt&&K?K([][Symbol.iterator]()):E,"%AsyncFromSyncIteratorPrototype%":E,"%AsyncFunction%":_t,"%AsyncGenerator%":_t,"%AsyncGeneratorFunction%":_t,"%AsyncIteratorPrototype%":_t,"%Atomics%":typeof Atomics>"u"?E:Atomics,"%BigInt%":typeof BigInt>"u"?E:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?E:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?E:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?E:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?E:Float32Array,"%Float64Array%":typeof Float64Array>"u"?E:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?E:FinalizationRegistry,"%Function%":ec,"%GeneratorFunction%":_t,"%Int8Array%":typeof Int8Array>"u"?E:Int8Array,"%Int16Array%":typeof Int16Array>"u"?E:Int16Array,"%Int32Array%":typeof Int32Array>"u"?E:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":xt&&K?K(K([][Symbol.iterator]())):E,"%JSON%":typeof JSON=="object"?JSON:E,"%Map%":typeof Map>"u"?E:Map,"%MapIteratorPrototype%":typeof Map>"u"||!xt||!K?E:K(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?E:Promise,"%Proxy%":typeof Proxy>"u"?E:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?E:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?E:Set,"%SetIteratorPrototype%":typeof Set>"u"||!xt||!K?E:K(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?E:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":xt&&K?K(""[Symbol.iterator]()):E,"%Symbol%":xt?Symbol:E,"%SyntaxError%":vt,"%ThrowTypeError%":qh,"%TypedArray%":Wh,"%TypeError%":wt,"%Uint8Array%":typeof Uint8Array>"u"?E:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?E:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?E:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?E:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?E:WeakMap,"%WeakRef%":typeof WeakRef>"u"?E:WeakRef,"%WeakSet%":typeof WeakSet>"u"?E:WeakSet};if(K)try{null.error}catch(t){Yi=K(K(t)),Xe["%Error.prototype%"]=Yi}var Yi,Vh=function t(e){var r;if(e==="%AsyncFunction%")r=Jo("async function () {}");else if(e==="%GeneratorFunction%")r=Jo("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=Jo("async function* () {}");else if(e==="%AsyncGenerator%"){var o=t("%AsyncGeneratorFunction%");o&&(r=o.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=t("%AsyncGenerator%");n&&K&&(r=K(n.prototype))}return Xe[e]=r,r},Xi={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Wt=Or(),Mr=Be(),Kh=Wt.call(Function.call,Array.prototype.concat),Hh=Wt.call(Function.apply,Array.prototype.splice),Zi=Wt.call(Function.call,String.prototype.replace),Lr=Wt.call(Function.call,String.prototype.slice),zh=Wt.call(Function.call,RegExp.prototype.exec),Jh=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Qh=/\\(\\)?/g,Yh=function(e){var r=Lr(e,0,1),o=Lr(e,-1);if(r==="%"&&o!=="%")throw new vt("invalid intrinsic syntax, expected closing `%`");if(o==="%"&&r!=="%")throw new vt("invalid intrinsic syntax, expected opening `%`");var n=[];return Zi(e,Jh,function(a,i,s,p){n[n.length]=s?Zi(p,Qh,"$1"):i||a}),n},Xh=function(e,r){var o=e,n;if(Mr(Xi,o)&&(n=Xi[o],o="%"+n[0]+"%"),Mr(Xe,o)){var a=Xe[o];if(a===_t&&(a=Vh(o)),typeof a>"u"&&!r)throw new wt("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:o,value:a}}throw new vt("intrinsic "+e+" does not exist!")};tc.exports=function(e,r){if(typeof e!="string"||e.length===0)throw new wt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new wt('"allowMissing" argument must be a boolean');if(zh(/^%?[^%]*%?$/,e)===null)throw new vt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var o=Yh(e),n=o.length>0?o[0]:"",a=Xh("%"+n+"%",r),i=a.name,s=a.value,p=!1,c=a.alias;c&&(n=c[0],Hh(o,Kh([0,1],c)));for(var f=1,l=!0;f<o.length;f+=1){var m=o[f],u=Lr(m,0,1),g=Lr(m,-1);if((u==='"'||u==="'"||u==="`"||g==='"'||g==="'"||g==="`")&&u!==g)throw new vt("property names with quotes must have matching quotes");if((m==="constructor"||!l)&&(p=!0),n+="."+m,i="%"+n+"%",Mr(Xe,i))s=Xe[i];else if(s!=null){if(!(m in s)){if(!r)throw new wt("base intrinsic for "+e+" exists, but the property is not available.");return}if(Ye&&f+1>=o.length){var _=Ye(s,m);l=!!_,l&&"get"in _&&!("originalValue"in _.get)?s=_.get:s=s[m]}else l=Mr(s,m),s=s[m];l&&!p&&(Xe[i]=s)}}return s}});var Xo=v((tS,Nr)=>{"use strict";var Yo=Or(),Tt=pe(),nc=Tt("%Function.prototype.apply%"),ac=Tt("%Function.prototype.call%"),sc=Tt("%Reflect.apply%",!0)||Yo.call(ac,nc),rc=Tt("%Object.getOwnPropertyDescriptor%",!0),Ze=Tt("%Object.defineProperty%",!0),Zh=Tt("%Math.max%");if(Ze)try{Ze({},"a",{value:1})}catch{Ze=null}Nr.exports=function(e){var r=sc(Yo,ac,arguments);if(rc&&Ze){var o=rc(r,"length");o.configurable&&Ze(r,"length",{value:1+Zh(0,e.length-(arguments.length-1))})}return r};var oc=function(){return sc(Yo,nc,arguments)};Ze?Ze(Nr.exports,"apply",{value:oc}):Nr.exports.apply=oc});var Zo=v((rS,cc)=>{"use strict";var ic=Object.prototype.toString;cc.exports=function(e){var r=ic.call(e),o=r==="[object Arguments]";return o||(o=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&ic.call(e.callee)==="[object Function]"),o}});var yc=v((oS,hc)=>{"use strict";var gc;Object.keys||(Vt=Object.prototype.hasOwnProperty,en=Object.prototype.toString,pc=Zo(),tn=Object.prototype.propertyIsEnumerable,lc=!tn.call({toString:null},"toString"),uc=tn.call(function(){},"prototype"),Kt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Dr=function(t){var e=t.constructor;return e&&e.prototype===t},fc={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},mc=function(){if(typeof window>"u")return!1;for(var t in window)try{if(!fc["$"+t]&&Vt.call(window,t)&&window[t]!==null&&typeof window[t]=="object")try{Dr(window[t])}catch{return!0}}catch{return!0}return!1}(),dc=function(t){if(typeof window>"u"||!mc)return Dr(t);try{return Dr(t)}catch{return!1}},gc=function(e){var r=e!==null&&typeof e=="object",o=en.call(e)==="[object Function]",n=pc(e),a=r&&en.call(e)==="[object String]",i=[];if(!r&&!o&&!n)throw new TypeError("Object.keys called on a non-object");var s=uc&&o;if(a&&e.length>0&&!Vt.call(e,0))for(var p=0;p<e.length;++p)i.push(String(p));if(n&&e.length>0)for(var c=0;c<e.length;++c)i.push(String(c));else for(var f in e)!(s&&f==="prototype")&&Vt.call(e,f)&&i.push(String(f));if(lc)for(var l=dc(e),m=0;m<Kt.length;++m)!(l&&Kt[m]==="constructor")&&Vt.call(e,Kt[m])&&i.push(Kt[m]);return i});var Vt,en,pc,tn,lc,uc,Kt,Dr,fc,mc,dc;hc.exports=gc});var wc=v((nS,_c)=>{"use strict";var ey=Array.prototype.slice,ty=Zo(),bc=Object.keys,jr=bc?function(e){return bc(e)}:yc(),xc=Object.keys;jr.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(o){return ty(o)?xc(ey.call(o)):xc(o)})}else Object.keys=jr;return Object.keys||jr};_c.exports=jr});var nn=v((aS,vc)=>{"use strict";var ry=pe(),rn=ry("%Object.defineProperty%",!0),on=function(){if(rn)try{return rn({},"a",{value:1}),!0}catch{return!1}return!1};on.hasArrayLengthDefineBug=function(){if(!on())return null;try{return rn([],"length",{value:1}).length!==1}catch{return!0}};vc.exports=on});var an=v((sS,Ic)=>{"use strict";var oy=wc(),ny=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",ay=Object.prototype.toString,sy=Array.prototype.concat,Tc=Object.defineProperty,iy=function(t){return typeof t=="function"&&ay.call(t)==="[object Function]"},cy=nn()(),Ac=Tc&&cy,py=function(t,e,r,o){if(e in t){if(o===!0){if(t[e]===r)return}else if(!iy(o)||!o())return}Ac?Tc(t,e,{configurable:!0,enumerable:!1,value:r,writable:!0}):t[e]=r},Pc=function(t,e){var r=arguments.length>2?arguments[2]:{},o=oy(e);ny&&(o=sy.call(o,Object.getOwnPropertySymbols(e)));for(var n=0;n<o.length;n+=1)py(t,o[n],e[o[n]],r[o[n]])};Pc.supportsDescriptors=!!Ac;Ic.exports=Pc});var Ur=v((iS,Sc)=>{"use strict";Sc.exports=function(){if(typeof Promise!="function")throw new TypeError("`Promise.prototype.finally` requires a global `Promise` be available.")}});var Rc=v((cS,Cc)=>{"use strict";var kc=Function.prototype.toString,At=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,cn,Gr;if(typeof At=="function"&&typeof Object.defineProperty=="function")try{cn=Object.defineProperty({},"length",{get:function(){throw Gr}}),Gr={},At(function(){throw 42},null,cn)}catch(t){t!==Gr&&(At=null)}else At=null;var ly=/^\s*class\b/,pn=function(e){try{var r=kc.call(e);return ly.test(r)}catch{return!1}},sn=function(e){try{return pn(e)?!1:(kc.call(e),!0)}catch{return!1}},Br=Object.prototype.toString,uy="[object Object]",fy="[object Function]",my="[object GeneratorFunction]",dy="[object HTMLAllCollection]",gy="[object HTML document.all class]",hy="[object HTMLCollection]",yy=typeof Symbol=="function"&&!!Symbol.toStringTag,by=!(0 in[,]),ln=function(){return!1};typeof document=="object"&&(Ec=document.all,Br.call(Ec)===Br.call(document.all)&&(ln=function(e){if((by||!e)&&(typeof e>"u"||typeof e=="object"))try{var r=Br.call(e);return(r===dy||r===gy||r===hy||r===uy)&&e("")==null}catch{}return!1}));var Ec;Cc.exports=At?function(e){if(ln(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{At(e,null,cn)}catch(r){if(r!==Gr)return!1}return!pn(e)&&sn(e)}:function(e){if(ln(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(yy)return sn(e);if(pn(e))return!1;var r=Br.call(e);return r!==fy&&r!==my&&!/^\[object HTML/.test(r)?!1:sn(e)}});var un=v((pS,Oc)=>{"use strict";Oc.exports=Rc()});var Lc=v((lS,Mc)=>{"use strict";Mc.exports=pe()});var Dc=v((uS,Nc)=>{"use strict";var xy=pe(),_y=Be(),wy=xy("%TypeError%");Nc.exports=function(e,r){if(e.Type(r)!=="Object")return!1;var o={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in r)if(_y(r,n)&&!o[n])return!1;if(e.IsDataDescriptor(r)&&e.IsAccessorDescriptor(r))throw new wy("Property Descriptors may not be both accessor and data descriptors");return!0}});var fn=v((fS,Gc)=>{"use strict";var jc=pe(),Uc=Xo(),vy=Uc(jc("String.prototype.indexOf"));Gc.exports=function(e,r){var o=jc(e,!!r);return typeof o=="function"&&vy(e,".prototype.")>-1?Uc(o):o}});var qc=v((mS,Fc)=>{"use strict";var Ty=pe(),Bc=Ty("%Array%"),Ay=!Bc.isArray&&fn()("Object.prototype.toString");Fc.exports=Bc.isArray||function(e){return Ay(e)==="[object Array]"}});var Hc=v((dS,Kc)=>{"use strict";var Wc=nn(),Py=pe(),$c=Wc()&&Py("%Object.defineProperty%",!0),Vc=Wc.hasArrayLengthDefineBug(),Iy=Vc&&qc(),Sy=fn(),Ey=Sy("Object.prototype.propertyIsEnumerable");Kc.exports=function(e,r,o,n,a,i){if(!$c){if(!e(i)||!i["[[Configurable]]"]||!i["[[Writable]]"]||a in n&&Ey(n,a)!==!!i["[[Enumerable]]"])return!1;var s=i["[[Value]]"];return n[a]=s,r(n[a],s)}return Vc&&a==="length"&&"[[Value]]"in i&&Iy(n)&&n.length!==i["[[Value]]"]?(n.length=i["[[Value]]"],n.length===i["[[Value]]"]):($c(n,a,o(i)),!0)}});var Fr=v((gS,zc)=>{"use strict";zc.exports=Number.isNaN||function(e){return e!==e}});var Qc=v((hS,Jc)=>{"use strict";var ky=Fr();Jc.exports=function(t){return(typeof t=="number"||typeof t=="bigint")&&!ky(t)&&t!==1/0&&t!==-1/0}});var Zc=v((yS,Xc)=>{"use strict";var Yc=pe(),Cy=Yc("%Math.abs%"),Ry=Yc("%Math.floor%"),Oy=Fr(),My=Qc();Xc.exports=function(e){if(typeof e!="number"||Oy(e)||!My(e))return!1;var r=Cy(e);return Ry(r)===r}});var rp=v((bS,tp)=>{"use strict";var ep=Be();tp.exports=function(e){return ep(e,"[[StartIndex]]")&&ep(e,"[[EndIndex]]")&&e["[[StartIndex]]"]>=0&&e["[[EndIndex]]"]>=e["[[StartIndex]]"]&&String(parseInt(e["[[StartIndex]]"],10))===String(e["[[StartIndex]]"])&&String(parseInt(e["[[EndIndex]]"],10))===String(e["[[EndIndex]]"])}});var qr=v((xS,sp)=>{"use strict";var op=pe(),np=op("%TypeError%"),Ly=op("%SyntaxError%"),z=Be(),Ny=Zc(),Dy=rp(),ap={"Property Descriptor":function(e){var r={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};if(!e)return!1;for(var o in e)if(z(e,o)&&!r[o])return!1;var n=z(e,"[[Value]]"),a=z(e,"[[Get]]")||z(e,"[[Set]]");if(n&&a)throw new np("Property Descriptors may not be both accessor and data descriptors");return!0},"Match Record":Dy,"Iterator Record":function(e){return z(e,"[[Iterator]]")&&z(e,"[[NextMethod]]")&&z(e,"[[Done]]")},"PromiseCapability Record":function(e){return!!e&&z(e,"[[Resolve]]")&&typeof e["[[Resolve]]"]=="function"&&z(e,"[[Reject]]")&&typeof e["[[Reject]]"]=="function"&&z(e,"[[Promise]]")&&e["[[Promise]]"]&&typeof e["[[Promise]]"].then=="function"},"AsyncGeneratorRequest Record":function(e){return!!e&&z(e,"[[Completion]]")&&z(e,"[[Capability]]")&&ap["PromiseCapability Record"](e["[[Capability]]"])},"RegExp Record":function(e){return e&&z(e,"[[IgnoreCase]]")&&typeof e["[[IgnoreCase]]"]=="boolean"&&z(e,"[[Multiline]]")&&typeof e["[[Multiline]]"]=="boolean"&&z(e,"[[DotAll]]")&&typeof e["[[DotAll]]"]=="boolean"&&z(e,"[[Unicode]]")&&typeof e["[[Unicode]]"]=="boolean"&&z(e,"[[CapturingGroupsCount]]")&&typeof e["[[CapturingGroupsCount]]"]=="number"&&Ny(e["[[CapturingGroupsCount]]"])&&e["[[CapturingGroupsCount]]"]>=0}};sp.exports=function(e,r,o,n){var a=ap[r];if(typeof a!="function")throw new Ly("unknown record type: "+r);if(e(n)!=="Object"||!a(n))throw new np(o+" must be a "+r)}});var cp=v((_S,ip)=>{"use strict";ip.exports=function(e){if(typeof e>"u")return e;var r={};return"[[Value]]"in e&&(r.value=e["[[Value]]"]),"[[Writable]]"in e&&(r.writable=!!e["[[Writable]]"]),"[[Get]]"in e&&(r.get=e["[[Get]]"]),"[[Set]]"in e&&(r.set=e["[[Set]]"]),"[[Enumerable]]"in e&&(r.enumerable=!!e["[[Enumerable]]"]),"[[Configurable]]"in e&&(r.configurable=!!e["[[Configurable]]"]),r}});var lp=v((wS,pp)=>{"use strict";pp.exports=function(e){if(e===null)return"Null";if(typeof e>"u")return"Undefined";if(typeof e=="function"||typeof e=="object")return"Object";if(typeof e=="number")return"Number";if(typeof e=="boolean")return"Boolean";if(typeof e=="string")return"String"}});var Fe=v((vS,up)=>{"use strict";var jy=lp();up.exports=function(e){return typeof e=="symbol"?"Symbol":typeof e=="bigint"?"BigInt":jy(e)}});var mp=v((TS,fp)=>{"use strict";var Uy=qr(),Gy=cp(),By=Fe();fp.exports=function(e){return typeof e<"u"&&Uy(By,"Property Descriptor","Desc",e),Gy(e)}});var hp=v((AS,gp)=>{"use strict";var dp=Be(),Fy=Fe(),qy=qr();gp.exports=function(e){return!(typeof e>"u"||(qy(Fy,"Property Descriptor","Desc",e),!dp(e,"[[Get]]")&&!dp(e,"[[Set]]")))}});var xp=v((PS,bp)=>{"use strict";var yp=Be(),$y=Fe(),Wy=qr();bp.exports=function(e){return!(typeof e>"u"||(Wy($y,"Property Descriptor","Desc",e),!yp(e,"[[Value]]")&&!yp(e,"[[Writable]]")))}});var wp=v((IS,_p)=>{"use strict";_p.exports=function(e){return typeof e=="string"||typeof e=="symbol"}});var Ap=v((SS,Tp)=>{"use strict";var vp=Fr();Tp.exports=function(e,r){return e===r?e===0?1/e===1/r:!0:vp(e)&&vp(r)}});var Ip=v((ES,Pp)=>{"use strict";Pp.exports=function(e){return!!e}});var kp=v((kS,Ep)=>{"use strict";var he=Be(),Vy=pe(),$r=Vy("%TypeError%"),Ky=Fe(),mn=Ip(),Sp=un();Ep.exports=function(e){if(Ky(e)!=="Object")throw new $r("ToPropertyDescriptor requires an object");var r={};if(he(e,"enumerable")&&(r["[[Enumerable]]"]=mn(e.enumerable)),he(e,"configurable")&&(r["[[Configurable]]"]=mn(e.configurable)),he(e,"value")&&(r["[[Value]]"]=e.value),he(e,"writable")&&(r["[[Writable]]"]=mn(e.writable)),he(e,"get")){var o=e.get;if(typeof o<"u"&&!Sp(o))throw new $r("getter must be a function");r["[[Get]]"]=o}if(he(e,"set")){var n=e.set;if(typeof n<"u"&&!Sp(n))throw new $r("setter must be a function");r["[[Set]]"]=n}if((he(r,"[[Get]]")||he(r,"[[Set]]"))&&(he(r,"[[Value]]")||he(r,"[[Writable]]")))throw new $r("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return r}});var Mp=v((CS,Op)=>{"use strict";var Hy=pe(),dn=Hy("%TypeError%"),Cp=Dc(),zy=Hc(),Jy=mp(),Rp=hp(),gn=xp(),Qy=wp(),Yy=Ap(),Xy=kp(),hn=Fe();Op.exports=function(e,r,o){if(hn(e)!=="Object")throw new dn("Assertion failed: Type(O) is not Object");if(!Qy(r))throw new dn("Assertion failed: IsPropertyKey(P) is not true");var n=Cp({Type:hn,IsDataDescriptor:gn,IsAccessorDescriptor:Rp},o)?o:Xy(o);if(!Cp({Type:hn,IsDataDescriptor:gn,IsAccessorDescriptor:Rp},n))throw new dn("Assertion failed: Desc is not a valid Property Descriptor");return zy(gn,Yy,Jy,e,r,n)}});var Np=v((RS,xn)=>{"use strict";var Zy=Lc(),Lp=Zy("%Reflect.construct%",!0),Wr=Mp();try{Wr({},"",{"[[Get]]":function(){}})}catch{Wr=null}Wr&&Lp?(yn={},bn={},Wr(bn,"length",{"[[Get]]":function(){throw yn},"[[Enumerable]]":!0}),xn.exports=function(e){try{Lp(e,bn)}catch(r){return r===yn}}):xn.exports=function(e){return typeof e=="function"&&!!e.prototype};var yn,bn});var Bp=v((OS,Gp)=>{"use strict";var Up=pe(),Dp=Up("%Symbol.species%",!0),_n=Up("%TypeError%"),eb=Np(),jp=Fe();Gp.exports=function(e,r){if(jp(e)!=="Object")throw new _n("Assertion failed: Type(O) is not Object");var o=e.constructor;if(typeof o>"u")return r;if(jp(o)!=="Object")throw new _n("O.constructor is not an Object");var n=Dp?o[Dp]:void 0;if(n==null)return r;if(eb(n))return n;throw new _n("no constructor found")}});var Tn=v((MS,qp)=>{"use strict";var tb=Ur();tb();var rb=un(),ob=Bp(),nb=Fe(),Fp=function(e,r){return new e(function(o){o(r)})},ab=Promise,sb=function(e,r){return function(o){var n=r(),a=Fp(e,n),i=function(){return o};return a.then(i)}},ib=function(e,r){return function(o){var n=r(),a=Fp(e,n),i=function(){throw o};return a.then(i)}},vn=function(e){var r=this;if(nb(r)!=="Object")throw new TypeError("receiver is not an Object");var o=ob(r,ab),n=e,a=e;return rb(e)&&(n=sb(o,e),a=ib(o,e)),r.then(n,a)};Object.getOwnPropertyDescriptor&&(wn=Object.getOwnPropertyDescriptor(vn,"name"),wn&&wn.configurable&&Object.defineProperty(vn,"name",{configurable:!0,value:"finally"}));var wn;qp.exports=vn});var An=v((LS,$p)=>{"use strict";var cb=Ur(),pb=Tn();$p.exports=function(){return cb(),typeof Promise.prototype.finally=="function"?Promise.prototype.finally:pb}});var Vp=v((NS,Wp)=>{"use strict";var lb=Ur(),ub=An(),fb=an();Wp.exports=function(){lb();var e=ub();return fb(Promise.prototype,{finally:e},{finally:function(){return Promise.prototype.finally!==e}}),e}});var Jp=v((DS,zp)=>{"use strict";var mb=Xo(),db=an(),gb=Tn(),Kp=An(),hb=Vp(),Hp=mb(Kp());db(Hp,{getPolyfill:Kp,implementation:gb,shim:hb});zp.exports=Hp});var Yp=v((US,Qp)=>{var yb=Ho(),bb=Jp();Qp.exports=class{constructor(){this._items=new Map}create(e,r,o){return this._rejectExistingRequest(e),this._createNewRequest(e,r,o)}resolve(e,r){e&&this._items.has(e)&&this._items.get(e).resolve(r)}rejectAll(e){this._items.forEach(r=>r.isPending?r.reject(e):null)}_rejectExistingRequest(e){let r=this._items.get(e);r&&r.isPending&&r.reject(new Error(`WebSocket request is replaced, id: ${e}`))}_createNewRequest(e,r,o){let n=new yb({timeout:o,timeoutReason:`WebSocket request was rejected by timeout (${o} ms). RequestId: ${e}`});return this._items.set(e,n),bb(n.call(r),()=>this._deleteRequest(e,n))}_deleteRequest(e,r){this._items.get(e)===r&&this._items.delete(e)}}});var Zp=v((GS,Xp)=>{Xp.exports={createWebSocket:t=>new WebSocket(t),packMessage:null,unpackMessage:null,attachRequestId:null,extractRequestId:null,extractMessageData:t=>t.data,timeout:0,connectionTimeout:0}});var el=v(Pn=>{Pn.throwIf=(t,e)=>{if(t)throw new Error(e)};Pn.isPromise=t=>t&&typeof t.then=="function"});var nl=v((FS,ol)=>{var qe=Ci(),tl=Ho(),{PromisedMap:xb}=Ui(),_b=Yp(),rl=Zp(),{throwIf:Vr,isPromise:wb}=el(),Kr={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},In=class{constructor(e,r){this._assertOptions(r),this._url=e,this._options=Object.assign({},rl,r),this._requests=new _b,this._promisedMap=new xb,this._ws=null,this._wsSubscription=null,this._createOpeningController(),this._createClosingController(),this._createChannels()}get ws(){return this._ws}get url(){return this._url}get isOpening(){return!!(this._ws&&this._ws.readyState===Kr.CONNECTING)}get isOpened(){return!!(this._ws&&this._ws.readyState===Kr.OPEN)}get isClosing(){return!!(this._ws&&this._ws.readyState===Kr.CLOSING)}get isClosed(){return!this._ws||this._ws.readyState===Kr.CLOSED}get onOpen(){return this._onOpen}get onSend(){return this._onSend}get onMessage(){return this._onMessage}get onUnpackedMessage(){return this._onUnpackedMessage}get onResponse(){return this._onResponse}get onClose(){return this._onClose}get onError(){return this._onError}open(){return this.isClosing?Promise.reject(new Error("Can't open WebSocket while closing.")):this.isOpened?this._opening.promise:this._opening.call(()=>{this._opening.promise.catch(e=>this._cleanup(e)),this._createWS()})}sendRequest(e,r={}){let o=r.requestId||`${Math.random()}`,n=r.timeout!==void 0?r.timeout:this._options.timeout;return this._requests.create(o,()=>{this._assertRequestIdHandlers();let a=this._options.attachRequestId(e,o);this.sendPacked(a)},n)}sendPacked(e){this._assertPackingHandlers();let r=this._options.packMessage(e);this.send(r)}send(e){Vr(!this.isOpened,"Can't send data because WebSocket is not opened."),this._ws.send(e),this._onSend.dispatchAsync(e)}waitUnpackedMessage(e,r={}){return Vr(typeof e!="function",`Predicate must be a function, got ${typeof e}`),r.timeout&&setTimeout(()=>{if(this._promisedMap.has(e)){let o=r.timeoutError||new Error("Timeout");this._promisedMap.reject(e,o)}},r.timeout),this._promisedMap.set(e)}close(e,r){return this.isClosed?Promise.resolve(this._closing.value):this._closing.call(()=>this._ws.close(e,r))}removeAllListeners(){this._onOpen.removeAllListeners(),this._onMessage.removeAllListeners(),this._onUnpackedMessage.removeAllListeners(),this._onResponse.removeAllListeners(),this._onSend.removeAllListeners(),this._onClose.removeAllListeners(),this._onError.removeAllListeners()}_createOpeningController(){let e=this._options.connectionTimeout||this._options.timeout;this._opening=new tl({timeout:e,timeoutReason:`Can't open WebSocket within allowed timeout: ${e} ms.`})}_createClosingController(){let e=this._options.timeout;this._closing=new tl({timeout:e,timeoutReason:`Can't close WebSocket within allowed timeout: ${e} ms.`})}_createChannels(){this._onOpen=new qe,this._onMessage=new qe,this._onUnpackedMessage=new qe,this._onResponse=new qe,this._onSend=new qe,this._onClose=new qe,this._onError=new qe}_createWS(){this._ws=this._options.createWebSocket(this._url),this._wsSubscription=new qe.Subscription([{channel:this._ws,event:"open",listener:e=>this._handleOpen(e)},{channel:this._ws,event:"message",listener:e=>this._handleMessage(e)},{channel:this._ws,event:"error",listener:e=>this._handleError(e)},{channel:this._ws,event:"close",listener:e=>this._handleClose(e)}]).on()}_handleOpen(e){this._onOpen.dispatchAsync(e),this._opening.resolve(e)}_handleMessage(e){let r=this._options.extractMessageData(e);this._onMessage.dispatchAsync(r),this._tryUnpack(r)}_tryUnpack(e){this._options.unpackMessage&&(e=this._options.unpackMessage(e),wb(e)?e.then(r=>this._handleUnpackedData(r)):this._handleUnpackedData(e))}_handleUnpackedData(e){e!==void 0&&(this._onUnpackedMessage.dispatchAsync(e),this._tryHandleResponse(e)),this._tryHandleWaitingMessage(e)}_tryHandleResponse(e){if(this._options.extractRequestId){let r=this._options.extractRequestId(e);r&&(this._onResponse.dispatchAsync(e,r),this._requests.resolve(r,e))}}_tryHandleWaitingMessage(e){this._promisedMap.forEach((r,o)=>{let n=!1;try{n=o(e)}catch(a){this._promisedMap.reject(o,a);return}n&&this._promisedMap.resolve(o,e)})}_handleError(e){this._onError.dispatchAsync(e)}_handleClose(e){this._onClose.dispatchAsync(e),this._closing.resolve(e);let r=new Error(`WebSocket closed with reason: ${e.reason} (${e.code}).`);this._opening.isPending&&this._opening.reject(r),this._cleanup(r)}_cleanupWS(){this._wsSubscription&&(this._wsSubscription.off(),this._wsSubscription=null),this._ws=null}_cleanup(e){this._cleanupWS(),this._requests.rejectAll(e)}_assertOptions(e){Object.keys(e||{}).forEach(r=>{if(!rl.hasOwnProperty(r))throw new Error(`Unknown option: ${r}`)})}_assertPackingHandlers(){let{packMessage:e,unpackMessage:r}=this._options;Vr(!e||!r,"Please define 'options.packMessage / options.unpackMessage' for sending packed messages.")}_assertRequestIdHandlers(){let{attachRequestId:e,extractRequestId:r}=this._options;Vr(!e||!r,"Please define 'options.attachRequestId / options.extractRequestId' for sending requests.")}};ol.exports=In});var Zl=typeof global=="object"&&global&&global.Object===Object&&global,Zt=Zl;var eu=typeof self=="object"&&self&&self.Object===Object&&self,tu=Zt||eu||Function("return this")(),B=tu;var ru=B.Symbol,tt=ru;var Bn=Object.prototype,ou=Bn.hasOwnProperty,nu=Bn.toString,St=tt?tt.toStringTag:void 0;function au(t){var e=ou.call(t,St),r=t[St];try{t[St]=void 0;var o=!0}catch{}var n=nu.call(t);return o&&(e?t[St]=r:delete t[St]),n}var Fn=au;var su=Object.prototype,iu=su.toString;function cu(t){return iu.call(t)}var qn=cu;var pu="[object Null]",lu="[object Undefined]",$n=tt?tt.toStringTag:void 0;function uu(t){return t==null?t===void 0?lu:pu:$n&&$n in Object(t)?Fn(t):qn(t)}var Z=uu;function fu(t){return t!=null&&typeof t=="object"}var oe=fu;var mu="[object Symbol]";function du(t){return typeof t=="symbol"||oe(t)&&Z(t)==mu}var Wn=du;var gu=Array.isArray,be=gu;var hu=/\s/;function yu(t){for(var e=t.length;e--&&hu.test(t.charAt(e)););return e}var Vn=yu;var bu=/^\s+/;function xu(t){return t&&t.slice(0,Vn(t)+1).replace(bu,"")}var Kn=xu;function _u(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var W=_u;var Hn=0/0,wu=/^[-+]0x[0-9a-f]+$/i,vu=/^0b[01]+$/i,Tu=/^0o[0-7]+$/i,Au=parseInt;function Pu(t){if(typeof t=="number")return t;if(Wn(t))return Hn;if(W(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=W(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Kn(t);var r=vu.test(t);return r||Tu.test(t)?Au(t.slice(2),r?2:8):wu.test(t)?Hn:+t}var Et=Pu;var zn=1/0,Iu=17976931348623157e292;function Su(t){if(!t)return t===0?t:0;if(t=Et(t),t===zn||t===-zn){var e=t<0?-1:1;return e*Iu}return t===t?t:0}var eo=Su;function Eu(t){return t}var er=Eu;var ku="[object AsyncFunction]",Cu="[object Function]",Ru="[object GeneratorFunction]",Ou="[object Proxy]";function Mu(t){if(!W(t))return!1;var e=Z(t);return e==Cu||e==Ru||e==ku||e==Ou}var rt=Mu;var Lu=B["__core-js_shared__"],tr=Lu;var Jn=function(){var t=/[^.]+$/.exec(tr&&tr.keys&&tr.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Nu(t){return!!Jn&&Jn in t}var Qn=Nu;var Du=Function.prototype,ju=Du.toString;function Uu(t){if(t!=null){try{return ju.call(t)}catch{}try{return t+""}catch{}}return""}var xe=Uu;var Gu=/[\\^$.*+?()[\]{}|]/g,Bu=/^\[object .+?Constructor\]$/,Fu=Function.prototype,qu=Object.prototype,$u=Fu.toString,Wu=qu.hasOwnProperty,Vu=RegExp("^"+$u.call(Wu).replace(Gu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ku(t){if(!W(t)||Qn(t))return!1;var e=rt(t)?Vu:Bu;return e.test(xe(t))}var Yn=Ku;function Hu(t,e){return t?.[e]}var Xn=Hu;function zu(t,e){var r=Xn(t,e);return Yn(r)?r:void 0}var ne=zu;var Ju=ne(B,"WeakMap"),rr=Ju;var Zn=Object.create,Qu=function(){function t(){}return function(e){if(!W(e))return{};if(Zn)return Zn(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),ea=Qu;function Yu(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var ta=Yu;function Xu(t,e){var r=-1,o=t.length;for(e||(e=Array(o));++r<o;)e[r]=t[r];return e}var ra=Xu;var Zu=800,ef=16,tf=Date.now;function rf(t){var e=0,r=0;return function(){var o=tf(),n=ef-(o-r);if(r=o,n>0){if(++e>=Zu)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var oa=rf;function of(t){return function(){return t}}var na=of;var nf=function(){try{var t=ne(Object,"defineProperty");return t({},"",{}),t}catch{}}(),ot=nf;var af=ot?function(t,e){return ot(t,"toString",{configurable:!0,enumerable:!1,value:na(e),writable:!0})}:er,aa=af;var sf=oa(aa),sa=sf;var cf=9007199254740991,pf=/^(?:0|[1-9]\d*)$/;function lf(t,e){var r=typeof t;return e=e??cf,!!e&&(r=="number"||r!="symbol"&&pf.test(t))&&t>-1&&t%1==0&&t<e}var or=lf;function uf(t,e,r){e=="__proto__"&&ot?ot(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var nt=uf;function ff(t,e){return t===e||t!==t&&e!==e}var Pe=ff;var mf=Object.prototype,df=mf.hasOwnProperty;function gf(t,e,r){var o=t[e];(!(df.call(t,e)&&Pe(o,r))||r===void 0&&!(e in t))&&nt(t,e,r)}var ia=gf;function hf(t,e,r,o){var n=!r;r||(r={});for(var a=-1,i=e.length;++a<i;){var s=e[a],p=o?o(r[s],t[s],s,r,t):void 0;p===void 0&&(p=t[s]),n?nt(r,s,p):ia(r,s,p)}return r}var ca=hf;var pa=Math.max;function yf(t,e,r){return e=pa(e===void 0?t.length-1:e,0),function(){for(var o=arguments,n=-1,a=pa(o.length-e,0),i=Array(a);++n<a;)i[n]=o[e+n];n=-1;for(var s=Array(e+1);++n<e;)s[n]=o[n];return s[e]=r(i),ta(t,this,s)}}var la=yf;function bf(t,e){return sa(la(t,e,er),t+"")}var ua=bf;var xf=9007199254740991;function _f(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=xf}var nr=_f;function wf(t){return t!=null&&nr(t.length)&&!rt(t)}var Ie=wf;function vf(t,e,r){if(!W(r))return!1;var o=typeof e;return(o=="number"?Ie(r)&&or(e,r.length):o=="string"&&e in r)?Pe(r[e],t):!1}var ar=vf;function Tf(t){return ua(function(e,r){var o=-1,n=r.length,a=n>1?r[n-1]:void 0,i=n>2?r[2]:void 0;for(a=t.length>3&&typeof a=="function"?(n--,a):void 0,i&&ar(r[0],r[1],i)&&(a=n<3?void 0:a,n=1),e=Object(e);++o<n;){var s=r[o];s&&t(e,s,o,a)}return e})}var fa=Tf;var Af=Object.prototype;function Pf(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Af;return t===r}var Se=Pf;function If(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o}var ma=If;var Sf="[object Arguments]";function Ef(t){return oe(t)&&Z(t)==Sf}var to=Ef;var da=Object.prototype,kf=da.hasOwnProperty,Cf=da.propertyIsEnumerable,Rf=to(function(){return arguments}())?to:function(t){return oe(t)&&kf.call(t,"callee")&&!Cf.call(t,"callee")},$e=Rf;function Of(){return!1}var ga=Of;var ba=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ha=ba&&typeof module=="object"&&module&&!module.nodeType&&module,Mf=ha&&ha.exports===ba,ya=Mf?B.Buffer:void 0,Lf=ya?ya.isBuffer:void 0,Nf=Lf||ga,at=Nf;var Df="[object Arguments]",jf="[object Array]",Uf="[object Boolean]",Gf="[object Date]",Bf="[object Error]",Ff="[object Function]",qf="[object Map]",$f="[object Number]",Wf="[object Object]",Vf="[object RegExp]",Kf="[object Set]",Hf="[object String]",zf="[object WeakMap]",Jf="[object ArrayBuffer]",Qf="[object DataView]",Yf="[object Float32Array]",Xf="[object Float64Array]",Zf="[object Int8Array]",em="[object Int16Array]",tm="[object Int32Array]",rm="[object Uint8Array]",om="[object Uint8ClampedArray]",nm="[object Uint16Array]",am="[object Uint32Array]",N={};N[Yf]=N[Xf]=N[Zf]=N[em]=N[tm]=N[rm]=N[om]=N[nm]=N[am]=!0;N[Df]=N[jf]=N[Jf]=N[Uf]=N[Qf]=N[Gf]=N[Bf]=N[Ff]=N[qf]=N[$f]=N[Wf]=N[Vf]=N[Kf]=N[Hf]=N[zf]=!1;function sm(t){return oe(t)&&nr(t.length)&&!!N[Z(t)]}var xa=sm;function im(t){return function(e){return t(e)}}var _a=im;var wa=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kt=wa&&typeof module=="object"&&module&&!module.nodeType&&module,cm=kt&&kt.exports===wa,ro=cm&&Zt.process,pm=function(){try{var t=kt&&kt.require&&kt.require("util").types;return t||ro&&ro.binding&&ro.binding("util")}catch{}}(),oo=pm;var va=oo&&oo.isTypedArray,lm=va?_a(va):xa,st=lm;var um=Object.prototype,fm=um.hasOwnProperty;function mm(t,e){var r=be(t),o=!r&&$e(t),n=!r&&!o&&at(t),a=!r&&!o&&!n&&st(t),i=r||o||n||a,s=i?ma(t.length,String):[],p=s.length;for(var c in t)(e||fm.call(t,c))&&!(i&&(c=="length"||n&&(c=="offset"||c=="parent")||a&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||or(c,p)))&&s.push(c);return s}var Ta=mm;function dm(t,e){return function(r){return t(e(r))}}var sr=dm;var gm=sr(Object.keys,Object),Aa=gm;var hm=Object.prototype,ym=hm.hasOwnProperty;function bm(t){if(!Se(t))return Aa(t);var e=[];for(var r in Object(t))ym.call(t,r)&&r!="constructor"&&e.push(r);return e}var Pa=bm;function xm(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Ia=xm;var _m=Object.prototype,wm=_m.hasOwnProperty;function vm(t){if(!W(t))return Ia(t);var e=Se(t),r=[];for(var o in t)o=="constructor"&&(e||!wm.call(t,o))||r.push(o);return r}var Sa=vm;function Tm(t){return Ie(t)?Ta(t,!0):Sa(t)}var ir=Tm;var Am=ne(Object,"create"),_e=Am;function Pm(){this.__data__=_e?_e(null):{},this.size=0}var Ea=Pm;function Im(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ka=Im;var Sm="__lodash_hash_undefined__",Em=Object.prototype,km=Em.hasOwnProperty;function Cm(t){var e=this.__data__;if(_e){var r=e[t];return r===Sm?void 0:r}return km.call(e,t)?e[t]:void 0}var Ca=Cm;var Rm=Object.prototype,Om=Rm.hasOwnProperty;function Mm(t){var e=this.__data__;return _e?e[t]!==void 0:Om.call(e,t)}var Ra=Mm;var Lm="__lodash_hash_undefined__";function Nm(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=_e&&e===void 0?Lm:e,this}var Oa=Nm;function it(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}it.prototype.clear=Ea;it.prototype.delete=ka;it.prototype.get=Ca;it.prototype.has=Ra;it.prototype.set=Oa;var no=it;function Dm(){this.__data__=[],this.size=0}var Ma=Dm;function jm(t,e){for(var r=t.length;r--;)if(Pe(t[r][0],e))return r;return-1}var Ee=jm;var Um=Array.prototype,Gm=Um.splice;function Bm(t){var e=this.__data__,r=Ee(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():Gm.call(e,r,1),--this.size,!0}var La=Bm;function Fm(t){var e=this.__data__,r=Ee(e,t);return r<0?void 0:e[r][1]}var Na=Fm;function qm(t){return Ee(this.__data__,t)>-1}var Da=qm;function $m(t,e){var r=this.__data__,o=Ee(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}var ja=$m;function ct(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}ct.prototype.clear=Ma;ct.prototype.delete=La;ct.prototype.get=Na;ct.prototype.has=Da;ct.prototype.set=ja;var ke=ct;var Wm=ne(B,"Map"),Ce=Wm;function Vm(){this.size=0,this.__data__={hash:new no,map:new(Ce||ke),string:new no}}var Ua=Vm;function Km(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Ga=Km;function Hm(t,e){var r=t.__data__;return Ga(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Re=Hm;function zm(t){var e=Re(this,t).delete(t);return this.size-=e?1:0,e}var Ba=zm;function Jm(t){return Re(this,t).get(t)}var Fa=Jm;function Qm(t){return Re(this,t).has(t)}var qa=Qm;function Ym(t,e){var r=Re(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}var $a=Ym;function pt(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}pt.prototype.clear=Ua;pt.prototype.delete=Ba;pt.prototype.get=Fa;pt.prototype.has=qa;pt.prototype.set=$a;var Wa=pt;var Xm=sr(Object.getPrototypeOf,Object),cr=Xm;var Zm="[object Object]",ed=Function.prototype,td=Object.prototype,Va=ed.toString,rd=td.hasOwnProperty,od=Va.call(Object);function nd(t){if(!oe(t)||Z(t)!=Zm)return!1;var e=cr(t);if(e===null)return!0;var r=rd.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Va.call(r)==od}var lt=nd;function ad(){this.__data__=new ke,this.size=0}var Ka=ad;function sd(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}var Ha=sd;function id(t){return this.__data__.get(t)}var za=id;function cd(t){return this.__data__.has(t)}var Ja=cd;var pd=200;function ld(t,e){var r=this.__data__;if(r instanceof ke){var o=r.__data__;if(!Ce||o.length<pd-1)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new Wa(o)}return r.set(t,e),this.size=r.size,this}var Qa=ld;function ut(t){var e=this.__data__=new ke(t);this.size=e.size}ut.prototype.clear=Ka;ut.prototype.delete=Ha;ut.prototype.get=za;ut.prototype.has=Ja;ut.prototype.set=Qa;var Ya=ut;var ts=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Xa=ts&&typeof module=="object"&&module&&!module.nodeType&&module,ud=Xa&&Xa.exports===ts,Za=ud?B.Buffer:void 0,es=Za?Za.allocUnsafe:void 0;function fd(t,e){if(e)return t.slice();var r=t.length,o=es?es(r):new t.constructor(r);return t.copy(o),o}var rs=fd;var md=ne(B,"DataView"),pr=md;var dd=ne(B,"Promise"),lr=dd;var gd=ne(B,"Set"),ur=gd;var os="[object Map]",hd="[object Object]",ns="[object Promise]",as="[object Set]",ss="[object WeakMap]",is="[object DataView]",yd=xe(pr),bd=xe(Ce),xd=xe(lr),_d=xe(ur),wd=xe(rr),We=Z;(pr&&We(new pr(new ArrayBuffer(1)))!=is||Ce&&We(new Ce)!=os||lr&&We(lr.resolve())!=ns||ur&&We(new ur)!=as||rr&&We(new rr)!=ss)&&(We=function(t){var e=Z(t),r=e==hd?t.constructor:void 0,o=r?xe(r):"";if(o)switch(o){case yd:return is;case bd:return os;case xd:return ns;case _d:return as;case wd:return ss}return e});var cs=We;var vd=B.Uint8Array,ao=vd;function Td(t){var e=new t.constructor(t.byteLength);return new ao(e).set(new ao(t)),e}var ps=Td;function Ad(t,e){var r=e?ps(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var ls=Ad;function Pd(t){return typeof t.constructor=="function"&&!Se(t)?ea(cr(t)):{}}var us=Pd;function Id(t){return function(e,r,o){for(var n=-1,a=Object(e),i=o(e),s=i.length;s--;){var p=i[t?s:++n];if(r(a[p],p,a)===!1)break}return e}}var fs=Id;var Sd=fs(),ms=Sd;var Ed=function(){return B.Date.now()},fr=Ed;var kd="Expected a function",Cd=Math.max,Rd=Math.min;function Od(t,e,r){var o,n,a,i,s,p,c=0,f=!1,l=!1,m=!0;if(typeof t!="function")throw new TypeError(kd);e=Et(e)||0,W(r)&&(f=!!r.leading,l="maxWait"in r,a=l?Cd(Et(r.maxWait)||0,e):a,m="trailing"in r?!!r.trailing:m);function u(x){var A=o,O=n;return o=n=void 0,c=x,i=t.apply(O,A),i}function g(x){return c=x,s=setTimeout(b,e),f?u(x):i}function _(x){var A=x-p,O=x-c,$=e-A;return l?Rd($,a-O):$}function d(x){var A=x-p,O=x-c;return p===void 0||A>=e||A<0||l&&O>=a}function b(){var x=fr();if(d(x))return k(x);s=setTimeout(b,_(x))}function k(x){return s=void 0,m&&o?u(x):(o=n=void 0,i)}function I(){s!==void 0&&clearTimeout(s),c=0,o=p=n=s=void 0}function y(){return s===void 0?i:k(fr())}function h(){var x=fr(),A=d(x);if(o=arguments,n=this,p=x,A){if(s===void 0)return g(p);if(l)return clearTimeout(s),s=setTimeout(b,e),u(p)}return s===void 0&&(s=setTimeout(b,e)),i}return h.cancel=I,h.flush=y,h}var F=Od;function Md(t,e,r){(r!==void 0&&!Pe(t[e],r)||r===void 0&&!(e in t))&&nt(t,e,r)}var Ct=Md;function Ld(t){return oe(t)&&Ie(t)}var ds=Ld;function Nd(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var Rt=Nd;function Dd(t){return ca(t,ir(t))}var gs=Dd;function jd(t,e,r,o,n,a,i){var s=Rt(t,r),p=Rt(e,r),c=i.get(p);if(c){Ct(t,r,c);return}var f=a?a(s,p,r+"",t,e,i):void 0,l=f===void 0;if(l){var m=be(p),u=!m&&at(p),g=!m&&!u&&st(p);f=p,m||u||g?be(s)?f=s:ds(s)?f=ra(s):u?(l=!1,f=rs(p,!0)):g?(l=!1,f=ls(p,!0)):f=[]:lt(p)||$e(p)?(f=s,$e(s)?f=gs(s):(!W(s)||rt(s))&&(f=us(p))):l=!1}l&&(i.set(p,f),n(f,p,o,a,i),i.delete(p)),Ct(t,r,f)}var hs=jd;function ys(t,e,r,o,n){t!==e&&ms(e,function(a,i){if(n||(n=new Ya),W(a))hs(t,e,i,r,ys,o,n);else{var s=o?o(Rt(t,i),a,i+"",t,e,n):void 0;s===void 0&&(s=a),Ct(t,i,s)}},ir)}var bs=ys;var Ud=fa(function(t,e,r,o){bs(t,e,r,o)}),Ot=Ud;var Gd="[object String]";function Bd(t){return typeof t=="string"||!be(t)&&oe(t)&&Z(t)==Gd}var ft=Bd;var Fd="[object Map]",qd="[object Set]",$d=Object.prototype,Wd=$d.hasOwnProperty;function Vd(t){if(t==null)return!0;if(Ie(t)&&(be(t)||typeof t=="string"||typeof t.splice=="function"||at(t)||st(t)||$e(t)))return!t.length;var e=cs(t);if(e==Fd||e==qd)return!t.size;if(Se(t))return!Pa(t).length;for(var r in t)if(Wd.call(t,r))return!1;return!0}var Ve=Vd;var Kd=Math.floor,Hd=Math.random;function zd(t,e){return t+Kd(Hd()*(e-t+1))}var xs=zd;var Jd=parseFloat,Qd=Math.min,Yd=Math.random;function Xd(t,e,r){if(r&&typeof r!="boolean"&&ar(t,e,r)&&(e=r=void 0),r===void 0&&(typeof e=="boolean"?(r=e,e=void 0):typeof t=="boolean"&&(r=t,t=void 0)),t===void 0&&e===void 0?(t=0,e=1):(t=eo(t),e===void 0?(e=t,t=0):e=eo(e)),t>e){var o=t;t=e,e=o}if(r||t%1||e%1){var n=Yd();return Qd(t+n*(e-t+Jd("1e-"+((n+"").length-1))),e)}return xs(t,e)}var Mt=Xd;var w=M(j());function mt(t){let e,r,o,n,a,i,s;return p(),{feed:c,reset:p};function p(){e=!0,r="",o=0,n=-1,a=void 0,i=void 0,s=""}function c(l){r=r?r+l:l,e&&Zd(r)&&(r=r.slice(ws.length)),e=!1;let m=r.length,u=0,g=!1;for(;u<m;){g&&(r[u]===`
`&&++u,g=!1);let _=-1,d=n,b;for(let k=o;_<0&&k<m;++k)b=r[k],b===":"&&d<0?d=k-u:b==="\r"?(g=!0,_=k-u):b===`
`&&(_=k-u);if(_<0){o=m-u,n=d;break}else o=0,n=-1;f(r,u,d,_),u+=_+1}u===m?r="":u>0&&(r=r.slice(u))}function f(l,m,u,g){if(g===0){s.length>0&&(t({type:"event",id:a,event:i||void 0,data:s.slice(0,-1)}),s="",a=void 0),i=void 0;return}let _=u<0,d=l.slice(m,m+(_?g:u)),b=0;_?b=g:l[m+u+1]===" "?b=u+2:b=u+1;let k=m+b,I=g-b,y=l.slice(k,k+I).toString();if(d==="data")s+=y?"".concat(y,`
`):`
`;else if(d==="event")i=y;else if(d==="id"&&!y.includes("\0"))a=y;else if(d==="retry"){let h=parseInt(y,10);Number.isNaN(h)||t({type:"reconnect-interval",value:h})}}}var ws=[239,187,191];function Zd(t){return ws.every((e,r)=>t.charCodeAt(r)===e)}var mr,eg=new Uint8Array(16);function io(){if(!mr&&(mr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mr(eg)}var H=[];for(let t=0;t<256;++t)H.push((t+256).toString(16).slice(1));function vs(t,e=0){return(H[t[e+0]]+H[t[e+1]]+H[t[e+2]]+H[t[e+3]]+"-"+H[t[e+4]]+H[t[e+5]]+"-"+H[t[e+6]]+H[t[e+7]]+"-"+H[t[e+8]]+H[t[e+9]]+"-"+H[t[e+10]]+H[t[e+11]]+H[t[e+12]]+H[t[e+13]]+H[t[e+14]]+H[t[e+15]]).toLowerCase()}var tg=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),co={randomUUID:tg};function rg(t,e,r){if(co.randomUUID&&!e&&!t)return co.randomUUID();t=t||{};let o=t.random||(t.rng||io)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){r=r||0;for(let n=0;n<16;++n)e[r+n]=o[n];return e}return vs(o)}var ee=rg;var Io=M(j());async function*dt(t){let e=t.getReader();try{for(;;){let{done:r,value:o}=await e.read();if(r)return;yield o}}finally{e.releaseLock()}}var Es=M(j());var C=M(j());function G(t){return C.default.storage.local.get(t)}async function R(t){return C.default.storage.local.set(t)}async function te(t){let e=await C.default.storage.local.get(t);return typeof t=="string"?e[t]:e}async function Ts(t,e){return new Promise((r,o)=>{te(t).then(n=>{if(typeof n<"u"){r(n);return}function a(i){i[t]&&typeof i[t].newValue<"u"&&(C.default.storage.local.onChanged.removeListener(a),r(i[t].newValue))}C.default.storage.local.onChanged.addListener(a),e&&setTimeout(()=>{C.default.storage.local.onChanged.removeListener(a),o()},e)})})}async function Oe(t){return C.default.storage.local.remove(t)}function po(t,e){typeof t=="string"&&(t=[t]);function r(o){for(let n of t)if(n in o){e(t.reduce((a,i)=>(a[i]=o[i],a),{}));break}}return C.default.storage.local.onChanged.addListener(r),()=>{C.default.storage.local.onChanged.removeListener(r)}}async function lo(t){if(C.default?.cookies){let e=await C.default.cookies.get(t);return e?.value?decodeURIComponent(e.value):""}return C.default.runtime.sendMessage({type:"GET_COOKIE",data:t})}async function uo(t){return C.default?.cookies?await C.default.cookies.set(t):C.default.runtime.sendMessage({type:"SET_COOKIE",data:t})}function dr(t){return lo({name:t,url:U.origin})}function fo(t,e,r=360){let o=Math.round(Date.now()/1e3)+86400*r;try{return uo({name:t,value:e,url:U.origin,domain:"."+new URL(U.origin).hostname,expirationDate:o,secure:!0})}catch{}}async function Ke(t){return C.default?.tabs?C.default.tabs.create(t):C.default.runtime.sendMessage({type:"OPEN_URL_IN_NEW_TAB",details:t})}async function As(t,e){let r=await C.default.tabs.query(t);for(let o of r)o.id&&await C.default.tabs.update(o.id,e)}async function mo(t,e=!1,r){let{url:o,...n}=t,a=new URL(o),i=`${a.origin}${a.pathname}/*`,s=await C.default.tabs.query({url:i,...n});if(s.length)for(let p of s)p.id&&(await C.default.tabs.update(p.id,{active:!0}),e&&await C.default.tabs.reload(p.id,r));else{let{url:p,cookieStoreId:c,...f}=t,l={url:Array.isArray(p)?p[0]:p,...f};await C.default.tabs.create(l)}}function go(t="general",e){let r="/options.html";t&&(r+=`?section=${t}`),e&&(e.startsWith("#")||(e="#"+e),r+=e),C.default.tabs.create({url:r})}async function ho(t){if(C.default?.scripting?.executeScript)return C.default.scripting.executeScript(t)}async function we(){return(await C.default.tabs.query({active:!0,currentWindow:!0}))[0]}function og(t,e){return t.type==="FORWARD_MSG"&&t.subtype?t.subtype===e:t.type===e}function Ps(t,e){return new Promise((r,o)=>{function n(a){og(a,t)&&(C.default.runtime.onMessage.removeListener(n),r(a))}C.default.runtime.onMessage.addListener(n),e&&setTimeout(()=>{o()},e)})}var ng="can_i_insert_content";async function Is(){if(!C.default?.tabs)return!0;let t=await we();return new Promise(e=>{t?.id&&C.default.tabs.sendMessage(t.id,{type:ng}).then(r=>{e(!!r)}).catch(()=>{t.url?.includes(`://${C.default.runtime.id}/`)?document.querySelector("chatgpt-sidebar")&&e(!0):e(!1)}),setTimeout(()=>{e(!1)},100)})}var yo=Es.default.runtime.getManifest(),Me=yo.version_name===yo.version+"-e";var bo=Me?"dhoenijjpgpeimemopealfcbiecgceod":"difoiogjjojoaoomphldepapgpbgkhkb",ks=`ChitChat_${Me?"Edge":"Chrome"}_Ext`,Le=yo.version,Cs=["gpmljinohlbfgmeoaeceoajachkabijo","nlipoenfbbikpbjkfpfillcgkoblgpmj"];var xo="gpt-3.5-turbo";var ag={dev:"https://dev.wisehood.ai",test:"https://dev.wisehood.ai",preview:"https://preview.sider.ai",prod:"https://sider.ai"},sg={dev:"wisehood.ai",test:"wisehood.ai",preview:"sider.ai",prod:"sider.ai"},Ss=ag["prod"],U={origin:Ss,api:`${Ss}/api`,domain:sg["prod"]},Rs="https://www.google-analytics.com/mp/collect",Os="G-0PRFKME4HP";var Ms="6FX_tIISST2SsnSx29yQRg";var Lt=(T=>(T.English="en",T["Chinese(Simplified)"]="zh_CN",T["Chinese(Traditional)"]="zh_TW",T.Spanish="es",T.French="fr",T.Japanese="ja",T.German="de",T.Portuguese="pt",T.Arabic="ar",T.Russian="ru",T.Italian="it",T.Korean="ko",T.Hindi="hi",T.Dutch="nl",T.Polish="pl",T.Amharic="am",T.Bulgarian="bg",T.Bengali="bn",T.Catalan="ca",T.Czech="cs",T.Danish="da",T.Greek="el",T.Estonian="et",T.Persian="fa",T.Finnish="fi",T.Filipino="fil",T.Gujarati="gu",T.Hebrew="he",T.Croatian="hr",T.Hungarian="hu",T.Indonesian="id",T.Kannada="kn",T.Lithuanian="lt",T.Latvian="lv",T.Malayalam="ml",T.Marathi="mr",T.Malay="ms",T.Norwegian="no",T.Romanian="ro",T.Slovak="sk",T.Slovenian="sl",T.Serbian="sr",T.Swedish="sv",T.Swahili="sw",T.Tamil="ta",T.Telugu="te",T.Thai="th",T.Turkish="tr",T.Ukrainian="uk",T.Urdu="ur",T.Vietnamese="vi",T))(Lt||{}),ig={en:"English",zh_CN:"\u4E2D\u6587(\u7B80\u4F53)",zh_TW:"\u4E2D\u6587(\u7E41\u9AD4)",es:"Espa\xF1ol",fr:"Fran\xE7ais",ja:"\u65E5\u672C\u8A9E",de:"Deutsch",pt:"Portugu\xEAs",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",it:"Italiano",ko:"\uD55C\uAD6D\uC5B4",hi:"\u0939\u093F\u0928\u094D\u0926\u0940",nl:"Nederlands",pl:"Polski",am:"\u12A0\u121B\u122D\u129B",bg:"\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438",bn:"\u09AC\u09BE\u0982\u09B2\u09BE",ca:"Catal\xE0",cs:"\u010Ce\u0161tina",da:"Dansk",el:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",et:"Eesti",fa:"\u0641\u0627\u0631\u0633\u06CC",fi:"Suomi",fil:"Filipino",gu:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0",he:"\u05E2\u05D1\u05E8\u05D9\u05EA",hr:"Hrvatski",hu:"Magyar",id:"Indonesia",kn:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",lt:"Lietuvi\u0173",lv:"Latvie\u0161u",ml:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02",mr:"\u092E\u0930\u093E\u0920\u0940",ms:"Bahasa Melayu",no:"Norsk",ro:"Rom\xE2n\u0103",sk:"Sloven\u010Dina",sl:"Sloven\u0161\u010Dina",sr:"\u0421\u0440\u043F\u0441\u043A\u0438",sv:"Svenska",sw:"Kiswahili",ta:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD",te:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",th:"\u0E44\u0E17\u0E22",tr:"T\xFCrk\xE7e",uk:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",ur:"\u0627\u0631\u062F\u0648",vi:"Ti\u1EBFng Vi\u1EC7t"},_o=Object.entries(Lt).reduce((t,[e,r])=>(t[r]=e,t),{}),HA=Object.entries(Lt).map(([t,e])=>({label:t,value:e})),zA=Object.entries(ig).map(([t,e])=>({label:e,value:t}));var gr=[{id:"default",title:"Ask ChatGPT",template:"Can you tell me something about $[keywords]? If possible, can you give me some links about it?   If $[keywords] is a code related question, please just write the code",canEdit:!1},{id:"list",title:"Keywords to Questions",template:'List 1 most popular question about "$[keywords]". Then, Answer this question. At last,  list another 4 questions.',canEdit:!1},{id:"suggest",title:"Get related keywords",template:"$[keywords] are my search keywords in Google. Please give me 5 sets of related keywords.",canEdit:!1}];var He="provider:siderApi";async function hr(){let t="provider:gpt3",[e="siderApi",r]=await Promise.all([te("provider"),te(t)]);return{provider:e,configs:{gpt3:r}}}var yr=[{key:"summarize",title:"Summarize",template:"Summarize this for a second-grade student: ",visible:!0},{key:"similar-pages",title:"Similar pages",template:"Find 10 similar pages to the following content with link: "},{key:"grammar",title:"Grammar",template:"Correct this to standard English: "},{key:"explain",title:"Explain",template:"Explain the following content: "},{key:"explain-codes",title:"Explain Codes",template:"Explain the following codes: "},{key:"rewrite",title:"Rewrite",template:"Rewrite the following content: "},{key:"translate",title:"Translate",template:"Translate the following content to $[lang] language: "},{key:"qa",title:"Q&A",template:"Answer this question: "}];var ve={login:`${U.origin}/login`,openaiChat:"https://chat.openai.com",openaiLogin:"https://platform.openai.com/login",openaiSignup:"https://platform.openai.com/signup",openaiApiKey:"https://platform.openai.com/account/api-keys",openaiApiSession:"https://chat.openai.com/api/auth/session",edgeStore:"https://microsoftedge.microsoft.com/addons/detail/sider-ai-sidebar/dhoenijjpgpeimemopealfcbiecgceod",chromeStoreReview:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb/reviews",chromeStore:"https://chrome.google.com/webstore/detail/chatgpt-sidebar/difoiogjjojoaoomphldepapgpbgkhkb",weChatQrCode:"https://sider.ai/resource/weixin/qrcode.jpeg",producthuntPromoteApi:"https://sider.ai/resource/promotion/extension-promote.json"};var Ls={"fab-config.example.com":{favicon:"",enable:!0}},cg={key:"j",keyCode:74,metaKey:!0,ctrlKey:!0,altKey:!1,shiftKey:!1};var br={provider:"gpt3","provider:gpt3":{apiKey:"",customURL:"",enableCustomURL:!0,model:"gpt-3.5-turbo"},language:"zh_CN",theme:"light",isShowSearch:!1,triggerMode:"questionMark",selectedSearchTemplate:{id:"suggest",title:""},promptTemplates:[],submitShortcut:"Enter",sidebarShortcut:{altKey:!1,ctrlKey:!0,key:"O",keyCode:79,metaKey:!1,shiftKey:!0},sidebarLocation:"right",sidebarDisplayOption:"overlay",sidebarFab:!0,selectionSidebarFab:!0,chatVisiblePromptKeys:[],readVisiblePromptKeys:[],writeVisiblePromptKeys:[],quickActionSelectionEnable:!0,quickActionInputSelectionEnable:!0,translatorShortcut:cg,quickActionTriggerKeyword:"//",translatorPinnedTemplates:[],quickActionPinnedReading:[],quickActionPinnedWriting:[],quickActionInputIconEnable:!0,quickActionInputIconDisabledHost:{},translatorHostConfig:{"fab-config.example.com":{favicon:"",enable:!0}},enableWebAssistantVideo:!0,enableWebAssistantArticle:!0,enableWebAssistantQA:!0};var JA=1024*1024*10;var gt=M(j());function wo(t){return[...new Set(t)]}var Ne=(...t)=>t.join("/").replace(/([^:])\/{2,}/g,"$1/");function xr(t=1e3){return new Promise(e=>setTimeout(e,t))}async function De(t,e=1e3,r=2){let o=0;for(;;){try{return await t()}catch(n){if(r>=0&&o++>=r)throw n}await xr(e)}}function Te(t,e=0){let r=!1,o;return function(...n){return r||(r=!0,o=new Promise((a,i)=>{t(...n).then(a).catch(i).finally(async()=>{e&&await xr(e),r=!1})})),o}}async function Ns(){return(await gt.default.cookies.getAll({domain:".chat.openai.com"})).some(r=>r.name=="__Secure-next-auth.session-token")}function vo(t,e,r){let o=gt.default.runtime.getURL("chat/index.html");gt.default.tabs.query({url:o+"*",currentWindow:!0}).then(async n=>{n.length?(await gt.default.tabs.update(n[0].id,{active:!0}),e&&e()):(r&&await r(),await gt.default.tabs.create({url:o+(t?"?reason="+t:"")}))})}function Ds(t){return t?t.startsWith("chrome://newtab")||t.startsWith("edge://newtab")?"newTab":t.startsWith("edge")?"edgePage":t.startsWith("chrome")?"chromePage":t.startsWith("https://microsoftedge.microsoft.com/addons")?"edgeStore":t.startsWith("https://chrome.google.com/webstore")?"webstore":"":""}function To(t){let e=t.lastIndexOf(".");return t.substring(0,e)}function _r(t,e="https://"){let r=t.trim();return/https?:\/\//.test(r)?r:e+r}var Ao=M(j());var js=M(j());async function Nt(){let{generatedRandomId:t}=await G({generatedRandomId:""});if(!t){let e=await pg();return e||(e=ee(),lg(e)),js.default.storage.local.set({generatedRandomId:e}),e}return t}var Us=U.origin.replace(/\/\/\w+?\./,"//Y2hhdGdwdC1zaWRlYmFy."),Gs="zgv2awnlswq";async function pg(){try{return await lo({url:Us,name:Gs})}catch{return""}}async function lg(t){let e=Math.round(Date.now()/1e3)+31104e3;try{return await uo({url:Us,name:Gs,value:t,expirationDate:e,secure:!0})}catch{}}async function Ae(){let t=await wr("userinfo-type"),e=await wr("token");if(t===null)return null;let r=!!(e&&t&&t!=="device");return R({logged:r}),r}async function Po(){let{vipInfo:t}=await G({vipInfo:{isVIP:!1,userTypeDetail:"login",resetTimeSec:0,"gpt-3.5":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},"gpt-4":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},"image-creator":{total:0,remain:0,extraTotal:0,extraRemain:0,period:"total"},summary:{total:0,remain:0,cost:3,period:"total"},ocr:{cost:1}}});return t}async function ae(t){let e=await Po();return Ot(e,t,(r,o)=>{if(Array.isArray(r))return o}),R({vipInfo:e})}async function ze(){let t=await Dt();return t?{...t,anonymous:!1}:(t=await ug(),{...t,anonymous:!0})}async function Dt(){if(await Ae()){let t=await wr("token"),e=await wr("refresh_token");return t?{token:t,refreshToken:e}:null}return null}async function ug(){let t=await Bs();if(t)return t;let{__getSiderAnonymousToken__:e}=await G({__getSiderAnonymousToken__:!1});if(e)await Ts("siderApiToken"),t=await Bs();else{R({__getSiderAnonymousToken__:!0});try{let r=await P.getSiderAnonymousToken();t={token:r.token.token,refreshToken:r.token.refresh_token}}catch(r){throw Oe("__getSiderAnonymousToken__"),r}Oe("__getSiderAnonymousToken__"),fg(t)}return t}async function fg(t){return Ao.default.storage.local.set({siderApiToken:t.token,siderApiRefreshToken:t.refreshToken})}async function Bs(){let{siderApiToken:t,siderApiRefreshToken:e}=await Ao.default.storage.local.get(["siderApiToken","siderApiRefreshToken"]);return t?{token:t,refreshToken:e}:null}async function wr(t){try{let e=await dr(t);if(!e)throw new Error("");return R({[t]:e}),e}catch{return(await G({[t]:""}))[t]}}var ht={609:"error_sider_premium_required",610:"error_sider_high_traffic",1003:"error_sider_need_login",1006:"error_sider_device_bind_account",1101:"error_sider_processing",1102:"error_sider_api_limit",1107:"error_sider_api_limit2",1109:"error_sider_gpt4_highload",1110:"error_sider_gpt_highload",1112:"error_sider_gpt4_limit",1113:"error_sider_gpt4_limit",1118:"error_sider_image_limit",1121:"error_sider_summary_video_limit",1127:"error_sider_ocr_limit",1515:"error_sider_bard_busy",1129:"error_sider_basic_text_limit",1130:"error_sider_advanced_text_limit",1132:"error_sider_openai_filter"};function jt(t,e){switch(t){case 1102:case 1107:case 1112:case 1113:case 1118:case 1121:case 1127:P.getVipInfoCached();break;default:break}if(t===1129||t===1130){let r=e.match(/restriction of (.*) messages/),o=e.match(/messages every (.*) minute[s]?\. Alternatively/);throw new Error(ht[t]+"-"+r[1]+"-"+o[1])}throw t in ht?new Error(ht[t]):typeof e=="string"&&e.startsWith("504")?new Error("error_sider_timeout"):new Error(e)}var D=ks,re=Le,se=Intl.DateTimeFormat().resolvedOptions().timeZone,P={async refreshToken(t){let e=await L("/v1/user/token/refresh",{refresh_token:t},{headers:{Authorization:""}});return{token:e.token.token,refreshToken:e.token.refresh_token}},getSiderAnonymousToken:Te(async()=>{let t=await Nt();return L("/v1/user/login/device_id",{device_id:t,uuid:t,app_name:D,app_version:re},{headers:{Authorization:""}})}),getUserInfo:async()=>{let t=await ie(`/v1/user/info?app_name=${D}&app_version=${re}`);return await R({userInfo:t}),t},getVipInfo:Fs,getVipInfoCached:Te(Fs,5e3),async getPricingPlan(){let t=await ie("/v1/app/ipinfo",null,{headers:{Authorization:""}}),e=t.region==="CN"||se==="Asia/Shanghai"&&(await G({language:"en"})).language==="zh_CN",r=await ie(`/v1/payment/pricing?from=web&location=${e?"CN":t.region}`,null,{headers:{Authorization:""}});R({isCNUser:e,pricingPlan:r.plan.map(o=>({currency:o.currency,interval:o.interval,originPrice:o.origin_price/100,price:o.price/100}))})},getUserSettings:Te(async()=>{let t=await ie(`/v1/user/settings?app_name=${D}&keys=ChitChat_Ext`),e=t.client_setting,r=t.keys?.ChitChat_Ext;if(e&&(!r||Object.keys(e).some(o=>!(o in r)))){let o={...e,...r||{}};return await P.setUserSettings(o),o}return r},2e3),setUserSettings(t){return De(()=>L("/v1/user/settings",{app_name:D,key:"ChitChat_Ext",key_setting:t}))},getUserPromptList(t){return ie(`/v1/prompt/list?type=${t}&page_size=999`)},getAllPromptList:F(async()=>{let t=await G({language:"",chatVisiblePromptKeys:null,readVisiblePromptKeys:null,writeVisiblePromptKeys:null,sidebarPromptTemplate:null}),e=t.language;if(!e)return;let r={};try{r=await P.getUserSettings()}catch{}let[o,n]=await Promise.all([ie(`/v1/prompt/list_all?app_name=${D}&page_size=999&language=${e}`,null,{headers:{Authorization:(await Dt())?.token||""}}),ie(`/v1/prompt/list?type=special&app_name=${D}&page_size=999&language=${e}`,null,{headers:{Authorization:(await Dt())?.token||""}})]),a=o.List;a.sort((d,b)=>(d.sort!==0||d.key==="improve_writing")&&(b.sort!==0||b.key==="improve_writing")?b.sort-d.sort:b.sort===0?1:d.sort===0?-1:0);let i=a.reduce((d,b)=>(d[b.key||b.id]=b,d),{});function s(d){return{id:String(d.id),key:String(d.key||d.id),isCustom:!d.key||d.key.startsWith("custom"),name:d.display_name||d.name,shortName:d.short_name,content:d.content,icon:d.icon,placeholder:d.placeholder,usedIn:d.use||void 0,children:d.has_child?[]:void 0,parentKey:d.parent_key}}let p=[],c={};for(let d of a){let{key:b,has_child:k,parent_key:I}=d;if(k){if(!(b in c)){let h=s(d);c[b]=h,p.push(h)}continue}if(I){let h=i[I];if(!h)continue;if(!(I in c)){let x=s(h);c[I]=x,p.push(x)}c[I]?.children?.push(s(d));continue}let y=s(d);p.push(y)}if(t.sidebarPromptTemplate)for(let d of t.sidebarPromptTemplate)!d.uid&&d.key?.startsWith("custom")&&p.unshift({id:"",key:d.key,isCustom:!0,name:d.title,content:d.template});function f(d,b=!1){let k=[];for(let I of p){let{usedIn:y}=I;(!y||y.includes(d))&&(!b||I.isCustom)&&k.push(I.key)}return k}let l=new Set(p.map(({key:d})=>d)),m=o.Sort,u={chat:["chatVisiblePromptKeys","ChatAsk"],read:["readVisiblePromptKeys","ReadingAssistant"],write:["writeVisiblePromptKeys","WritingAssistant"]},g={};for(let[d,[b,k]]of Object.entries(u)){let I=t[b];I?g[b]=wo([...I.filter(h=>l.has(h)),...f(d)]):g[b]=wo([...f(d,!0),...m[k].split(",").map(h=>h.trim()),...f(d)]);let y=r?.[b];if(y?.length){let h=y.reduce((x,A,O)=>(x[A]=O,x),{});g[b].sort((x,A)=>{let O=h[x],$=h[A],X=typeof O>"u",S=typeof $>"u";return X&&S?0:X?1:S?-1:O-$})}}let _=n.List.map(d=>s(d));await R({...g,allPromptList:p,specialPromptList:_,__DONT_SYNC__:`visiblePromptKeys${Date.now()}`})},1e3),createPrompt(t){return De(()=>L("/v1/prompt/create",{is_template:!1,type:"sidebar",...t}))},createUserPrompt(t){return De(()=>L("/v1/prompt/create",{is_template:!1,...t}))},editUserPrompt(t){return De(()=>L("/v1/prompt/edit",t))},delUserPrompt(t){return De(()=>L("/v1/prompt/update",{id:t,status:"Deleted"}))},async uploadHistoryMsg(t){return(await L("/v1/conversation/upload",{app_name:D,app_version:re,messages:t})).cid},uploadConversion(t){return L("/v1/conversation/upload",{share:!0,app_name:D,app_version:re,messages:t})},saveConversion(t){return L("/v1/conversation/upload",{save_by_user:!0,app_name:D,app_version:re,messages:t})},async shareConversion(t){return(await ie(`/v1/conversation/share/${t}`)).share_key},saveSiderConversion(t){return ie(`/v1/conversation/save-by-user/${t}`)},unSaveSiderConversion(t){return ie(`/v1/conversation/unsave-by-user/${t}`)},delConversion(t){return mg(`/v1/conversation/delete/${t}`)},checkGrammarError(t){return L("/v1/completion/grammar_check",{content:t,tz_name:se,app_name:D,app_version:re})},async improveWriting(t){function e(o){if(o?.total){let n={[t.model]:{total:o.total,remain:o.remain,extraTotal:o.extra_total,extraRemain:o.extra_quota,period:o.remain_period}};ae(n)}}let r=F(e,1e3,{leading:!0});return L("/v1/completion/improve_writing",{content:t.content,model:t.model==="gpt-4"?t.model:"gpt3.5",tz_name:se,app_name:D,app_version:re},{onStreamData({data:o,done:n}){!n&&o&&r(o),t.onStreamData({text:o?.text||"",done:n})},getAbortMethod(o){}})},async sendFeedback({title:t,detail:e,email:r}){let o=await Dt();return L("/v1/app/feedback",{title:t,email:r,data:{detail:e},app_name:D,app_version:re},{headers:{Authorization:o?.token||""}})},async getInviteRewardConfig(){let t=await ie("/v1/invite/config",null,{headers:{Authorization:""}});return R({inviteRewardConfig:{"gpt3.5":t.GPT3Dot5Count,gpt4:t.GPT4Count}}),t},createInviteLink(){return L("/v1/invite/create",{type:"link"})},async getInviteRewardCount(){let t=await ie("/v1/invite/reward");return R({inviteRewardCount:{"gpt3.5":t.reward_gpt3dot5_count,gpt4:t.reward_gpt4_count}}),t},inviteFinish:async()=>{let t=await Nt();return L("/v1/invite/finish",{device_id:t})},async summaryVideo(t){function e(u){if(u?.total)if(t.vip){let g={"gpt-3.5":{total:u.total,remain:u.remain,extraTotal:u.extra_total,extraRemain:u.extra_quota,period:u.remain_period}};ae(g)}else{let g={summary:{remain:u.remain}};ae(g)}}let r=F(e,1e3,{leading:!0}),o={app_name:D,app_version:re,tz_name:se,content:t.text,title:t.title,language:t.lang,source:t.source,source_type:t.sourceType,request_id:ee(),cid:""},n=[];t.getAbortMethod(()=>{for(let u of n)u()});let{content:a,cid:i,...s}=o,p=null;try{p=await L("/v1/completion/summarize_init",s,{getAbortMethod(u){n.push(u)}})}catch{}p&&(o.cid=p.cid||"");let c=L("/v1/completion/summarize_all",o,{onStreamData({data:u,done:g}){!g&&u&&r(u),t.onStreamData({text:u?.text||"",done:g})},getAbortMethod(u){n.push(u)}}),f=L("/v1/completion/summarize",o,{getAbortMethod(u){n.push(u)}}),[l,m]=await Promise.all([c,f]);return e(m),{text:m.text,subtitle:m.subtitle}},statUserStop(t,e){return L("/v1/completion/mark-user-stop",{app_name:D,app_version:re,cid:t,mid:e})},async OCR(t,e){let r=new FormData;r.append("file",t),r.append("app_name",D),r.append("app_version",re),r.append("tz_name",se);let o=await L("/v1/ocr/math",r,{getAbortMethod:e});if(o?.limit){let a={"image-creator":{total:o.limit.total,remain:o.limit.remain,extraTotal:o.limit.extra_total,extraRemain:o.limit.extra_quota,period:o.limit.remain_period}};ae(a)}return o?.result?.text||""},adStat(t){return L("/v1/lp/action",t,{headers:{Authorization:""}})},async googleAnalytics(t,e){return Io.default.tabs?L(`${Rs}?measurement_id=${Os}&api_secret=${Ms}`,{client_id:await Nt(),events:[{name:t.replace(/-/gi,"_"),params:{...e}}]},{headers:{Authorization:""}}):Io.default.runtime.sendMessage({type:"GA_API",args:[t,e]})},uploadImage(t){let e=new FormData;return e.append("file",t),L("/v1/imagechat/upload",e)},signImageCookie(){return L("/v1/image/sign-cookie")}};async function Fs(){let t;try{t=await ie(`/v1/completion/limit?app_name=${D}&app_version=${re}&tz_name=${se}`)}catch(i){throw ae({isVIP:!1}),i}if(!t.chat.count)throw R({ERR_MUST_LOGIN:!0}),new Error("wrong_data");let e=t.user_type,r=["device","login","premium"],o=t.chat_period_info,n=t.gpt_4_chat_period_info,a={isVIP:t.user_type==="premium",userTypeDetail:t.user_type_detail,resetTimeSec:t.chat.reset_time,showNewPlan:!!t.show_new_plan,"gpt-3.5":{total:t.chat.count,remain:t.chat.remain,extraTotal:t.chat.extra_total,extraRemain:t.chat.extra_quota,period:t.chat.period,maxToken:o[e]?.prompt_max_token,award:r.reduce((i,s)=>(i[s]={count:o[s].count},i),{})},"gpt-4":{total:t.gpt_4_chat.count,remain:t.gpt_4_chat.remain,extraTotal:t.gpt_4_chat.extra_total,extraRemain:t.gpt_4_chat.extra_quota,period:t.gpt_4_chat.period,maxToken:n[e]?.prompt_max_token,award:r.reduce((i,s)=>(i[s]={count:n[s].count},i),{})},summary:{total:t.summarize.count,remain:t.summarize.remain,cost:t.summarize.deduct_count,period:t.summarize.period},ocr:{cost:t.ocr_period_info.deduct_count},"image-creator":{total:t.image.count,remain:t.image.remain,extraTotal:t.image.extra_total,extraRemain:t.image.extra_quota,period:t.image.period}};return ae(a),a}async function So(t,e=null,r={}){t.startsWith("http")||(t=Ne(U.api,t));let{onStreamData:o,getAbortMethod:n,noAuth:a,timeout:i,...s}=r;s.method&&(s.method=s.method.toUpperCase());let p=new AbortController;if(s.signal=p.signal,n?.(()=>{p.abort()}),s.headers=new Headers(s.headers||{}),!a&&!s.headers.has("Authorization")){let m=(await ze()).token;m&&(s.headers.set("Authorization",m),Oe("ERR_MUST_LOGIN"))}if(e)try{e instanceof FormData||e instanceof Blob||e instanceof URLSearchParams||e instanceof ReadableStream||e instanceof ArrayBuffer||e instanceof DataView?s.body=e:(s.body=JSON.stringify(e),s.headers.set("Content-Type","application/json"))}catch{s.body=e}let c;i&&(c=setTimeout(()=>p.abort(),i));let f=await fetch(t,s);i&&clearTimeout(c);let l=null;if(o||(l=await f.json().catch(()=>({}))),!f.ok||l&&l.code!==0){if(l||(l=await f.json().catch(()=>({}))),l.errMsg=l.msg||l.message,Ve(l))l.errMsg=`${f.status} ${f.statusText}`;else{(l.code===1003||l.code===1006)&&R({ERR_MUST_LOGIN:!0});try{jt(l.code,l.msg||l.message)}catch(m){l.errMsg=m.message}}throw o&&o({data:null,done:!0}),l}if(o&&f.body){let m=mt(u=>{if(u.type==="event"){let g={code:0,data:null,msg:"",errMsg:"",done:u.data==="[DONE]"},_=null;try{_=JSON.parse(u.data)}catch{}if(_&&(g={...g,..._}),g.code!==0){try{jt(g.code,g.msg)}catch(d){g.errMsg=d.message}throw o({data:null,done:!0}),g}o({data:g.data,done:g.done})}});for await(let u of dt(f.body)){let g=new TextDecoder().decode(u);m.feed(g)}}return l?.data}function ie(t,e=null,r={}){return So(t,e,{method:"GET",...r})}function L(t,e=null,r={}){return So(t,e,{method:"POST",...r})}function mg(t,e=null,r={}){return So(t,e,{method:"DELETE",...r})}function dg(t){return lt(t)&&Object.hasOwn(t,"code")&&Object.hasOwn(t,"data")&&Object.hasOwn(t,"msg")&&typeof t.code=="number"}async function J(t,e,r={},o={}){let n=new AbortController,{signal:a}=n,i=new URL(`${U.api}${t}`),s=r.body??e,p=new Headers(r.headers),c=(r.method??"GET").toUpperCase(),f=c==="GET"||c==="HEAD";p.has("Content-Type")||p.set("Content-Type","application/json");let{noAuth:l=!1,timeout:m,noAppInfo:u=!1}=o;if(!l&&!p.has("Authorization")){let k;try{k=(await ze()).token}catch(I){throw I instanceof Error?I:dg(I)&&I.msg?new Error(I.msg,{cause:I}):new Error("Failed to get token")}p.set("Authorization",k)}if(r.signal&&r.signal.addEventListener("abort",()=>n.abort()),s instanceof FormData&&p.delete("Content-Type"),!u)if(f){let k=i.searchParams;k.has("app_name")||k.append("app_name",D),k.has("tz_name")||k.append("tz_name",se),k.has("app_version")||k.append("app_version",re)}else s instanceof FormData?(s.has("app_name")||s.append("app_name",D),s.has("tz_name")||s.append("tz_name",se),s.has("app_version")||s.append("app_version",re)):lt(s)&&(Object.hasOwn(s,"app_name")||(s.app_name=D),Object.hasOwn(s,"tz_name")||(s.tz_name=se),Object.hasOwn(s,"app_version")||(s.app_version=re));let g=Object.assign({},r,{signal:a,headers:p,method:c,body:f?void 0:p.get("Content-Type")==="application/json"?JSON.stringify(s):s}),_;m&&(_=setTimeout(()=>n.abort(),m));let d=await fetch(i,g);clearTimeout(_);let b=await d.json().catch(()=>{});if(!d.ok)throw b&&b.msg?new Error(`${d.status}: ${b.msg}`,{cause:b}):new Error(`${d.status}: ${d.statusText}`);if(!b)throw new Error("Response body is not json");if(b.code!==0)throw(b.code===1003||b.code===1006)&&R({ERR_MUST_LOGIN:!0}),new Error(b.msg,{cause:b});return Oe("ERR_MUST_LOGIN"),b.data}var gg=M(j());function qs(t){return Ne(U.origin,t)}async function $s(){Ke({url:qs("/login")})}async function Ws(){Ke({url:qs("/invite")})}var hg=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(t=>[t.name,t]),yg=new Map(hg),Eo=yg;var bg=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],ko=new WeakSet,xg=t=>{ko.add(t);let e=t.toJSON();return ko.delete(t),e},_g=t=>Eo.get(t)??Error,Ks=({from:t,seen:e,to:r,forceEnumerable:o,maxDepth:n,depth:a,useToJSON:i,serialize:s})=>{if(!r)if(Array.isArray(t))r=[];else if(!s&&Vs(t)){let c=_g(t.name);r=new c}else r={};if(e.push(t),a>=n)return r;if(i&&typeof t.toJSON=="function"&&!ko.has(t))return xg(t);let p=c=>Ks({from:c,seen:[...e],forceEnumerable:o,maxDepth:n,depth:a,useToJSON:i,serialize:s});for(let[c,f]of Object.entries(t)){if(typeof Buffer=="function"&&Buffer.isBuffer(f)){r[c]="[object Buffer]";continue}if(f!==null&&typeof f=="object"&&typeof f.pipe=="function"){r[c]="[object Stream]";continue}if(typeof f!="function"){if(!f||typeof f!="object"){r[c]=f;continue}if(!e.includes(t[c])){a++,r[c]=p(t[c]);continue}r[c]="[Circular]"}}for(let{property:c,enumerable:f}of bg)typeof t[c]<"u"&&t[c]!==null&&Object.defineProperty(r,c,{value:Vs(t[c])?p(t[c]):t[c],enumerable:o?!0:f,configurable:!0,writable:!0});return r};function yt(t,e={}){let{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:o=!0}=e;return typeof t=="object"&&t!==null?Ks({from:t,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:o,serialize:!0}):typeof t=="function"?`[Function: ${t.name??"anonymous"}]`:t}function Vs(t){return!!t&&typeof t=="object"&&"name"in t&&"message"in t&&"stack"in t}var wg=M(j()),vr=new Map,Hs=(t,e)=>{let r=t.type,o=vr.get(r);if(o)return Promise.resolve(o({sender:e,data:t.data,id:r,timestamp:Date.now()})).then(n=>({data:n})).catch(n=>({error:yt(n)}))};function Q(t,e){if(vr.get(t))throw new Error(`Message ID "${t}" already has a listener.`);return vr.set(t,e),()=>vr.delete(t)}var zs=[{version:"3.5.0",features:[{title:"Sider Vision Became Smarter",features:["GPT-4/Claude 2 + Vision","1-click to answer the same question with different bots"]}],notifyType:"modal"},{version:"3.4.0",features:[{title:"Sider Grammar Widget",features:["Check grammar errors","Fix grammar errors","Improve the writing beyond grammar"]}],notifyType:"modal"},{version:"3.3.0",features:[{title:"Sider Vision \u2014 ChatGPT sidebar with Vision",features:["Extract text from an image","Ask any question about the image","3 ways to send image to Sider Vision<div><ol><li>Take a  screenshot</li><li>Drag & Drop an image to Chat window</li><li>Upload an image</li></ol></div>"]}],notifyType:"modal"},{version:"3.2.0",features:[{title:"New pricing plan with 5x more  GPT-4 queries",features:["Great news! Our updated pricing now gives you even more access to GPT-4 and Claude 2 queries.","If you're already a premium user, you'll be upgraded automatically. Plus, we've got a new 'Unlimited' plan for all you power users!"]}],notifyType:"modal"},{version:"3.1.0",features:[{title:"More bot!",features:["Support Bard now!"]},{title:"OCR: Extract text from any image and send it to ChatGPT",features:["Recognize 10+ major languages of printed materials","Recognize handwritten in English","Recognize math equation in the text"]},{title:"Improve Painter",features:["Replace the whole background","Remove selected area"]}],notifyType:"modal"},{version:"3.0.0",features:[{features:["More Chatbots: Now Supporting Claude-instant, Claude 2, and Bard!"]},{features:["Group Chat: Compare Answers Across Chatbots!"]},{features:["Mention: Tag Chatbots with '@'!"]},{features:["Quick Prompt: Just Type '/' and Go!"]},{features:["Simple Design: Streamlined for Speed!"]}],notifyType:"modal"},{version:"2.9.0",features:[{title:"Enhanced prompt manager for",features:["Reading context menu","Writing context menu"]},{title:"AI image editor",features:["Remove background from any images","Remove text from any images"]}],notifyType:"modal"},{version:"2.8.0",features:["Reading Assistant: Use AI for fast understanding while reading web pages","Writing Assistant: Quickly generate content with AI in the web input box"],notifyType:"modal"},{version:"2.7.0",features:["Draw picture from text","Draw picture from a reference picture"],notifyType:"modal"},{version:"2.6.0",features:["Sider Supports Fixed Sidebar - You can chat between all tabs without overlapping any content (available in Chrome 114 or later)"],notifyType:"modal"},{version:"2.5.0",features:["Youtube Summary! Watch 1 hour of YouTube video in 1 minute","Compare the answers provided by humans and AI on Q&A sites such as Quora, StackOverflow, and Zhihu"],notifyType:"modal"},{version:"2.4.0",features:["Smart web access: Based on your query, the Al will decide if it needs to access the web.","Stability improvement"],notifyType:"modal"},{version:"2.3.0",features:["Support Browsing and Plugins for Plus users!","ChatGPT with internet access for everyone!"],notifyType:"modal"},{version:"2.2.0",features:["Compose any message","Reply email, tweet, comment etc"],notifyType:"modal"},{version:"2.1.0",features:["Shortcut for Quick Lookup","Resize the Quick Lookup window","Bug fixes and other UX improvements"],notifyType:"modal"},{version:"2.0.0",features:["Support GPT-4 for all users!","Invite friends and gain GPT-4 queries for both of you!","Bug fixes and other UX improvements"],notifyType:"modal"},{version:"1.1.0",features:["Full Chat in the new tab!","ChatGPT, Bing, Bard together!","Bug fixes"],notifyType:"modal"},{version:"1.0.13",features:["Continue the chat after asking questions","Switch between GPT-4 and GPT-3.5 for Plus users","Easily access and search chat history"],notifyType:"modal"},{version:"1.0.12",features:["Sync extension settings across computers","Access your prompts from different laptops","Save chats for future use","Share chats via link"],notifyType:"modal"},{version:"1.0.11",features:["Quickly access actions through a pop-up window without opening the sidebar.","Add support for additional languages.","Retain the user's language preference when using the translation feature.","Resolve shortcut conflicts on platforms like GitHub and others."],notifyType:"modal"},{version:"1.0.10",features:["Support 50+ languages now!"],notifyType:"modal"},{version:"1.0.8",features:["Support GPT-4 for Plus users! Check settings page!"],notifyType:"modal"},{version:"1.0.7",features:["Remember prompt used last time","Optimize the position of the chatGPT panel on search pages","Add an option to put the sidebar in-page icon on the left side","Optimize package size","Add dark mode","Support your API url proxy"],notifyType:"modal"},{version:"1.0.6",features:["Improve summarize feature in Youtube page"],notifyType:"modal"},{version:"1.0.5",features:["Remember the location of sidebar in\u2013age icon","Improve shortcuts","Save prompt templates from the sidebar directly"]},{version:"1.0.4",features:["Re-order prompt items in the dropdown list","Archive prompt items you will not use","Support response in 50+ languages"]},{version:"1.0.3",features:["CMD/Ctrl + Enter to do quick \u201CSubmit\u201D","Option to hide panel in the search results page","Support ESC to hide sidebar","Support summarize long article"]},{version:"1.0.2",features:["Add stop button to stop generating response","Change the place of collapse button"]},{version:"1.0.1",features:["Improve summarize feature in Youtube page","Fix some bugs related to copy/paste and print"]}];function Js(t,e){let r=t.key||"translatorHostConfig";G({[r]:Ls}).then(o=>{let n=o[r],a=t.host,i=t.favicon;try{a=a||new URL(e.url||"").host,i=i||e.tab?.favIconUrl||e.url+"/favicon.ico"}catch{}let s=n[a]?.enable===!1;return typeof t.enable=="boolean"&&(s=t.enable),n={...n,[a]:{favicon:i,enable:s}},s==!0&&delete n[a],R({[r]:n})})}var de=M(j());async function Tr({prompt:t,windowId:e}){let o=(await de.default.tabs.query({url:"https://chat.openai.com/chat*",windowId:e}))[0];o||(o=await de.default.tabs.create({active:!0,url:"https://chat.openai.com",windowId:e}),await new Promise(n=>{let a=(i,s,p)=>{i==o.id&&s.status=="complete"&&(n(),de.default.tabs.onUpdated.removeListener(a))};de.default.tabs.onUpdated.addListener(a)})),de.default.tabs.update(o.id,{active:!0}),de.default.tabs.sendMessage(o.id,{type:"automate-send-prompt",prompt:t}),await new Promise(n=>{let a=0,i=(s,p)=>{if(p.tab?.id===o.id)switch(s.type){case"loaded":a+=1,a<2&&de.default.tabs.sendMessage(o.id,{type:"automate-send-prompt",prompt:t});return;case"automate-send-prompt-done":de.default.runtime.onMessage.removeListener(i),n();return}};de.default.runtime.onMessage.addListener(i),setTimeout(n,1e3*60)})}var ci=M(Ar()),q=M(j());var oi=M(Ar());var ni=M(j());var Pr=class{constructor(){this.results=[];this.isBrowsing=!1}parseMessage(e){let r=e.message,o=this.results.findIndex(n=>n.id===r?.id);return r&&(r.author.role==="assistant"?this.handleAssistantMessage(r,o):r.author.role==="tool"&&(r.author.name==="browser"?this.handleBrowserMessage(r):this.handlePluginMessage(r))),this.results}handleAssistantMessage(e,r){if(e.recipient!=="all")if(e.recipient!=="browser")if(r===-1)this.results.push({id:e?.id,type:"plugin",pluginName:e?.recipient,isLoading:!0,info:[{type:"request",text:e?.content?.parts?.[0]}]});else{let o=this.results[r];o.info[0].text=e?.content?.parts?.[0]}else if(!this.isBrowsing)this.results.push({id:e?.id,type:"browsing",isLoading:!0,actions:[{messageId:"0",command:"startBrowsing"}]}),this.isBrowsing=!0;else{let o=this.results[this.results.length-1],n=o.actions[o.actions.length-1];n.messageId!==e?.id&&(n.command==="search"||n.command==="click"||n.command==="quote"&&n.status==="finished")&&o.actions.push({messageId:"2",command:"think"})}else if(r===-1)this.handleNewTextMessage(e);else{let o=this.results[r],n=this.getTextWithCitations(e);o.text=n.text,o.searchSnippets=n.searchSnippets}}handleBrowserMessage(e){if(this.isBrowsing){let r=this.results[this.results.length-1];if(r.type==="browsing"){let o=r,n=e.metadata;(o.actions.length===0||n.command!==o.actions[o.actions.length-1].command||o.actions[o.actions.length-1].messageId!==e?.id)&&(n.command!=="quote"||o.actions[o.actions.length-1].command!=="quote")?(o.actions[o.actions.length-1].command==="think"&&o.actions.pop(),o.actions.push({messageId:e?.id,command:n.command,status:n.status,args:n.args,_cite_metadata:n.command==="click"?this.getClickMetadata(n._cite_metadata):{}})):(o.actions[o.actions.length-1].status=n.status,n.command==="click"&&(o.actions[o.actions.length-1]._cite_metadata=this.getClickMetadata(n._cite_metadata)))}}}handlePluginMessage(e){let r=this.results[this.results.length-1];r.isLoading=!1,r.info.push({type:"response",text:e?.content?.parts?.[0]})}handleNewTextMessage(e){if(this.results.length>0){let r=this.results[this.results.length-1];if(r.type==="browsing"){let o=r;o.isLoading=!1,o.actions.push({messageId:"1",command:"finishBrowsing"}),this.isBrowsing=!1}}this.results.push({id:e?.id,type:"text",text:e?.content?.parts?.[0]})}getClickMetadata(e){return{metadata_list:[{url:e?.metadata_list?.[0]?.url,title:e?.metadata_list?.[0]?.title}]}}getTextWithCitations(e){let r=e?.content?.parts?.[0],o=e?.metadata?.citations,n={};if(o&&o.length>0){let a=r,i=o.length;return o.sort((s,p)=>p.end_ix-s.end_ix).forEach((s,p)=>{let c=s.start_ix,f=s.end_ix,l=s.metadata.url;l?(a=a.slice(0,c)+`[^${i-p}](${l})`+a.slice(f),n[i-p]={link:l,title:s.metadata.title,snippet:s.metadata.text}):a=a.slice(0,c)+a.slice(f)}),{text:a,searchSnippets:n}}else return{text:r}}};async function je(t,e,r=!1){let{onMessage:o,...n}=e,i=await(r?ge:fetch)(t,n);if(!i.ok){let p=await i.json().catch(()=>({}));throw new Error(Ve(p)?`${i.status} ${i.statusText}`:JSON.stringify(p))}let s=mt(p=>{p.type==="event"&&o(p.data)});for await(let p of dt(i.body)){let c=new TextDecoder().decode(p);s.feed(c)}}var Ro=M(j());async function Ig(t){let e=await clients.matchAll();for(let r of e)if(r.url===t)return!0;return!1}var Ut=null;async function Sg(t){let e=Ro.default.runtime.getURL(t);await Ig(e)||(Ut?await Ut:(Ut=chrome.offscreen.createDocument({url:t,reasons:["IFRAME_SCRIPTING"],justification:"reason for needing the document"}),await Ut,Ut=null))}async function Eg(){return await Sg("arkose-frame.html"),Ro.default.runtime.sendMessage({type:"getArkoseToken",target:"offscreen"})}async function ti(){return Eg()}var Je="ChatGPT Webapp",Sr=`${Je}: error_chatgpt_auth`;async function Lo(t,e,r,o){let n={method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}};return o&&(n.body=JSON.stringify(o)),ge(`https://chat.openai.com/backend-api${r}`,n)}async function ai(t,e){await Lo(t,"POST","/conversation/message_feedback",e)}async function ri(t,e,r){await Lo(t,"PATCH",`/conversation/${e}`,r)}async function si(t){let e=await fe({isForce:!0});return Lo(e,"GET","/models",null).then(r=>r.json())}async function ii(t){return t||(t=await fe()),await(await ge("https://chat.openai.com/backend-api/aip/p?offset=0&limit=250&is_installed=true",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).json()}var Oo="accessToken",Mo=new oi.default(10*1e3);async function No(){if(Mo.get(Oo))return Mo.get(Oo);let t=null;try{t=await fetch(ve.openaiApiSession)}catch(o){throw new Error(`${Je}: ${o.message}`)}let e=Sr;if(t?.status===403)throw new Error(e);let r=await t?.json().catch(()=>({}));if(!r.accessToken)throw new Error(e);return Mo.set(Oo,r.accessToken),r.accessToken}async function kg(t){try{return(await ni.default.storage.local.get({selectWebAppModel:"gpt-4"})).selectWebAppModel}catch{return null}}var Ir=class{constructor(e){this.token=e;this.token=e}async generateAnswer(e){if(!this.token)throw new Error(Sr);let r,o=Promise.resolve(),n=async()=>{try{await o}catch(l){throw r&&(await ri(this.token,r,{is_visible:!1}),r=""),new Error(`${Je}: ${l}`)}r&&(await ri(this.token,r,{is_visible:!1}),r="")};e.getCleanupMethod?.(n);let a=Array.isArray(e.prompt)?e.prompt.map(l=>({id:ee(),author:{role:l.role},content:{content_type:"text",parts:[l.content]}})):[{id:ee(),author:{role:"user"},content:{content_type:"text",parts:[e.prompt]}}],i=()=>{i=null,e.onEvent({type:"done"}),n()},s=[],p=new Pr,c=await kg(this.token)||"text-davinci-002-render",f=null;if(c.startsWith("gpt-4")&&chrome.offscreen)try{f=await ti()}catch(l){throw new Error(l)}o=je("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify({action:"next",messages:a,model:c,parent_message_id:ee(),plugin_ids:e.pluginIds,timezone_offset_min:new Date().getTimezoneOffset(),arkose_token:f}),onMessage(l){if(l==="[DONE]"){i?.();return}else if(l.startsWith("event: typing"))return;let m;try{m=JSON.parse(l)}catch{return}if(!m.message?.content?.parts?.[0]&&m.message?.author.role!=="assistant"&&!m.message?.metadata?.command||m.message?.author.role==="system"||m.message?.author.role==="user"||m.message?.content?.content_type==="text"&&m.message?.author.name===null&&m.message?.status==="finished_successfully"&&!m.message?.end_turn)return;s=p.parseMessage(m);let u=m.message?.content?.parts?.[0];(u||s.length>0)&&(r=m.conversation_id,e.onEvent({type:"answer",data:{message:m.message,contents:s,text:u,messageId:m.message.id,conversationId:""}}))}},!0).catch(l=>{let m=l.message;try{let u=JSON.parse(m);m=u.message||u.msg||u.error?.message||u.detail?.message||u.detail||m}catch{}throw e.onEvent({type:"error",data:{error:`${Je}: ${m}`}}),new Error(`${Je}: ${m}`)}).finally(()=>{i?.()})}};var Ue=0,Er=!1,bt=new ci.default(1e3*60*10),Do="accessToken",pi="noCacheToken",Cg="alwaysProxyFetch";q.default.storage.local.get({guardChatgptTabId:0}).then(({guardChatgptTabId:t})=>{Ue==0&&(Ue=t),Er=t!=0});async function li(){let t=null;try{t=await q.default.tabs.get(Ue),await q.default.tabs.update(t.id,{active:!0})}catch{}t||(t=await q.default.tabs.create({url:ve.openaiChat,pinned:!0,active:!0}));let e=t.id;await q.default.storage.local.set({guardChatgptTabId:e}),Ue=e,Er=!0,await new Promise(r=>{let o=(n,a)=>{switch(n.type){case"loaded":a.tab?.id==e&&q.default.tabs.sendMessage(e,{type:"guard-session-activate"});break;case"guard-session-activated":q.default.runtime.onMessage.removeListener(o),r();break}};q.default.runtime.onMessage.addListener(o),setTimeout(()=>r(),1e3*40)})}async function Rg(){let t=await q.default.tabs.create({url:ve.openaiChat,pinned:!0,active:!1});return await q.default.storage.local.set({guardChatgptTabId:t.id}),Ue=t.id,Er=!0,t}async function Og(){let t="https://chat.openai.com/*",e=await q.default.tabs.query({pinned:!0,url:t});if(e.length>0){let r=e[0];return Ue=r.id,await q.default.tabs.reload(r.id),r}return null}async function Mg(){let t=null;try{t=await q.default.tabs.get(Ue),/chat\.openai\.com/.test(t.url||"")?await q.default.tabs.reload(t.id):t=await q.default.tabs.update(t.id,{url:ve.openaiChat})}catch{}t||(t=await Og()),t||(t=await Rg());let e=t?.id||0;await new Promise(r=>{let o=(n,a)=>{switch(n.type){case"loaded":a.tab?.id==e&&q.default.tabs.sendMessage(e,{type:"guard-session-activate"});break;case"guard-session-activated":q.default.runtime.onMessage.removeListener(o),r();break;case"guard-session-logout":throw Error("")}};q.default.runtime.onMessage.addListener(o),setTimeout(()=>r(),1e3*40)})}async function fe({onRefresh:t,throwGuideError:e,isForce:r}={}){if(!r&&bt.get(pi)!==!0&&bt.get(Do))return bt.get(Do);let n=await(await ge(ve.openaiApiSession,{},{onRefresh:t,throwGuideError:e})).json().catch(()=>({}));return bt.set(Do,n.accessToken),n.accessToken}async function Lg(t,e,r){let o=q.default.tabs.connect(t,{name:"guard-proxy"}),n=null,a=null,i=new Promise((u,g)=>{n=u,a=g}),s;o.onDisconnect.addListener(()=>{a(new Error("proxy fetch aborted")),s?.close()}),r?.signal?.addEventListener("abort",()=>{s?.close(),o.disconnect()});let p={type:"guard-proxy-request",key:Date.now()+"",url:e,options:r};o.postMessage(p);let c=new ReadableStream({start(u){s=u},cancel(){o.disconnect()}}),f=setTimeout(()=>a(new Error("connect timeout")),1e3*1),l=u=>{switch(u.type){case"guard-proxy-request-received":clearTimeout(f);break;case"guard-proxy-response":n(new Response(c,u.options));break;case"guard-proxy-response-chunk":s.enqueue(new TextEncoder().encode(u.value)),u.done&&(s.close(),o.onMessage.removeListener(l),o.disconnect());break;case"guard-proxy-response-error":o.onMessage.removeListener(l),o.disconnect(),a(new Error(u.error)),s.close();break}};return o.onMessage.addListener(l),await i}async function ge(t,e,r){let o=null;try{o=await fetch(t,e)}catch{}if(!o)throw new Error(Sr);if(o.status===401)throw new Error("");if(o.status==403){if(bt.set(pi,!0),bt.set(Cg,!0),!Er&&r?.throwGuideError)throw Error(`${Je}: error_chatgpt_session_timeout`);r?.onRefresh?.(),await Mg(),o=await Lg(Ue,t,e)}return o}var Gt=M(j());function ui(){Ng("NEW","#F00","#FFF")}function Ng(t,e,r){Gt.default.action.setBadgeBackgroundColor({color:e}),Gt.default.action.setBadgeText({text:t}),r&&Gt.default.action.setBadgeTextColor({color:r})}function jo(){return Gt.default.action.setBadgeText({text:""})}var Dg=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,jg=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Ug=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function Gg(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){return}return e}function fi(t,e={}){if(typeof t!="string")return t;let r=t.trim();if(t[0]==='"'&&t[t.length-1]==='"')return r.slice(1,-1);if(r.length<=9){let o=r.toLowerCase();if(o==="true")return!0;if(o==="false")return!1;if(o==="undefined")return;if(o==="null")return null;if(o==="nan")return Number.NaN;if(o==="infinity")return Number.POSITIVE_INFINITY;if(o==="-infinity")return Number.NEGATIVE_INFINITY}if(!Ug.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Dg.test(t)||jg.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Gg)}return JSON.parse(t)}catch(o){if(e.strict)throw o;return t}}var TI=String.fromCharCode;var Bg=/#/g,Fg=/&/g;var qg=/=/g;var Fo=/\+/g,$g=/%5e/gi,Wg=/%60/gi;var Vg=/%7c/gi;var Kg=/%20/gi;function Hg(t){return encodeURI(""+t).replace(Vg,"|")}function Go(t){return Hg(typeof t=="string"?t:JSON.stringify(t)).replace(Fo,"%2B").replace(Kg,"+").replace(Bg,"%23").replace(Fg,"%26").replace(Wg,"`").replace($g,"^")}function Uo(t){return Go(t).replace(qg,"%3D")}function di(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function zg(t){return di(t.replace(Fo," "))}function Jg(t){return di(t.replace(Fo," "))}function Qg(t=""){let e={};t[0]==="?"&&(t=t.slice(1));for(let r of t.split("&")){let o=r.match(/([^=]+)=?(.*)/)||[];if(o.length<2)continue;let n=zg(o[1]);if(n==="__proto__"||n==="constructor")continue;let a=Jg(o[2]||"");e[n]===void 0?e[n]=a:Array.isArray(e[n])?e[n].push(a):e[n]=[e[n],a]}return e}function Yg(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(r=>`${Uo(t)}=${Go(r)}`).join("&"):`${Uo(t)}=${Go(e)}`:Uo(t)}function Xg(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>Yg(e,t[e])).filter(Boolean).join("&")}var Zg=/^\w{2,}:([/\\]{1,2})/,eh=/^\w{2,}:([/\\]{2})?/,th=/^([/\\]\s*){2,}[^/\\]/;function gi(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?Zg.test(t):eh.test(t)||(e.acceptRelative?th.test(t):!1)}var rh=/\/$|\/\?/;function Bo(t="",e=!1){return e?rh.test(t):t.endsWith("/")}function oh(t="",e=!1){if(!e)return(Bo(t)?t.slice(0,-1):t)||"/";if(!Bo(t,!0))return t||"/";let[r,...o]=t.split("?");return(r.slice(0,-1)||"/")+(o.length>0?`?${o.join("?")}`:"")}function nh(t="",e=!1){if(!e)return t.endsWith("/")?t:t+"/";if(Bo(t,!0))return t||"/";let[r,...o]=t.split("?");return r+"/"+(o.length>0?`?${o.join("?")}`:"")}function hi(t,e){if(ah(e)||gi(t))return t;let r=oh(e);return t.startsWith(r)?t:ch(r,t)}function yi(t,e){let r=bi(t),o={...Qg(r.search),...e};return r.search=Xg(o),ph(r)}function ah(t){return!t||t==="/"}function sh(t){return t&&t!=="/"}var ih=/^\.?\//;function ch(t,...e){let r=t||"";for(let o of e.filter(n=>sh(n)))if(r){let n=o.replace(ih,"");r=nh(r)+n}else r=o;return r}function bi(t="",e){if(!gi(t,{acceptRelative:!0}))return e?bi(e+t):mi(t);let[r="",o,n=""]=(t.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[a="",i=""]=(n.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:s,search:p,hash:c}=mi(i.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r,auth:o?o.slice(0,Math.max(0,o.length-1)):"",host:a,pathname:s,search:p,hash:c}}function mi(t=""){let[e="",r="",o=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:r,hash:o}}function ph(t){let e=t.pathname+(t.search?(t.search.startsWith("?")?"":"?")+t.search:"")+t.hash;return t.protocol?t.protocol+"//"+(t.auth?t.auth+"@":"")+t.host+e:e}var qo=class extends Error{constructor(){super(...arguments),this.name="FetchError"}};function lh(t,e,r){let o="";e&&(o=e.message),t&&r?o=`${o} (${r.status} ${r.statusText} (${t.toString()}))`:t&&(o=`${o} (${t.toString()})`);let n=new qo(o);return Object.defineProperty(n,"request",{get(){return t}}),Object.defineProperty(n,"response",{get(){return r}}),Object.defineProperty(n,"data",{get(){return r&&r._data}}),Object.defineProperty(n,"status",{get(){return r&&r.status}}),Object.defineProperty(n,"statusText",{get(){return r&&r.statusText}}),Object.defineProperty(n,"statusCode",{get(){return r&&r.status}}),Object.defineProperty(n,"statusMessage",{get(){return r&&r.statusText}}),n}var uh=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function xi(t="GET"){return uh.has(t.toUpperCase())}function fh(t){if(t===void 0)return!1;let e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}var mh=new Set(["image/svg","application/xml","application/xhtml","application/html"]),dh=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function gh(t=""){if(!t)return"json";let e=t.split(";").shift()||"";return dh.test(e)?"json":mh.has(e)||e.startsWith("text/")?"text":"blob"}function hh(t,e,r=globalThis.Headers){let o={...e,...t};if(e?.params&&t?.params&&(o.params={...e?.params,...t?.params}),e?.query&&t?.query&&(o.query={...e?.query,...t?.query}),e?.headers&&t?.headers){o.headers=new r(e?.headers||{});for(let[n,a]of new r(t?.headers||{}))o.headers.set(n,a)}return o}var yh=new Set([408,409,425,429,500,502,503,504]);function $o(t){let{fetch:e,Headers:r}=t;function o(i){let s=i.error&&i.error.name==="AbortError"||!1;if(i.options.retry!==!1&&!s){let c;typeof i.options.retry=="number"?c=i.options.retry:c=xi(i.options.method)?0:1;let f=i.response&&i.response.status||500;if(c>0&&yh.has(f))return n(i.request,{...i.options,retry:c-1})}let p=lh(i.request,i.error,i.response);throw Error.captureStackTrace&&Error.captureStackTrace(p,n),p}let n=async function(s,p={}){let c={request:s,options:hh(p,t.defaults,r),response:void 0,error:void 0};c.options.onRequest&&await c.options.onRequest(c),typeof c.request=="string"&&(c.options.baseURL&&(c.request=hi(c.request,c.options.baseURL)),(c.options.query||c.options.params)&&(c.request=yi(c.request,{...c.options.params,...c.options.query})),c.options.body&&xi(c.options.method)&&fh(c.options.body)&&(c.options.body=typeof c.options.body=="string"?c.options.body:JSON.stringify(c.options.body),c.options.headers=new r(c.options.headers||{}),c.options.headers.has("content-type")||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")));try{c.response=await e(c.request,c.options)}catch(l){return c.error=l,c.options.onRequestError&&await c.options.onRequestError(c),await o(c)}let f=(c.options.parseResponse?"json":c.options.responseType)||gh(c.response.headers.get("content-type")||"");if(f==="json"){let l=await c.response.text(),m=c.options.parseResponse||fi;c.response._data=m(l)}else f==="stream"?c.response._data=c.response.body:c.response._data=await c.response[f]();return c.options.onResponse&&await c.options.onResponse(c),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await c.options.onResponseError(c),await o(c)):c.response},a=async function(s,p){return(await n(s,p))._data};return a.raw=n,a.native=e,a.create=(i={})=>$o({...t,defaults:{...t.defaults,...i}}),a}var _i=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),bh=_i.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),xh=_i.Headers,Qe=$o({fetch:bh,Headers:xh});var ce=class{constructor(){this.abortMap={}}sendChat(e){return this.option=e,this._sendChat(e)}async abortChat(e){this.abortMap[e]?.abort?.(),delete this.abortMap[e]}sendAnswering(e={}){this.option.onEvent({type:"chat-answering",data:{conversation_id:this.conversation_id,message_id:this.message_id,originId:this.option.originId,text:this.text,...e}})}sendAnswerEnd(e={}){this.option.onEvent({type:"chat-answer-end",data:{conversation_id:this.conversation_id,message_id:this.message_id,originId:this.option.originId,...e}})}sendAnswerErr(e){this.option.onEvent({type:"chat-answer-error",data:{originId:this.option.originId,text:ft(e.error?.msg)&&e.error.msg||ft(e.error)&&e.error||e.error?.toString?.()||e.error||"unknown error",position:e?.position??e.error?.position??"unknown",...e,error:yt(e.error)}})}};var Y=class extends Error{constructor(r,o,n,a){super(r,a);this.message=r;this.code=o;this.position=n}};function wi(t,e){return new RegExp(`"${t}":"([^"]+)"`).exec(e)?.[1]}async function vi(){let t=await Qe("https://bard.google.com/faq"),e=wi("SNlM0e",t),r=wi("cfb2h",t);return{atValue:e,blValue:r}}function Ti(t){let e=JSON.parse(t.split(`
`)[3]),r=JSON.parse(e[0][2]);if(!r)throw new Y("Bard is not available.","no access","bard-token");return{text:r[0][0],ids:[...r[1],r[4][0][0]]}}function _h(){return Math.floor(Math.random()*9e5)+1e5}var Bt=class extends ce{async _sendChat(e){let r=e.parent_message_id?JSON.parse(e.parent_message_id):["","",""],o=e.conversation_id?JSON.parse(e.conversation_id):await vi();this.conversation_id=JSON.stringify(o),this.message_id="";let n=new AbortController;this.abortMap[e.originId]=n;let a=await Qe("https://bard.google.com/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",{method:"POST",signal:n.signal,query:{bl:o.blValue,_reqid:_h(),rt:"c"},body:new URLSearchParams({at:o.atValue,"f.req":JSON.stringify([null,`[[${JSON.stringify(e.content)}],null,${JSON.stringify(r)}]`])}),parseResponse:i=>i}).catch(i=>{this.sendAnswerErr({error:i,code:"api error",position:i?.position??"bard"})});try{let{text:i,ids:s}=Ti(a);this.message_id=JSON.stringify(s),this.text=i,this.sendAnswering(),this.sendAnswerEnd()}catch(i){this.sendAnswerErr({error:i,code:i?.code||"system error",position:i?.position??"bard-parser message"})}}};var cl=M(nl());function vb(){return`13.${Mt(104,107)}.${Mt(0,255)}.${Mt(0,255)}`}var Sn="https://www.bing.com/turing/conversation/create";async function al(){let t={"x-ms-client-request-id":ee(),"x-ms-useragent":"azsdk-js-api-client-factory/1.0.0-beta.1 core-rest-pipeline/1.10.0 OS/Win32"},e;try{if(e=await Qe(Sn,{headers:t,redirect:"error"}),!e.result)throw new Y("Invalid response","api error","bing-token")}catch{if(e=await Qe(Sn,{headers:{...t,"x-forwarded-for":vb()},redirect:"error"}),!e)throw new Y(`Failed to fetch (${Sn})`,"api error","bing-token retry create")}if(e.result.value!=="Success"){let r=`${e.result.value}: ${e.result.message}`;throw e.result.value==="UnauthorizedRequest"?new Y(r,"no access","bing-token"):e.result.value==="Forbidden"?new Y(r,"no access","bing-token"):new Error(r)}return e}function il(t){if(t.messageType==="InternalSearchQuery")return t.text;for(let e of t.adaptiveCards)for(let r of e.body)if(r.type==="TextBlock")return r.text;return""}var sl=String.fromCharCode(30),En={packMessage(t){return`${JSON.stringify(t)}${sl}`},unpackMessage(t){return t.toString().split(sl).filter(Boolean).map(e=>JSON.parse(e))}};var Tb={balanced:"harmonyv3",creative:"h3imaginative",precise:"h3precise"},Ht=class extends ce{buildChatRequest(r,o){return{arguments:[{source:"cib",optionsSets:["deepleo","nlu_direct_response_filter","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","dtappid","rai253","dv3sugg",Tb[r.conversationStyle]],allowedMessageTypes:["Chat","InternalSearchQuery"],isStartOfSession:r.invocationId===0,message:{author:"user",inputMethod:"Keyboard",text:o,messageType:"Chat"},conversationId:r.conversationId,conversationSignature:r.conversationSignature,participant:{id:r.clientId}}],invocationId:r.invocationId.toString(),target:"chat",type:4}}async _sendChat(r){let o=r.originId;this.message_id="",this.conversation_id=r.conversation_id||"";let n=this.conversation_id&&JSON.parse(this.conversation_id);if(!n){let[i]=await Promise.all([al()]);n={conversationId:i.conversationId,conversationSignature:i.conversationSignature,clientId:i.clientId,invocationId:0,conversationStyle:"balanced"},this.conversation_id=JSON.stringify(n)}let a=new cl.default("wss://sydney.bing.com/sydney/ChatHub",{packMessage:En.packMessage,unpackMessage:En.unpackMessage});this.wsp=a,a.onUnpackedMessage.addListener(i=>{for(let s of i)if(JSON.stringify(s)==="{}")a.sendPacked({type:6}),a.sendPacked(this.buildChatRequest(n,r.content)),n.invocationId+=1,this.conversation_id=JSON.stringify(n);else if(s.type===6)a.sendPacked({type:6});else if(s.type===3)this.sendAnswerEnd(),a.removeAllListeners(),a.close();else if(s.type===1){let p=s.arguments[0].messages?.[0];if(!p)return;let c=il(p);this.text=c,this.sendAnswering()}else if(s.type===2){let p=s.item.messages;p?p.some(f=>f.contentOrigin==="TurnLimiter")&&this.sendAnswerErr({text:"Sorry, you have reached chat turns limit in this conversation.",code:"custom error",error:s.item,position:"bing"}):s.item.result?this.sendAnswerErr({error:JSON.stringify(s.item.result),code:"api error",position:"bing"}):this.sendAnswerErr({error:JSON.stringify(s.item),code:"api error",position:"bing"})}}),a.onClose.addListener(()=>{this.sendAnswerEnd()}),await a.open(),a.sendPacked({protocol:"json",version:1})}async abortChat(r){this.wsp.removeAllListeners(),this.wsp.close()}};var pl=M(Ar());var ll={changeConversation:async(t,e)=>ge(`https://chat.openai.com/backend-api/conversation/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await fe()}`},body:JSON.stringify(e)}).then(r=>r.json()),deleteConversation:t=>ll.changeConversation(t,{is_visible:!1}),getConversations:async()=>ge("https://chat.openai.com/backend-api/conversations",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await fe()}`}}).then(t=>t.json()),getModels:async()=>ge("https://chat.openai.com/backend-api/models",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await fe()}`}}).then(t=>t.json())};var cE=new pl.default(10*1e3);var Hr=ll;var Pt=class extends ce{async _sendChat(e){let r=e.model||"text-davinci-002-render",o=e.parent_message_id||ee(),n=ee();this.conversation_id=e.conversation_id||"",this.message_id="";let a=e.originId;if(e.TTL=e.TTL??2,!e.TTL--){let l="Too many loop sending times, please resend"}let i=!e.conversation_id,s=!1,p="";try{p=await fe()}catch(l){this.sendAnswerErr({error:l,code:l?.code||"system error",position:l?.position??"chatGPT-token"});return}let c=!1,f=new AbortController;this.abortMap[e.originId]=f,await je("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:f.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({action:"next",messages:[...e.messages?e.messages?.map?.(l=>({id:ee(),role:l.role,content:{content_type:"text",parts:[l.message]}})):[],{id:n,role:"user",content:{content_type:"text",parts:[e.content]}}],model:r,parent_message_id:o,plugin_ids:e.plugin_ids}),onMessage:l=>{if(c){try{this.abortChat(a)}catch{}return}if(l==="[DONE]"){c=!0,this.sendAnswerEnd({conversation_id:""}),Hr.deleteConversation(this.conversation_id);return}let m;try{m=JSON.parse(l)}catch{return}let u=m.message?.content?.parts?.[0];m.message?.author?.role=="assistant"&&(u&&s&&(this.conversation_id=m.conversation_id,this.message_id=m.message.id,this.text=u,this.sendAnswering({conversation_id:""})),u==""&&(s=!0))}},!0).catch(async l=>{this.sendAnswerErr({error:l,code:l?.code||"api error",position:l?.position??"chatGPT"})})}};async function zr(t,e){let{onMessage:r,...o}=e,n=await fetch(t,o);if(!n.ok){let i=await n.json().catch(()=>({}));throw new Error(Ve(i)?`${n.status} ${n.statusText}`:JSON.stringify(i),{cause:i})}let a=mt(i=>{i.type==="event"&&r(i.data)});for await(let i of dt(n.body)){let s=new TextDecoder().decode(i);a.feed(s)}}var zt=class extends ce{constructor(r){super();this.config=r.configs.gpt3}async _sendChat(r){let o=r.model||this.config.model||"gpt-3.5-turbo",n=r.originId;this.conversation_id=r.conversation_id||"",this.message_id="";let a=o==="gpt-3.5-turbo",i="",s=Ne(this.config.enableCustomURL&&this.config.customURL?this.config.customURL:"https://api.openai.com","/v1/chat/completions"),p={model:o,stream:!0};p.messages=[...r.messages?r.messages?.map?.(f=>({role:f.role,content:f.message})):[],{role:"user",content:r.content}];let c=new AbortController;this.abortMap[r.originId]=c,await zr(s,{method:"POST",signal:c.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify(p),onMessage:f=>{if(f==="[DONE]"){this.sendAnswerEnd({conversation_id:""});return}let l;try{l=JSON.parse(f);let m=l.choices[0].delta.content;if(m==="<|im_end|>"||m==="<|im_sep|>"||!m)return;this.conversation_id=l.id,this.message_id=l.id,i+=m,this.text=i,this.sendAnswering({conversation_id:""})}catch(m){this.sendAnswerErr({error:new Y(m.message,"system error","openai-message parse"),code:"system error",position:"openai-parser message"});return}}}).catch(f=>{this.sendAnswerErr({error:f,code:f?.code||"api error",position:f?.position??"openai"})})}};var Jt=class extends ce{constructor(r){super();this.loginCount=0;this.config=r.configs.gpt3}async _sendChat(r){let o="";this.conversation_id=r.conversation_id,this.message_id="";let n=(await G({[He]:{model:"gpt-3.5"}}))[He].model??"gpt-3.5",a={};if(r.messages?.length&&!r.conversation_id)try{let s=await L(`${U.api}/v1/conversation/upload`,{app_name:D,app_version:Le,tz_name:se,messages:r.messages.map(p=>({role:p.role,content:p.message})),...this.conversation_id?{cid:this.conversation_id}:{}});this.conversation_id=s?.cid??this.conversation_id}catch(s){throw this.sendAnswerErr({error:s,code:s?.code||"api error",position:s?.position??"sider-create cid"}),s}let i=new AbortController;this.abortMap[r.originId]=i,await zr(`${U.api}/v1/completion/text`,{method:"POST",signal:i.signal,headers:{"Content-Type":"application/json",Authorization:(await ze()).token},body:JSON.stringify({prompt:r.content,stream:!0,tz_name:se,app_name:D,app_version:Le,model:n.replace(/-/g,""),...this.conversation_id?{cid:this.conversation_id}:{}}),onMessage:s=>{if(s=="[DONE]"){this.sendAnswerEnd({otherData:a});return}let p=JSON.parse(s);if(p.code!==0)throw new Y(p?.msg||s,"api error","sider",{cause:p});this.conversation_id=p.data.cid,this.message_id=p.data.message_id,ae({[n]:{total:p.data.total,remain:p.data.remain,extraRemain:p.data.extra_quota,extraTotal:p.data.extra_total,period:p.data.remain_period}}),a=p.data;let c=p.data.text;c&&(o+=c,this.text=o,this.sendAnswering({otherData:a}))}}).catch(s=>{throw this.sendAnswerErr({error:s,code:s?.code||"api error",position:s?.position??"sider"}),new Error(s)})}};async function ul(t,e){let r,o=await hr(),n=!1;switch(e.target){case"openai":case"chatGPT":{n=!0,o.provider==="chatgpt"&&(r=new Pt),o.provider==="gpt3"&&(r=new zt(o)),o.provider==="siderApi"&&(r=new Jt(o));break}case"bard":{r=new Bt;break}case"bing":{r=new Ht;break}default:r=new Pt}r.sendChat({...e,onEvent(a){t.postMessage({type:a.type,data:{...a?.data??{},sendType:n?o.provider:e.target}})}}).catch(a=>{let i={originId:e.originId,sendType:n?o.provider:e.target,error:yt(a)};a instanceof Y?t.postMessage({type:"chat-answer-error",data:{text:a.message,code:a.code||"system error",position:"base-"+a.position,...i}}):a?.msg?t.postMessage({type:"chat-answer-error",data:{text:a.msg,code:"api error",position:"base",...i}}):t.postMessage({type:"chat-answer-error",data:{text:ft(a)?a:a?.toString?.()||a,code:"system error",position:"base",...i}})}),t.onDisconnect.addListener(()=>{r.abortChat(e.originId)})}var Qt=M(j());var fl="ocr_result_fullscreen",ml="ocr_result_fullscreen_opened",Cn="do_ocr";async function Rn(t){Qt.default.runtime.sendMessage({type:"is-sidepanel-open"}).then(async r=>{r?Qt.default.runtime.sendMessage({type:Cn,data:{img:t,isForSidepanel:!0}}):e()}).catch(e);async function e(){if(await Is()){let o=await we();o?.id&&Qt.default.tabs.sendMessage(o.id,{type:Cn,data:{img:t}});return}Ke({url:"fullscreen.html?type=ocr"}),await xr(100),await Ps(ml);let r=await we();r?.id&&Qt.default.tabs.sendMessage(r.id,{type:fl,data:{img:t}})}}var hl=M(j());function yl(){hl.default.storage.local.onChanged.addListener(t=>{if(t.__DONT_SYNC__?.newValue)return;let e=Object.keys(t).filter(r=>r in br);e.length&&Pb(e)})}var bl=async t=>{if(!await Ae())return;await xl();let r=await te(t);r["provider:gpt3"]&&(r["provider:gpt3"].apiKey=""),dl(r,"translatorHostConfig"),dl(r,"quickActionInputIconDisabledHost"),"promptTemplates"in r&&(r.promptTemplates=r.promptTemplates.map(o=>({uid:o.uid||"",id:o.id}))),P.setUserSettings(r)},On=new Map,Pb=t=>{let e=t.sort().toString();On.has(e)||On.set(e,F(bl,2e3)),On.get(e)?.(t)},xl=async()=>{let{promptTemplates:t,allPromptList:e,sidebarPromptTemplate:r}=await te(["promptTemplates","allPromptList","sidebarPromptTemplate"]),o=!1;t&&(await Promise.all(t.map(async n=>{if(n.canEdit&&!n.uid){o=!0;let a=await P.createUserPrompt({type:"search",name:n.title,content:n.template});n.uid=a.id}})),o&&await R({__DONT_SYNC__:`unsavedSearchTpl${Date.now()}`,promptTemplates:t})),o=!1,e&&(await Promise.all(e.map(async n=>{if(!n.id){o=!0;let a=await P.createPrompt({key:n.key,name:n.name,content:n.content,use:n.usedIn});if(n.id=String(a.id),r){let i=r.find(({key:s})=>s===n.key);i&&(i.uid=a.id)}}})),o&&await R({__DONT_SYNC__:`unsavedSidebarTpl${Date.now()}`,allPromptList:e,sidebarPromptTemplate:r}))},Jr=F(async()=>{await Ae()&&(await xl(),await Ib(),await Sb())},1e3),Mn=null;async function Ib(){let t=Object.keys(br),e={...await P.getUserSettings()||{}};if(!e||!Object.keys(e).length){await bl(t);return}let r={};for(let a of Object.keys(e))a in br||(e[a]!==null&&(r[a]=null),delete e[a]);Object.keys(r).length&&P.setUserSettings(r);let o=await te(t),n;o["provider:gpt3"]&&(n=o["provider:gpt3"].apiKey),gl(e,"translatorHostConfig"),gl(e,"quickActionInputIconDisabledHost"),"promptTemplates"in o&&delete o.promptTemplates,"promptTemplates"in e&&(Mn=e.promptTemplates,delete e.promptTemplates),["chatVisiblePromptKeys","readVisiblePromptKeys","writeVisiblePromptKeys"].forEach(a=>{delete e[a]}),Ot(o,e,{"provider:gpt3":{apiKey:n}},(a,i)=>{if(Array.isArray(a))return i}),await R({__DONT_SYNC__:`pullFromCloud${Date.now()}`,...o})}async function Sb(){let t=await te("promptTemplates")||[],e=Mn?.length?[...Mn]:t,r=e.reduce((n,a)=>{if(n[a.uid||a.id]=a,a.uid||a.id.startsWith("search"))Object.assign(a,{canEdit:!0});else{let i=t.find(s=>s.id===a.id);Object.assign(a,i)}return n},{}),o=await P.getUserPromptList("search");if(o?.List?.length){for(let n of o.List)r[n.id]?Object.assign(r[n.id],{uid:n.id,title:n.name,template:n.content,canEdit:!0}):e.unshift({id:n.id,uid:n.id,title:n.name,template:n.content,canEdit:!0});await R({__DONT_SYNC__:`pullSearchTpl${Date.now()}`,promptTemplates:e.filter(n=>n.title)})}}function dl(t,e){let r=[];if(t[e]&&typeof t[e]=="object"){for(let[o,n]of Object.entries(t[e]))r.push({__key__:o,...n||{}});t[e]=r}}function gl(t,e){let r={};if(Array.isArray(t[e])){for(let o of t[e])r[o.__key__]=o,delete o.__key__;t[e]=r}}function _l(){po("logged",t=>{Ln(t.logged?.newValue)}),po(["logged","language"],t=>{P.getAllPromptList()})}var Ln=F(t=>{t?Eb():kb()},3e3,{leading:!0}),Eb=()=>{P.getUserInfo(),P.getVipInfo(),Jr(),Nn()},kb=()=>{Oe("userInfo"),P.getVipInfo()},Nn=Te(async()=>{let{__invited_reward_finish__:t}=await G({__invited_reward_finish__:!1});if(t)return;if(await Ae()){let r=await P.inviteFinish();r.is_invited&&r.is_rewarded&&(R({userIsInvited:!0,inviteRewardConfig:{"gpt3.5":r.reward.GPT3Dot5Count,gpt4:r.reward.GPT4Count}}),r.already_rewarded||R({__show_invited_reward__:!0})),R({__invited_reward_finish__:!0})}},1e4),Cb=Te(async()=>{let{__LAST_REFRESH_DISPLAY_DATA__:t}=await G({__LAST_REFRESH_DISPLAY_DATA__:0});if(Date.now()-t<6e4)return;let e=await Ae();P.getVipInfo(),e&&P.getInviteRewardCount(),R({__LAST_REFRESH_DISPLAY_DATA__:Date.now()})},6e4),wl=F(Cb,2e3,{leading:!0});async function Dn(){let t=await Ae();Ln(!!t),P.getPricingPlan(),P.getAllPromptList()}var jn=M(j());async function Un(){let t=await te("language");if(t&&t!=="auto")return;let e=navigator.languages;for(let r of e){r=r.replace("-","_");let o=r.split("_");o[0]=o[0].toLowerCase(),o[1]&&(o[1]=o[1].toUpperCase()),r=o.join("_");let n="";if(r in _o?n=r:n=Object.keys(_o).find(a=>o[0]===a.split("_")[0])||"",n){await jn.default.storage.local.set({__DONT_SYNC__:`language${Date.now()}`,language:n});return}}jn.default.storage.local.set({__DONT_SYNC__:`language${Date.now()}`,language:"en"})}var vl=M(j());async function Tl(){let t={},e=["p","p1","p2"],r=Me?`https://*.microsoft.com/*${bo}*`:`https://*.google.com/*${bo}*`,o=await vl.default.tabs.query({url:r,currentWindow:!0});if(o.length){o.reverse();for(let n of o){let a=n.url||U.origin,{searchParams:i}=new URL(a),s=!1;for(let[p,c]of i.entries())e.includes(p)&&c&&(s=!0,t[p]=c);if(s)break}}if(Object.keys(t).length>0)for(let[n,a]of Object.entries(t))await fo(n==="p"?"source":n,a,7);else for(let n of e){let a=await dr(n==="p"?"source":n);a&&(t[n]=a)}Object.keys(t).length&&(P.adStat({action:"install-sider-successfully",source:t.p||"",p1:t.p1||"",p2:t.p2||""}),await R({installByAD:!0}))}var Al=M(j());var Rb="OpenAI";async function Ob(t,e){let r=await Al.default.storage.local.get("provider:gpt3"),{apiKey:o,enableCustomURL:n,customURL:a}=r["provider:gpt3"];if(o){let i=n&&a?_r(a):Mb;return fetch(i+e,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r["provider:gpt3"].apiKey}`}}).then(s=>s.json())}else return!1}async function Pl(){return Ob("GET","/v1/models")}var Mb="https://api.openai.com",Qr=class{constructor(e,r,o){this.token=e;this.model=r;this.url=o;this.token=e,this.model=r,this.url=o}async generateAnswer(e){let r="",o=Ne(this.url?this.url:"https://api.openai.com","/v1","/chat/completions"),n={model:this.model,stream:!0};Array.isArray(e.prompt)?n.messages=e.prompt:n.messages=[{role:"user",content:e.prompt}],await je(o,{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(n),onMessage(a){if(a==="[DONE]"){e.onEvent({type:"done"});return}let i;try{i=JSON.parse(a);let s=i.choices[0].delta.content;if(i.choices[0].finish_reason==="stop"){e.onEvent({type:"done"});return}if(s==="<|im_end|>"||s==="<|im_sep|>"||!s)return;r+=s,e.onEvent({type:"answer",data:{text:r,messageId:i.id,conversationId:""}})}catch{return}}}).catch(a=>{let i=a.message;try{let s=JSON.parse(i);i=s.message||s.msg||s.error?.message||s.detail?.message||i}catch{}throw new Error(`${Rb}: ${i}`)})}};var Lb=M(j());var Yr=class{constructor(){this.queue=[];this.isRunning=!1}async run(e){if(this.queue.push(e),!this.isRunning){for(this.isRunning=!0;this.queue.length;){let r=this.queue.shift();r&&await r()}this.isRunning=!1}}};var zk=F(ae,2e3,{leading:!0}),Xr=class{constructor(e){this.token="";this.refreshToken="";this.anonymous=!0;this.cid=e}async getToken(){let e=await ze();this.token=e.token,this.refreshToken=e.refreshToken,this.anonymous=e.anonymous}async generateAnswer(e){let r={};try{await this.getToken()}catch(l){throw new Error(l.errMsg)}if(!this.cid&&e.historyMsg)try{this.cid=await P.uploadHistoryMsg(e.historyMsg)}catch(l){throw new Error(l.errMsg)}let{[He]:{model:o}}=await G({[He]:{model:"gpt-3.5"}}),n=e.model||o,a="",i="",s=!1;function p(){!s&&a&&i&&P.statUserStop(a,i)}e.getCleanupMethod?.(p);let c=async(l,m,u)=>{try{return await je(l,{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json",Authorization:this.token},body:JSON.stringify(m),onMessage(g){if(g=="[DONE]"){s=!0,e.onEvent({type:"done"});return}let _=JSON.parse(g);if(_.code!==0)throw new Error(JSON.stringify({code:_.code,msg:_.msg||_.message}));a=_.data.cid,i=_.data.message_id,u(_.data)}})}catch(g){let _=g.message,d=null;try{d=JSON.parse(_)}catch{}jt(d?.code,d?.msg||d?.message||_)}},f=new Yr;await c(`${U.api}/v1/completion/text`,{prompt:e.prompt,stream:!0,app_name:D,app_version:Le,tz_name:se,cid:this.cid,model:n,search:e.forceSearch,auto_search:e.autoSearch,filter_search_history:e.filterSearchHistory,from:e.from,prompt_key:e.promptKey,chat_models:e.chatModels,image_id:e.imageId,force_ocr:e.forceOcr},l=>{if(!l)return;if(typeof l.total<"u"){let g=l.chat_model?l.chat_model:n;l.use_image_chat?g="image-creator":g==="claude-instant"||g==="bard"?g="gpt-3.5":g==="claude2"&&(g="gpt-4");let _={[g]:{total:l.total,remain:l.remain,extraTotal:l.extra_total,extraRemain:l.extra_quota,period:l.remain_period}};Po().then(d=>{let b=d[g];(b.remain!==_[g].remain||b.extraRemain!==_[g].extraRemain||b.period!==_[g].period||b.extraTotal!==_[g].extraTotal||b.total!==_[g].total||b.period!==_[g].period)&&b.remain+b.extraRemain>_[g].remain+_[g].extraRemain&&f.run(()=>ae(_))})}let m=l.text;if(m&&(r[l.chat_model]||(r[l.chat_model]=""),r[l.chat_model]+=m,e.onEvent({type:"answer",data:{text:r[l.chat_model],messageId:"",conversationId:l.cid,chatModel:l.chat_model}})),l.code&&l.code!==0){let g=ht[l.code]||l.msg;if(l.code===1129||l.code===1130){let _=l.msg.match(/restriction of (.*) messages/),d=l.msg.match(/messages every (.*) minute[s]?\. Alternatively/);g=ht[l.code]+"-"+_[1]+"-"+d[1]}e.onEvent({type:"error",data:{error:g,chatModel:l.chat_model||n}})}l.done&&e.onEvent({type:"done",data:{chatModel:l.chat_model||n,done:!0}});let u=l.search_keywords||"";u&&e.onEvent({type:"searchKeywords",data:{searchKeywords:u,searchSnippets:l.search_snippets,chatModel:l.chat_model}})})}};var Il=M(j());var me=18e4;async function Sl({prompt:t,width:e,height:r,cid:o,samples:n,style:a,engine:i,negativePrompt:s,cfgScale:p,clipGuidance:c,sampler:f,seed:l,steps:m}){return ue(J("/v1/image/text-to-image",{prompt:t,cid:o,engine:i,height:r,width:e,style:a,samples:n,negative_prompt:s,cfg_scale:p===void 0?void 0:p.toString(),clip_guidance:c,sampler:f,seed:l,steps:m},{method:"POST"},{timeout:me}))}async function El({prompt:t,cid:e,samples:r,style:o,engine:n,imageUrl:a,imageStrength:i,cfgScale:s,clipGuidance:p,negativePrompt:c,sampler:f,seed:l,steps:m}){let u=new FormData;return u.append("prompt",t),u.append("init_image",await fetch(a).then(g=>g.blob())),r!==void 0&&u.append("samples",String(r)),e&&u.append("cid",e),n&&u.append("engine",n),o&&u.append("style",o),i!==void 0&&u.append("image_strength",String(i)),s!==void 0&&u.append("cfg_scale",String(s)),p&&u.append("clip_guidance",p),c&&u.append("negative_prompt",c),f&&u.append("sampler",f),l!==void 0&&u.append("seed",String(l)),m!==void 0&&u.append("steps",String(m)),ue(J("/v1/image/image-to-image",u,{method:"POST"},{timeout:me}))}async function kl({cfgScale:t,cid:e,height:r,prompt:o,seed:n,steps:a,imageUrl:i,width:s}){let p=new FormData;if(s!==void 0)p.append("width",String(s));else{if(r===void 0)throw new Error("width or height must be set");p.append("height",String(r))}return p.append("init_image",await fetch(i).then(c=>c.blob())),t!==void 0&&p.append("cfg_scale",String(t)),e&&p.append("cid",e),o&&p.append("prompt",o),n!==void 0&&p.append("seed",String(n)),a!==void 0&&p.append("steps",String(a)),ue(J("/v1/image/image-to-image/upscale",p,{method:"POST"},{timeout:me}))}async function Cl({maskSource:t,maskImageUrl:e,initImageUrl:r,prompt:o}){let n=new FormData;return ue(J("/v1/image/image-to-image/masking"))}async function Rl({initImageUrl:t,maskImageUrl:e}){let r=new FormData;return r.append("init_image",await fetch(t).then(o=>o.blob())),r.append("mask_image",await fetch(e).then(o=>o.blob())),ue(J("/v1/image/inpainting",r,{method:"POST"},{timeout:me}))}async function Ol({initImageUrl:t}){let e=new FormData;return e.append("init_image",await fetch(t).then(r=>r.blob())),ue(J("/v1/image/remove-text",e,{method:"POST"},{timeout:me}))}async function Ml({initImageUrl:t}){let e=new FormData;return e.append("init_image",await fetch(t).then(r=>r.blob())),ue(J("/v1/image/remove-background",e,{method:"POST"},{timeout:me}))}async function Ll({initImageUrl:t,upscale:e}){let r=new FormData;return r.append("init_image",await fetch(t).then(o=>o.blob())),r.append("upscale",String(e)),ue(J("/v1/image/super-solution",r,{method:"POST"},{timeout:me}))}async function Nl({initImageUrl:t,prompt:e}){let r=new FormData;return r.append("init_image",await fetch(t).then(o=>o.blob())),r.append("prompt",e),ue(J("/v1/image/replace-background",r,{method:"POST"},{timeout:me}))}async function Dl({initImageUrl:t}){let e=new FormData;return e.append("init_image",await fetch(t).then(r=>r.blob())),ue(J("/v1/image/portrait-depth-estimation",e,{method:"POST"},{timeout:me}))}async function jl({initImageUrl:t}){let e=new FormData;return e.append("init_image",await fetch(t).then(r=>r.blob())),ue(J("/v1/image/portrait-surface-normals",e,{method:"POST"},{timeout:me}))}async function Ul({initImageUrl:t,samples:e,engine:r}){let o=new FormData;return o.append("init_image",await fetch(t).then(n=>n.blob())),o.append("samples",String(e)),r&&o.append("engine",r),ue(J("/v1/image/image-to-image/variation",o,{method:"POST"},{timeout:me}))}async function Gl(){let t=await J("/v1/image/sign-cookie",void 0,{method:"POST"},{noAppInfo:!0});return await Bl(t),t}async function Bl(t){let{domain:e,cookies:r}=t;return Promise.all(r.map(({Name:o,Value:n})=>Il.default.cookies.set({url:`https://${e}`,name:o,value:n,expirationDate:Date.now()/1e3+5184e3})))}async function ue(t){if(t=await t,t.remain_period&&ae({"image-creator":{total:t.total,remain:t.remain,extraTotal:t.extra_total,extraRemain:t.extra_quota,period:t.remain_period}}),t.signed_cookie)try{return await Bl(t.signed_cookie),t}catch(e){throw e instanceof Error?new Error(`Failed to set cookie: ${e.message}`,{cause:{data:t}}):new Error("Failed to set cookie: unknown error",{cause:{data:t}})}return t}async function Fl(){return J("/v1/image/load-engines")}async function ql(){return J("/v1/image/load-tools")}var Nb=Te(async()=>{let t=[Jr(),P.getPricingPlan(),P.getAllPromptList()];await Promise.all(t),await R({__SCHEDULE_RUN_AT__:Date.now()})}),$l=F(async()=>{let t=Date.now(),e=1e3*60*60*6,{__SCHEDULE_RUN_AT__:r}=await G({__SCHEDULE_RUN_AT__:0});if(r===0){await R({__SCHEDULE_RUN_AT__:t});return}if(t-r>e)try{await Nb()}catch{}},1e3,{leading:!0});var Yt=M(j());var Wl=F(async t=>{let e=await Yt.default.storage.local.get({promptTemplates:gr}),r=gr.reduce((o,{id:n},a)=>(o[n]=gr[a],o),{});for(let o of e.promptTemplates)o.id in r&&(o.title=t[o.id].title,o.template=t[o.id].template);Yt.default.storage.local.set({__DONT_SYNC__:`searchPromptTPL${Date.now()}`,...e})},200),lC=F(async(t,e)=>{let r=await Yt.default.storage.local.get("sidebarPromptTemplate"),o=!1;if(r.sidebarPromptTemplate||(o=!0,r.sidebarPromptTemplate=yr),!t||!e)return;let n=yr.reduce((a,{key:i},s)=>(a[i]=yr[s],a),{});for(let a of r.sidebarPromptTemplate)a.key in n&&(a.title=t[a.key].title,o||a.changed===!1||a.template.trim()===e[a.key].template.trim()?(a.template=t[a.key].template,a.changed=!1):a.changed=!0);Yt.default.storage.local.set({__DONT_SYNC__:`sidebarPromptTPL${Date.now()}`,...r})},100);_l();yl();w.default.runtime.onStartup.addListener(()=>{Dn()});async function Db(t,{question:e,type:r,cid:o,historyMsg:n,model:a,chatModels:i,pluginIds:s,forceSearch:p,autoSearch:c,filterSearchHistory:f,from:l,promptKey:m,imageId:u,forceOcr:g}){let _=await hr(),d;if(_.provider==="chatgpt"){let I=await fe({onRefresh:()=>t.postMessage({event:"GUARD_TAB_REFRESHING"}),throwGuideError:!0});d=new Ir(I)}else if(_.provider==="gpt3"){let{apiKey:I,enableCustomURL:y,customURL:h,model:x}=_.configs.gpt3,A=y&&h?_r(h):"";d=new Qr(I,x||xo,A)}else if(_.provider==="siderApi")d=new Xr(o);else throw new Error(`Unknown provider ${_.provider}`);let b=()=>{},k=new AbortController;t.onDisconnect.addListener(()=>{k.abort(),b?.()}),await d.generateAnswer({prompt:e,type:r,signal:k.signal,historyMsg:n,pluginIds:s,onEvent(I){if(I.type==="done"){I.data?.chatModel?t.postMessage(I.data):t.postMessage({event:"DONE"});return}t.postMessage(I.data)},getCleanupMethod(I){b=I},forceSearch:p,autoSearch:c,filterSearchHistory:f,from:l,promptKey:m,model:a,chatModels:i,imageId:u,forceOcr:g})}var jb=async t=>{let e=await te("webAppModelsLastUpdateTime"),r=await te("webAppModels");if(t||!r||!e||e-Date.now()>1e3*60*60*24)return si().then(o=>w.default.storage.local.set({webAppModels:o.models,webAppModelsLastUpdateTime:Date.now()}))},Ub=()=>Pl().then(async t=>{if(t.data){let e=t.data.filter(n=>n.id.startsWith("gpt-3.5")||n.id.startsWith("gpt-4")).map(n=>({name:n.id})),r=await te("provider:gpt3"),o={apiModels:e};return r&&r.model&&(e.find(n=>n.name===r.model)||(o["provider:gpt3"]={...r,model:xo})),w.default.storage.local.set(o)}else return t.error?.message||"error"});function Kl(t){ho({target:{tabId:t},files:["content-all.js"]}).catch(e=>{}),ho({target:{tabId:t,allFrames:!0},files:["all-frames.js"]}).catch(e=>{})}w.default.runtime.onConnect.addListener(t=>{t.onMessage.addListener(async e=>{if(e.type=="chat")try{await ul(t,e.data)}catch(r){t.postMessage({type:"chat-answer-error",text:r.toString(),error:r})}else try{await Db(t,{question:e.question,type:e.type,cid:e.cid,historyMsg:e.historyMsg,chatModels:e.chatModels,model:e.model,pluginIds:e.pluginIds,autoSearch:e.autoSearch,forceSearch:e.forceSearch,filterSearchHistory:e.filterSearchHistory,from:e.from,promptKey:e.promptKey,imageId:e.imageId,forceOcr:e.forceOcr})}catch(r){t.postMessage({error:r.message})}})});w.default.runtime.onMessage.addListener(async(t,e)=>{let r=Hs(t,e);if(r)return r;switch(t.type){case"FEEDBACK":{let o=await No();await ai(o,t.data);break}case"OPEN_OPTIONS_PAGE":{go(t.section,t.hash);break}case"GET_ACCESS_TOKEN":return No();case"SEND_CHATGPT":return Tr({prompt:t.promt});case"IS_CHAT_LOGIN":return Ns().then(o=>{e.tab?.id&&w.default.tabs.sendMessage(e.tab.id,{type:"CHAT_LOGIN_STATE",value:o}),w.default.runtime.sendMessage({type:"CHAT_LOGIN_STATE",value:o})});case"POPUP_OPEN":return Xt(t.isShow);case"OPEN_URL_IN_NEW_TAB":return w.default.tabs.create(t.details);case"OPEN_URL":{w.default.tabs.create({url:t.url});break}case"UPDATE_TAB":return As(t.queryInfo,t.updateDetails);case"RELOAD_TAB":return mo(t.queryInfo,!0);case"SWITCH_TAB":return mo(t.queryInfo);case"GET_CHATGPT_MODELS":return jb(t.isForce);case"GET_API_MODELS":return Ub();case"GET_COOKIE":try{let o=await w.default.cookies.get(t.data);return o?.value?decodeURIComponent(o.value):""}catch(o){return Promise.reject(o)}case"SET_COOKIE":try{return await w.default.cookies.set(t.data)}catch(o){return Promise.reject(o)}case"SET_PROMPT_BY_I18N":{if(t.tplType==="search")return Wl(t.translation);break}case"CHECK_SCHEDULE_JOB":{$l();break}case"REFRESH_DISPALY_DATA":{wl();break}case"REFRESH_VIP_INFO":{De(async()=>{if(!(await P.getVipInfo()).isVIP)throw new Error("")},2e3);break}case"FORWARD_TO_CHAT":{w.default.runtime.sendMessage({type:"is-sidepanel-open"}).then(o=>{if(o)return w.default.runtime.sendMessage({...t,type:"SEND_TO_CHAT",isForSidepanel:!0});w.default.tabs.sendMessage(e.tab?.id,{...t,type:"SEND_TO_CHAT"})}).catch(()=>{w.default.tabs.sendMessage(e.tab?.id,{...t,type:"SEND_TO_CHAT"})});return}case"CONTINUE_IN_CHAT":{w.default.runtime.sendMessage({type:"is-sidepanel-open"}).then(o=>{if(o)return w.default.runtime.sendMessage({...t,type:"DO_CONTINUE_IN_CHAT",isForSidepanel:!0});w.default.tabs.sendMessage(e.tab?.id,{...t,type:"DO_CONTINUE_IN_CHAT"})}).catch(()=>{w.default.tabs.sendMessage(e.tab?.id,{...t,type:"DO_CONTINUE_IN_CHAT"})});return}case"SEND_MSG_IN_CHAT":{w.default.runtime.sendMessage({type:"is-sidepanel-open"}).then(o=>{if(o)return w.default.runtime.sendMessage({...t,type:"DO_SEND_MSG_IN_CHAT",isForSidepanel:!0});w.default.tabs.sendMessage(e.tab?.id,{...t,type:"DO_SEND_MSG_IN_CHAT"})}).catch(()=>{w.default.tabs.sendMessage(e.tab?.id,{...t,type:"DO_SEND_MSG_IN_CHAT"})});return}case"CHECK_PINNED":return!!(await w.default.action.getUserSettings())?.isOnToolbar;case"OPEN_CHAT_PAGE":{vo("",()=>{w.default.runtime.sendMessage({type:"switchChat",data:{contact:t.contact||"chat",conversation:t.currentCid}})},()=>R({activeConversation:{contact:t.contact||"chat",conversation:t.currentCid}}));break}case"QUERY_SELECTION":return w.default.tabs.sendMessage(t.tabId||e.tab?.id,{type:"query-selection",selectionText:t.selectionText});case"TOGGLE_HOST_TRANSLATOR_FAB":return Js(t,e);case"TOGGLE_SIDEBAR":{Xt(t.isShow);break}case"GUARD_CHATGPT_TAB":{li();break}case"TOGGLE_TRANSLATOR":w.default.tabs.sendMessage(t.tabId||e.tab?.id,{type:"toggle-translator",show:t.show});break;case"GO_LOGIN":{$s();break}case"GO_INVITE":{Ws();break}case"GET_INVITE_LINK":return P.createInviteLink();case"chat-get-chatGPT-models":return await Hr.getModels();case"GET_CHATGPT_PLUGINS":return Gb();case"REMOVE_SELECTION":{let o=await we();o?.id&&w.default.tabs.sendMessage(o.id,{type:"remove-selection"});break}case"SEND_TO_CURRENT_TAB":{let o=await we();o?.id&&w.default.tabs.sendMessage(o.id,t.data);break}case"CAN_INSERT_CHANGED":{let o=await we();o?.id&&w.default.tabs.sendMessage(o.id,t);break}case"CAPTURE_VISIBLE_TAB":return w.default.tabs.captureVisibleTab(void 0,{format:"jpeg"});case"FORWARD_MSG":{let o=await we();o?.id&&w.default.tabs.sendMessage(o.id,t);break}case"GET_SRC_SUFFIX":{let o="",n=await Vl();n.length||await P.signImageCookie(),n=await Vl();let a=n.join("&");return o=a?"?"+a:"",o;break}case"CLEAR_BADGE":return jo();case"GA_API":return P.googleAnalytics(...Array.from(t.args));default:break}});async function Vl(){return(await w.default.cookies.getAll({domain:U.domain})).filter(e=>e.name.startsWith("CloudFront-")&&e.domain==="."+U.domain).map(e=>e.name.split("CloudFront-")[1]+"="+e.value)}Q("sider-image-creator-get-signed-cookie",Gl);Q("sider-image-creator-get-engine-list",Fl);Q("sider-image-creator-get-tools-list",ql);Q("sider-image-creator-text-to-image",({data:t})=>Sl(t));Q("sider-image-creator-image-to-image",({data:t})=>El(t));Q("sider-image-creator-image-to-image-upscale",({data:t})=>kl(t));Q("sider-image-creator-image-to-image-masking",({data:t})=>Cl(t));Q("sider-image-creator-image-to-image-inpainting",({data:t})=>Rl(t));Q("sider-image-creator-image-to-image-remove-text",({data:t})=>Ol(t));Q("sider-image-creator-image-to-image-remove-background",({data:t})=>Ml(t));Q("sider-image-creator-image-to-image-replace-background",({data:t})=>Nl(t));Q("sider-image-creator-image-to-image-upscaling",({data:t})=>Ll(t));Q("sider-image-creator-image-to-image-portrait-depth",({data:t})=>Dl(t));Q("sider-image-creator-image-to-image-portrait-normals",({data:t})=>jl(t));Q("sider-image-creator-image-to-image-variation",({data:t})=>Ul(t));chrome&&chrome.sidePanel&&chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(t=>{});w.default.runtime.onInstalled.addListener(async t=>{if(t.reason==="install"&&(Un(),w.default.storage.local.set({installedAt:Date.now(),installedFirstVersion:w.default.runtime.getManifest().version}),await Tl(),setTimeout(async()=>{w.default.tabs.create({url:"setup.html"});let{installByAD:e}=await G({installByAD:!1});e&&!Me&&Ke({url:ve.login,active:!1})},200)),(t.reason==="install"||t.reason==="update")&&(Dn(),w.default.tabs.query({active:!0,currentWindow:!0}).then(e=>{let r=e[0].id;w.default.tabs.sendMessage(r,{type:"check"}).catch(o=>{Kl(r)})})),t.reason==="update"){let e=zs[0];w.default.storage.local.get({shownChangelogVersion:"",installedFirstVersion:"1.0.0"}).then(({shownChangelogVersion:r,installedFirstVersion:o})=>{r!==e.version&&e.notifyType==="modal"&&To(o)!==To(e.version)&&ui()})}t.reason==="install"&&Nn(),w.default.alarms.create("refresh-image-cookie",{periodInMinutes:5*24*60})});w.default.alarms.onAlarm.addListener(t=>{t.name==="refresh-image-cookie"&&P.signImageCookie()});w.default.tabs.onActivated.addListener(t=>{let e=t.tabId;w.default.tabs.sendMessage(e,{type:"check"}).catch(r=>{Kl(e)})});w.default.contextMenus.create({contexts:["selection"],id:"query-selection",title:"Ask ChatGPT"});w.default.contextMenus.onClicked.addListener((t,e)=>{switch(t.menuItemId){case"query-selection":t.selectionText&&e?.id&&w.default.tabs.sendMessage(e.id,{type:"query-selection",selectionText:t.selectionText}).then(r=>{r||Tr({prompt:t.selectionText})}).catch(()=>{Tr({prompt:t.selectionText})});break}});w.default.runtime.onMessageExternal.addListener((t,e,r)=>{if(Cs.includes(e.id||""))switch(t.type){case"SIDER_OCR":r(!0),t.data?.img&&Rn(t.data.img);break;default:r(!0),Xt();break}});w.default.action.onClicked.addListener(t=>{t.status==="loading"?w.default.runtime.onMessage.addListener(function e(r,o){o.tab&&o.tab.id===t.id&&r.type==="sidebar-ready"&&(w.default.runtime.onMessage.removeListener(e),Xt())}):Xt(),jo()});async function Xt(t){let e=await w.default.tabs.query({active:!0,currentWindow:!0});try{await w.default.tabs.sendMessage(e[0].id,{type:"toggle-sidebar",isShow:t})}catch{return vo(Ds(e[0].url)),!1}return{action:"close"}}var Gb=F(async function(){let r=(await ii()).items;if(Array.isArray(r)){let o=r.map(n=>({id:n.id,logo:n.manifest.logo_url,name:n.manifest.name_for_human,description:n.manifest.description_for_human}));return w.default.storage.local.set({chatgptPlugins:o})}},1e3);w.default.runtime.setUninstallURL("https://sider.ai/uninstall?app_version="+w.default.runtime.getManifest().version);})();
