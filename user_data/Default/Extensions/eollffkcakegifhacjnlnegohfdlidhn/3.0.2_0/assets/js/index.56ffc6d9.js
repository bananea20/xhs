var Er=Object.defineProperty;var yr=(t,e,r)=>e in t?Er(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var re=(t,e,r)=>(yr(t,typeof e!="symbol"?e+"":e,r),r);import{a as p,j as h,R as rt,b as A,F as fe}from"./jsx-runtime.48969444.js";import{p as wr}from"./Popup.ca031a61.js";var xr={exports:{}};(function(t){var e=function(r){var n=Object.prototype,s=n.hasOwnProperty,o=Object.defineProperty||function(f,d,g){f[d]=g.value},a,l=typeof Symbol=="function"?Symbol:{},i=l.iterator||"@@iterator",u=l.asyncIterator||"@@asyncIterator",m=l.toStringTag||"@@toStringTag";function c(f,d,g){return Object.defineProperty(f,d,{value:g,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{c({},"")}catch{c=function(d,g,b){return d[g]=b}}function x(f,d,g,b){var R=d&&d.prototype instanceof G?d:G,N=Object.create(R.prototype),U=new I(b||[]);return o(N,"_invoke",{value:ge(f,g,U)}),N}r.wrap=x;function v(f,d,g){try{return{type:"normal",arg:f.call(d,g)}}catch(b){return{type:"throw",arg:b}}}var y="suspendedStart",_="suspendedYield",k="executing",P="completed",C={};function G(){}function F(){}function O(){}var M={};c(M,i,function(){return this});var H=Object.getPrototypeOf,j=H&&H(H(L([])));j&&j!==n&&s.call(j,i)&&(M=j);var B=O.prototype=G.prototype=Object.create(M);F.prototype=O,o(B,"constructor",{value:O,configurable:!0}),o(O,"constructor",{value:F,configurable:!0}),F.displayName=c(O,m,"GeneratorFunction");function me(f){["next","throw","return"].forEach(function(d){c(f,d,function(g){return this._invoke(d,g)})})}r.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return d?d===F||(d.displayName||d.name)==="GeneratorFunction":!1},r.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,O):(f.__proto__=O,c(f,m,"GeneratorFunction")),f.prototype=Object.create(B),f},r.awrap=function(f){return{__await:f}};function z(f,d){function g(N,U,X,Y){var W=v(f[N],f,U);if(W.type==="throw")Y(W.arg);else{var Ue=W.arg,Re=Ue.value;return Re&&typeof Re=="object"&&s.call(Re,"__await")?d.resolve(Re.__await).then(function(ce){g("next",ce,X,Y)},function(ce){g("throw",ce,X,Y)}):d.resolve(Re).then(function(ce){Ue.value=ce,X(Ue)},function(ce){return g("throw",ce,X,Y)})}}var b;function R(N,U){function X(){return new d(function(Y,W){g(N,U,Y,W)})}return b=b?b.then(X,X):X()}o(this,"_invoke",{value:R})}me(z.prototype),c(z.prototype,u,function(){return this}),r.AsyncIterator=z,r.async=function(f,d,g,b,R){R===void 0&&(R=Promise);var N=new z(x(f,d,g,b),R);return r.isGeneratorFunction(d)?N:N.next().then(function(U){return U.done?U.value:N.next()})};function ge(f,d,g){var b=y;return function(N,U){if(b===k)throw new Error("Generator is already running");if(b===P){if(N==="throw")throw U;return $()}for(g.method=N,g.arg=U;;){var X=g.delegate;if(X){var Y=S(X,g);if(Y){if(Y===C)continue;return Y}}if(g.method==="next")g.sent=g._sent=g.arg;else if(g.method==="throw"){if(b===y)throw b=P,g.arg;g.dispatchException(g.arg)}else g.method==="return"&&g.abrupt("return",g.arg);b=k;var W=v(f,d,g);if(W.type==="normal"){if(b=g.done?P:_,W.arg===C)continue;return{value:W.arg,done:g.done}}else W.type==="throw"&&(b=P,g.method="throw",g.arg=W.arg)}}}function S(f,d){var g=d.method,b=f.iterator[g];if(b===a)return d.delegate=null,g==="throw"&&f.iterator.return&&(d.method="return",d.arg=a,S(f,d),d.method==="throw")||g!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+g+"' method")),C;var R=v(b,f.iterator,d.arg);if(R.type==="throw")return d.method="throw",d.arg=R.arg,d.delegate=null,C;var N=R.arg;if(!N)return d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,C;if(N.done)d[f.resultName]=N.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=a);else return N;return d.delegate=null,C}me(B),c(B,m,"Generator"),c(B,i,function(){return this}),c(B,"toString",function(){return"[object Generator]"});function E(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function T(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function I(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(E,this),this.reset(!0)}r.keys=function(f){var d=Object(f),g=[];for(var b in d)g.push(b);return g.reverse(),function R(){for(;g.length;){var N=g.pop();if(N in d)return R.value=N,R.done=!1,R}return R.done=!0,R}};function L(f){if(f||f===""){var d=f[i];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var g=-1,b=function R(){for(;++g<f.length;)if(s.call(f,g))return R.value=f[g],R.done=!1,R;return R.value=a,R.done=!0,R};return b.next=b}}throw new TypeError(typeof f+" is not iterable")}r.values=L;function $(){return{value:a,done:!0}}return I.prototype={constructor:I,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(T),!f)for(var d in this)d.charAt(0)==="t"&&s.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=a)},stop:function(){this.done=!0;var f=this.tryEntries[0],d=f.completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var d=this;function g(Y,W){return N.type="throw",N.arg=f,d.next=Y,W&&(d.method="next",d.arg=a),!!W}for(var b=this.tryEntries.length-1;b>=0;--b){var R=this.tryEntries[b],N=R.completion;if(R.tryLoc==="root")return g("end");if(R.tryLoc<=this.prev){var U=s.call(R,"catchLoc"),X=s.call(R,"finallyLoc");if(U&&X){if(this.prev<R.catchLoc)return g(R.catchLoc,!0);if(this.prev<R.finallyLoc)return g(R.finallyLoc)}else if(U){if(this.prev<R.catchLoc)return g(R.catchLoc,!0)}else if(X){if(this.prev<R.finallyLoc)return g(R.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(f,d){for(var g=this.tryEntries.length-1;g>=0;--g){var b=this.tryEntries[g];if(b.tryLoc<=this.prev&&s.call(b,"finallyLoc")&&this.prev<b.finallyLoc){var R=b;break}}R&&(f==="break"||f==="continue")&&R.tryLoc<=d&&d<=R.finallyLoc&&(R=null);var N=R?R.completion:{};return N.type=f,N.arg=d,R?(this.method="next",this.next=R.finallyLoc,C):this.complete(N)},complete:function(f,d){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&d&&(this.next=d),C},finish:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.finallyLoc===f)return this.complete(g.completion,g.afterLoc),T(g),C}},catch:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc===f){var b=g.completion;if(b.type==="throw"){var R=b.arg;T(g)}return R}}throw new Error("illegal catch attempt")},delegateYield:function(f,d,g){return this.delegate={iterator:L(f),resultName:d,nextLoc:g},this.method==="next"&&(this.arg=a),C}},r}(t.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(xr);const oe=class{constructor(e=!0){this.logToConsole=e,window.addEventListener("vc-print-logs",()=>{console.log("All logs:"),console.log(oe.allLogs)})}static info(e,r){this.instance.write(e,"info",r)}static success(e,r){this.instance.write(e,"success",r)}static warn(e,r){this.instance.write(e,"warning",r)}static error(e,r){this.instance.write(e,"error",r)}static verbose(e,r){this.instance.logToConsole&&oe.allLogs.push([Date.now(),"verbose",e,r])}static setup(){if(!oe.instance){const r=window.localStorage.getItem("vc-log")==="true";this.instance=new oe(r)}return oe.instance}write(e,r,n){if(this.logToConsole){const o=`color: ${this.getConsoleColor(r)}`;n?console.log(`%c[${r}] ${e}`,o,n):console.log(`%c[${r}] ${e}`,o),oe.allLogs.push([Date.now(),r,e,n])}}getConsoleColor(e){return e==="info"?"#2e99d9":e==="warning"?"#ffbb00":e==="success"?"#1abc9c":"#b91e1e"}};let w=oe;re(w,"instance"),re(w,"allLogs",[]);const et="chrome-extension-voice-control-at-textarea",Ht="chrome-extension-voice-control-in-body",Te="#prompt-textarea",qt="[data-testid=send-button]",Sr=".text-base .whitespace-pre-wrap.break-words",Rr=".markdown",br="form button.btn-neutral:not(.group)",Xt="form .flex.ml-1.gap-0.justify-center button",nt="vc-repeat-icon",$r=".text-base .text-gray-400.flex.self-end.justify-center.mt-2.gap-2.visible .flex.gap-1",Ir="#sai-root",Le=p.exports.createContext(null);function Tr(){const t=p.exports.useRef(null),e=p.exports.useRef(new Set);return p.exports.useEffect(()=>(t.current=new MutationObserver((s,o)=>{e.current.forEach(a=>{a(s,o)})}),t.current.observe(document,{childList:!0,subtree:!0}),()=>{var s;t.current||w.warn("Unable to unmount non existing MutationObserver"),(s=t.current)==null||s.disconnect()}),[]),{addCallback:s=>{e.current.add(s)},removeCallback:s=>{e.current.delete(s)}}}function Lr(t){document.querySelectorAll($r).forEach((r,n)=>{!!r.querySelector("."+nt)||t(r,n)})}const Kt="/assets/svg/imgMute.chunk.svg";function we(t){const e=r=>{var n;r.preventDefault(),(n=t.onClick)==null||n.call(t)};return h("button",{id:t.id,style:t.style,onClick:e,className:`
        vc-icon-button
        vc-focus-element
        active:bg-gray-200       
        p-1 rounded-md md:bottom-3 md:p-2 md:right-3 
        dark:hover:bg-gray-900 dark:disabled:hover:bg-transparent 
        right-2 disabled:text-gray-400  text-white bottom-1.5 
        transition-colors disabled:opacity-40 ${t.className}
      `,children:t.children})}const Nr={},Cr={en:Nr};globalThis&&globalThis.__awaiter;function Ar(t){const e=p.exports.useRef(()=>{throw new Error("Cannot call an event handler while rendering.")});return Wt(()=>{e.current=t},[t]),p.exports.useCallback((...r)=>e.current(...r),[e])}function pt(t,e,r,n){const s=p.exports.useRef(e);Wt(()=>{s.current=e},[e]),p.exports.useEffect(()=>{var o;const a=(o=r==null?void 0:r.current)!==null&&o!==void 0?o:window;if(!(a&&a.addEventListener))return;const l=i=>s.current(i);return a.addEventListener(t,l,n),()=>{a.removeEventListener(t,l,n)}},[t,r,n])}globalThis&&globalThis.__awaiter;const Wt=typeof window<"u"?p.exports.useLayoutEffect:p.exports.useEffect;function zt(t,e){const r=p.exports.useCallback(()=>{if(typeof window>"u")return e;try{const l=window.localStorage.getItem(t);return l?kr(l):e}catch(l){return console.warn(`Error reading localStorage key \u201C${t}\u201D:`,l),e}},[e,t]),[n,s]=p.exports.useState(r),o=Ar(l=>{typeof window>"u"&&console.warn(`Tried setting localStorage key \u201C${t}\u201D even though environment is not a client`);try{const i=l instanceof Function?l(n):l;window.localStorage.setItem(t,JSON.stringify(i)),s(i),window.dispatchEvent(new Event("local-storage"))}catch(i){console.warn(`Error setting localStorage key \u201C${t}\u201D:`,i)}});p.exports.useEffect(()=>{s(r())},[]);const a=p.exports.useCallback(l=>{(l==null?void 0:l.key)&&l.key!==t||s(r())},[t,r]);return pt("storage",a),pt("local-storage",a),[n,o]}function kr(t){try{return t==="undefined"?void 0:JSON.parse(t!=null?t:"")}catch{console.log("parsing error on",{value:t});return}}function Or(){const t="sai-read-aloud",e=window.localStorage.getItem(t),r="sai-language",n=window.localStorage.getItem(r),s=`sai-voice-preference${n}`,o=window.localStorage.getItem(s),l={language:n,muted:e==="false",voice:o&&n?[[n,o]]:[]};return window.localStorage.removeItem(t),window.localStorage.removeItem(r),window.localStorage.removeItem(s),l}const Ce=Or(),_r={language:Ce.language||"en-US",didSetLanguage:!!Ce.language,voice:Ce.voice||[],speed:1,muted:Ce.muted||!1,showExtension:!0,version:"0.0.0"},J=p.exports.createContext({}),Ne=t=>{const e=t.voice.find(([r])=>{if(r===t.language)return!0});return e?e[1]:void 0};function Pr(){const t="vc-settings",[e,r]=zt(t,_r);return{t:Cr.en,settings:e,setSettings:r,getVoicePreference:Ne}}function Fr(t){const[e,r]=zt("vc-current-message",{text:"",messageIndex:-1}),n=p.exports.useRef([]),s=async()=>{if(n.current.length===0)return;const l=n.current.shift();l?(r(l),await t(l),s()):w.error("No queued message to speak")};return{pushToSpeakQueue:(l,i)=>{l.length>0?(w.info(`Push to queue: ${l}`),n.current.push({text:l,messageIndex:i}),s()):w.warn("Empty text to push to queue")},resetQueue:()=>{n.current=[]},currentMessage:e}}var Ve=p.exports,Dr=function(t){return typeof t=="function"},Gr=function(t){var e=Ve.useState(t),r=e[0],n=e[1],s=Ve.useRef(r),o=Ve.useCallback(function(a){s.current=Dr(a)?a(s.current):a,n(s.current)},[]);return[r,o,s]},Yt=Gr;async function q(t){const e=window.localStorage.getItem("vc-settings");if(e){const{showExtension:r}=JSON.parse(e);if(!r)return}w.verbose("gaTrackEvent",t),chrome.runtime.sendMessage({gaEvent:t},r=>{})}const xe=p.exports.createContext({currentMessage:{text:"",messageIndex:-1},pushToSpeakQueue:()=>{},stopReadAloud:()=>{},skipReadAloud:()=>{}});function Mr(t,e){const[r,n,s]=Yt(t.settings),[o,a]=p.exports.useState(-1),l=Fr(async({text:F,messageIndex:O})=>{if(O===y.current){w.warn(`Skipping message ${O}`);return}await G(F)}),i=p.exports.useRef(),u=p.exports.useRef(),m=p.exports.useRef(0),c=p.exports.useRef(0),x=p.exports.useRef(0),v=p.exports.useRef(0),y=p.exports.useRef(-1),_=p.exports.useRef(window.location.pathname);p.exports.useEffect(()=>{w.info("Setup userReadAloud");const F=()=>{_.current=window.location.pathname,k(),y.current=-1},O=()=>{const M=_.current==="/",H=window.location.pathname==="/";if(M&&!H){w.info("New chat: coming from home. Do not reset."),_.current=window.location.pathname,q({name:"new_chat",params:{page_title:document.title,page_location:window.location.pathname}});return}if(_.current!==window.location.pathname){w.info("New chat: Resetting read aloud and skip"),q({name:"change_chat",params:{page_title:document.title,page_location:document.location.href}}),F();return}};e==null||e.addCallback(O)},[]),p.exports.useEffect(()=>{n(t.settings)},[t.settings]);const k=()=>{clearTimeout(u.current),clearTimeout(i.current),l.resetQueue(),window.speechSynthesis.cancel()},P=()=>{w.info(`Skipping message ${o}`),y.current=o,k()},C=(F,O)=>{if(a(O),O===y.current){w.warn(`Skipping message ${O}`);return}l.pushToSpeakQueue(F,O)},G=F=>new Promise(O=>{var S;const M=()=>{w.info("Read aloud resolved"),O(void 0),clearTimeout(u.current),clearTimeout(i.current)};if(s.current.muted){M();return}if(!F){w.info("No text to read"),M();return}const H=F.replace(/([0-9]+)\.(?=[0-9]+(?!\.))/g,"$1,"),j=new SpeechSynthesisUtterance(H),B=window.speechSynthesis.getVoices(),me=Ne(s.current),z=(S=B.find(E=>E.voiceURI===me))!=null?S:B[0];j.volume=1,j.voice=z,j.rate=s.current.speed,w.info(`Voice name: ${z.name}, lang: ${z.lang}, rate: ${s.current.speed}: ${H}`);const ge=()=>{if(z.name.includes("Microsoft")){w.warn("Not resuming infinity for MS voices");return}const[E,T]=jr(z.lang,s.current.speed,m.current,c.current,x.current,v.current);clearTimeout(u.current),c.current=E,v.current=T,window.speechSynthesis.pause(),window.speechSynthesis.resume(),i.current=setTimeout(ge,7e3)};j.addEventListener("error",E=>{w.error(`Read aloud error ${E.error}`,E),M()}),j.addEventListener("start",()=>{w.info(`Speech has started. Volume: ${j.volume}`),m.current=Date.now(),ge()}),j.addEventListener("end",function(){w.info("Speech has ended"),M()}),j.addEventListener("pause",function(E){w.info("Speech has paused",E)}),j.addEventListener("resume",function(E){w.info("Speech has resumed",E)}),j.addEventListener("boundary",function(E){w.info(`Speech reached boundary. CharIndex: ${E.charIndex}`,E)}),j.addEventListener("mark",function(E){w.info("Speech reached mark",E)}),clearTimeout(u.current),u.current=setTimeout(()=>{w.error("Failed to start reading aloud. Trying to pause and resume."),window.speechSynthesis.pause(),window.speechSynthesis.resume()},5e3),window.speechSynthesis.speak(j),x.current=H.length});return{currentMessage:l.currentMessage,readTextAloud:G,stopReadAloud:k,pushToSpeakQueue:C,skipReadAloud:P}}function jr(t,e,r,n,s,o){const a=Date.now()-r,l=Ur(t,s,e);if(w.warn(`[resumeInfinity] Time since last utter: ${a.toFixed(1)}. Timeout: ${l.toFixed(1)}. Last char count: ${s}`),window.navigator.userAgent.search("Mac")>-1&&a===0&&o>0){const u=n-o,m=u/n*100;w.warn(`Last timeout safety gap: ${u.toFixed(1)}ms. ${m.toFixed(1)}%`),m<25&&w.error(`________Safety gap ${m.toFixed(1)}% too low!________`)}return a>l?(w.error(`No utter timeout ${l.toFixed(1)} - cancel.`),window.speechSynthesis.cancel(),setTimeout(()=>{window.speechSynthesis.resume()},50),[0,0]):[l,a]}function Ur(t,e,r){let n=100;return(t==="zh-CN"||t==="zh-TW"||t==="zh-HK")&&(n=240),t==="zh-TW"&&(n=300),t==="ja-JP"&&(n=260),t==="ko-KR"&&(n=240),7e3+e*n*(1/r)}function Qt(){const t=document.querySelectorAll(Sr),e=[];return t.forEach(r=>{var m,c;const s=!!r.querySelector(Rr)?"assistant":"user",o=r.cloneNode(!0);let a=(m=o.textContent)!=null?m:"";o.querySelectorAll("pre").forEach(x=>{x.insertAdjacentText("beforebegin","[pre-start]"),x.insertAdjacentText("afterend","[pre-end]")}),a=((c=o.textContent)!=null?c:"").trim();let i,u;for(;(i=a.indexOf("[pre-start]"))!==-1&&(u=a.indexOf("[pre-end]",i),u!==-1);)a=a.substring(0,i)+a.substring(u+9);a=a.replace(/\[pre-(start|end)\]/g,""),a&&e.push({role:s,content:a})}),e}function Vr(){const t=Qt().filter(n=>n.role==="assistant"),e=t[t.length-1],r=t.length-1;if(!(!e||r===-1))return{message:e,index:r}}function Br(t){const{pushToSpeakQueue:e,stopReadAloud:r}=p.exports.useContext(xe),{settings:n}=p.exports.useContext(J),s=()=>{const o=Qt().filter(l=>l.role==="assistant");r();const a=o[t.index];if(a!=null&&a.content){const l=Math.floor(Math.random()*100001);e(a.content,l)}else w.error("Repeat message has no content. This should not be possible.")};return n.muted?null:h("div",{children:h(we,{style:{padding:3,width:24,height:24},onClick:s,className:"flex ml-auto gizmo:ml-0 gap-2 items-center rounded-md  text-xs gizmo:gap-1.5 gizmo:pl-0 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400 hover:bg-gray-100 hover:text-gray-700",children:h("img",{style:{width:32,height:32},src:chrome.runtime.getURL(Kt),alt:"mute"})})})}function Hr(t){const e=document.querySelector(`.${nt}[data-vc-uuid="${t.uuid}"]`),r=e==null?void 0:e.dataset.index;return e?r?rt.createPortal(h(Br,{index:parseInt(r,10)}),e):(w.error("AtButtonGroupPortal: index not found"),null):(w.verbose("AtButtonGroupPortal: root not found"),t.onRemoveItem(t.uuid),null)}function mt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}const qr="/assets/svg/imgMic-button.chunk.svg",Xr="/assets/svg/imgSubmit-button.chunk.svg";function Kr(t){const e=p.exports.useRef(null);return p.exports.useEffect(()=>{e.current=new BroadcastChannel("mia-broadcast-channel"),e.current.onmessage=n=>{n.data&&t(n.data)}},[]),n=>{if(e.current===null){w.error("Broadcast channel is not initialized");return}e.current.postMessage(n)}}const Wr=window.SpeechRecognition||window.webkitSpeechRecognition;class zr{constructor(e,r,n){re(this,"transcript","");re(this,"recognition",new Wr);re(this,"isRecording",!1);re(this,"lastStop",0);re(this,"startTimer");this.onTranscript=e,this.onRecognitionEnd=r,this.onError=n,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.onstart=()=>{},this.recognition.onresult=s=>{let o="";for(let a=s.resultIndex;a<s.results.length;++a)s.results[a].isFinal?this.isRecording&&(this.transcript+=s.results[a][0].transcript,this.onTranscript(this.transcript)):o+=s.results[a][0].transcript;this.isRecording&&this.onTranscript(this.transcript+o)},this.recognition.onerror=s=>{let o;s.error==="not-allowed"?o="mic-denied":s.error==="no-speech"?o="no-microphone-sound":s.error==="language-not-supported"||s.error==="network"?o="speech-recognition-not-supported":o="unknown-error",this.onError(o),w.error(`recognition.onerror ${s.error}`)},this.recognition.onend=()=>{w.info("Ended"),this.onRecognitionEnd()}}start(e){const r=()=>{w.info("Start recording"),this.recognition.lang=e,this.recognition.start(),this.isRecording=!0};if(this.lastStop+1e3>Date.now()){const n=this.lastStop+1e3-Date.now();w.warn(`Quick restart: cool down ${n}`),this.startTimer=setTimeout(r,n)}else r()}stop(){w.info(`Stop recording: ${this.transcript}`),clearTimeout(this.startTimer),this.isRecording=!1,this.lastStop=Date.now(),this.recognition.stop()}reset(){this.isRecording=!1,this.transcript=""}}function Yr(t){const[e,r]=p.exports.useState(""),[n,s]=p.exports.useState(!1),o=p.exports.useRef();return p.exports.useEffect(()=>{if(o.current)return;const u=c=>{r(c)},m=()=>{w.info("onRecognitionEnd"),s(!1)};o.current=new zr(u,m,t)},[]),{transcript:e,speechRecognitionIsRecording:n,onErrorCallback:t,startSpeechRecognition:u=>{var m;o.current||w.error("startSpeechRecognition: speechRecognition.current is undefined"),s(!0),(m=o.current)==null||m.start(u)},stopSpeechRecognition:()=>{var u;o.current||w.error("stopSpeechRecognition: speechRecognition.current is undefined"),s(!1),(u=o.current)==null||u.stop()},resetTranscript:()=>{var u;r(""),(u=o.current)==null||u.reset()}}}const Qr={conversationState:"idle"},Zt=p.exports.createContext({});function Zr(t,e){const r=t.settings,[n,s,o]=Yt(Qr),a=Yr(e),[l,i]=p.exports.useState(),u=Kr(v=>{v.type==="mia:start:recognition"&&(w.info("Received start recognition message"),c("idle"))});p.exports.useEffect(()=>{w.info(`useVoiceControl transcript: ${a.transcript}`)},[a.transcript]),p.exports.useEffect(()=>{r.language!==l&&(i(r.language),o.current.conversationState!=="idle"&&c("idle"))},[r.language]);const m=()=>{w.info(`Speech recognition language: ${r.language}`),a.startSpeechRecognition(r.language),u({type:"mia:start:recognition"}),s({...o.current,conversationState:"recording"})},c=v=>{a.stopSpeechRecognition(),s({...o.current,conversationState:v})},x=v=>{s({...o.current,conversationState:v})};return{isRecording:a.speechRecognitionIsRecording,state:o.current,startSpeechRecognition:m,stopSpeechRecognition:c,transcript:a.transcript,resetTranscript:a.resetTranscript,suspendSpeechRecognition:x}}function Jr(){const[t,e]=p.exports.useState("loading");return p.exports.useEffect(()=>{window.navigator.permissions.query({name:"microphone"}).then(function(n){e(n.state)})},[]),{permissionState:t,requestMicrophone:()=>{window.navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>{e("granted")}).catch(function(n){console.error("Microphone access error:",n),e("denied")})}}}function tt(){return tt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},tt.apply(this,arguments)}var Jt=["shift","alt","meta","mod","ctrl"],en={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function ie(t){return(en[t]||t).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function tn(t){return Jt.includes(t)}function Be(t,e){return e===void 0&&(e=","),t.split(e)}function He(t,e,r){e===void 0&&(e="+");var n=t.toLocaleLowerCase().split(e).map(function(a){return ie(a)}),s={alt:n.includes("alt"),ctrl:n.includes("ctrl")||n.includes("control"),shift:n.includes("shift"),meta:n.includes("meta"),mod:n.includes("mod")},o=n.filter(function(a){return!Jt.includes(a)});return tt({},s,{keys:o,description:r})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(t){t.key!==void 0&&er([ie(t.key),ie(t.code)])}),document.addEventListener("keyup",function(t){t.key!==void 0&&tr([ie(t.key),ie(t.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){ae.clear()})})();var ae=new Set;function st(t){return Array.isArray(t)}function rn(t,e){e===void 0&&(e=",");var r=st(t)?t:t.split(e);return r.every(function(n){return ae.has(n.trim().toLowerCase())})}function er(t){var e=Array.isArray(t)?t:[t];ae.has("meta")&&ae.forEach(function(r){return!tn(r)&&ae.delete(r.toLowerCase())}),e.forEach(function(r){return ae.add(r.toLowerCase())})}function tr(t){var e=Array.isArray(t)?t:[t];t==="meta"?ae.clear():e.forEach(function(r){return ae.delete(r.toLowerCase())})}function nn(t,e,r){(typeof r=="function"&&r(t,e)||r===!0)&&t.preventDefault()}function sn(t,e,r){return typeof r=="function"?r(t,e):r===!0||r===void 0}function on(t){return rr(t,["input","textarea","select"])}function rr(t,e){var r=t.target;e===void 0&&(e=!1);var n=r&&r.tagName;return st(e)?Boolean(n&&e&&e.some(function(s){return s.toLowerCase()===n.toLowerCase()})):Boolean(n&&e&&e===!0)}function an(t,e){return t.length===0&&e?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):e?t.some(function(r){return e.includes(r)})||t.includes("*"):!0}var cn=function(e,r,n){n===void 0&&(n=!1);var s=r.alt,o=r.meta,a=r.mod,l=r.shift,i=r.ctrl,u=r.keys,m=e.key,c=e.code,x=e.ctrlKey,v=e.metaKey,y=e.shiftKey,_=e.altKey,k=ie(c),P=m.toLowerCase();if(!n){if(s===!_&&P!=="alt"||l===!y&&P!=="shift")return!1;if(a){if(!v&&!x)return!1}else if(o===!v&&P!=="meta"&&P!=="os"||i===!x&&P!=="ctrl"&&P!=="control")return!1}return u&&u.length===1&&(u.includes(P)||u.includes(k))?!0:u?rn(u):!u},un=p.exports.createContext(void 0),ln=function(){return p.exports.useContext(un)};function nr(t,e){return t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(t).length===Object.keys(e).length&&Object.keys(t).reduce(function(r,n){return r&&nr(t[n],e[n])},!0):t===e}var hn=p.exports.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),fn=function(){return p.exports.useContext(hn)};function dn(t){var e=p.exports.useRef(void 0);return nr(e.current,t)||(e.current=t),e.current}var gt=function(e){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},pn=typeof window<"u"?p.exports.useLayoutEffect:p.exports.useEffect;function he(t,e,r,n){var s=p.exports.useRef(null),o=p.exports.useRef(!1),a=r instanceof Array?n instanceof Array?void 0:n:r,l=st(t)?t.join(a==null?void 0:a.splitKey):t,i=r instanceof Array?r:n instanceof Array?n:void 0,u=p.exports.useCallback(e,i!=null?i:[]),m=p.exports.useRef(u);i?m.current=u:m.current=e;var c=dn(a),x=fn(),v=x.enabledScopes,y=ln();return pn(function(){if(!((c==null?void 0:c.enabled)===!1||!an(v,c==null?void 0:c.scopes))){var _=function(F,O){var M;if(O===void 0&&(O=!1),!(on(F)&&!rr(F,c==null?void 0:c.enableOnFormTags))&&!(c!=null&&c.ignoreEventWhen!=null&&c.ignoreEventWhen(F))){if(s.current!==null&&document.activeElement!==s.current&&!s.current.contains(document.activeElement)){gt(F);return}(M=F.target)!=null&&M.isContentEditable&&!(c!=null&&c.enableOnContentEditable)||Be(l,c==null?void 0:c.splitKey).forEach(function(H){var j,B=He(H,c==null?void 0:c.combinationKey);if(cn(F,B,c==null?void 0:c.ignoreModifiers)||(j=B.keys)!=null&&j.includes("*")){if(O&&o.current)return;if(nn(F,B,c==null?void 0:c.preventDefault),!sn(F,B,c==null?void 0:c.enabled)){gt(F);return}m.current(F,B),O||(o.current=!0)}})}},k=function(F){F.key!==void 0&&(er(ie(F.code)),((c==null?void 0:c.keydown)===void 0&&(c==null?void 0:c.keyup)!==!0||c!=null&&c.keydown)&&_(F))},P=function(F){F.key!==void 0&&(tr(ie(F.code)),o.current=!1,c!=null&&c.keyup&&_(F,!0))},C=s.current||(a==null?void 0:a.document)||document;return C.addEventListener("keyup",P),C.addEventListener("keydown",k),y&&Be(l,c==null?void 0:c.splitKey).forEach(function(G){return y.addHotkey(He(G,c==null?void 0:c.combinationKey,c==null?void 0:c.description))}),function(){C.removeEventListener("keyup",P),C.removeEventListener("keydown",k),y&&Be(l,c==null?void 0:c.splitKey).forEach(function(G){return y.removeHotkey(He(G,c==null?void 0:c.combinationKey,c==null?void 0:c.description))})}}},[l,c,v]),s}function ot(t){if(!t.open)return null;const e=r=>{var s;r.target.closest(".vc-modal")||(s=t.onClose)==null||s.call(t)};return he("esc",()=>{var r;t.open&&((r=t.onClose)==null||r.call(t))}),h("div",{className:"vc-modal-backdrop absolute inset-0 z-50",onClick:e,children:h("div",{"data-state":"open",className:"fixed inset-0 bg-gray-300/70 dark:bg-gray-600/70 ",style:{pointerEvents:"auto"},children:h("div",{className:" grid-cols-[10px_1fr_10px] grid h-full w-full grid-rows-[minmax(10px,_1fr)_auto_minmax(10px,_1fr)] md:grid-rows-[minmax(20px,_1fr)_auto_minmax(20px,_1fr)] overflow-y-auto",children:A("div",{role:"dialog",id:"radix-:r27:","aria-describedby":"radix-:r29:","aria-labelledby":"radix-:r28:","data-state":"open",className:"vc-modal relative col-auto col-start-2 row-auto row-start-2 w-full rounded-lg text-left shadow-xl transition-all left-1/2 -translate-x-1/2 bg-white dark:bg-gray-900 md:max-w-[680px]",tabIndex:-1,style:{pointerEvents:"auto"},children:[A("div",{className:" px-4 pb-4 pt-5 sm:p-6 flex items-center justify-between border-b border-black/10 dark:border-white/10",children:[h("div",{className:"flex",children:h("div",{className:"flex flex-col gap-1 text-center sm:text-left",children:h("h2",{id:"radix-:r28:",className:"text-lg font-medium leading-6 text-gray-900 dark:text-gray-200",children:t.title})})}),t.onClose&&h("button",{onClick:t.onClose,className:"text-gray-500 transition hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:A("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",height:"20",width:"20",xmlns:"http://www.w3.org/2000/svg",children:[h("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),h("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),h("div",{className:"p-4 sm:p-6 sm:pt-4",children:t.children})]})})})})}const mn="/assets/png/imgMic-help.chunk.png";function gn(t){return h(ot,{title:"\u{1F6A8}  Microphone Denied",open:t.open,onClose:t.onClose,children:A("div",{className:"flex justify-between",children:[A("div",{className:"vc-rich-text",children:[h("p",{children:"To enable microphone permission, please click the padlock next to the address bar"}),h("p",{children:"Then turn on the toggle to allow the website to access your microphone."}),A("p",{children:["Please visit our"," ",h("a",{href:"https://voicecontrol.chat/support?utm_source=vc-extension&utm_medium=mic-modal",target:"_blank",rel:"noreferrer",children:"support page"})," ","if you have trouble getting this to work"]})]}),h("img",{className:"w-[250px]",src:chrome.runtime.getURL(mn),alt:"microphone help"})]})})}function vn(t){const e=p.exports.useRef(!1);p.exports.useEffect(()=>{const r=s=>{const o=s.target;(o==null?void 0:o.localName)!=="textarea"&&s.code==="Space"&&(s.stopPropagation(),e.current||(t.startRecording(),e.current=!0))},n=s=>{s.code==="Space"&&(t.stopRecording(),e.current=!1)};return document.addEventListener("keydown",r,!0),document.addEventListener("keyup",n,!0),()=>{document.removeEventListener("keydown",r,!0),document.removeEventListener("keyup",n,!0),e.current=!1}},[t]),he("esc",t.onCancel,{keydown:!0}),he("q",t.onCancel,{keydown:!0}),he("e",t.onCancel,{keydown:!0})}function En(){const t=document.querySelector(Te),e=document.querySelector(qt);if(t.value.length===0){w.warn("No message to submit");return}if(t.dispatchEvent(new Event("input",{bubbles:!0})),w.info("Submit message"),e)e.click();else{const r=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:13});t.dispatchEvent(r)}}function yn(){var s;const t=document.querySelector(Te),e=(s=t==null?void 0:t.parentElement)==null?void 0:s.parentElement;if(!e){w.warn("Could not find prompt text area wrapper");return}const r=e.querySelectorAll("button");if(!r){w.warn("Could not find prompt text area buttons");return}let n=!1;if(r.forEach(o=>{o.innerHTML.includes("background-image")&&(n=!0)}),n){const o=document.querySelector(qt);t.value.length===0?(w.info("Hide send button due to image upload"),o==null||o.classList.add("hidden")):(w.info("Show send button because text is not empty"),o==null||o.classList.remove("hidden"))}}function wn(){const{stopReadAloud:t}=p.exports.useContext(xe),e=p.exports.useContext(Le),{permissionState:r}=Jr(),[n,s]=p.exports.useState(!1),{settings:o}=p.exports.useContext(J),a=p.exports.useContext(Zt),[l,i]=p.exports.useState(""),[u,m]=p.exports.useState(!1),c=a.isRecording,x=l+a.transcript,v=()=>document.querySelector(Te),y=!c&&(u||a.transcript.length>0);p.exports.useEffect(()=>{const O=v(),M=()=>{m(O.value.length>0),yn()};return o.showExtension?(e==null||e.addCallback(M),O.placeholder="Send a message or hold space bar to talk"):(O.placeholder="Send a message",e==null||e.removeCallback(M)),()=>{e==null||e.removeCallback(M)}},[o.showExtension]),p.exports.useEffect(()=>{var M,H;const O=v();return c?(O.addEventListener("click",F),(M=O.parentElement)==null||M.classList.add("vc-textarea-parent-is-recording"),a.transcript.length>0&&(O.value=x+" ",O.dispatchEvent(new Event("input",{bubbles:!0}))),r==="denied"&&(q({name:"microphone_denied"}),s(!0),P())):(O.removeEventListener("click",F),(H=O.parentElement)==null||H.classList.remove("vc-textarea-parent-is-recording")),()=>{O.removeEventListener("click",F)}},[r,x,c]);const _=()=>{En(),a.resetTranscript()},k=p.exports.useCallback(()=>{if(!o.showExtension||c)return;q({name:"start_recording"});const O=v();i(O.value),t(),a.resetTranscript(),a.startSpeechRecognition()},[t,r,o.showExtension,c]),P=p.exports.useCallback(()=>{!c||(q({name:"stop_recording"}),a.stopSpeechRecognition("idle"),_())},[c]),C=p.exports.useCallback(()=>{a.state.conversationState==="recording"?P():k()},[a.state.conversationState]),G=()=>{q({name:"cancel_recording"}),a.stopSpeechRecognition("idle"),a.resetTranscript(),w.info("Cancel message")},F=p.exports.useCallback(()=>{if(a.stopSpeechRecognition("idle"),w.info("Edit message"),q({name:"edit_transcript"}),x.length>0){const O=v();O.value=x+" "}a.resetTranscript()},[x]);return vn({startRecording:k,stopRecording:P,onCancel:G}),o.showExtension?h(fe,{children:!y&&A(fe,{children:[h(gn,{open:n,onClose:()=>s(!1)}),h("div",{className:"absolute z-20 top-0 right-[12px] h-full flex items-end vc-record-button-wrapper",children:h(we,{id:"vc-record-button",style:{width:32,height:32,padding:0,borderRadius:100},onClick:C,className:`mb-[5px] md:mb-[12px]  ${c?"":"hover:bg-gray-100"}`,children:h("img",{className:c?"animate-pulse":"",style:{width:45,height:30,marginLeft:"auto",marginRight:"auto"},src:chrome.runtime.getURL(c?Xr:qr),alt:"microphone"})})})]})}):h("div",{})}function sr(t,e){return t===e||t==="zh-CN"&&e==="cmn-Hans-CN"||t==="zh-TW"&&e==="cmn-Hant-TW"||t==="zh-HK"&&e==="yue-Hant-HK"||t==="ar-001"&&e==="ar-EG"}const xn=[["English (US)","en-US"],["English (UK)","en-GB"],["English (AU)","en-AU"],["English (CA)","en-CA"],["English (IN)","en-IN"],["English (NZ)","en-NZ"],["\u666E\u901A\u8BDD (\u4E2D\u56FD\u5927\u9646)","cmn-Hans-CN"],["\u4E2D\u6587 (\u53F0\u7063)","cmn-Hant-TW"],["\u7CB5\u8A9E (\u9999\u6E2F)","yue-Hant-HK"],["Afrikaans","af-ZA"],["Bahasa Indonesia","id-ID"],["Bahasa Melayu","ms-MY"],["Catal\xE0","ca-ES"],["\u010Ce\u0161tina","cs-CZ"],["Dansk","da-DK"],["Deutsch","de-DE"],["Espa\xF1ol (ES)","es-ES"],["Espa\xF1ol (MX)","es-MX"],["Espa\xF1ol (AR)","es-AR"],["Espa\xF1ol (CO)","es-CO"],["Espa\xF1ol (PE)","es-PE"],["Espa\xF1ol (VE)","es-VE"],["Euskara","eu-ES"],["Fran\xE7ais","fr-FR"],["Galego","gl-ES"],["Hrvatski","hr_HR"],["IsiZulu","zu-ZA"],["\xCDslenska","is-IS"],["Italiano","it-IT"],["Magyar","hu-HU"],["Nederlands","nl-NL"],["Norsk bokm\xE5l","nb-NO"],["Polski","pl-PL"],["Portugu\xEAs (PT)","pt-PT"],["Portugu\xEAs (BR)","pt-BR"],["Rom\xE2n\u0103","ro-RO"],["Sloven\u010Dina","sk-SK"],["Suomi","fi-FI"],["Svenska","sv-SE"],["T\xFCrk\xE7e","tr-TR"],["\u0431\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438","bg-BG"],["\u65E5\u672C\u8A9E","ja-JP"],["\uD55C\uAD6D\uC5B4","ko-KR"],["P\u0443\u0441\u0441\u043A\u0438\u0439","ru-RU"],["\u0421\u0440\u043F\u0441\u043A\u0438","sr-RS"],["Ti\u1EBFng Vi\u1EC7t","vi-VN"],["\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22","th-TH"],["\u05E2\u05B4\u05D1\u05E8\u05B4\u05D9\u05EA","he-IL"],["\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC","el-GR"],["\u0627\u0644\u0644\u063A\u0629 \u0627\u0644\u0639\u0631\u0628\u064A\u0629","ar-EG"],["\u0939\u093F\u0928\u094D\u0926\u0940","hi-IN"]];async function Sn(){const t=[];try{const e=await or();return xn.forEach(r=>{e.some(s=>sr(s.lang,r[1]))?t.push(r):w.verbose(`${r[0]} not supported. Removed from selector.`)}),t}catch{return w.error("Could not get voices from window.speechSynthesis"),[]}}function or(){return new Promise((t,e)=>{const r=window.speechSynthesis.getVoices();if(r.length>0){t(r);return}const n=setTimeout(()=>{e()},5e3);window.speechSynthesis.onvoiceschanged=()=>{clearTimeout(n);const s=window.speechSynthesis.getVoices();t(s)}})}function Rn(){return A("svg",{"aria-hidden":"true",className:"inline w-4 h-4 mr-2 text-gray-200 animate-spin dark:text-gray-600 fill-gray-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),h("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})]})}function ir(){const[t,e]=p.exports.useState([]),{settings:r}=p.exports.useContext(J),n=async()=>(await or()).filter(o=>sr(o.lang,r.language)).reverse();return p.exports.useEffect(()=>{n().then(s=>{e(s)})},[r.language]),{voices:t,getAsyncVoices:n}}function bn(){const[t,e]=p.exports.useState(!0),[r,n]=p.exports.useState([]),{settings:s,setSettings:o}=p.exports.useContext(J),{voices:a,getAsyncVoices:l}=ir(),[i,u]=p.exports.useState(!1),m=x=>{const v=x.find(([y,_])=>_.includes(navigator.language));v?(w.info(`Set default language to ${v[1]} from navigator`),o({...s,language:v[1],didSetLanguage:!0})):(w.info(`Set default language to ${x[0][1]} from fallback`),o({...s,language:x[0][1],didSetLanguage:!0}))};p.exports.useEffect(()=>{Sn().then(x=>{x.length===0&&u(!0),e(!1),n(x),!s.didSetLanguage&&x.length>0&&(w.warn("No language set. Setting default language"),m(x))})},[]),p.exports.useEffect(()=>{Ne(s)||l().then(v=>{const y=v.find(_=>_.lang===s.language);o({...s,voice:s.voice.concat([[s.language,y==null?void 0:y.voiceURI]])})})},[s.language]);const c=p.exports.useCallback(x=>{const v=x.target.value;o({...s,language:v})},[s,a]);return t?h("div",{className:"flex items-center justify-center h-full ml-4",children:h(Rn,{})}):i?h("a",{href:"https://voicecontrol.chat/install-voices?utm_source=vc-extension&utm_medium=install-voices",target:"_blank",rel:"noreferrer",className:"mx-2 vc-focus-element text-xs border border-gray-300 rounded-md px-3 py-1 text-gray-500 hover:bg-gray-100",children:"Install voice"}):h("select",{value:s.language,onChange:c,className:"max-w-[125px] rounded-md vc-focus-element vc-language-selector pl-3 py-1 pr-8 text-sm text-gray-500 bg-transparent",children:r.map(([x,v],y)=>h("option",{value:v,children:x},y))})}const $n="/assets/svg/imgKebab.chunk.svg",In="/assets/svg/imgClose.chunk.svg",Tn="/assets/svg/imgEye.chunk.svg";function Ln(t){return h("input",{id:t.id||"",step:t.step||.1,type:"range",value:t.value,min:t.min,max:t.max,onChange:t.onChange,className:"vc-range-thumb w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})}function ar(t){return h("h4",{className:`text-sm ${t.className}`,children:t.children})}const Nn="/assets/svg/imgStar.chunk.svg",Cn="/assets/svg/imgWorld.chunk.svg",An="/assets/png/imgTalkio-banner.chunk.png";function kn(t){return p.exports.useEffect(()=>{t.open&&q({name:"open_about_modal"})},[t.open]),h(ot,{title:"Info",open:t.open,onClose:t.onClose,children:A(fe,{children:[A("div",{className:"vc-rich-text",children:[h("p",{children:"Hello \u{1F44B} I am Theis, the developer behind Voice Control for ChatGPT."}),A("p",{children:["Thank you for using my extension. If you encounter any issues or have any questions, please do not hesitate to visit the"," ",h("a",{href:"https://voicecontrol.chat/support/?utm_source=vc-extension&utm_medium=about-modal&utm_campaign=vc-support",target:"_blank",rel:"noreferrer",children:"Support Page"})," ","for assistance."]}),h("p",{children:"To stay tuned on the latest product updates from me and my team, please consider subscribing to our occasional newsletter."})]}),h("div",{children:A("form",{action:"https://voicecontrol.chat/newsletter",method:"get",target:"_blank",className:"flex mt-8 mb-6 flex-col",onSubmit:()=>{setTimeout(()=>{t.onClose()},500)},children:[A("div",{className:"flex",children:[h("input",{type:"hidden",name:"source",value:"chatgpt-extension"}),h("input",{type:"email",name:"email",placeholder:"Enter your email",className:"border-gray-300 border py-2 px-3 rounded grow",required:!0}),h("button",{type:"submit",className:"btn relative btn-primary ml-2 grow-0",children:"Subscribe"})]}),A("div",{className:"flex items-center mt-2 text-sm text-gray-500",children:[h("input",{className:"w-4 h-4 vc-text-primary bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",id:"vc-terms-accept",type:"checkbox",required:!0}),A("label",{className:"ml-1",htmlFor:"vc-terms-accept",children:["By subscribing, you agree to our"," ",h("a",{href:"https://voicecontrol.chat/newsletter/consent",target:"_blank",rel:"noreferrer",className:"font-bold",children:"Privacy Policy"})]})]})]})}),h("div",{className:"h-px my-4 bg-gray-100"}),A("div",{className:"vc-rich-text mb-7",children:[h("h3",{children:"Keyboard shortcuts"}),A("p",{children:["Press-and-hold ",h("strong",{children:"SPACE"})," (outside text input) to record, and release to submit"]}),A("p",{children:["Press ",h("strong",{children:"ESC"})," or ",h("strong",{children:"Q"})," to stop and copy the transcription to the ChatGPT input field without submitting"]}),A("p",{children:["Press ",h("strong",{children:"S"})," to skip reading the current message"]}),A("p",{children:["Press ",h("strong",{children:"M"})," to turn mute on or off"]})]}),h("div",{className:"h-px my-4 bg-gray-100"}),h("a",{href:"https://talkio.ai?utm_source=vc-extension&utm_medium=info-modal",target:"_blank",rel:"noreferrer",className:"block mt-7",children:h("img",{className:"w-full",src:chrome.runtime.getURL(An),alt:"microphone help"})})]})})}function On(){const[t,e]=p.exports.useState(!1);return A(fe,{children:[h(kn,{open:t,onClose:()=>e(!1)}),A("div",{className:"bg-neutral-100 px-5 py-4 flex justify-between rounded-b-xl",children:[h("div",{children:h(vt,{label:"Info",onClick:()=>e(!0),src:chrome.runtime.getURL(Cn)})}),h("div",{children:h(vt,{label:"Feedback",onClick:()=>window.open("https://voicecontrol.chat/feedback?utm_source=vc-extension&utm_medium=settings-footer&utm_campaign=vc-support","_blank"),src:chrome.runtime.getURL(Nn)})})]})]})}function vt(t){return A("a",{href:"#",onClick:e=>{e.preventDefault(),t.onClick()},className:"flex text-xs hover:opacity-50",children:[h("img",{style:{width:15,height:15},src:t.src,alt:t.label}),h("span",{className:"ml-2",children:t.label})]})}function _n(){var s;const{voices:t}=ir(),{settings:e,setSettings:r}=p.exports.useContext(J),n=p.exports.useCallback(o=>{const a=e.voice.findIndex(([i])=>i===e.language),l=e.voice;a===-1?l.push([e.language,o.target.value]):l[a]=[e.language,o.target.value],r({...e,voice:l})},[e]);return A(fe,{children:[h(ar,{className:"mr-1",children:"Voice"}),h("select",{value:Ne(e)||((s=t[0])==null?void 0:s.voiceURI),onChange:n,className:"max-w-[180px] rounded-md vc-focus-element pl-2 py-1 pr-7 text-sm text-gray-500",children:t.map(o=>h("option",{value:o.voiceURI,children:o.name},o.voiceURI))}),h("div",{className:"ml-1",children:h("a",{href:"https://voicecontrol.chat/install-voices?utm_source=vc-extension&utm_medium=install-voices",target:"_blank",rel:"noreferrer",className:"hover:bg-emerald-500 focus:bg-emerald-500 focus:outline-none focus:ring-0 cursor-pointer rounded-full w-3 h-3 mt-[2px] text-xs bg-neutral-300 text-white flex justify-center items-center",children:"+"})})]})}function Pn(){const[t,e]=p.exports.useState(!1),{settings:r,setSettings:n}=p.exports.useContext(J);p.exports.useEffect(()=>{const l=i=>{const u=i.target;u.closest(".vc-settings")||u.closest(".vc-modal-backdrop")||u.closest(".vc-modal")||e(!1)};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)});const s=()=>{e(!t),t||q({name:"show_settings"})},o=()=>{let l=r.muted;const i=!r.showExtension;i||(l=!0,q({name:"hide_extension"})),n({...r,showExtension:i,muted:l})},a=l=>{n({...r,speed:Number(l.target.value)})};return A("div",{className:"vc-settings relative",children:[t&&A("div",{className:"vc-settings-popover absolute rounded-xl bottom-11 z-1 right-0 w-[280px] shadow-lg bg-white dark:bg-dark-background",children:[A("div",{className:"border-b border-gray-100 py-1 pl-5 pr-[12px] flex justify-between items-center",children:[h("h3",{className:"text-sm font-bold m-0",children:"Voice Control"}),A(we,{style:{width:30,height:30,padding:"0.5rem"},onClick:o,children:[h("img",{style:{width:20,height:20,marginTop:-4},src:chrome.runtime.getURL(Tn),alt:"display"}),!r.showExtension&&h("div",{className:"bg-gray-400 w-[2px] h-[20px] top-[9px] ml-[5px] absolute rotate-45"})]})]}),r.showExtension&&A("div",{className:"px-5",children:[h("div",{className:"flex justify-between items-center mt-3 mb-1",children:h(_n,{})}),A("div",{className:"mt-4 mb-5",children:[A(ar,{className:"mt-3 mb-1",children:[h("span",{className:"mr-1",children:"Read aloud speed:"})," ",h("span",{children:r.speed.toFixed(1)})]}),h(Ln,{value:r.speed,min:0,max:3,onChange:l=>a(l)})]})]}),h(On,{})]}),h(we,{style:{width:30,height:30},onClick:s,children:h("img",{style:{width:15,height:15,marginTop:t?-1:-2},src:chrome.runtime.getURL(t?In:$n),alt:"settings"})})]})}function Fn(){const{settings:t,setSettings:e}=p.exports.useContext(J),{stopReadAloud:r}=p.exports.useContext(xe),n=p.exports.useCallback(()=>{t.muted||r(),q({name:"toggle_mute"}),e({...t,muted:!t.muted})},[t]);return he("m",n),A(we,{style:{padding:6,width:32,height:30},onClick:n,children:[h("img",{style:{marginTop:-4,width:25,height:25},src:chrome.runtime.getURL(Kt),alt:"mute"}),t.muted&&h("div",{className:"bg-gray-400 w-[1px] h-[25px] top-[6px] ml-[6px] absolute rotate-45"})]})}const Dn="/assets/svg/imgSkip.chunk.svg";function Gn(){const{skipReadAloud:t}=p.exports.useContext(xe),e=()=>{q({name:"skip_read_aloud"}),t()};return he("s",e),h(we,{style:{width:30,height:30},onClick:e,children:h("img",{style:{width:14,height:14,marginTop:-1},src:chrome.runtime.getURL(Dn),alt:"skip"})})}function Mn(){const{settings:t}=p.exports.useContext(J),e=p.exports.useContext(Le);return p.exports.useEffect(()=>{const r=()=>{const n=document.querySelector(br);n&&!n.classList.contains("vc-moved")&&(n.classList.add("vc-moved"),n.style.top="-30px",n.style.left="0px",n.style.position="absolute",n.style.bottom="auto")};return e==null||e.addCallback(r),()=>e==null?void 0:e.removeCallback(r)},[e]),A("div",{className:"vc-menu px-1 absolute right-0 top-[-45px] h-[38px] flex bg-white bg-opacity-90 rounded border border-gray-100",children:[t.showExtension&&A(fe,{children:[h("div",{className:"mr-1 flex items-center",children:h(Fn,{})}),h("div",{className:"mr-1 flex items-center",children:h(Gn,{})}),h("div",{className:"mr-1 flex items-center",children:h(bn,{})})]}),h("div",{className:"flex items-center",children:h(Pn,{})})]})}function jn(t){const e=document.querySelector(`#${et}[data-vc-uuid="${t.uuid}"]`);return e?rt.createPortal(A(fe,{children:[h(Mn,{}),h(wn,{})]}),e):(w.verbose("AtButtonGroupPortal: root not found"),t.onRemoveItem(t.uuid),null)}function Un(t){const e=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu;return t.replace(e,"")}function Vn(){const t=document.querySelector(Xt);if(!t)return w.warn("Could not find regenerate button"),!1;const e=(t==null?void 0:t.innerText)==="Regenerate",r=t==null?void 0:t.innerHTML.includes("polyline");return e||r}const qe=()=>document.querySelector(Xt);function Bn(){const t=p.exports.useContext(Le),{pushToSpeakQueue:e}=p.exports.useContext(xe),r=p.exports.useRef(!0),n=p.exports.useRef(null),s=p.exports.useRef(""),o=p.exports.useRef(!0),a=p.exports.useRef(),l=p.exports.useRef(),i=p.exports.useRef(-1),u=()=>{i.current=-1,s.current=window.location.pathname,o.current=!0},m=(c,x,v=!1)=>{const y=Hn(c),_=/[.:!?]/;if(_.test(y)){const k=y.split(_);if(k.length>0){const P=i.current+1;if(v){for(let G=P;G<k.length;G++)e(k[G],x);u();return}const C=k[P];P!==k.length-1&&C&&(e(k[P],x),i.current=P)}}else v&&(w.info(`READ Only: ${y}`),e(y,x),u())};p.exports.useEffect(()=>{w.success("Setup mutation server for useChatResponse");const c=()=>{w.warn("Abort reading messages"),o.current=!0,i.current=-1,s.current=window.location.pathname},x=()=>{var C,G;const v=Vr(),y=s.current===window.location.pathname;if(!v)return y||(w.verbose("RESET PREV INDEX"),r.current=!0,n.current=null,i.current=-1),null;clearTimeout(a.current),a.current=setTimeout(x,1e3);const _=v.index,k=v.message;if(n.current===null){n.current=r.current?_-1:_,r.current=!1,clearTimeout(a.current),a.current=setTimeout(x,50);return}const P=Vn();if(P&&o.current){w.info("Finished reading all messages"),n.current=null,clearTimeout(a.current),(C=qe())==null||C.removeEventListener("click",c);return}else o.current=!1;k.content.length>0&&_>n.current&&(m(k.content,_,P),n.current=_-1,s.current=window.location.pathname),(G=qe())==null||G.addEventListener("click",c)};return s.current=window.location.pathname,t==null||t.addCallback(x),l.current=setInterval(x,2500),()=>{var v;w.success("Teardown mutation server for useChatResponse"),t==null||t.removeCallback(x),clearTimeout(a.current),clearInterval(l.current),(v=qe())==null||v.removeEventListener("click",c)}},[])}function Hn(t){const e=t.replace(/`/g,"").replace(/\*/g,"").replace(/"/g,"").replace(/\\n/g,"").replace(/\\t/g,"").replace(/\\b/g,"").replace(/（/g," (").replace(/）/g,") ").replace(/？/g,"? ").replace(/：/g,": ").replace(/！/g,"! ").replace(/。/g,". ").trim();return Un(e)}function cr(t){window.dispatchEvent(new CustomEvent("vc-toast-event",{detail:{...t}}))}function qn(){const[t,e]=p.exports.useState(),[r,n]=p.exports.useState(),[s,o]=p.exports.useState(!1),a=p.exports.useRef();p.exports.useEffect(()=>{window.addEventListener("vc-toast-event",i=>{const u=i;e(u.detail.type),n(u.detail.message),o(!0),clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},5e3)})},[]);const l=()=>{clearTimeout(a.current),o(!1)};return s?!r||!t?(w.error("Toast component is missing toastMessage or toastType. This should never happen."),null):h("div",{className:"fixed right-0 top-0 z-40",children:A("div",{className:"flex items-center w-full max-w-xs p-4 mb-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800",role:"alert",children:[t==="success"?h(Xn,{}):h(Kn,{}),h("div",{className:"ml-3 text-sm font-normal",children:r}),A("button",{type:"button",className:"ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700","data-dismiss-target":"#toast-danger","aria-label":"Close",onClick:l,children:[h("span",{className:"sr-only",children:"Close"}),h("svg",{className:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:h("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})})]})]})}):null}const Xn=()=>A("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-green-500 bg-green-100 rounded-lg dark:bg-green-800 dark:text-green-200",children:[h("svg",{className:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:h("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"})}),h("span",{className:"sr-only",children:"Check icon"})]}),Kn=()=>A("div",{className:"inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-red-500 bg-red-100 rounded-lg dark:bg-red-800 dark:text-red-200",children:[h("svg",{className:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:h("path",{d:"M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"})}),h("span",{className:"sr-only",children:"Error icon"})]});var de={exports:{}};const Wn="2.0.0",ur=256,zn=Number.MAX_SAFE_INTEGER||9007199254740991,Yn=16,Qn=ur-6,Zn=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Fe={MAX_LENGTH:ur,MAX_SAFE_COMPONENT_LENGTH:Yn,MAX_SAFE_BUILD_LENGTH:Qn,MAX_SAFE_INTEGER:zn,RELEASE_TYPES:Zn,SEMVER_SPEC_VERSION:Wn,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const Jn=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var De=Jn;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=Fe,o=De;e=t.exports={};const a=e.re=[],l=e.safeRe=[],i=e.src=[],u=e.t={};let m=0;const c="[a-zA-Z0-9-]",x=[["\\s",1],["\\d",s],[c,n]],v=_=>{for(const[k,P]of x)_=_.split(`${k}*`).join(`${k}{0,${P}}`).split(`${k}+`).join(`${k}{1,${P}}`);return _},y=(_,k,P)=>{const C=v(k),G=m++;o(_,G,k),u[_]=G,i[G]=k,a[G]=new RegExp(k,P?"g":void 0),l[G]=new RegExp(C,P?"g":void 0)};y("NUMERICIDENTIFIER","0|[1-9]\\d*"),y("NUMERICIDENTIFIERLOOSE","\\d+"),y("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${c}*`),y("MAINVERSION",`(${i[u.NUMERICIDENTIFIER]})\\.(${i[u.NUMERICIDENTIFIER]})\\.(${i[u.NUMERICIDENTIFIER]})`),y("MAINVERSIONLOOSE",`(${i[u.NUMERICIDENTIFIERLOOSE]})\\.(${i[u.NUMERICIDENTIFIERLOOSE]})\\.(${i[u.NUMERICIDENTIFIERLOOSE]})`),y("PRERELEASEIDENTIFIER",`(?:${i[u.NUMERICIDENTIFIER]}|${i[u.NONNUMERICIDENTIFIER]})`),y("PRERELEASEIDENTIFIERLOOSE",`(?:${i[u.NUMERICIDENTIFIERLOOSE]}|${i[u.NONNUMERICIDENTIFIER]})`),y("PRERELEASE",`(?:-(${i[u.PRERELEASEIDENTIFIER]}(?:\\.${i[u.PRERELEASEIDENTIFIER]})*))`),y("PRERELEASELOOSE",`(?:-?(${i[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[u.PRERELEASEIDENTIFIERLOOSE]})*))`),y("BUILDIDENTIFIER",`${c}+`),y("BUILD",`(?:\\+(${i[u.BUILDIDENTIFIER]}(?:\\.${i[u.BUILDIDENTIFIER]})*))`),y("FULLPLAIN",`v?${i[u.MAINVERSION]}${i[u.PRERELEASE]}?${i[u.BUILD]}?`),y("FULL",`^${i[u.FULLPLAIN]}$`),y("LOOSEPLAIN",`[v=\\s]*${i[u.MAINVERSIONLOOSE]}${i[u.PRERELEASELOOSE]}?${i[u.BUILD]}?`),y("LOOSE",`^${i[u.LOOSEPLAIN]}$`),y("GTLT","((?:<|>)?=?)"),y("XRANGEIDENTIFIERLOOSE",`${i[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),y("XRANGEIDENTIFIER",`${i[u.NUMERICIDENTIFIER]}|x|X|\\*`),y("XRANGEPLAIN",`[v=\\s]*(${i[u.XRANGEIDENTIFIER]})(?:\\.(${i[u.XRANGEIDENTIFIER]})(?:\\.(${i[u.XRANGEIDENTIFIER]})(?:${i[u.PRERELEASE]})?${i[u.BUILD]}?)?)?`),y("XRANGEPLAINLOOSE",`[v=\\s]*(${i[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[u.XRANGEIDENTIFIERLOOSE]})(?:${i[u.PRERELEASELOOSE]})?${i[u.BUILD]}?)?)?`),y("XRANGE",`^${i[u.GTLT]}\\s*${i[u.XRANGEPLAIN]}$`),y("XRANGELOOSE",`^${i[u.GTLT]}\\s*${i[u.XRANGEPLAINLOOSE]}$`),y("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),y("COERCERTL",i[u.COERCE],!0),y("LONETILDE","(?:~>?)"),y("TILDETRIM",`(\\s*)${i[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",y("TILDE",`^${i[u.LONETILDE]}${i[u.XRANGEPLAIN]}$`),y("TILDELOOSE",`^${i[u.LONETILDE]}${i[u.XRANGEPLAINLOOSE]}$`),y("LONECARET","(?:\\^)"),y("CARETTRIM",`(\\s*)${i[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",y("CARET",`^${i[u.LONECARET]}${i[u.XRANGEPLAIN]}$`),y("CARETLOOSE",`^${i[u.LONECARET]}${i[u.XRANGEPLAINLOOSE]}$`),y("COMPARATORLOOSE",`^${i[u.GTLT]}\\s*(${i[u.LOOSEPLAIN]})$|^$`),y("COMPARATOR",`^${i[u.GTLT]}\\s*(${i[u.FULLPLAIN]})$|^$`),y("COMPARATORTRIM",`(\\s*)${i[u.GTLT]}\\s*(${i[u.LOOSEPLAIN]}|${i[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",y("HYPHENRANGE",`^\\s*(${i[u.XRANGEPLAIN]})\\s+-\\s+(${i[u.XRANGEPLAIN]})\\s*$`),y("HYPHENRANGELOOSE",`^\\s*(${i[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[u.XRANGEPLAINLOOSE]})\\s*$`),y("STAR","(<|>)?=?\\s*\\*"),y("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),y("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(de,de.exports);const es=Object.freeze({loose:!0}),ts=Object.freeze({}),rs=t=>t?typeof t!="object"?es:t:ts;var it=rs;const Et=/^[0-9]+$/,lr=(t,e)=>{const r=Et.test(t),n=Et.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},ns=(t,e)=>lr(e,t);var hr={compareIdentifiers:lr,rcompareIdentifiers:ns};const Ae=De,{MAX_LENGTH:yt,MAX_SAFE_INTEGER:ke}=Fe,{safeRe:wt,t:xt}=de.exports,ss=it,{compareIdentifiers:ve}=hr;class Q{constructor(e,r){if(r=ss(r),e instanceof Q){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>yt)throw new TypeError(`version is longer than ${yt} characters`);Ae("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const n=e.trim().match(r.loose?wt[xt.LOOSE]:wt[xt.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>ke||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ke||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ke||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const o=+s;if(o>=0&&o<ke)return o}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Ae("SemVer.compare",this.version,this.options,e),!(e instanceof Q)){if(typeof e=="string"&&e===this.version)return 0;e=new Q(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Q||(e=new Q(e,this.options)),ve(this.major,e.major)||ve(this.minor,e.minor)||ve(this.patch,e.patch)}comparePre(e){if(e instanceof Q||(e=new Q(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{const n=this.prerelease[r],s=e.prerelease[r];if(Ae("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return ve(n,s)}while(++r)}compareBuild(e){e instanceof Q||(e=new Q(e,this.options));let r=0;do{const n=this.build[r],s=e.build[r];if(Ae("prerelease compare",r,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return ve(n,s)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(r){let o=[r,s];n===!1&&(o=[r]),ve(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}var K=Q;const St=K,os=(t,e,r=!1)=>{if(t instanceof St)return t;try{return new St(t,e)}catch(n){if(!r)return null;throw n}};var Se=os;const is=Se,as=(t,e)=>{const r=is(t,e);return r?r.version:null};var cs=as;const us=Se,ls=(t,e)=>{const r=us(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};var hs=ls;const Rt=K,fs=(t,e,r,n,s)=>{typeof r=="string"&&(s=n,n=r,r=void 0);try{return new Rt(t instanceof Rt?t.version:t,r).inc(e,n,s).version}catch{return null}};var ds=fs;const bt=Se,ps=(t,e)=>{const r=bt(t,null,!0),n=bt(e,null,!0),s=r.compare(n);if(s===0)return null;const o=s>0,a=o?r:n,l=o?n:r,i=!!a.prerelease.length;if(!!l.prerelease.length&&!i)return!l.patch&&!l.minor?"major":a.patch?"patch":a.minor?"minor":"major";const m=i?"pre":"";return r.major!==n.major?m+"major":r.minor!==n.minor?m+"minor":r.patch!==n.patch?m+"patch":"prerelease"};var ms=ps;const gs=K,vs=(t,e)=>new gs(t,e).major;var Es=vs;const ys=K,ws=(t,e)=>new ys(t,e).minor;var xs=ws;const Ss=K,Rs=(t,e)=>new Ss(t,e).patch;var bs=Rs;const $s=Se,Is=(t,e)=>{const r=$s(t,e);return r&&r.prerelease.length?r.prerelease:null};var Ts=Is;const $t=K,Ls=(t,e,r)=>new $t(t,r).compare(new $t(e,r));var ee=Ls;const Ns=ee,Cs=(t,e,r)=>Ns(e,t,r);var As=Cs;const ks=ee,Os=(t,e)=>ks(t,e,!0);var _s=Os;const It=K,Ps=(t,e,r)=>{const n=new It(t,r),s=new It(e,r);return n.compare(s)||n.compareBuild(s)};var at=Ps;const Fs=at,Ds=(t,e)=>t.sort((r,n)=>Fs(r,n,e));var Gs=Ds;const Ms=at,js=(t,e)=>t.sort((r,n)=>Ms(n,r,e));var Us=js;const Vs=ee,Bs=(t,e,r)=>Vs(t,e,r)>0;var Ge=Bs;const Hs=ee,qs=(t,e,r)=>Hs(t,e,r)<0;var ct=qs;const Xs=ee,Ks=(t,e,r)=>Xs(t,e,r)===0;var fr=Ks;const Ws=ee,zs=(t,e,r)=>Ws(t,e,r)!==0;var dr=zs;const Ys=ee,Qs=(t,e,r)=>Ys(t,e,r)>=0;var ut=Qs;const Zs=ee,Js=(t,e,r)=>Zs(t,e,r)<=0;var lt=Js;const eo=fr,to=dr,ro=Ge,no=ut,so=ct,oo=lt,io=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return eo(t,r,n);case"!=":return to(t,r,n);case">":return ro(t,r,n);case">=":return no(t,r,n);case"<":return so(t,r,n);case"<=":return oo(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};var pr=io;const ao=K,co=Se,{safeRe:Oe,t:_e}=de.exports,uo=(t,e)=>{if(t instanceof ao)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(Oe[_e.COERCE]);else{let n;for(;(n=Oe[_e.COERCERTL].exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||n.index+n[0].length!==r.index+r[0].length)&&(r=n),Oe[_e.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;Oe[_e.COERCERTL].lastIndex=-1}return r===null?null:co(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,e)};var lo=uo,Xe,Tt;function ho(){return Tt||(Tt=1,Xe=function(t){t.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Xe}var fo=D;D.Node=pe;D.create=D;function D(t){var e=this;if(e instanceof D||(e=new D),e.tail=null,e.head=null,e.length=0,t&&typeof t.forEach=="function")t.forEach(function(s){e.push(s)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)e.push(arguments[r]);return e}D.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;return e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null,e};D.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}};D.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}};D.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)mo(this,arguments[t]);return this.length};D.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)go(this,arguments[t]);return this.length};D.prototype.pop=function(){if(!!this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}};D.prototype.shift=function(){if(!!this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}};D.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;r!==null;n++)t.call(e,r.value,n,this),r=r.next};D.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;r!==null;n--)t.call(e,r.value,n,this),r=r.prev};D.prototype.get=function(t){for(var e=0,r=this.head;r!==null&&e<t;e++)r=r.next;if(e===t&&r!==null)return r.value};D.prototype.getReverse=function(t){for(var e=0,r=this.tail;r!==null&&e<t;e++)r=r.prev;if(e===t&&r!==null)return r.value};D.prototype.map=function(t,e){e=e||this;for(var r=new D,n=this.head;n!==null;)r.push(t.call(e,n.value,this)),n=n.next;return r};D.prototype.mapReverse=function(t,e){e=e||this;for(var r=new D,n=this.tail;n!==null;)r.push(t.call(e,n.value,this)),n=n.prev;return r};D.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else if(this.head)n=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)r=t(r,n.value,s),n=n.next;return r};D.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)r=t(r,n.value,s),n=n.prev;return r};D.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;r!==null;e++)t[e]=r.value,r=r.next;return t};D.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;r!==null;e++)t[e]=r.value,r=r.prev;return t};D.prototype.slice=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new D;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(;s!==null&&n<e;n++,s=s.next)r.push(s.value);return r};D.prototype.sliceReverse=function(t,e){e=e||this.length,e<0&&(e+=this.length),t=t||0,t<0&&(t+=this.length);var r=new D;if(e<t||e<0)return r;t<0&&(t=0),e>this.length&&(e=this.length);for(var n=this.length,s=this.tail;s!==null&&n>e;n--)s=s.prev;for(;s!==null&&n>t;n--,s=s.prev)r.push(s.value);return r};D.prototype.splice=function(t,e,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var n=0,s=this.head;s!==null&&n<t;n++)s=s.next;for(var o=[],n=0;s&&n<e;n++)o.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<r.length;n++)s=po(this,s,r[n]);return o};D.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;r!==null;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this};function po(t,e,r){var n=e===t.head?new pe(r,null,e,t):new pe(r,e,e.next,t);return n.next===null&&(t.tail=n),n.prev===null&&(t.head=n),t.length++,n}function mo(t,e){t.tail=new pe(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function go(t,e){t.head=new pe(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function pe(t,e,r,n){if(!(this instanceof pe))return new pe(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{ho()(D)}catch{}const vo=fo,ue=Symbol("max"),se=Symbol("length"),Ee=Symbol("lengthCalculator"),Ie=Symbol("allowStale"),le=Symbol("maxAge"),ne=Symbol("dispose"),Lt=Symbol("noDisposeOnSet"),V=Symbol("lruList"),Z=Symbol("cache"),mr=Symbol("updateAgeOnGet"),Ke=()=>1;class Eo{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[ue]=e.max||1/0;const r=e.length||Ke;if(this[Ee]=typeof r!="function"?Ke:r,this[Ie]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[le]=e.maxAge||0,this[ne]=e.dispose,this[Lt]=e.noDisposeOnSet||!1,this[mr]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[ue]=e||1/0,be(this)}get max(){return this[ue]}set allowStale(e){this[Ie]=!!e}get allowStale(){return this[Ie]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[le]=e,be(this)}get maxAge(){return this[le]}set lengthCalculator(e){typeof e!="function"&&(e=Ke),e!==this[Ee]&&(this[Ee]=e,this[se]=0,this[V].forEach(r=>{r.length=this[Ee](r.value,r.key),this[se]+=r.length})),be(this)}get lengthCalculator(){return this[Ee]}get length(){return this[se]}get itemCount(){return this[V].length}rforEach(e,r){r=r||this;for(let n=this[V].tail;n!==null;){const s=n.prev;Nt(this,e,n,r),n=s}}forEach(e,r){r=r||this;for(let n=this[V].head;n!==null;){const s=n.next;Nt(this,e,n,r),n=s}}keys(){return this[V].toArray().map(e=>e.key)}values(){return this[V].toArray().map(e=>e.value)}reset(){this[ne]&&this[V]&&this[V].length&&this[V].forEach(e=>this[ne](e.key,e.value)),this[Z]=new Map,this[V]=new vo,this[se]=0}dump(){return this[V].map(e=>Pe(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[V]}set(e,r,n){if(n=n||this[le],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const s=n?Date.now():0,o=this[Ee](r,e);if(this[Z].has(e)){if(o>this[ue])return ye(this,this[Z].get(e)),!1;const i=this[Z].get(e).value;return this[ne]&&(this[Lt]||this[ne](e,i.value)),i.now=s,i.maxAge=n,i.value=r,this[se]+=o-i.length,i.length=o,this.get(e),be(this),!0}const a=new yo(e,r,o,s,n);return a.length>this[ue]?(this[ne]&&this[ne](e,r),!1):(this[se]+=a.length,this[V].unshift(a),this[Z].set(e,this[V].head),be(this),!0)}has(e){if(!this[Z].has(e))return!1;const r=this[Z].get(e).value;return!Pe(this,r)}get(e){return We(this,e,!0)}peek(e){return We(this,e,!1)}pop(){const e=this[V].tail;return e?(ye(this,e),e.value):null}del(e){ye(this,this[Z].get(e))}load(e){this.reset();const r=Date.now();for(let n=e.length-1;n>=0;n--){const s=e[n],o=s.e||0;if(o===0)this.set(s.k,s.v);else{const a=o-r;a>0&&this.set(s.k,s.v,a)}}}prune(){this[Z].forEach((e,r)=>We(this,r,!1))}}const We=(t,e,r)=>{const n=t[Z].get(e);if(n){const s=n.value;if(Pe(t,s)){if(ye(t,n),!t[Ie])return}else r&&(t[mr]&&(n.value.now=Date.now()),t[V].unshiftNode(n));return s.value}},Pe=(t,e)=>{if(!e||!e.maxAge&&!t[le])return!1;const r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[le]&&r>t[le]},be=t=>{if(t[se]>t[ue])for(let e=t[V].tail;t[se]>t[ue]&&e!==null;){const r=e.prev;ye(t,e),e=r}},ye=(t,e)=>{if(e){const r=e.value;t[ne]&&t[ne](r.key,r.value),t[se]-=r.length,t[Z].delete(r.key),t[V].removeNode(e)}};class yo{constructor(e,r,n,s,o){this.key=e,this.value=r,this.length=n,this.now=s,this.maxAge=o||0}}const Nt=(t,e,r,n)=>{let s=r.value;Pe(t,s)&&(ye(t,r),t[Ie]||(s=void 0)),s&&e.call(n,s.value,s.key,t)};var wo=Eo,ze,Ct;function te(){if(Ct)return ze;Ct=1;class t{constructor(E,T){if(T=n(T),E instanceof t)return E.loose===!!T.loose&&E.includePrerelease===!!T.includePrerelease?E:new t(E.raw,T);if(E instanceof s)return this.raw=E.value,this.set=[[E]],this.format(),this;if(this.options=T,this.loose=!!T.loose,this.includePrerelease=!!T.includePrerelease,this.raw=E.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(I=>this.parseRange(I.trim())).filter(I=>I.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const I=this.set[0];if(this.set=this.set.filter(L=>!y(L[0])),this.set.length===0)this.set=[I];else if(this.set.length>1){for(const L of this.set)if(L.length===1&&_(L[0])){this.set=[L];break}}}this.format()}format(){return this.range=this.set.map(E=>E.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(E){const I=((this.options.includePrerelease&&x)|(this.options.loose&&v))+":"+E,L=r.get(I);if(L)return L;const $=this.options.loose,f=$?l[i.HYPHENRANGELOOSE]:l[i.HYPHENRANGE];E=E.replace(f,z(this.options.includePrerelease)),o("hyphen replace",E),E=E.replace(l[i.COMPARATORTRIM],u),o("comparator trim",E),E=E.replace(l[i.TILDETRIM],m),o("tilde trim",E),E=E.replace(l[i.CARETTRIM],c),o("caret trim",E);let d=E.split(" ").map(N=>P(N,this.options)).join(" ").split(/\s+/).map(N=>me(N,this.options));$&&(d=d.filter(N=>(o("loose invalid filter",N,this.options),!!N.match(l[i.COMPARATORLOOSE])))),o("range list",d);const g=new Map,b=d.map(N=>new s(N,this.options));for(const N of b){if(y(N))return[N];g.set(N.value,N)}g.size>1&&g.has("")&&g.delete("");const R=[...g.values()];return r.set(I,R),R}intersects(E,T){if(!(E instanceof t))throw new TypeError("a Range is required");return this.set.some(I=>k(I,T)&&E.set.some(L=>k(L,T)&&I.every($=>L.every(f=>$.intersects(f,T)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new a(E,this.options)}catch{return!1}for(let T=0;T<this.set.length;T++)if(ge(this.set[T],E,this.options))return!0;return!1}}ze=t;const e=wo,r=new e({max:1e3}),n=it,s=Me(),o=De,a=K,{safeRe:l,t:i,comparatorTrimReplace:u,tildeTrimReplace:m,caretTrimReplace:c}=de.exports,{FLAG_INCLUDE_PRERELEASE:x,FLAG_LOOSE:v}=Fe,y=S=>S.value==="<0.0.0-0",_=S=>S.value==="",k=(S,E)=>{let T=!0;const I=S.slice();let L=I.pop();for(;T&&I.length;)T=I.every($=>L.intersects($,E)),L=I.pop();return T},P=(S,E)=>(o("comp",S,E),S=O(S,E),o("caret",S),S=G(S,E),o("tildes",S),S=H(S,E),o("xrange",S),S=B(S,E),o("stars",S),S),C=S=>!S||S.toLowerCase()==="x"||S==="*",G=(S,E)=>S.trim().split(/\s+/).map(T=>F(T,E)).join(" "),F=(S,E)=>{const T=E.loose?l[i.TILDELOOSE]:l[i.TILDE];return S.replace(T,(I,L,$,f,d)=>{o("tilde",S,I,L,$,f,d);let g;return C(L)?g="":C($)?g=`>=${L}.0.0 <${+L+1}.0.0-0`:C(f)?g=`>=${L}.${$}.0 <${L}.${+$+1}.0-0`:d?(o("replaceTilde pr",d),g=`>=${L}.${$}.${f}-${d} <${L}.${+$+1}.0-0`):g=`>=${L}.${$}.${f} <${L}.${+$+1}.0-0`,o("tilde return",g),g})},O=(S,E)=>S.trim().split(/\s+/).map(T=>M(T,E)).join(" "),M=(S,E)=>{o("caret",S,E);const T=E.loose?l[i.CARETLOOSE]:l[i.CARET],I=E.includePrerelease?"-0":"";return S.replace(T,(L,$,f,d,g)=>{o("caret",S,L,$,f,d,g);let b;return C($)?b="":C(f)?b=`>=${$}.0.0${I} <${+$+1}.0.0-0`:C(d)?$==="0"?b=`>=${$}.${f}.0${I} <${$}.${+f+1}.0-0`:b=`>=${$}.${f}.0${I} <${+$+1}.0.0-0`:g?(o("replaceCaret pr",g),$==="0"?f==="0"?b=`>=${$}.${f}.${d}-${g} <${$}.${f}.${+d+1}-0`:b=`>=${$}.${f}.${d}-${g} <${$}.${+f+1}.0-0`:b=`>=${$}.${f}.${d}-${g} <${+$+1}.0.0-0`):(o("no pr"),$==="0"?f==="0"?b=`>=${$}.${f}.${d}${I} <${$}.${f}.${+d+1}-0`:b=`>=${$}.${f}.${d}${I} <${$}.${+f+1}.0-0`:b=`>=${$}.${f}.${d} <${+$+1}.0.0-0`),o("caret return",b),b})},H=(S,E)=>(o("replaceXRanges",S,E),S.split(/\s+/).map(T=>j(T,E)).join(" ")),j=(S,E)=>{S=S.trim();const T=E.loose?l[i.XRANGELOOSE]:l[i.XRANGE];return S.replace(T,(I,L,$,f,d,g)=>{o("xRange",S,I,L,$,f,d,g);const b=C($),R=b||C(f),N=R||C(d),U=N;return L==="="&&U&&(L=""),g=E.includePrerelease?"-0":"",b?L===">"||L==="<"?I="<0.0.0-0":I="*":L&&U?(R&&(f=0),d=0,L===">"?(L=">=",R?($=+$+1,f=0,d=0):(f=+f+1,d=0)):L==="<="&&(L="<",R?$=+$+1:f=+f+1),L==="<"&&(g="-0"),I=`${L+$}.${f}.${d}${g}`):R?I=`>=${$}.0.0${g} <${+$+1}.0.0-0`:N&&(I=`>=${$}.${f}.0${g} <${$}.${+f+1}.0-0`),o("xRange return",I),I})},B=(S,E)=>(o("replaceStars",S,E),S.trim().replace(l[i.STAR],"")),me=(S,E)=>(o("replaceGTE0",S,E),S.trim().replace(l[E.includePrerelease?i.GTE0PRE:i.GTE0],"")),z=S=>(E,T,I,L,$,f,d,g,b,R,N,U,X)=>(C(I)?T="":C(L)?T=`>=${I}.0.0${S?"-0":""}`:C($)?T=`>=${I}.${L}.0${S?"-0":""}`:f?T=`>=${T}`:T=`>=${T}${S?"-0":""}`,C(b)?g="":C(R)?g=`<${+b+1}.0.0-0`:C(N)?g=`<${b}.${+R+1}.0-0`:U?g=`<=${b}.${R}.${N}-${U}`:S?g=`<${b}.${R}.${+N+1}-0`:g=`<=${g}`,`${T} ${g}`.trim()),ge=(S,E,T)=>{for(let I=0;I<S.length;I++)if(!S[I].test(E))return!1;if(E.prerelease.length&&!T.includePrerelease){for(let I=0;I<S.length;I++)if(o(S[I].semver),S[I].semver!==s.ANY&&S[I].semver.prerelease.length>0){const L=S[I].semver;if(L.major===E.major&&L.minor===E.minor&&L.patch===E.patch)return!0}return!1}return!0};return ze}var Ye,At;function Me(){if(At)return Ye;At=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(m,c){if(c=r(c),m instanceof e){if(m.loose===!!c.loose)return m;m=m.value}m=m.trim().split(/\s+/).join(" "),a("comparator",m,c),this.options=c,this.loose=!!c.loose,this.parse(m),this.semver===t?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(m){const c=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],x=m.match(c);if(!x)throw new TypeError(`Invalid comparator: ${m}`);this.operator=x[1]!==void 0?x[1]:"",this.operator==="="&&(this.operator=""),x[2]?this.semver=new l(x[2],this.options.loose):this.semver=t}toString(){return this.value}test(m){if(a("Comparator.test",m,this.options.loose),this.semver===t||m===t)return!0;if(typeof m=="string")try{m=new l(m,this.options)}catch{return!1}return o(m,this.operator,this.semver,this.options)}intersects(m,c){if(!(m instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new i(m.value,c).test(this.value):m.operator===""?m.value===""?!0:new i(this.value,c).test(m.semver):(c=r(c),c.includePrerelease&&(this.value==="<0.0.0-0"||m.value==="<0.0.0-0")||!c.includePrerelease&&(this.value.startsWith("<0.0.0")||m.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&m.operator.startsWith(">")||this.operator.startsWith("<")&&m.operator.startsWith("<")||this.semver.version===m.semver.version&&this.operator.includes("=")&&m.operator.includes("=")||o(this.semver,"<",m.semver,c)&&this.operator.startsWith(">")&&m.operator.startsWith("<")||o(this.semver,">",m.semver,c)&&this.operator.startsWith("<")&&m.operator.startsWith(">")))}}Ye=e;const r=it,{safeRe:n,t:s}=de.exports,o=pr,a=De,l=K,i=te();return Ye}const xo=te(),So=(t,e,r)=>{try{e=new xo(e,r)}catch{return!1}return e.test(t)};var je=So;const Ro=te(),bo=(t,e)=>new Ro(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));var $o=bo;const Io=K,To=te(),Lo=(t,e,r)=>{let n=null,s=null,o=null;try{o=new To(e,r)}catch{return null}return t.forEach(a=>{o.test(a)&&(!n||s.compare(a)===-1)&&(n=a,s=new Io(n,r))}),n};var No=Lo;const Co=K,Ao=te(),ko=(t,e,r)=>{let n=null,s=null,o=null;try{o=new Ao(e,r)}catch{return null}return t.forEach(a=>{o.test(a)&&(!n||s.compare(a)===1)&&(n=a,s=new Co(n,r))}),n};var Oo=ko;const Qe=K,_o=te(),kt=Ge,Po=(t,e)=>{t=new _o(t,e);let r=new Qe("0.0.0");if(t.test(r)||(r=new Qe("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){const s=t.set[n];let o=null;s.forEach(a=>{const l=new Qe(a.semver.version);switch(a.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!o||kt(l,o))&&(o=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),o&&(!r||kt(r,o))&&(r=o)}return r&&t.test(r)?r:null};var Fo=Po;const Do=te(),Go=(t,e)=>{try{return new Do(t,e).range||"*"}catch{return null}};var Mo=Go;const jo=K,gr=Me(),{ANY:Uo}=gr,Vo=te(),Bo=je,Ot=Ge,_t=ct,Ho=lt,qo=ut,Xo=(t,e,r,n)=>{t=new jo(t,n),e=new Vo(e,n);let s,o,a,l,i;switch(r){case">":s=Ot,o=Ho,a=_t,l=">",i=">=";break;case"<":s=_t,o=qo,a=Ot,l="<",i="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Bo(t,e,n))return!1;for(let u=0;u<e.set.length;++u){const m=e.set[u];let c=null,x=null;if(m.forEach(v=>{v.semver===Uo&&(v=new gr(">=0.0.0")),c=c||v,x=x||v,s(v.semver,c.semver,n)?c=v:a(v.semver,x.semver,n)&&(x=v)}),c.operator===l||c.operator===i||(!x.operator||x.operator===l)&&o(t,x.semver))return!1;if(x.operator===i&&a(t,x.semver))return!1}return!0};var ht=Xo;const Ko=ht,Wo=(t,e,r)=>Ko(t,e,">",r);var zo=Wo;const Yo=ht,Qo=(t,e,r)=>Yo(t,e,"<",r);var Zo=Qo;const Pt=te(),Jo=(t,e,r)=>(t=new Pt(t,r),e=new Pt(e,r),t.intersects(e,r));var ei=Jo;const ti=je,ri=ee;var ni=(t,e,r)=>{const n=[];let s=null,o=null;const a=t.sort((m,c)=>ri(m,c,r));for(const m of a)ti(m,e,r)?(o=m,s||(s=m)):(o&&n.push([s,o]),o=null,s=null);s&&n.push([s,null]);const l=[];for(const[m,c]of n)m===c?l.push(m):!c&&m===a[0]?l.push("*"):c?m===a[0]?l.push(`<=${c}`):l.push(`${m} - ${c}`):l.push(`>=${m}`);const i=l.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return i.length<u.length?i:e};const Ft=te(),ft=Me(),{ANY:Ze}=ft,$e=je,dt=ee,si=(t,e,r={})=>{if(t===e)return!0;t=new Ft(t,r),e=new Ft(e,r);let n=!1;e:for(const s of t.set){for(const o of e.set){const a=ii(s,o,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},oi=[new ft(">=0.0.0-0")],Dt=[new ft(">=0.0.0")],ii=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Ze){if(e.length===1&&e[0].semver===Ze)return!0;r.includePrerelease?t=oi:t=Dt}if(e.length===1&&e[0].semver===Ze){if(r.includePrerelease)return!0;e=Dt}const n=new Set;let s,o;for(const v of t)v.operator===">"||v.operator===">="?s=Gt(s,v,r):v.operator==="<"||v.operator==="<="?o=Mt(o,v,r):n.add(v.semver);if(n.size>1)return null;let a;if(s&&o){if(a=dt(s.semver,o.semver,r),a>0)return null;if(a===0&&(s.operator!==">="||o.operator!=="<="))return null}for(const v of n){if(s&&!$e(v,String(s),r)||o&&!$e(v,String(o),r))return null;for(const y of e)if(!$e(v,String(y),r))return!1;return!0}let l,i,u,m,c=o&&!r.includePrerelease&&o.semver.prerelease.length?o.semver:!1,x=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1;c&&c.prerelease.length===1&&o.operator==="<"&&c.prerelease[0]===0&&(c=!1);for(const v of e){if(m=m||v.operator===">"||v.operator===">=",u=u||v.operator==="<"||v.operator==="<=",s){if(x&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===x.major&&v.semver.minor===x.minor&&v.semver.patch===x.patch&&(x=!1),v.operator===">"||v.operator===">="){if(l=Gt(s,v,r),l===v&&l!==s)return!1}else if(s.operator===">="&&!$e(s.semver,String(v),r))return!1}if(o){if(c&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===c.major&&v.semver.minor===c.minor&&v.semver.patch===c.patch&&(c=!1),v.operator==="<"||v.operator==="<="){if(i=Mt(o,v,r),i===v&&i!==o)return!1}else if(o.operator==="<="&&!$e(o.semver,String(v),r))return!1}if(!v.operator&&(o||s)&&a!==0)return!1}return!(s&&u&&!o&&a!==0||o&&m&&!s&&a!==0||x||c)},Gt=(t,e,r)=>{if(!t)return e;const n=dt(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},Mt=(t,e,r)=>{if(!t)return e;const n=dt(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};var ai=si;const Je=de.exports,jt=Fe,ci=K,Ut=hr,ui=Se,li=cs,hi=hs,fi=ds,di=ms,pi=Es,mi=xs,gi=bs,vi=Ts,Ei=ee,yi=As,wi=_s,xi=at,Si=Gs,Ri=Us,bi=Ge,$i=ct,Ii=fr,Ti=dr,Li=ut,Ni=lt,Ci=pr,Ai=lo,ki=Me(),Oi=te(),_i=je,Pi=$o,Fi=No,Di=Oo,Gi=Fo,Mi=Mo,ji=ht,Ui=zo,Vi=Zo,Bi=ei,Hi=ni,qi=ai;var Xi={parse:ui,valid:li,clean:hi,inc:fi,diff:di,major:pi,minor:mi,patch:gi,prerelease:vi,compare:Ei,rcompare:yi,compareLoose:wi,compareBuild:xi,sort:Si,rsort:Ri,gt:bi,lt:$i,eq:Ii,neq:Ti,gte:Li,lte:Ni,cmp:Ci,coerce:Ai,Comparator:ki,Range:Oi,satisfies:_i,toComparators:Pi,maxSatisfying:Fi,minSatisfying:Di,minVersion:Gi,validRange:Mi,outside:ji,gtr:Ui,ltr:Vi,intersects:Bi,simplifyRange:Hi,subset:qi,SemVer:ci,re:Je.re,src:Je.src,tokens:Je.t,SEMVER_SPEC_VERSION:jt.SEMVER_SPEC_VERSION,RELEASE_TYPES:jt.RELEASE_TYPES,compareIdentifiers:Ut.compareIdentifiers,rcompareIdentifiers:Ut.rcompareIdentifiers};const Ki=()=>A("div",{children:[h("p",{children:"Thanks for using Voice Control for ChatGPT!"}),h("p",{children:`\u{1F504} We've given the extension a complete makeover to make it more
      user-friendly and compact.`}),h("p",{children:`\u{1F399}\uFE0F You can still use it the way you always have, just press and hold the
      space bar to talk.`}),h("p",{children:`\u{1F4A1} We're eager to hear your thoughts on the changes and any ideas for
      further improvement. You can find a feedback button in the settings menu
      (three vertical dots).`}),h("p",{children:`\u{1F680} Stay tuned for more updates in the pipeline that we can't wait to share
      with you over the coming weeks. We hope you enjoy the new and improved
      Voice Control for ChatGPT!`})]}),Wi=()=>A("div",{children:[h("p",{children:"Dear Voice Control Users,"}),h("p",{children:"We've been hard at work improving the Voice Control extension, and we're thrilled to present our latest update. A heartfelt thank you to everyone who provided valuable feedback; your insights have been crucial in helping us make these improvements."}),h("p",{children:"\u{1F44B} If you are new to Voice Control, welcome aboard! If you've been with us for a while, you might notice some changes\u2014here's what's new:"}),h("p",{children:"\u{1F504} The extension has undergone a comprehensive redesign to enhance its user-friendliness and offer a more compact interface."}),h("p",{children:"\u{1F399}\uFE0F Good news! Your favorite voice command feature remains unchanged\u2014simply press and hold the space bar to speak."}),h("p",{children:"\u{1F527} For those who faced issues with the previous update, we apologize for the inconvenience. We've fixed all known bugs in this release. If you encounter further issues, please don't hesitate to reach out to us at support@voicecontrol.chat or use the feedback form accessible via the settings menu."}),h("p",{children:"We hope you enjoy using the new and improved Voice Control for ChatGPT!"}),h("p",{children:"Warm regards,"}),h("p",{children:"The Voice Control Team"})]});function zi(){const{settings:t,setSettings:e}=p.exports.useContext(J),[r,n]=p.exports.useState(null),[s,o]=p.exports.useState(""),a=()=>{setTimeout(()=>{const l=document.querySelector("[role=dialog]:not(.vc-modal) button");l&&(l.click(),w.info("Clicked start modal button"))},1e3)};return p.exports.useEffect(()=>{fetch(chrome.runtime.getURL("/manifest.json")).then(l=>l.json()).then(l=>{const i=l.version,u=t.version;if(w.info(`Settings version: ${t.version}. Manifest version: ${i}`),e({...t,version:i}),Xi.gt(i,u))switch(o("Voice Control Was Updated \u{1F389}"),i){case"3.0.0":case"3.0.1":n(Ki);break;case"3.0.2":a(),n(Wi);break;default:w.info(`No template for version v${i}`)}else w.info(`User already saw template for v${i}`)})},[]),A(ot,{title:s,open:!!r,onClose:()=>n(null),children:[h("div",{className:"vc-rich-text",children:r}),h("div",{className:"flex justify-end",children:h("button",{className:"btn relative btn-primary",onClick:()=>n(null),children:h("div",{className:"flex w-full gap-2 items-center justify-center",children:"Okay, let\u2019s go"})})})]})}class Yi extends p.exports.Component{constructor(){super(...arguments);re(this,"state",{hasError:!1})}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,n){w.error("Uncaught error:",{...r,...n});const s=(r==null?void 0:r.message)||"Unknown error",o=(n==null?void 0:n.componentStack)||"Unknown stack";this.props.onCatch(s,o)}render(){return this.props.children}}function Qi(){const t=p.exports.useContext(Le),{settings:e}=p.exports.useContext(J),[r,n]=p.exports.useState([]),[s,o]=p.exports.useState([]),a=p.exports.useRef(!1);Bn(),p.exports.useEffect(()=>{const i=()=>{const u=document.getElementById(et),m=document.querySelector(Te),c=document.querySelector(Ir),x=document.querySelectorAll(`#${Ht}`);if(!u&&m){const v=mt(),y=document.createElement("div");y.id=et,y.dataset.vcUuid=v,m.after(y),o(_=>[..._,v])}Lr((v,y)=>{const _=mt(),k=document.createElement("span");k.classList.add(nt),k.dataset.vcUuid=_,k.dataset.index=y.toString(),v.appendChild(k),n(P=>[...P,_])}),!a.current&&(x.length>1||c)&&(a.current=!0,cr({type:"error",message:`
            Looks like you have several versions of Voice Control installed. 
            Please make sure to only have one version installed.
          `}))};return t==null||t.addCallback(i),()=>{t==null||t.removeCallback(i)}},[]),p.exports.useEffect(()=>{var i;q({name:"page_view",params:{page_title:document.title,page_location:document.location.href}}),q({name:"settings-voice",params:{voice:(i=Ne(e))!=null?i:"default"}}),q({name:"settings-language",params:{language:e.language}})},[]);const l=(i,u)=>{q({name:"error",params:{errorMessage:i,errorStack:u}})};return p.exports.useEffect(()=>{chrome.runtime.onMessage.addListener((i,u,m)=>(i.key===wr&&m({value:"yes-we-are-here"}),!0))},[]),A(Yi,{onCatch:l,children:[h(qn,{}),h(zi,{}),r.map(i=>h(Hr,{uuid:i,onRemoveItem:u=>{n(m=>m.filter(c=>c!==u))}},i)),s.map(i=>h(jn,{uuid:i,onRemoveItem:u=>{o(m=>m.filter(c=>c!==u))}},i))]})}function Zi(t){let e="";switch(t){case"speech-recognition-not-supported":e="Speech recognition not supported in this browser";break;case"no-microphone-sound":e="No sound from the microphone";break;case"mic-denied":e="Microphone access denied";break;case"no-network":e="Unable to contact speech recognition server";break;case"unknown-error":default:e="Unknown error";break}cr({type:"error",message:e})}function Ji(t){const e=Pr(),r=Zr(e,Zi),n=Tr(),s=Mr(e,n);return he("ctrl+shift+l",()=>{const o=window.localStorage.getItem("vc-log")==="true";window.localStorage.setItem("vc-log",o?"false":"true"),console.log("toggle vc-log on:",!o)}),h("div",{children:h(Le.Provider,{value:n,children:h(J.Provider,{value:e,children:h(Zt.Provider,{value:r,children:h(xe.Provider,{value:s,children:t.children})})})})})}let Vt=!1;var Bt;(Bt=window.speechSynthesis)==null||Bt.getVoices();w.setup();function ea(){var e,r;if(document.querySelector(Te)&&!Vt){w.info("Insert InBody component"),vr.disconnect(),Vt=!0,(e=window.speechSynthesis)==null||e.getVoices(),(r=window.speechSynthesis)==null||r.cancel();const n=document.createElement("div");n.id=Ht,document.body.appendChild(n),rt.render(h(Ji,{children:h(Qi,{})}),n)}}const vr=new MutationObserver(ea),ta={childList:!0,subtree:!0,characterData:!0};vr.observe(document.body,ta);
