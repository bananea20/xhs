!function(n,t){"use strict";var r=t.ArrayUtils,i=t.CollectionUtils,e=t.StringUtils;n.ShortcutsLookupTable=function(t){if(this.lookupTable=Object.create(null),t)for(var e=0;e<t.length;e++)this.addRule(t[e])},n.ShortcutsLookupTable.prototype={addRule:function(t){var e=this._getRuleShortcut(t);if(!e||"http:/"==e||"https:"==e)return!1;if(e in this.lookupTable){var l=this.lookupTable[e];if(r.isArray(l)){for(var o=!0,u=0;u<l.length;u++)if(l[u].ruleText===t.ruleText&&l[u].filterId!==t.filterId){o=!(l[u].filterId=[l[u].filterId,t.filterId]),t=Object.create(null);break}o&&l.push(t)}else this.lookupTable[e]=[l,t]}else this.lookupTable[e]=t;return!0},removeRule:function(t){var e=this._getRuleShortcut(t);if(e&&e in this.lookupTable){var l=this.lookupTable[e];r.isArray(l)?(i.removeRule(l,t),0==l.length&&delete this.lookupTable[e]):delete this.lookupTable[e]}},clearRules:function(){this.lookupTable=Object.create(null)},lookupRules:function(t){for(var e=[],l=0;l<=t.length-n.ShortcutsLookupTable.SHORTCUT_LENGTH;l++){var o=t.substring(l,l+n.ShortcutsLookupTable.SHORTCUT_LENGTH),u=this.lookupTable[o];u&&(r.isArray(u)?e=e.concat(u):e.push(u))}return e},getRules:function(){var t=[];for(var e in this.lookupTable){var l=this.lookupTable[e];l&&(r.isArray(l)?t=t.concat(l):t.push(l))}return t},_getRuleShortcut:function(t){return e.isEmpty(t.shortcut)||t.shortcut.length<n.ShortcutsLookupTable.SHORTCUT_LENGTH?null:t.shortcut.substring(t.shortcut.length-n.ShortcutsLookupTable.SHORTCUT_LENGTH)}},n.ShortcutsLookupTable.SHORTCUT_LENGTH=6,n.DomainsLookupTable=function(t){if(this.lookupTable=Object.create(null),t)for(var e=0;e<t.length;e++)this.addRule(t[e])},n.DomainsLookupTable.prototype={addRule:function(t){var e=t.getPermittedDomains();if(!e||0===e.length)return!1;for(var l=0;l<e.length;l++){var o=e[l],u=this.lookupTable[o];u||(u=[],this.lookupTable[o]=u),u.push(t)}return!0},removeRule:function(t){var e=t.getPermittedDomains();if(e&&0!==e.length)for(var l=0;l<e.length;l++){var o=e[l],u=this.lookupTable[o];u&&(i.removeRule(u,t),0===u.length&&delete this.lookupTable[o])}},clearRules:function(){this.lookupTable=Object.create(null)},lookupRules:function(t){if(!t)return null;var e=t.split(".");if(0===e.length)return null;for(var l=null,o=e[e.length-1],u=e.length-2;0<=u;u--){o=e[u]+"."+o;var r=this.lookupTable[o];r&&0<r.length&&(null===l&&(l=[]),l=l.concat(r))}return l},getRules:function(){var t=[];for(var e in this.lookupTable){var l=this.lookupTable[e];l&&(i.isArray(l)?t=t.concat(l):t.push(l))}return t}},n.UrlFilterRuleLookupTable=function(){this.shortcutsLookupTable=new n.ShortcutsLookupTable,this.domainsLookupTable=new n.DomainsLookupTable,this.rulesWithoutShortcuts=[]},n.UrlFilterRuleLookupTable.prototype={addRule:function(t){this.shortcutsLookupTable.addRule(t)||this.domainsLookupTable.addRule(t)||this.rulesWithoutShortcuts.push(t)},removeRule:function(t){this.shortcutsLookupTable.removeRule(t),this.domainsLookupTable.removeRule(t),i.removeRule(this.rulesWithoutShortcuts,t)},clearRules:function(){this.shortcutsLookupTable.clearRules(),this.domainsLookupTable.clearRules(),this.rulesWithoutShortcuts=[]},getRules:function(){var t=[];return t=(t=(t=t.concat(this.rulesWithoutShortcuts)).concat(this.shortcutsLookupTable.getRules())).concat(this.domainsLookupTable.getRules())},_isFiltered:function(t,e,l,o,u,r){var i=t.isPermitted(e),s=(o||t.isGeneric(),t.isFiltered(l,u,r));return i&&s},_findRule:function(t,e,l,o,u,r){var i,s;if(n.UrlFilterRule.contentTypes[u]===n.UrlFilterRule.contentTypes.DOCUMENT)for(s=0;s<l.length;s++)if(i=l[s],0<(n.UrlFilterRule.contentTypes.DOCUMENT_LEVEL_EXCEPTIONS&i.permittedContentType)&&!yiclear.antiBannerService.requestFilter.passFilter.isPass(e,i.filterId)&&this._isFiltered(i,e,t,r,o,"DOCUMENT_LEVEL_EXCEPTIONS"))return i;for(s=0;s<l.length;s++)if(i=l[s],!yiclear.antiBannerService.requestFilter.passFilter.isPass(e,i.filterId)&&this._isFiltered(i,e,t,r,o,u))return i;return null},findRule:function(t,e,l,o,u){if(!t)return null;var r,i=t.toLowerCase(),s=this.shortcutsLookupTable.lookupRules(i);return s&&0<s.length&&(r=this._findRule(t,e,s,l,o,u))?r:(s=this.domainsLookupTable.lookupRules(e))&&0<s.length&&(r=this._findRule(t,e,s,l,o,u))?r:0<this.rulesWithoutShortcuts.length&&(r=this._findRule(t,e,this.rulesWithoutShortcuts,l,o,u))?r:null}}}(yiclearAPI,vAPI);