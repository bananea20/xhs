import{a as T}from"./AZMC6STA.js";import{a as m}from"./MM6H3LLZ.js";import{h as i}from"./WUMYY75E.js";import{a as u}from"./42TZCCKB.js";import{f as p}from"./UTGLRY7A.js";var n=p(u());var o="USECHATGPT_AUTH_INFO_STORAGE_KEY_20230829";var a=p(m());var E={GET_USER_INFO:"/user/get_user_info",TWITTER_SHARE_COMPLETE:"/user/twitter_share_complete",TWITTER_FOLLOWING_COMPLETE:"/user/twitter_following_complete",GET_REFERRAL_DASHBOARD:"/user/get_referral_dashboard",SAVE_TWITTER_SCREEN_NAME:"/user/save_twitter_screen_name",GET_TWITTER_REFERRAL_TASKS_STATUS:"/user/get_twitter_referral_tasks_status",GET_USER_SUBSCRIPTION_INFO:"/user/get_user_subscription_info"},S={GET_FAVOURITE_PROMPTS:"/prompt/get_favourite_prompts",GET_OWN_PROMPTS:"/prompt/get_own_prompts",SEARCH_PROMPT:"/prompt/search_prompt",GET_PROMPT_DETAIL:"/prompt/get_prompt_detail",GET_PRIVATE_PROMPT_DETAIL:"/prompt/get_private_prompt_detail",PROMPT_CATEGORY:"/prompt/category",ADD_PROMPT:"/prompt/add_own_prompt",ADD_FAVOURITE_PROMPT:"/prompt/add_favourite_prompt",REMOVE_FAVOURITE_PROMPT:"/prompt/remove_favourite_prompt",DELETE_PROMPT:"/prompt/remove_own_prompt",EDIT_OWN_PROMPT:"/prompt/update_own_prompt"};var w=()=>{try{let e=window.localStorage.getItem("UseChatGPTAuthServiceProvider.email"),t=`UseChatGPTAuthServiceProvider.${e}`,r=window.localStorage.getItem(t+".accessToken"),s=window.localStorage.getItem(t+".refreshToken");return s?{accessToken:r,refreshToken:s,email:e}:null}catch{return null}},R=async()=>{let e=await n.default.storage.local.get(o);return e[o]?e[o]?.refreshToken:""},G=async()=>{let e=await n.default.storage.local.get(o);return e[o]?e[o]?.userInfo:null},y=async()=>(await new T({runtime:"client"}).postMessage({event:"Client_logoutUseChatGPTAuth"})).success,C=()=>{try{let e=document.querySelector("#__NEXT_DATA__");return e&&JSON.parse(e.innerText)?.props?.pageProps?.user?.email||""}catch{return""}},_="LOGIN_STUCK_STORAGE_KEY",f=async e=>{let t=await l()??{};await n.default.storage.local.set({[_]:{...t,...e}})},l=async()=>(await n.default.storage.local.get(_)??{})[_]??{},N=async()=>{let e=await l(),t=(0,a.default)().format("YYYY-MM-DD"),r=e[t]??0;await f({[t]:r+1})},D=async()=>{try{let e=await R();if(!e)return;let t=await fetch(`${i}${E.GET_USER_SUBSCRIPTION_INFO}`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let r=await t.json();if(r.status==="OK"&&r.data)return r.data}return}catch{return}},L=e=>{let t=e?.roles[0].name||"free";e?.roles?.length&&e.roles.find(c=>c.name==="pro")&&(t="pro");let r=!1;if(e?.chatgpt_expires_at&&t==="free"&&new Date(e.chatgpt_expires_at).getTime()>new Date().getTime()&&(t="pro_gift"),t==="free"&&e?.created_at){let s=(0,a.default)(e?.created_at);(0,a.default)().utc().diff(s,"day")<=-1e5&&(t="new_user",r=!0)}return t};export{o as a,S as b,w as c,R as d,G as e,y as f,C as g,l as h,N as i,D as j,L as k};
